
"use strict";var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.TickProcessSystem=void 0;const Log_1=require("../Common/Log"),TickSystem_1=require("./TickSystem");class TickProcess{constructor(){this.Id=0,this.IAa=void 0,this.KKa=0,this.bnr=0,this.$Ka=0,this.XKa=8,this.YKa=void 0,this.Id=++TickProcess.o6}get Group(){return this.XKa}Init(s,i,t,e=0,c=void 0){this.IAa=new WeakRef(s),this.XKa=i,this.KKa=t,this.bnr=e,this.$Ka=0,this.YKa=c}Tick(s){var i=this.IAa?.deref();return i?(i(s),0===this.KKa||1===this.KKa&&(this.$Ka+=s,this.$Ka>=this.bnr)):(2===this.KKa&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("Tick",36,"[TickProcessSystem] Callback Invalid. 可能存在ForeverCallback未及时注销的情况",["CreateReason",this.YKa]),!0)}}TickProcess.o6=0;class TickProcessSystem{static zKa(i,t){if(!this.JKa.has(i)){let s=void 0;switch(i){case 0:s=TickSystem_1.TickSystem.Add(this.ZKa,"TickProcess_PrePhysics",i,t);break;case 1:s=TickSystem_1.TickSystem.Add(this.e$a,"TickProcess_StartPhysics",i,t);break;case 2:s=TickSystem_1.TickSystem.Add(this.t$a,"TickProcess_DuringPhysics",i,t);break;case 3:s=TickSystem_1.TickSystem.Add(this.i$a,"TickProcess_EndPhysics",i,t);break;case 4:s=TickSystem_1.TickSystem.Add(this.r$a,"TickProcess_PostPhysics",i,t);break;case 5:s=TickSystem_1.TickSystem.Add(this.o$a,"TickProcess_PostUpdateWork",i,t);break;case 6:s=TickSystem_1.TickSystem.Add(this.n$a,"TickProcess_LastDemotable",i,t);break;case 7:s=TickSystem_1.TickSystem.Add(this.s$a,"TickProcess_NewlySpawned",i,t)}s&&this.JKa.set(i,s)}}static a$a(s){var i;this.JKa.has(s)&&(i=this.JKa.get(s))&&(this.JKa.delete(s),TickSystem_1.TickSystem.Remove(i?.Id))}static r6(s,i){if(this.h$a.has(i)){i=this.h$a.get(i);if(!(i.size<1)){for(const t of i)t.Tick(s)&&this.l$a.add(t.Id);if(0<this.l$a.size){for(const e of this.l$a)this.UnregisterTickProcess(e);this.l$a.clear()}}}}static Initialize(){this.JKa.clear(),this.l$a.clear(),this.h$a.clear(),this._$a.clear()}static RegisterTickProcess(s,i,t,e){this.h$a.has(s)||(this.h$a.set(s,new Set),this.zKa(s,i));i=new TickProcess;return i.Init(t,s,2,0,e),this.h$a.get(s)?.add(i),this._$a.set(i.Id,i),i.Id}static RegisterOnceTickProcess(s,i,t){this.h$a.has(s)||(this.h$a.set(s,new Set),this.zKa(s,i));i=new TickProcess;return i.Init(t,s,0),this.h$a.get(s)?.add(i),this._$a.set(i.Id,i),i.Id}static RegisterDelayTickProcess(s,i,t,e){this.h$a.has(s)||(this.h$a.set(s,new Set),this.zKa(s,i));i=new TickProcess;return i.Init(t,s,1,e),this.h$a.get(s)?.add(i),this._$a.set(i.Id,i),i.Id}static UnregisterTickProcess(s){var i;this._$a.has(s)&&(i=this._$a.get(s))&&(this._$a.delete(s),s=i.Group,s=this.h$a.get(s))&&s.delete(i)}static Clear(){for(const s of this.h$a.keys())this.a$a(s);this._$a.clear(),this.h$a.clear(),this.l$a.clear()}}exports.TickProcessSystem=TickProcessSystem,(_a=TickProcessSystem).ZKa=s=>{_a.r6(s,0)},TickProcessSystem.e$a=s=>{_a.r6(s,1)},TickProcessSystem.t$a=s=>{_a.r6(s,2)},TickProcessSystem.i$a=s=>{_a.r6(s,3)},TickProcessSystem.r$a=s=>{_a.r6(s,4)},TickProcessSystem.o$a=s=>{_a.r6(s,5)},TickProcessSystem.n$a=s=>{_a.r6(s,6)},TickProcessSystem.s$a=s=>{_a.r6(s,7)},TickProcessSystem.JKa=new Map,TickProcessSystem.l$a=new Set,TickProcessSystem.h$a=new Map,TickProcessSystem._$a=new Map;
//# sourceMappingURL=TickProcessSystem.js.map