
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const UE=require("ue"),FormationPropertyAll_1=require("../../Core/Define/ConfigQuery/FormationPropertyAll"),PassiveSkillById_1=require("../../Core/Define/ConfigQuery/PassiveSkillById"),EntitySystem_1=require("../../Core/Entity/EntitySystem"),RegisterComponent_1=require("../../Core/Entity/RegisterComponent"),GameplayTagUtils_1=require("../../Core/Utils/GameplayTagUtils"),EventDefine_1=require("../Common/Event/EventDefine"),EventSystem_1=require("../Common/Event/EventSystem"),FormationAttributeController_1=require("../Module/Abilities/FormationAttributeController"),CharacterAttributeTypes_1=require("../NewWorld/Character/Common/Component/Abilities/CharacterAttributeTypes"),CharacterPassiveSkillComponent_1=require("../NewWorld/Character/Common/Component/Abilities/CharacterPassiveSkillComponent"),CharacterTagContainer_1=require("../NewWorld/Character/Common/Component/Abilities/CharacterTagContainer"),TriggerType_1=require("../NewWorld/Character/Common/Component/Abilities/Trigger/TriggerType"),CombatDebugController_1=require("./CombatDebugController"),CombatDebugDrawController_1=require("./CombatDebugDrawController"),CombatLog_1=require("./CombatLog");class CombatDebugBlueprintFunctionLibrary extends UE.BlueprintFunctionLibrary{static AddPassiveSkillForDebug(t,e){t=EntitySystem_1.EntitySystem.GetComponent(t,23);t?.Valid&&t.LearnPassiveSkill(e,{CombatMessageId:-1n})}static RemovePassiveSkillForDebug(t,e){t=EntitySystem_1.EntitySystem.GetComponent(t,23);t?.Valid&&t.ForgetPassiveSkill(e)}static GetDebugMonsterMovePath(){return CombatDebugDrawController_1.CombatDebugDrawController.DebugMonsterMovePath}static SetDebugMonsterMovePath(t){CombatDebugDrawController_1.CombatDebugDrawController.DebugMonsterMovePath=t}static GetDebugMonsterControl(){return CombatDebugDrawController_1.CombatDebugDrawController.DebugMonsterControl}static SetDebugMonsterControl(t){CombatDebugDrawController_1.CombatDebugDrawController.DebugMonsterControl=t}static OpenMonsterServerLogic(t){t="CloseMonsterServerLogic#"+(t?0:1);EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.RunGm,t)}static IsDrawEntityBoxEnabled(){return CombatDebugDrawController_1.CombatDebugDrawController.IsDrawEntityBoxEnabled??!1}static SetDrawEntityBoxEnabled(t){CombatDebugDrawController_1.CombatDebugDrawController.IsDrawEntityBoxEnabled=t}static IsDrawEntityBoxInfoEnabled(){return CombatDebugDrawController_1.CombatDebugDrawController.IsDrawEntityBoxInfoEnabled??!1}static SetDrawEntityBoxInfoEnabled(t){CombatDebugDrawController_1.CombatDebugDrawController.IsDrawEntityBoxInfoEnabled=t}static GetCombatScriptIndexes(){return CombatDebugController_1.CombatDebugController.ScriptHelper.CombatScriptIndexes}static FilterScript(t){return CombatDebugController_1.CombatDebugController.FilterCmd(t)}static IsDebugPrintOpened(t){return CombatLog_1.CombatLog.DebugCombatInfo.has(t)}static SetDebugPrintOpened(t,e){e?CombatLog_1.CombatLog.DebugCombatInfo.add(t):CombatLog_1.CombatLog.DebugCombatInfo.delete(t)}static TryRefreshServerDebugInfo(){CombatDebugController_1.CombatDebugController.RefreshServerDebugInfo()}static GetServerBuffRemainDuration(t,e){return(EntitySystem_1.EntitySystem.Get(t)?.GetComponent(20))?.GetServerBuffRemainDuration(e)??-1}static GetServerBuffTotalDuration(t,e){return(EntitySystem_1.EntitySystem.Get(t)?.GetComponent(20))?.GetServerBuffTotalDuration(e)??-1}static GetDebugBuff(t,e){var t=EntitySystem_1.EntitySystem.Get(t)?.GetComponent(194),r=t?.GetBuffByHandle(e);return r||(!r&&(0,RegisterComponent_1.isComponentInstance)(t,175)?t.GetFormationBuffComp().GetBuffByHandle(e):void 0)}static GetBuffRemainDuration(t,e){return CombatDebugBlueprintFunctionLibrary.GetDebugBuff(t,e)?.GetRemainDuration()??-1}static GetBuffTotalDuration(t,e){return CombatDebugBlueprintFunctionLibrary.GetDebugBuff(t,e)?.Duration??-1}static GetAttributeDebugString(t){var e=EntitySystem_1.EntitySystem.GetComponent(t,20),r=EntitySystem_1.EntitySystem.GetComponent(t,159);if(!e||!r)return"";var a=new Set(CharacterAttributeTypes_1.attributeIdsWithMax.values()),n=new Set(CharacterAttributeTypes_1.attrsAutoRecoverSpeedMap.values()),o=new Set(CharacterAttributeTypes_1.attrsAutoRecoverMaxMap.values());let i="";const s=e.iGr?.GSs;var u=new Array(CharacterAttributeTypes_1.ATTRIBUTE_ID_MAX);if(s)for(const y of s)u[y.tSs]=y;for(let t=1;t<CharacterAttributeTypes_1.ATTRIBUTE_ID_MAX;t++)if(!(CharacterAttributeTypes_1.attributeIdsWithMax.has(t)||a.has(t)||CharacterAttributeTypes_1.attrsAutoRecoverSpeedMap.has(t)||n.has(t)||o.has(t))){var[l,C]=[r.GetBaseValue(t),r.GetCurrentValue(t)],b=C.toFixed(0),C=C===l?"":(l<C?"(+":"(")+(C-l).toFixed(0)+")";const s=u[t];var[l,c]=[s?.eSs??0,s?.y6n??0],m=c.toFixed(0),c=c===l?"":(l<c?"(+":"(")+(c-l).toFixed(0)+")";i+=`#${t} undefined C:${b}${C} | S:${m}${c}
`}return i.trim()}static GetStateAttributeDebugString(t){var e=EntitySystem_1.EntitySystem.GetComponent(t,20),r=EntitySystem_1.EntitySystem.GetComponent(t,159);if(!e||!r)return"";let a="";const n=e.iGr?.GSs;var o=new Array(CharacterAttributeTypes_1.ATTRIBUTE_ID_MAX);if(n)for(const c of n)o[c.tSs]=c;for(let t=1;t<CharacterAttributeTypes_1.ATTRIBUTE_ID_MAX;t++)if(CharacterAttributeTypes_1.attributeIdsWithMax.has(t)||CharacterAttributeTypes_1.attrsAutoRecoverSpeedMap.has(t)){var i=r.GetBaseValue(t).toFixed(0);const n=o[t];var s,u,l,C,b=(n?.eSs??0).toFixed(0);CharacterAttributeTypes_1.attrsAutoRecoverSpeedMap.has(t)?(s=CharacterAttributeTypes_1.attrsAutoRecoverSpeedMap.get(t)??0,C=CharacterAttributeTypes_1.attrsAutoRecoverMaxMap.get(t)??0,u=r.GetCurrentValue(C).toFixed(0),C=(o[C]?.y6n??0).toFixed(0),l=r.GetCurrentValue(s).toFixed(0),s=(o[s]?.y6n??0).toFixed(0),a+=`#${t} undefined C:${i}/${u} (${l}/s) | S:${b}/${C} (${s}/s)
`):CharacterAttributeTypes_1.attributeIdsWithMax.has(t)&&(u=CharacterAttributeTypes_1.attributeIdsWithMax.get(t)??0,l=r.GetCurrentValue(u).toFixed(0),C=(o[u]?.y6n??0).toFixed(0),a+=`#${t} undefined C:${i}/${l} | S:${b}/${C}
`)}return a.trim()}static GetFormationAttributeDebugString(t){t=EntitySystem_1.EntitySystem.GetComponent(t,20);if(!t)return"";let e="";var t=t.iGr?.M6n,r=new Array;if(t)for(const C of t)r[C.E6n]=C;for(const b of FormationPropertyAll_1.configFormationPropertyAll.GetConfigList()){var a=b.Id,n=FormationAttributeController_1.FormationAttributeController.GetValue(a),o=FormationAttributeController_1.FormationAttributeController.GetMax(a),i=FormationAttributeController_1.FormationAttributeController.GetSpeed(a),s=r[a],u=s?.y6n.toFixed(0)??"???",l=s?.I6n.toFixed(0)??"???",s=s?.L6n.toFixed(0)??"???";e+=`#${a} C:${n?.toFixed(0)}/${o?.toFixed(0)} (${i?.toFixed(0)}/s)`+` | S:${u}/${l} (${s}/s)
`}return e.trim()}static GetPassiveDebugString(t){var e=EntitySystem_1.EntitySystem.GetComponent(t,23),r=EntitySystem_1.EntitySystem.GetComponent(t,25);if(!e)return"";let a="";for(const s of e.GetAllPassiveSkills()){r?.GetTrigger(s.TriggerHandle);var n=PassiveSkillById_1.configPassiveSkillById.GetConfig(s.SkillId),o=e.BOr?.GetPassiveSkillCdInfo(s.SkillId)?.CurRemainingCd;a=(a=(a=(a+=`技能: ${s.SkillId} handle: ${s.TriggerHandle} CD:${o?.toFixed(2)}
`)+`说明: ${n.SkillDesc}
`)+`触发器类型: ${n.TriggerType}${void 0!==TriggerType_1.ETriggerEvent[n.TriggerType]?"":"(非法类型)"}
`+`触发时机: undefined
`)+`条件公式: undefined
`+"触发行为:\n";for(const u of s.Actions){var i=u.Action;switch(i){case CharacterPassiveSkillComponent_1.ESkillAction.AddBullet:a+=`    添加子弹 ${u.BulletRowNames.join("、")}
`;break;case CharacterPassiveSkillComponent_1.ESkillAction.RemoveBullet:a+=`    移除子弹 ${u.BulletRowNames.map((t,e)=>`${t}(${u.SummonChild?"创建子子弹":"不创建子子弹"})`).join("、")}
`;break;case CharacterPassiveSkillComponent_1.ESkillAction.AddBuff:a+=`    添加Buff ${u.BuffId.join("、")}
`;break;case CharacterPassiveSkillComponent_1.ESkillAction.RemoveBuff:a+=`    移除Buff ${u.BuffId.map((t,e)=>""+t+(u.StackCount[e]<=0?"":`(移除${u.StackCount[e]}层)`)).join("、")}
`;break;case CharacterPassiveSkillComponent_1.ESkillAction.StartSkill:a+=`    触发主动技能 ${u.SkillId}
`;break;default:a+=`    未知行为 ${i}
`}}a+="\n\n"}return a.trim()}static GetTagsDebugString(t){const o=EntitySystem_1.EntitySystem.GetComponent(t,190)?.TagContainer;t=EntitySystem_1.EntitySystem.GetComponent(t,20);if(!t||!o)return"";var e=t?.iGr?.bAs,t=t?.iGr?.qAs,r=new Map;const i=new Map([["实体",new Map],["编队",new Map]]);if(e){var a=i.get("实体");for(const s of e)r.set(s.m5n,r.get(s.m5n)??0+s.m9n),a.set(s.m5n,s.m9n)}if(t){var n=i.get("编队");for(const u of t)r.set(u.m5n,r.get(u.m5n)??0+u.m9n),n.set(u.m5n,u.m9n)}return("【客户端】\n"+[...o.GetAllExactTags()].map(t=>{var e=o.GetExactTagCount(t);let r=GameplayTagUtils_1.GameplayTagUtils.GetNameByTagId(t)+` x ${e}(`;for(const n of o.GetAllChannels()){var a=o.GetRowTagCount(n,t);a&&(r+=CharacterTagContainer_1.channelDebugName[n]+` x ${a} `)}return r.trimEnd()+")\n"}).sort((t,e)=>t.localeCompare(e)).join("")+"\n【服务端】\n"+[...r.entries()].map(([t,e])=>{let r=GameplayTagUtils_1.GameplayTagUtils.GetNameByTagId(t)+` x ${e}(`;var a,n;for([a,n]of i.entries()){var o=n.get(t);o&&(r+=a+` x ${o} `)}return r.trimEnd()+")\n"}).sort((t,e)=>t.localeCompare(e)).join("")).trim()}static GetCueDebugString(t,e=""){t=EntitySystem_1.EntitySystem.GetComponent(t,19);if(!t)return"";let r="";var a=[...e.matchAll(/[0-9]+/g)].map(t=>t[0]??"");for(const n of t.GetAllCurrentCueRef())0<a.length&&!a.some(t=>String(n.CueConfig.Id).includes(t))||(r+=`CueId: ${n.CueConfig.Id} Handle: ${n.Handle} BuffId: ${n.BuffId}
`);return r}}exports.default=CombatDebugBlueprintFunctionLibrary;
//# sourceMappingURL=CombatDebugBlueprintFunctionLibrary.js.map