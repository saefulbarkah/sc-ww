
"use strict";var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.CloudGameManager=void 0;const ue_1=require("ue"),Json_1=require("../../Core/Common/Json"),Log_1=require("../../Core/Common/Log"),StringUtils_1=require("../../Core/Utils/StringUtils"),Platform_1=require("../../Launcher/Platform/Platform"),CloudGameDefine_1=require("../CloudGame/CloudGameDefine"),GlobalData_1=require("../GlobalData"),MenuController_1=require("../Module/Menu/MenuController");class CloudGameManager{static get IsCloudGame(){return Platform_1.Platform.IsCloudGame()}static get CloudGameTraceId(){return CloudGameManager.Ou_}static set CloudGameTraceId(e){CloudGameManager.Ou_=e,Log_1.Log.CheckInfo()&&Log_1.Log.Info("CloudGame",58,"设置云游戏Trace",["trace",e])}static get CloudGameServerTag(){return CloudGameManager.Gu_}static get CloudGamePlatform(){return Platform_1.Platform.CloudGamePlatform()}static get CloudGamePadInfo(){return CloudGameManager.Nu_}static get CloudGameDpi(){return CloudGameManager.Vu_}static get DeviceScreenWidth(){return CloudGameManager.ju_}static get DeviceScreenHeight(){return CloudGameManager.Hu_}static get ScreenWidth(){return CloudGameManager.BD_}static get ScreenHeight(){return CloudGameManager.kD_}static Init(){var e;Log_1.Log.CheckInfo()&&Log_1.Log.Info("CloudGame",58,"云游戏初始化"),this.ParseCommandLine(),CloudGameManager.IsCloudGame&&(e=new ue_1.KuroCloudGameWrapper,(CloudGameManager.KuroCloudGameWrapper=e).CloudGameOnReceiveDataDelegate.Bind(CloudGameManager.bBn),e.CloudGameOnReceiveDataWithKeyDelegate.Bind(CloudGameManager.qBn),CloudGameManager.BindFunction("OnResolutionChange",CloudGameManager.Wu_),CloudGameManager.BindFunction("OnGamePadDeviceChange",CloudGameManager.OnGamePadDeviceChange),this.Qu_())}static ParseCommandLine(){var e=ue_1.KismetSystemLibrary.GetCommandLine(),a=CloudGameDefine_1.cloudGameDeviceRegex.exec(e),a=(a&&(CloudGameManager.Ku_=a[1]),CloudGameDefine_1.cloudGameServerTagRegex.exec(e)),a=(a&&(CloudGameManager.Gu_=a[1]),CloudGameDefine_1.cloudGameDpiRegex.exec(e)),a=(a&&(CloudGameManager.Vu_=Number(a[1])),CloudGameDefine_1.cloudGameDeviceScreenResolution.exec(e)),a=(a&&(CloudGameManager.ju_=Number(a[1]),CloudGameManager.Hu_=Number(a[2])),CloudGameDefine_1.cloudGameScreenResolution.exec(e));a&&(CloudGameManager.BD_=Number(a[1]),CloudGameManager.kD_=Number(a[2])),Log_1.Log.CheckInfo()&&Log_1.Log.Info("CloudGame",16,"初始化云游戏平台类型",["-CloudGame",CloudGameManager.IsCloudGame],["-CloudGamePlatform",CloudGameManager.CloudGamePlatform],["-Device",CloudGameManager.Ku_],["-ServerTag",CloudGameManager.Gu_],["-Dpi",CloudGameManager.Vu_],["-DeviceScreenWidth",CloudGameManager.ju_],["-DeviceScreenHeight",CloudGameManager.Hu_])}static Qu_(){ue_1.KismetSystemLibrary.ExecuteConsoleCommand(GlobalData_1.GlobalData.World,"wp.Runtime.OverrideMultipleRuntimeGridNames Grid_Near&Grid_Middle&Grid_Middle_Far&Grid_Far&Grid_SuperFar&Grid_SSuperFar&Grid_HLOD_Small&Grid_HLOD_Middle&Grid_HLOD&Grid_HLOD_Volume_Small&Grid_HLOD_Volume_Middle&Grid_HLOD_Volume&GridRuntime_Landscape&GridRuntime_LandscapeHLOD&Grid_Water&Grid_Impostor&Grid_ExtremeFarFoliage&Grid_Foliage_Normal&Grid_ISM_Near&Grid_ISM_Middle&Grid_ISM_Far&Grid_ISM_SuperFar&Grid_Foliage_Near&Grid_Foliage_Grass&Grid_Foliage_Middle&Grid_Foliage_Far&Grid_Foliage_SuperFar&Grid_ReverseMiddle&Grid_ReverseFar&Grid_ReverseSuperFar&Grid_SSuperFarReverse&Grid_EnclosedSpaceNear&Grid_EnclosedSpaceMiddle&Grid_EnclosedSpaceFar&Grid_EnclosedSpaceSuperFar&Grid_EnclosedSpaceSSuperFar&Grid_AudioNear&Grid_AudioMiddle&Grid_AudioFar&Grid_AudioSuperFar&Grid_PcgWater&Grid_Light_Middle&Grid_Light_Far&Grid_HighResLandscape&Grid_MSuperFar&HLOD0_200m_300m&HLOD0_300m_500m&HLOD1_400m_800m&HLOD0_500m_1000m&HLOD0_500m_1500m&HLOD1_600m_1200m&HLOD1_800m_2500m&HLOD1_800m_4000m"),ue_1.KismetSystemLibrary.ExecuteConsoleCommand(GlobalData_1.GlobalData.World,"wp.Runtime.OverrideMultipleRuntimeGridLoadingRangeValues 60&85&200&180&650&2600&100&140&170&100&190&250&440&3500&610&450&1300&274&60&83&100&150&40&80&100&100&196&260&430&860&2600&50&80&130&650&860&40&80&252&86&440&120&156&300&1300&260&430&690&860&1300&1040&2160&3460")}static BindFunction(e,a){CloudGameManager.GBn.set(e,a)}static UnBindFunction(e){CloudGameManager.GBn.delete(e)}static SendData(e){Log_1.Log.CheckInfo()&&Log_1.Log.Info("CloudGame",58,"SendData",["data",e]),ue_1.KuroCloudGameWrapper.SendDataToPipeBinary(e)}static SendDataByKey(e,a){Log_1.Log.CheckInfo()&&Log_1.Log.Info("CloudGame",58,"SendDataByKey",["key",e],["data",a]),ue_1.KuroCloudGameWrapper.SendDataToPipeBinaryWithKey(e,a)}static TryRequestGamePadDevice(){CloudGameManager.IsCloudGame&&CloudGameManager.SendData("RequestGamePadDevice")}static ExitGame(e){e={Content:e},e=Json_1.Json.Encode(e);CloudGameManager.SendDataByKey("ExitGame",e)}}exports.CloudGameManager=CloudGameManager,(_a=CloudGameManager).KuroCloudGameWrapper=void 0,CloudGameManager.GBn=new Map,CloudGameManager.Ou_=StringUtils_1.EMPTY_STRING,CloudGameManager.Nu_=void 0,CloudGameManager.Ku_=StringUtils_1.EMPTY_STRING,CloudGameManager.Gu_=StringUtils_1.EMPTY_STRING,CloudGameManager.Vu_=CloudGameDefine_1.CLOUD_GAME_DEFAULT_DPI,CloudGameManager.ju_=CloudGameDefine_1.CLOUD_GAME_DEFAULT_SCREEN_WIDTH,CloudGameManager.Hu_=CloudGameDefine_1.CLOUD_GAME_DEFAULT_SCREEN_HEIGHT,CloudGameManager.BD_=CloudGameDefine_1.CLOUD_GAME_DEFAULT_SCREEN_WIDTH,CloudGameManager.kD_=CloudGameDefine_1.CLOUD_GAME_DEFAULT_SCREEN_HEIGHT,CloudGameManager.bBn=e=>{Log_1.Log.CheckInfo()&&Log_1.Log.Info("CloudGame",16,"OnReceiveData:",["key",e]);var a=CloudGameManager.GBn.get(e);a?a(e):Log_1.Log.CheckError()&&Log_1.Log.Error("CloudGame",16,"OnReceiveData: 函数未绑定",["key",e])},CloudGameManager.qBn=(e,a)=>{Log_1.Log.CheckInfo()&&Log_1.Log.Info("CloudGame",16,"OnReceiveDataWithKey:",["key",e],["data",a]);var r=CloudGameManager.GBn.get(e);r?r(a):Log_1.Log.CheckError()&&Log_1.Log.Error("CloudGame",16,"OnReceiveDataWithKey: 函数未绑定",["key",e],["data",a])},CloudGameManager.Wu_=e=>{var e=Json_1.Json.Decode(e),e=new ue_1.IntPoint(e.Width,e.Height),a=ue_1.GameUserSettings.GetGameUserSettings();a.SetScreenResolution(e),a.ApplySettings(!0)},CloudGameManager.OnGamePadDeviceChange=e=>{e=Json_1.Json.Decode(e);1===e.IsConnectPad?_a.Nu_=e:_a.Nu_=void 0,MenuController_1.MenuController.RefreshGamepadConnect()};
//# sourceMappingURL=CloudGameManager.js.map