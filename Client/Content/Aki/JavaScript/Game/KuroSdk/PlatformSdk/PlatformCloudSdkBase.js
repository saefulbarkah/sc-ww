
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PlatformCloudSdkBase=void 0;const Json_1=require("../../../Core/Common/Json"),LanguageSystem_1=require("../../../Core/Common/LanguageSystem"),Log_1=require("../../../Core/Common/Log"),Time_1=require("../../../Core/Common/Time"),CloudGameManagerLauncher_1=require("../../../Launcher/Platform/CloudGameManagerLauncher"),EventDefine_1=require("../../Common/Event/EventDefine"),EventSystem_1=require("../../Common/Event/EventSystem"),CloudGameManager_1=require("../../Manager/CloudGameManager"),ControllerHolder_1=require("../../Manager/ControllerHolder"),ModelManager_1=require("../../Manager/ModelManager"),LogReportDefine_1=require("../../Module/LogReport/LogReportDefine"),KuroSdkData_1=require("../KuroSdkData"),KuroSdkReport_1=require("../KuroSdkReport"),PlatformSdkWindows_1=require("./PlatformSdkWindows"),WEBVIEWCD=5e3;class PlatformCloudSdkBase extends PlatformSdkWindows_1.PlatformSdkWindows{constructor(){super(...arguments),this.CustomerServiceResultCallBack=e=>{var o=Json_1.Json.Parse(e);Log_1.Log.CheckInfo()&&Log_1.Log.Info("CloudGame",58,"当前客服红点数量",["num",e]),o&&(Log_1.Log.CheckInfo()&&Log_1.Log.Info("CloudGame",58,"当前客服红点数量",["num",o.isredot]),this.CurrentCustomerShowState=0<o.isredot),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.SdkCustomerRedPointRefresh)},this.Ou_=e=>{0===Json_1.Json.Decode(e).ErrorCode?EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.OnShareResult,!0):EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.OnShareResult,!1)},this.Gu_=e=>{var o,e=Json_1.Json.Decode(e);ControllerHolder_1.ControllerHolder.KuroSdkController.OnSdkPayEnd(1===e.paymentType,""),1===e.paymentType?((o=new LogReportDefine_1.SuccessSdkPayEvent).s_sdk_pay_order=ModelManager_1.ModelManager.KuroSdkModel.CurrentPayingOrderId,ControllerHolder_1.ControllerHolder.LogReportController.LogReport(o)):((o=new LogReportDefine_1.FailSdkPayEvent).s_sdk_pay_order=ModelManager_1.ModelManager.KuroSdkModel.CurrentPayingOrderId,o.s_reason=3===e.paymentType?"cancel":"fail",ControllerHolder_1.ControllerHolder.LogReportController.LogReport(o)),KuroSdkReport_1.KuroSdkReport.OnSdkPay()}}BindProtocolListener(){}BindShareResultListener(){CloudGameManager_1.CloudGameManager.BindFunction("OnShareResult",this.Ou_),CloudGameManager_1.CloudGameManager.BindFunction("OnSDKPayResult",this.Gu_)}KuroSdkBindRedPointFunction(e){}KuroSdkExitBindFunction(){}KuroSdkQueryProductBindFunction(){}KuroDeepLinkBindFunction(){}KuroGameWinStateBindFunction(){}SdkLogout(){}SdkLogin(){CloudGameManagerLauncher_1.CloudGameManagerLauncher.IsPreLaunch?Log_1.Log.CheckInfo()&&Log_1.Log.Info("CloudGame",16,"请求下发缓存的SDK登录信息 预启动跳过重复流程"):(CloudGameManager_1.CloudGameManager.SendData("RequestLogin"),Log_1.Log.CheckInfo()&&Log_1.Log.Info("CloudGame",58,"请求下发缓存的SDK登录信息"))}SdkOpenLoginWnd(){CloudGameManager_1.CloudGameManager.SendData("RequestLogin"),Log_1.Log.CheckInfo()&&Log_1.Log.Info("CloudGame",58,"请求重新下发缓存的SDK登录信息")}OpenUserCenter(){CloudGameManager_1.CloudGameManager.SendData("OpenUserCenter")}ShowAgreement(){CloudGameManager_1.CloudGameManager.SendData("OpenAgreement")}KuroOpenPrivacyClauseWnd(){CloudGameManager_1.CloudGameManager.SendData("OpenPrivacyClause")}OpenPostWebView(){if(0!==this.LastOpenPostViewTime&&Time_1.Time.Now-this.LastOpenPostViewTime<=WEBVIEWCD)return void ControllerHolder_1.ControllerHolder.GenericPromptController.ShowPromptByCode("InDisplayCd");this.LastOpenPostViewTime=Time_1.Time.Now,Log_1.Log.CheckInfo()&&Log_1.Log.Info("CloudGame",58,"打开公告");var e=ModelManager_1.ModelManager.FunctionModel,o=ModelManager_1.ModelManager.PlayerInfoModel,r=ControllerHolder_1.ControllerHolder.KuroSdkController.GetIfGlobalSdk()?"global":"cn",n=new KuroSdkData_1.OpenPostWebViewParam,o=(n.playerId=void 0===o.GetId()?"0":o.GetId().toString(),n.playerLevel=e.GetPlayerLevel()?e.GetPlayerLevel().toString():"1",n.language=LanguageSystem_1.LanguageSystem.PackageLanguage,n.extend="extend",n.gameOrientation="2",n.type=r,Json_1.Json.Stringify(n));Log_1.Log.CheckInfo()&&Log_1.Log.Info("CloudGame",58,"云游戏OpenPostWebView",["data",o]),CloudGameManager_1.CloudGameManager.SendDataByKey("OpenPostWebView",o)}OpenWebView(e,o,r,n,a){if(0!==this.LastOpenTime&&Time_1.Time.Now-this.LastOpenTime<=WEBVIEWCD)return void ControllerHolder_1.ControllerHolder.GenericPromptController.ShowPromptByCode("InDisplayCd");this.LastOpenTime=Time_1.Time.Now;var t=new KuroSdkData_1.OpenWebViewParamCloudGame,e=(t.title=e,t.url=o,t.transparent=n,t.webAccelerated=a,t.isLandscape=r,Json_1.Json.Stringify(t));Log_1.Log.CheckInfo()&&Log_1.Log.Info("CloudGame",58,"OpenWebView",["sdkJson",e??""]),CloudGameManager_1.CloudGameManager.SendDataByKey("OpenWebView",e)}SdkOpenUrlWnd(e,o,r,n,a=!0){this.OpenWebView(e,o,r,n,a)}}exports.PlatformCloudSdkBase=PlatformCloudSdkBase;
//# sourceMappingURL=PlatformCloudSdkBase.js.map