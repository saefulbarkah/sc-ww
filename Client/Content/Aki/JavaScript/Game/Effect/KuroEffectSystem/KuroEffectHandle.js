
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.KuroEffectHandle=void 0;const cpp_1=require("cpp"),Log_1=require("../../../Core/Common/Log"),EntitySystem_1=require("../../../Core/Entity/EntitySystem"),EventDefine_1=require("../../Common/Event/EventDefine"),EventSystem_1=require("../../Common/Event/EventSystem"),EffectSystem_1=require("../EffectSystem");class KuroEffectHandle{constructor(){this.Id=0,this.IsLoop=!1,this.age=void 0,this.c_c=void 0,this.u_c=void 0,this.d_c=void 0,this.m_c=void 0,this.nx=void 0,this.OnCustomCheckOwner=void 0,this.f_c=!1,this.zCe=!1,this.g_c=!1,this.C_c=()=>{this.g_c?this.p_c():Log_1.Log.CheckWarn()&&Log_1.Log.Warn("RenderEffect",36,"[特效框架]KuroEffectHandle EffectFinsh没有调用就注销",["Id",this.Id])},this.gfn=t=>{if(t===this.Id||0===this.Id){if(this.age)for(const i of this.age)i(t);EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.FinishEffect,this.Id,"KuroEffectHandle.OnAfterFinish",!0),EffectSystem_1.EffectSystem.RemoveKuroEffectHandle(this.Id)}},this.OnBeforeInitCallback=t=>{t!==this.Id&&0!==this.Id||this.c_c&&this.c_c(t)},this.OnEffectInitCallback=(t,i)=>{i!==this.Id&&0!==this.Id||this.u_c&&this.u_c(t,i)},this.OnBeforePlayCallback=t=>{t!==this.Id&&0!==this.Id||(this.f_c=!0,this.d_c&&this.d_c(t),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.BeforePlayEffect,this.Id,"KuroEffectHandle.OnBeforePlay"))},this.OnInitCallbackClear=()=>{this.c_c=void 0,this.u_c=void 0,this.d_c=void 0},this.OnDynamicEffectInitCallback=(t,i)=>{i!==this.Id&&0!==this.Id||this.m_c&&this.m_c(t,i)},this.v_c=()=>{this.m_c=void 0}}Init(t,i,s,h){this.nx=t,this.c_c=i,this.u_c=s,this.d_c=h}OnAfterSpawn(t){this.Id=t,this.IsLoop=cpp_1.FEffectSystem.EffectIsLoop(t),this.RegisterFinishCallback()}Clear(){this.p_c(),this.c_c=void 0,this.u_c=void 0,this.d_c=void 0,this.m_c=void 0,this.nx=void 0,this.OnCustomCheckOwner=void 0}CheckOwner(){if(this.OnCustomCheckOwner)return this.OnCustomCheckOwner(this.Id);if(this.nx){if(this.nx.EntityId)if(!EntitySystem_1.EntitySystem.Get(this.nx.EntityId)?.Valid)return!1;if(this.nx.SourceObject&&!this.nx.SourceObject.IsValid())return!1}return!0}IsDone(){return this.f_c}SetNotRecord(t){this.zCe=t}GetNotRecord(){return this.zCe}RegisterFinishCallback(){this.g_c||(this.g_c=!0,cpp_1.FEffectSystem.AddFinishCallback(this.Id,this.gfn,this.C_c,this))}p_c(){this.g_c&&(this.g_c=!1,cpp_1.FEffectSystem.RemoveFinishCallback(this.Id),this.age)&&this.age.clear()}AddFinishCallback(t){t&&(this.age||(this.age=new Set),this.age.has(t)||this.age.add(t))}RemoveFinishCallback(t){return!!t&&!!this.age&&this.age.delete(t)}RegisterDynamicEffectInitCallback(t){this.m_c=t,cpp_1.FEffectSystem.DynamicRegisterSpawnCallback(this.Id,this.OnDynamicEffectInitCallback,this.v_c,this)}}exports.KuroEffectHandle=KuroEffectHandle;
//# sourceMappingURL=KuroEffectHandle.js.map