
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.KuroEffectSystem=void 0;const cpp_1=require("cpp"),UE=require("ue"),ActorSystem_1=require("../../../Core/Actor/ActorSystem"),AudioSystem_1=require("../../../Core/Audio/AudioSystem"),Info_1=require("../../../Core/Common/Info"),Log_1=require("../../../Core/Common/Log"),EffectSpecDataGetAll_1=require("../../../Core/Define/ConfigQuery/EffectSpecDataGetAll"),Protocol_1=require("../../../Core/Define/Net/Protocol"),EffectEnvironment_1=require("../../../Core/Effect/EffectEnvironment"),EntitySystem_1=require("../../../Core/Entity/EntitySystem"),Vector_1=require("../../../Core/Utils/Math/Vector"),TsBaseCharacter_1=require("../../Character/TsBaseCharacter"),EventDefine_1=require("../../Common/Event/EventDefine"),EventSystem_1=require("../../Common/Event/EventSystem"),PublicUtil_1=require("../../Common/PublicUtil"),GameSettingsDefine_1=require("../../GameSettings/GameSettingsDefine"),GameSettingsManager_1=require("../../GameSettings/GameSettingsManager"),GlobalData_1=require("../../GlobalData"),ControllerHolder_1=require("../../Manager/ControllerHolder"),ModelManager_1=require("../../Manager/ModelManager"),SceneTeamDefine_1=require("../../Module/SceneTeam/SceneTeamDefine"),CharRenderingComponent_1=require("../../Render/Character/Manager/CharRenderingComponent"),EffectModelNiagara_1=require("../../Render/Effect/Data/EffectModelNiagara"),CustomMap_1=require("../../World/Define/CustomMap"),GameBudgetAllocatorConfigCreator_1=require("../../World/Define/GameBudgetAllocatorConfigCreator"),EffectAudioContext_1=require("../EffectContext/EffectAudioContext"),EffectContext_1=require("../EffectContext/EffectContext"),EffectRuntimeGhostEffectContext_1=require("../EffectContext/EffectRuntimeGhostEffectContext"),SkeletalMeshEffectContext_1=require("../EffectContext/SkeletalMeshEffectContext"),TsEffectSystem_1=require("../TsEffectSystem"),KuroEffectActorHandle_1=require("./KuroEffectActorHandle"),KuroEffectHandle_1=require("./KuroEffectHandle"),KuroEffectNiagaraComponentHandle_1=require("./KuroEffectNiagaraComponentHandle"),MIN_NIAGARA_SIMULATION_TICK_TIME=.033,CHECK_EFFECT_OWNER_INTERVAL=6e4,EFFECT_SPEC_DATA_PATH="../Config/Client/EffectData/";class KuroEffectSystem{constructor(){this.Lfe=!1,this.y_c=!1,this.S_c=new CustomMap_1.CustomMap,this.bpc=new CustomMap_1.CustomMap,this.Lpc=new CustomMap_1.CustomMap,this.M_c=e=>{cpp_1.FEffectSystem.OnUiSceneStateChange(e)},this.E_c=e=>{cpp_1.FEffectSystem.OnTickSystemPausedChange(e)},this.mCc=new Array,this.kpe=()=>{if(0===this.mCc.length)for(let e=0;e<SceneTeamDefine_1.SCENE_TEAM_MAX_NUM;e++)this.mCc.push(new cpp_1.FSceneTeamItem);var t=ModelManager_1.ModelManager.SceneTeamModel.GetTeamItems();for(let e=0;e<SceneTeamDefine_1.SCENE_TEAM_MAX_NUM;e++){var r=t[e],i=r?.EntityHandle;r?.IsMyRole()&&i?(this.mCc[e].EntityId=i.Id,this.mCc[e].IsMyRole=!0):(this.mCc[e].EntityId=0,this.mCc[e].IsMyRole=!1)}cpp_1.FEffectSystem.OnPlayerEffectContainerFormationLoaded(this.mCc)},this.I_c=new Array,this.T_c=new Array,this._pe=CHECK_EFFECT_OWNER_INTERVAL,this.Tfe=()=>{cpp_1.FEffectSystem.OnGlobalTimeScaleChange()},this.mna=()=>{var e=GameSettingsManager_1.GameSettingsManager.GetCurrentValue(GameSettingsDefine_1.EFunction.NIAGARAQUALITY);void 0!==e&&(Info_1.Info.IsPcPlatform()?e<1?this.dna():this.Cna():e<2?this.dna():this.Cna())}}Initialize(){return Info_1.Info.IsGameRunning()&&cpp_1.FKuroTimerSystem.Initialize(GlobalData_1.GlobalData.GameInstance),this.S_c.Clear(),!!this.b_c()&&(this.y_c=!0,EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.TriggerUiTimeDilation,this.Tfe),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.SetNiagaraQuality,this.mna),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.AfterGameSettingsAppliedOnOpenLoading,this.mna),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnGlobalUiSceneStateChanged,this.M_c),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnSetGamePaused,this.E_c),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnUpdateSceneTeam,this.kpe),!0)}b_c(e=!1,t=!1){cpp_1.FKuroResourceSystem.Initialize(GlobalData_1.GlobalData.World,1),e||this.L_c();let r=!0;e&&!t&&cpp_1.FEffectSystem.HasEffectForSpecData()&&(r=!1);t=new Array;return r&&(this.w_c(e),this.R_c(t,e)),this.I_c.length=0,this.T_c.length=0,!!cpp_1.FEffectSystem.Initialize(GlobalData_1.GlobalData.GameInstance,t,Info_1.Info.IsGameRunning(),.1,.3,.3,!0,UE.BP_EffectPreview_C.StaticClass(),r)&&(cpp_1.FEffectSystem.InitStaticGlobalData(EffectEnvironment_1.EffectEnvironment.UseLog,Info_1.Info.IsInEditorTick(),PublicUtil_1.PublicUtil.UseDbConfig()),cpp_1.FEffectSystem.RegisterJsFunction(KuroEffectSystem.A_c,KuroEffectSystem.P_c,KuroEffectSystem.x_c,KuroEffectSystem.U_c,KuroEffectSystem.D_c,KuroEffectSystem.B_c,KuroEffectSystem.k_c,KuroEffectSystem.O_c,KuroEffectSystem.q_c,KuroEffectSystem.G_c,KuroEffectSystem.F_c,KuroEffectSystem.N_c,KuroEffectSystem.V_c,KuroEffectSystem.j_c,KuroEffectSystem.H_c,KuroEffectSystem.$_c,KuroEffectSystem.W_c,KuroEffectSystem.Q_c,KuroEffectSystem.K_c,KuroEffectSystem.X_c,KuroEffectSystem.Y_c,KuroEffectSystem.z_c,KuroEffectSystem.J_c,KuroEffectSystem.Z_c,KuroEffectSystem.ecc,KuroEffectSystem.tcc),!0)}Clear(){this.y_c=!1,EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnUpdateSceneTeam,this.kpe),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnSetGamePaused,this.E_c),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnGlobalUiSceneStateChanged,this.M_c),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.AfterGameSettingsAppliedOnOpenLoading,this.mna),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.SetNiagaraQuality,this.mna),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.TriggerUiTimeDilation,this.Tfe),this.Lfe=!1,EffectEnvironment_1.EffectEnvironment.GameTimeInSeconds=0;for(const e of this.S_c.GetItems())e.Clear();return this.S_c.Clear(),cpp_1.FEffectSystem.Clear(),Info_1.Info.IsGameRunning()&&(cpp_1.FKuroTimerSystem.Clear(),cpp_1.FKuroResourceSystem.Clear()),!0}ClearPool(){return cpp_1.FEffectSystem.ClearPool(!1),!0}InitializeWithPreview(e){var t;return!!Info_1.Info.IsGameRunning()||!(e||!this.Lfe)||(e&&this.Lfe&&cpp_1.FEffectSystem.HasInitialize()?(t=new Array,this.w_c(!0),this.R_c(t,!0),cpp_1.FEffectSystem.RefreshEffectForSpecData(t),!0):this.y_c?(Log_1.Log.CheckError()&&Log_1.Log.Error("RenderEffect",36,"[特效框架]InitializeWithPreview时 FEffectSystem还未Clear,非法"),!0):(this.Lfe=!0,this.b_c(!0,e)))}L_c(){if(PublicUtil_1.PublicUtil.UseDbConfig()){this.I_c.length=0,this.T_c.length=0;var e=EffectSpecDataGetAll_1.configEffectSpecDataGetAll.GetConfigList(!1);if(e)for(const t of e)this.T_c.push(t)}}w_c(e=!1){if(Info_1.Info.IsPlayInEditor&&(e||!PublicUtil_1.PublicUtil.UseDbConfig())){this.I_c.length=0,this.T_c.length=0;e=UE.KismetSystemLibrary.GetProjectDirectory()+EFFECT_SPEC_DATA_PATH;if(UE.BlueprintPathsLibrary.DirectoryExists(e))try{var t,r=UE.KuroStaticLibrary.LoadFilesRecursive(e,"*.json",!0,!1),i=new Array;for(let e=0;e<r.Num();++e)i.push(r.Get(e));for(const n of i)!n||n.length<1||(t=JSON.parse(n),this.I_c.push(t))}catch(e){e instanceof Error?Log_1.Log.CheckError()&&Log_1.Log.ErrorWithStack("RenderEffect",3,"读取EffectSpec.json异常",e,["Name",this.constructor.name],["error",e.message]):Log_1.Log.CheckError()&&Log_1.Log.Error("RenderEffect",3,"读取EffectSpec.json异常",["Name",this.constructor.name],["error",e])}else Log_1.Log.CheckWarn()&&Log_1.Log.Warn("World",3,"不存在EffectSpec配置文件目录",["Path",e])}}R_c(e,t=!1){if(t||!PublicUtil_1.PublicUtil.UseDbConfig())for(const n of this.I_c){var r=new cpp_1.FEffectSpecData;r.Id=n.Id,r.Path=new UE.FName(n.Path),r.SpecType=n.SpecType,r.EffectRegularType=n.EffectRegularType,r.LifeTime=n.LifeTime,e.push(r)}else for(const o of this.T_c){var i=new cpp_1.FEffectSpecData;i.Id=o.Id,i.SpecType=o.SpecType,i.EffectRegularType=o.EffectRegularType,i.LifeTime=o.LifeTime,e.push(i)}}Tick(e){if(this._pe-=e,this._pe<0){this._pe=CHECK_EFFECT_OWNER_INTERVAL;for(const t of this.S_c.GetItems())t.IsLoop&&!t.CheckOwner()&&this.StopEffectById(t.Id,"CheckOwner Failed",!0)}}dna(){Log_1.Log.CheckInfo()&&Log_1.Log.Info("RenderEffect",36,"Open Niagara Down Sampling"),UE.KismetSystemLibrary.ExecuteConsoleCommand(GlobalData_1.GlobalData.World,"Kuro.Niagara.SystemSimulation.TickDeltaTime "+MIN_NIAGARA_SIMULATION_TICK_TIME),UE.KismetSystemLibrary.ExecuteConsoleCommand(GlobalData_1.GlobalData.World,"Kuro.Niagara.SystemSimulation.SpawnAlignment 0")}Cna(){Log_1.Log.CheckInfo()&&Log_1.Log.Info("RenderEffect",36,"Close Niagara Down Sampling"),UE.KismetSystemLibrary.ExecuteConsoleCommand(GlobalData_1.GlobalData.World,"Kuro.Niagara.SystemSimulation.TickDeltaTime -1"),UE.KismetSystemLibrary.ExecuteConsoleCommand(GlobalData_1.GlobalData.World,"Kuro.Niagara.SystemSimulation.SpawnAlignment 0")}SpawnEffectWithActor(e,t,r,i,n=!0,o,a=!0,f=3){var c=o?this.icc(o):void 0,e=cpp_1.FEffectSystem.SpawnEffectWithActor(e,t,r,i,n,c,a,f);return this.IsValid(e)?this.S_c.Contains(e)?(Log_1.Log.CheckWarn()&&Log_1.Log.Warn("RenderEffect",36,"[特效框架]SpawnEffectWithActor 生成了一个已经存在的effectId",["id",e]),0):((t=new KuroEffectHandle_1.KuroEffectHandle).Init(o),t.Id=e,t.IsLoop=cpp_1.FEffectSystem.EffectIsLoop(e),this.S_c.Set(e,t),e):0}RemoveKuroEffectHandle(e){this.S_c.Contains(e)&&(this.S_c.Get(e)?.Clear(),this.S_c.Remove(e),this.bpc.Contains(e)&&this.bpc.Remove(e),this.Lpc.Contains(e))&&this.Lpc.Remove(e)}GetEffectLruCount(e){return cpp_1.FEffectSystem.GetEffectLruCount(e)}GetEffectLruCapacity(){return cpp_1.FEffectSystem.GetEffectLruCapacity()}SetEffectLruCapacity(e){cpp_1.FEffectSystem.SetEffectLruCapacity(e)}GetEffectLruSize(){return cpp_1.FEffectSystem.GetEffectLruSize()}SpawnUnloopedEffect(e,t,r,i,n,o=3,a,f,c,s=!1,_=!1){var p=new KuroEffectHandle_1.KuroEffectHandle,n=(p.Init(n,a,f,c),n?this.icc(n):void 0),e=cpp_1.FEffectSystem.SpawnUnloopedEffect(e,t,r,i,n,o,s,_,a?p.OnBeforeInitCallback:void 0,f?p.OnEffectInitCallback:void 0,c?p.OnBeforePlayCallback:void 0,p.OnInitCallbackClear,p);return this.IsValid(e)?this.S_c.Contains(e)?(Log_1.Log.CheckWarn()&&Log_1.Log.Warn("RenderEffect",36,"[特效框架]SpawnUnloopedEffect 生成了一个已经存在的effectId",["id",e]),0):(p.Id=e,p.IsLoop=cpp_1.FEffectSystem.EffectIsLoop(e),this.S_c.Set(e,p),e):0}SpawnEffect(e,t,r,i,n,o=3,a,f,c,s=!1,_=!1){var p=new KuroEffectHandle_1.KuroEffectHandle,n=(p.Init(n,a,f,c),n?this.icc(n):void 0),e=cpp_1.FEffectSystem.SpawnEffect(e,t,r,i,n,o,s,_,a?p.OnBeforeInitCallback:void 0,f?p.OnEffectInitCallback:void 0,c?p.OnBeforePlayCallback:void 0,p.OnInitCallbackClear,p);return this.IsValid(e)?this.S_c.Contains(e)?(Log_1.Log.CheckWarn()&&Log_1.Log.Warn("RenderEffect",36,"[特效框架]SpawnEffect 生成了一个已经存在的effectId",["id",e]),0):(p.Id=e,p.IsLoop=cpp_1.FEffectSystem.EffectIsLoop(e),this.S_c.Set(e,p),e):0}DynamicRegisterSpawnCallback(e,t){this.S_c.Contains(e)&&this.S_c.Get(e)?.RegisterDynamicEffectInitCallback(t)}AddFinishCallback(e,t){this.S_c.Contains(e)&&this.S_c.Get(e)?.AddFinishCallback(t)}RemoveFinishCallback(e,t){this.S_c.Contains(e)&&this.S_c.Get(e)?.RemoveFinishCallback(t)}ForceCheckPendingInit(e){cpp_1.FEffectSystem.ForceCheckPendingInit(e)}SetEffectHidden(e,t,r=void 0,i=!1){cpp_1.FEffectSystem.SetEffectHidden(e,t,r,i)}StopEffectById(e,t,r,i){return cpp_1.FEffectSystem.StopEffectById(e,t,r,i)}IsValid(e){return cpp_1.FEffectSystem.IsValid(e)}GetEffectActor(e){let t=void 0;return cpp_1.FEffectSystem.IsEffectActorValid(e)?t=this.GetSureEffectActor(e):this.bpc.Contains(e)?t=this.bpc.Get(e):(t=new KuroEffectActorHandle_1.KuroEffectActorHandle(e),this.bpc.Set(e,t)),t}GetSureEffectActor(e){return cpp_1.FEffectSystem.GetSureEffectActor(e)}GetNiagaraComponent(e){let t=this.GetSureNiagaraComponent(e);return t||(this.Lpc.Contains(e)?t=this.Lpc.Get(e):(t=new KuroEffectNiagaraComponentHandle_1.KuroEffectNiagaraComponentHandle(e),this.Lpc.Set(e,t))),t}GetSureNiagaraComponent(e){return cpp_1.FEffectSystem.GetSureNiagaraComponent(e)}ReplayEffect(e,t,r){cpp_1.FEffectSystem.ReplayEffect(e,t,r)}IsPlaying(e){return cpp_1.FEffectSystem.IsPlaying(e)}SetHandleLifeCycle(e,t){cpp_1.FEffectSystem.SetHandleLifeCycle(e,t)}SetTimeScale(e,t,r=!1){cpp_1.FEffectSystem.SetTimeScale(e,t,r)}FreezeHandle(e,t,r=!1){cpp_1.FEffectSystem.FreezeHandle(e,t,r)}IsHandleFreeze(e){return cpp_1.FEffectSystem.IsHandleFreeze(e)}HandleSeekToTime(e,t,r,i=!1){return cpp_1.FEffectSystem.HandleSeekToTime(e,t,r,i)}HandleSeekToTimeWithProcess(e,t,r=!1,i=-1){cpp_1.FEffectSystem.HandleSeekToTimeWithProcess(e,t,r,i)}GetSeekToTargetTime(e){return cpp_1.FEffectSystem.GetSeekToTargetTime(e)}SetEffectNotRecord(e,t=!0){this.S_c.Contains(e)&&this.S_c.Get(e)?.SetNotRecord(t)}GetPath(e){return cpp_1.FEffectSystem.GetPath(e)}SetEffectDataByNiagaraParam(e,t,r){var i;this.IsValid(e)&&((i=cpp_1.FEffectSystem.GetEffectModel(e))instanceof EffectModelNiagara_1.default&&(i.FloatParameters=t.FloatParameters,i.VectorParameters=t.VectorParameters,i.ColorParameters=t.ColorParameters),cpp_1.FEffectSystem.SetThreeStageTime(e,t.StartTime,t.LoopTime,t.EndTime,r))}SetEffectParameterNiagara(e,t){var r;t&&(r=new cpp_1.FKuroEffectNiagaraParameters,t.ToKuroEffectParameterNiagara(r),cpp_1.FEffectSystem.SetEffectParameterNiagara(e,r))}SetEffectDataFloatConstParam(e,t,r){cpp_1.FEffectSystem.SetEffectDataFloatConstParam(e,t,r)}SetEffectExtraState(e,t){cpp_1.FEffectSystem.SetEffectExtraState(e,t)}SetEffectIgnoreVisibilityOptimize(e,t){cpp_1.FEffectSystem.SetEffectIgnoreVisibilityOptimize(e,t)}SetEffectStoppingTime(e,t){cpp_1.FEffectSystem.SetEffectStoppingTime(e,t)}GlobalStoppingPlayTime(){return cpp_1.FEffectSystem.GlobalStoppingPlayTime()}GlobalStoppingTime(){return cpp_1.FEffectSystem.GlobalStoppingTime()}SetGlobalStoppingTime(e,t){cpp_1.FEffectSystem.SetGlobalStoppingTime(e,t)}AttachToEffectSkeletalMesh(e,t,r,i){cpp_1.FEffectSystem.AttachToEffectSkeletalMesh(e,t,r,i)}AttachSkeletalMesh(e,t){t=this.icc(t);cpp_1.FEffectSystem.AttachSkeletalMesh(e,t)}icc(e){let t=void 0;return e instanceof EffectRuntimeGhostEffectContext_1.EffectRuntimeGhostEffectContext?(t=new cpp_1.FEffectRuntimeGhostEffectContext).ContextType=3:e instanceof EffectAudioContext_1.EffectAudioContext?(t=new cpp_1.FEffectAudioContext).ContextType=2:e instanceof SkeletalMeshEffectContext_1.SkeletalMeshEffectContext?(t=new cpp_1.FSkeletalMeshEffectContext).ContextType=1:e instanceof EffectContext_1.EffectContext&&((t=new cpp_1.FEffectContext).ContextType=0),t&&e.ToKuroEffectContext(t),t}CollectMaterialFloatCurve(e,t,r){cpp_1.FEffectSystem.CollectMaterialFloatCurve(e,t,r)}CollectMaterialVectorCurve(e,t,r){cpp_1.FEffectSystem.CollectMaterialVectorCurve(e,t,r)}CollectMaterialLinearColorCurve(e,t,r){cpp_1.FEffectSystem.CollectMaterialLinearColorCurve(e,t,r)}GetEffectModel(e){return cpp_1.FEffectSystem.GetEffectModel(e)}GetTotalPassTime(e){return cpp_1.FEffectSystem.GetTotalPassTime(e)}GetPassTime(e){return cpp_1.FEffectSystem.GetPassTime(e)}GetHideOnBurstSkill(e){e=this.GetEffectModel(e);return!!e&&e.HideOnBurstSkill}RegisterCustomCheckOwnerFunc(e,t){this.S_c.Contains(e)&&(e=this.S_c.Get(e))&&(e.OnCustomCheckOwner=t)}TickHandleInEditor(e,t){cpp_1.FEffectSystem.TickHandleInEditor(e,t)}GetLastPlayTime(e){return cpp_1.FEffectSystem.GetLastPlayTime(e)}GetLastStopTime(e){return cpp_1.FEffectSystem.GetLastStopTime(e)}UpdateBodyEffect(e,t,r,i){cpp_1.FEffectSystem.UpdateBodyEffect(e,t,r,i)}DebugUpdate(e,t){cpp_1.FEffectSystem.DebugUpdate(e,t)}GetEffectCount(){return cpp_1.FEffectSystem.GetEffectCount()}GetActiveEffectCount(){return cpp_1.FEffectSystem.GetActiveEffectCount()}DebugPrintAllErrorEffects(){cpp_1.FEffectSystem.DebugPrintAllErrorEffects()}DebugPrintCurrentImportanceEffects(){cpp_1.FEffectSystem.DebugPrintCurrentImportanceEffects()}DebugPrintEffect(){cpp_1.FEffectSystem.DebugPrintEffect()}GetPlayerEffectLruSize(e){return cpp_1.FEffectSystem.GetPlayerEffectLruSize(e)}SetEffectStartRecording(e,t,r,i){for(const o of this.S_c.GetItems()){var n;o&&o.IsDone()&&this.GetEffectModel(o.Id)?.IsValid()&&(o.GetNotRecord()||(n=this.GetSureEffectActor(o.Id))&&(e.FromUeVector(n.D_K2_GetActorLocation()),Vector_1.Vector.DistSquared(e,t)>r||i(o.Id,n)))}}static A_c(e,t,r,i){let n=t;return e<1?((n=n||i.GetComponentByClass(UE.CharRenderingComponent_C.StaticClass()))||(n=i.AddComponentByClass(UE.CharRenderingComponent_C.StaticClass(),!1,new UE.Transform,!1),GlobalData_1.GlobalData.IsUiSceneOpen?n.Init(5):n.Init(7)),n.SetLogicOwner(i),n.AddComponentByCase(0,r),n.SetDitherEffect(e,1)):n&&n.SetDitherEffect(1,1),n}static P_c(e,t){let r=t;(r=r||e.GetComponentByClass(UE.CharRenderingComponent_C.StaticClass()))?.ResetAllRenderingState(),r?.K2_DestroyComponent(r)}static x_c(e){return 0!==e&&(e=EntitySystem_1.EntitySystem.Get(e))?e.GetComponent(3)?.Owner:void 0}static U_c(e){if(Info_1.Info.IsGameRunning()&&0!==e){e=ModelManager_1.ModelManager.CreatureModel?.GetEntityById(e);if(e?.Valid){e=e.Entity.GetComponent(0);if(e){e=e?.GetModelConfig();if(e)return e.ID}}}return 0}static D_c(e){return GameBudgetAllocatorConfigCreator_1.GameBudgetAllocatorConfigCreator.GetEffectDynamicGroup(e)?.GroupName}static B_c(t,e){return AudioSystem_1.AudioSystem.GetAkComponent(e,{OnCreated:e=>{ControllerHolder_1.ControllerHolder.GameAudioController.SetRolePriority(t?0:2,e)}})}static k_c(e,t){AudioSystem_1.AudioSystem.ExecuteAction(e,0,{TransitionDuration:t})}static O_c(e,t){return AudioSystem_1.AudioSystem.PostEvent(e,t)}static q_c(e,t){return AudioSystem_1.AudioSystem.PostEvent(e,t)}static G_c(e){var t;return!!Info_1.Info.IsGameRunning()&&!(!(e=ModelManager_1.ModelManager.CharacterModel?.GetHandle(e))?.Valid||((t=(e=e.Entity).GetComponent(0)).GetEntityType()!==Protocol_1.Aki.Protocol.kks.Proto_Player||e.GetComponent(3).IsAutonomousProxy)&&(t=ModelManager_1.ModelManager.CreatureModel.GetEntityId(t.GetSummonerId()),!(t=EntitySystem_1.EntitySystem.Get(t)?.GetComponent(0))||t.GetEntityType()!==Protocol_1.Aki.Protocol.kks.Proto_Player||e.GetComponent(3).IsAutonomousProxy))}static F_c(e,t){return!(Info_1.Info.IsGameRunning()&&!t&&(t=ModelManager_1.ModelManager.CharacterModel?.GetHandle(e))?.Valid&&((t=(e=t.Entity).GetComponent(0)).GetEntityType()===Protocol_1.Aki.Protocol.kks.Proto_Player&&!e.GetComponent(3).IsAutonomousProxy||(t=ModelManager_1.ModelManager.CreatureModel.GetEntityId(t.GetSummonerId()),(t=EntitySystem_1.EntitySystem.Get(t)?.GetComponent(0))&&t.GetEntityType()===Protocol_1.Aki.Protocol.kks.Proto_Player&&!e.GetComponent(3).IsAutonomousProxy)))}static N_c(e){return!Info_1.Info.IsGameRunning()||!(e=ModelManager_1.ModelManager.CharacterModel?.GetHandle(e))?.Valid||(e=e.Entity).GetComponent(0).GetEntityType()!==Protocol_1.Aki.Protocol.kks.Proto_Player||!e.GetComponent(3).IsAutonomousProxy}static V_c(e,t){return ActorSystem_1.ActorSystem.Get(e,t)}static j_c(e,t){return ActorSystem_1.ActorSystem.Put(e,t)}static H_c(e,t){e.IsA(UE.BP_EffectPreview_C.StaticClass())&&(e.EffectView=t)}static $_c(e){return!!Info_1.Info.IsGameRunning()&&!!(e=ModelManager_1.ModelManager.CreatureModel?.GetEntityById(e))?.Valid&&(e=e.Entity.GetComponent(0)).GetEntityType()===Protocol_1.Aki.Protocol.kks.Proto_Player&&e.GetPlayerId()!==ModelManager_1.ModelManager.CreatureModel.GetPlayerId()}static W_c(e){return!(!Info_1.Info.IsMobilePlatform()||!TsEffectSystem_1.MOBILE_EFFECT_BLACK_LIST.has(e))}static Zba(t,e,r,i){let n=void 0;var o=t?.GetAttachParentActor();if(i.NeedDisableWithActor){let e=0;if(0<(e=t?.IsA(UE.EffectSystemActor.StaticClass())?t.GetOwnerEntityId():e)){var t=EntitySystem_1.EntitySystem.Get(e)?.GetComponent(3)?.Owner;if(t instanceof TsBaseCharacter_1.default)return t.CharRenderingComponent}}return(0<i.LoopTime||i.NeedDisableWithActor)&&(e&&(t=e.GetOwner(),n=t?.GetComponentByClass(UE.CharRenderingComponent_C.StaticClass())),n=n||o?.GetComponentByClass(UE.CharRenderingComponent_C.StaticClass())),n||!i.NeedDisableWithActor||(n=r&&r!==o?r.GetComponentByClass(UE.CharRenderingComponent_C.StaticClass()):n)||(e=r?.GetOwner())&&e!==o&&(n=e.GetComponentByClass(UE.CharRenderingComponent_C.StaticClass())),n}static Q_c(e,t,r,i,n){t=KuroEffectSystem.Zba(t,r,i,n);t&&t.RegisterBodyEffect(e)}static K_c(e,t,r,i,n){t=KuroEffectSystem.Zba(t,r,i,n);t&&t.UnregisterBodyEffect(e)}}(exports.KuroEffectSystem=KuroEffectSystem).X_c=(e,t)=>{if(0!==e){e=EntitySystem_1.EntitySystem.Get(e)?.GetComponent(3)?.Owner;if(e instanceof TsBaseCharacter_1.default)return e.CharRenderingComponent}if(t instanceof TsBaseCharacter_1.default)return t.CharRenderingComponent},KuroEffectSystem.Y_c=e=>{if(e)return(e=e.GetOwner())instanceof TsBaseCharacter_1.default?e.CharRenderingComponent:e.GetComponentByClass(CharRenderingComponent_1.default.StaticClass())||void 0},KuroEffectSystem.z_c=e=>UE.KuroRenderingRuntimeBPPluginBPLibrary.D_SpawnActorFromClass(e,UE.BP_MaterialControllerRenderActor_C.StaticClass(),new UE.TransformDouble),KuroEffectSystem.J_c=(e,t)=>{var r;if(e)return r=t?.GetOwner(),e=e.CharRenderingComponent,GlobalData_1.GlobalData.IsUiSceneOpen?e.Init(5):e.Init(7),e.SetLogicOwner(r),e.AddComponentByCase(0,t),e},KuroEffectSystem.Z_c=(e,t)=>{return e&&t?e.AddMaterialControllerData(t):-1},KuroEffectSystem.ecc=(e,t)=>{e&&-1!==t&&e.RemoveMaterialControllerData(t)},KuroEffectSystem.tcc=e=>{e&&e.Destroy()};
//# sourceMappingURL=KuroEffectSystem.js.map