
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CameraRotationZone=void 0;const UE=require("ue"),Macro_1=require("../../Core/Preprocessor/Macro"),MathCommon_1=require("../../Core/Utils/Math/MathCommon"),Quat_1=require("../../Core/Utils/Math/Quat"),Rotator_1=require("../../Core/Utils/Math/Rotator"),Vector_1=require("../../Core/Utils/Math/Vector"),MathUtils_1=require("../../Core/Utils/MathUtils"),GlobalData_1=require("../GlobalData"),CharacterUnifiedStateTypes_1=require("../NewWorld/Character/Common/Component/Abilities/CharacterUnifiedStateTypes"),ColorUtils_1=require("../Utils/ColorUtils"),CAMERA_DIRECTION_LENGTH=500,CAMERA_DIRECTION_ARROW_SIZE=2e3;class CameraRotationZone{constructor(){this.Hh=void 0,this.e1h=void 0,this.t1h=void 0,this.i1h=void 0,this.Khl=void 0,this.$hl=void 0,this.Xhl=0,this.r1h=0,this.Yhl=0,this.zhl=0,this.Jhl=0,this.Zhl=0,this.az=Quat_1.Quat.Create(),this.Gue=Rotator_1.Rotator.Create()}Init(t){this.Hh=t}SetCharacter(t){this.e1h=t,this.e1h?.Valid&&(this.t1h=this.e1h.Entity.GetComponent(55),this.i1h=this.e1h.Entity.GetComponent(3),this.Khl=this.e1h.Entity.GetComponent(53),this.$hl=this.e1h.Entity.GetComponent(166))}UpdateInputState(t){var i,s,h;1===this.Hh.CameraZoneMode&&(i=this.i1h.InputDirectProxy,[s,h]=(this.IsHasPitchMovement()?this.Jhl+=t:this.Jhl=0,this.t1h.GetCameraInput()),MathUtils_1.MathUtils.IsNearlyZero(h,MathUtils_1.MathUtils.KindaSmallNumber)?this.Zhl+=t:this.Zhl=0,MathUtils_1.MathUtils.IsNearlyZero(i.Y,MathUtils_1.MathUtils.KindaSmallNumber)?this.Yhl=0:this.Yhl+=t,MathUtils_1.MathUtils.IsNearlyZero(s,MathUtils_1.MathUtils.KindaSmallNumber)?this.zhl+=t:this.zhl=0)}UpdatePitchZone(t){var i,s,h;return!this.o1h()||1!==this.Hh.CameraZoneMode?this.Hh.DesiredCamera.ArmRotation.Pitch:(i=this.i1h.ActorVelocityProxy,MathUtils_1.MathUtils.LookRotationForwardFirst(i,Vector_1.Vector.UpVectorProxy,this.az),this.az.Rotator(this.Gue),i=this.Gue.Pitch,s=this.Hh.DesiredCamera.ArmRotation.Pitch,h=MathUtils_1.MathUtils.WrapAngle(i-s),this.e1l(h),this.t1l(i,s,h,t))}e1l(t){t>=this.Hh.PitchSoftZoneMin&&t<=this.Hh.PitchSoftZoneMax&&(this.Xhl=2),this.i1l()?this.Xhl=0:this.t1h.HasCameraInput()?this.Xhl=1:this.r1l()?2!==this.Xhl&&this.l1h()&&(this.Xhl=3):this.o1l()&&(this.Xhl=4)}t1l(t,i,s,h){if(0===this.Xhl)return i;var a=MathUtils_1.MathUtils.Lerp(this.Hh.PitchZoneSpeedMin,this.Hh.PitchZoneSpeedMax,MathUtils_1.MathUtils.Clamp(Math.abs(s)/this.Hh.PitchSoftZoneMax,0,1));let e=i;return 1!==this.Xhl&&(e=this.A7l(i,t,h*a,s),(i=MathUtils_1.MathUtils.WrapAngle(t-e))>=this.Hh.PitchSoftZoneMin)&&i<=this.Hh.PitchSoftZoneMax&&(this.Xhl=2),e=this.R7l(2===this.Xhl,t,e,this.Hh.PitchSoftZoneMin,this.Hh.PitchSoftZoneMax,this.Hh.PitchDeadZoneMin,this.Hh.PitchDeadZoneMax)}UpdateYawZone(t){return!this.o1h()||1!==this.Hh.CameraZoneMode?this.Hh.DesiredCamera.ArmRotation.Yaw:(this.n1h(),this.s1h(t))}n1h(){var t=MathUtils_1.MathUtils.WrapAngle(this.i1h.ActorRotationProxy.Yaw),i=MathUtils_1.MathUtils.WrapAngle(this.Hh.DesiredCamera.ArmRotation.Yaw),t=MathUtils_1.MathUtils.WrapAngle(t-i);t>=this.Hh.YawSoftZoneMin&&t<=this.Hh.YawSoftZoneMax&&(this.r1h=2),this.s1l()?this.r1h=0:this.a1h()&&this.t1h.HasCameraInput()?this.r1h=1:this.h1h()?2!==this.r1h&&this.l1h()&&(this.r1h=3):this.a1l()&&(2===this.r1h?this.r1h=5:5!==this.r1h&&(this.r1h=4))}s1h(t){if(0===this.r1h)return this.Hh.DesiredCamera.ArmRotation.Yaw;var i,s,h=MathUtils_1.MathUtils.WrapAngle(this.i1h.ActorRotationProxy.Yaw),a=MathUtils_1.MathUtils.WrapAngle(this.Hh.DesiredCamera.ArmRotation.Yaw),e=MathUtils_1.MathUtils.WrapAngle(h-a),t=t*MathUtils_1.MathUtils.Lerp(this.Hh.YawZoneSpeedMin,this.Hh.YawZoneSpeedMax,MathUtils_1.MathUtils.Clamp(Math.abs(e)/this.Hh.YawDeadZoneMax,0,1));let r=a;return 2===this.r1h?r=this.u1h(a,t):3===this.r1h?(r=this.c1h(a,t,e,r),i=this.m1h()?this.Hh.YawSoftZoneMin:this.Hh.YawSoftZoneMax,s=MathUtils_1.MathUtils.WrapAngle(h-r),(e<0&&i<s||0<e&&s<i)&&(this.r1h=2)):4!==this.r1h&&5!==this.r1h||(r=this.d1h(a,h,t,e),(s=MathUtils_1.MathUtils.WrapAngle(h-r))>=this.Hh.YawSoftZoneMin&&s<=this.Hh.YawSoftZoneMax&&(this.r1h=2)),r=this.R7l(2===this.r1h||5===this.r1h,h,r,this.Hh.YawSoftZoneMin,this.Hh.YawSoftZoneMax,this.Hh.YawDeadZoneMin,this.Hh.YawDeadZoneMax)}u1h(t,i){return MathUtils_1.MathUtils.WrapAngle(t+(this.m1h()?i:-i))}c1h(t,i,s,h){return this.g1h(s)?MathUtils_1.MathUtils.WrapAngle(t+i*this.Hh.YawDeadZoneTransToSoftZoneSpeedRatio):this.p1h(s)?MathUtils_1.MathUtils.WrapAngle(t-i*this.Hh.YawDeadZoneTransToSoftZoneSpeedRatio):h}d1h(t,i,s,h){if(h<0){const a=MathUtils_1.MathUtils.WrapAngle(t-s*this.Hh.YawTransToForwardSpeedRatio),e=MathUtils_1.MathUtils.WrapAngle(i-a);return 0<e?i:a}const a=MathUtils_1.MathUtils.WrapAngle(t+s*this.Hh.YawTransToForwardSpeedRatio),e=MathUtils_1.MathUtils.WrapAngle(i-a);return e<0?i:a}A7l(t,i,s,h){if(h<0){const a=MathUtils_1.MathUtils.WrapAngle(t-s),e=MathUtils_1.MathUtils.WrapAngle(i-a);return 0<e?i:a}const a=MathUtils_1.MathUtils.WrapAngle(t+s),e=MathUtils_1.MathUtils.WrapAngle(i-a);return e<0?i:a}R7l(t,i,s,h,a,e,r){var o=MathUtils_1.MathUtils.WrapAngle(i-s),h=t?h:e,e=t?a:r;return o<h?MathUtils_1.MathUtils.WrapAngle(i-h):e<o?MathUtils_1.MathUtils.WrapAngle(i-e):s}s1l(){return 1===this.Hh.CameraZoneMode&&(this.Hh.CharacterMoveEnterState===CharacterUnifiedStateTypes_1.ECharMoveState.Soar||this.$hl.HasKuroRootMotion||this.t1h.IsInCameraDrivenAutoFlightMode()||0<this.Yhl&&0<this.zhl&&!this.IsYawRollback())}i1l(){return 1===this.Hh.CameraZoneMode&&(this.Hh.CharacterMoveEnterState===CharacterUnifiedStateTypes_1.ECharMoveState.Soar||this.$hl.HasKuroRootMotion||this.t1h.IsInCameraDrivenAutoFlightMode()||0<this.Zhl&&!this.IsPitchRollback())}a1h(){return 1!==this.Hh.CameraZoneMode||!this.t1h.IsInCameraDrivenAutoFlightMode()}h1h(){return 1===this.Hh.CameraZoneMode&&this.IsYawInputEnable()&&this.IsYawRollback()}r1l(){return 1===this.Hh.CameraZoneMode&&!this.$hl.HasKuroRootMotion&&this.IsPitchInputEnable()&&this.IsPitchRollback()}m1h(){return 1===this.Hh.CameraZoneMode&&this.i1h.InputDirectProxy.Y<0}l1h(){return 1===this.Hh.CameraZoneMode}g1h(t){return 1===this.Hh.CameraZoneMode&&0<this.i1h.InputDirectProxy.Y&&0<t}p1h(t){return 1===this.Hh.CameraZoneMode&&this.i1h.InputDirectProxy.Y<0&&t<0}a1l(){return 1===this.Hh.CameraZoneMode&&this.IsYawRollback()}o1l(){return 1===this.Hh.CameraZoneMode&&(this.$hl.HasKuroRootMotion||this.IsPitchRollback())}o1h(){return!!this.e1h?.Valid&&!!(this.t1h?.Valid&&this.i1h?.Valid&&this.Khl?.Valid&&this.$hl?.Valid)}IsPitchRollback(){return this.Zhl>=this.Hh.PitchRollbackEnableTime}IsPitchInputEnable(){return this.Jhl>=this.Hh.PitchInputEnableTime}IsYawRollback(){return this.zhl>=this.Hh.YawRollbackEnableTime}IsYawInputEnable(){return this.Yhl>=this.Hh.YawInputEnableTime}IsHasPitchMovement(){return!(!this.Khl?.Valid||!this.i1h?.Valid)&&(this.Khl.SoarBoostOn||!this.i1h.InputDirectProxy.IsNearlyZero())}IsHasPitchUpMovement(){return!!this.Khl?.Valid&&this.i1h.InputDirectProxy.X<0}IsHasPitchHorizontalMovement(){return!(!this.Khl?.Valid||!this.i1h?.Valid)&&this.Khl.SoarBalanceOn}Clear(){this.Hh=void 0,this.e1h=void 0,this.t1h=void 0,this.i1h=void 0,this.Khl=void 0,this.$hl=void 0}}exports.CameraRotationZone=CameraRotationZone;
//# sourceMappingURL=CameraRotationZone.js.map