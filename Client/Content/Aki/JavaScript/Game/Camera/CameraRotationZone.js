
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CameraRotationZone=void 0;const UE=require("ue"),Macro_1=require("../../Core/Preprocessor/Macro"),MathCommon_1=require("../../Core/Utils/Math/MathCommon"),Quat_1=require("../../Core/Utils/Math/Quat"),Rotator_1=require("../../Core/Utils/Math/Rotator"),Vector_1=require("../../Core/Utils/Math/Vector"),MathUtils_1=require("../../Core/Utils/MathUtils"),GlobalData_1=require("../GlobalData"),CharacterUnifiedStateTypes_1=require("../NewWorld/Character/Common/Component/Abilities/CharacterUnifiedStateTypes"),ColorUtils_1=require("../Utils/ColorUtils"),CAMERA_DIRECTION_LENGTH=500,CAMERA_DIRECTION_ARROW_SIZE=2e3;class CameraRotationZone{constructor(){this.Hh=void 0,this.e1h=void 0,this.t1h=void 0,this.i1h=void 0,this.Whl=void 0,this.Qhl=void 0,this.Khl=0,this.r1h=0,this.$hl=0,this.Xhl=0,this.Yhl=0,this.zhl=0,this.az=Quat_1.Quat.Create(),this.Gue=Rotator_1.Rotator.Create(),this.c1e=new Set}Init(t){this.Hh=t}SetCharacter(t){this.e1h=t,this.e1h?.Valid&&(this.t1h=this.e1h.Entity.GetComponent(61),this.i1h=this.e1h.Entity.GetComponent(3),this.Whl=this.e1h.Entity.GetComponent(58),this.Qhl=this.e1h.Entity.GetComponent(172))}UpdateInputState(t){var i,s,h;0===this.Hh.CameraZoneMode||0<this.c1e.size||(i=this.i1h.InputDirectProxy,[s,h]=(this.IsHasPitchMovement()?this.Yhl+=t:this.Yhl=0,this.t1h.GetCameraInput()),MathUtils_1.MathUtils.IsNearlyZero(h,MathUtils_1.MathUtils.KindaSmallNumber)?this.zhl+=t:this.zhl=0,MathUtils_1.MathUtils.IsNearlyZero(i.Y,MathUtils_1.MathUtils.KindaSmallNumber)?this.$hl=0:this.$hl+=t,MathUtils_1.MathUtils.IsNearlyZero(s,MathUtils_1.MathUtils.KindaSmallNumber)?this.Xhl+=t:this.Xhl=0)}UpdatePitchZone(t){if(!this.o1h())return this.Hh.DesiredCamera.ArmRotation.Pitch;if(0===this.Hh.CameraZoneMode)return this.Hh.DesiredCamera.ArmRotation.Pitch;let i=this.i1h.ActorRotation.Pitch;1===this.Hh.CameraZoneMode&&(s=this.i1h.ActorVelocityProxy,MathUtils_1.MathUtils.LookRotationForwardFirst(s,Vector_1.Vector.UpVectorProxy,this.az),this.az.Rotator(this.Gue),i=this.Gue.Pitch);var s=this.Hh.DesiredCamera.ArmRotation.Pitch,h=MathUtils_1.MathUtils.WrapAngle(i-s);return this.Jhl(h),this.Zhl(i,s,h,t)}Jhl(t){t>=this.Hh.PitchSoftZoneMin&&t<=this.Hh.PitchSoftZoneMax&&(this.Khl=2),this.e1l()?this.Khl=0:this.t1h.HasCameraInput()||0<this.c1e.size?this.Khl=1:this.t1l()?2!==this.Khl&&this.l1h()&&(this.Khl=3):this.i1l()&&(this.Khl=4)}Zhl(t,i,s,h){if(0===this.Khl)return i;var e=MathUtils_1.MathUtils.Lerp(this.Hh.PitchZoneSpeedMin,this.Hh.PitchZoneSpeedMax,MathUtils_1.MathUtils.Clamp(Math.abs(s)/this.Hh.PitchSoftZoneMax,0,1));let a=i;return 1!==this.Khl&&(a=this.pQl(i,t,h*e,s),(i=MathUtils_1.MathUtils.WrapAngle(t-a))>=this.Hh.PitchSoftZoneMin)&&i<=this.Hh.PitchSoftZoneMax&&(this.Khl=2),a=this.vQl(2===this.Khl,t,a,this.Hh.PitchSoftZoneMin,this.Hh.PitchSoftZoneMax,this.Hh.PitchDeadZoneMin,this.Hh.PitchDeadZoneMax)}UpdateYawZone(t){return!this.o1h()||0===this.Hh.CameraZoneMode?this.Hh.DesiredCamera.ArmRotation.Yaw:(this.n1h(),this.s1h(t))}n1h(){var t=MathUtils_1.MathUtils.WrapAngle(this.i1h.ActorRotationProxy.Yaw),i=MathUtils_1.MathUtils.WrapAngle(this.Hh.DesiredCamera.ArmRotation.Yaw),t=MathUtils_1.MathUtils.WrapAngle(t-i);t>=this.Hh.YawSoftZoneMin&&t<=this.Hh.YawSoftZoneMax&&(this.r1h=2),this.o1l()?this.r1h=0:this.a1h()&&this.t1h.HasCameraInput()||0<this.c1e.size?this.r1h=1:this.h1h()?2!==this.r1h&&this.l1h()&&(this.r1h=3):this.n1l()&&(2===this.r1h?this.r1h=5:5!==this.r1h&&(this.r1h=4))}s1h(t){if(0===this.r1h)return this.Hh.DesiredCamera.ArmRotation.Yaw;var i,s,h=MathUtils_1.MathUtils.WrapAngle(this.i1h.ActorRotationProxy.Yaw),e=MathUtils_1.MathUtils.WrapAngle(this.Hh.DesiredCamera.ArmRotation.Yaw),a=MathUtils_1.MathUtils.WrapAngle(h-e),t=t*MathUtils_1.MathUtils.Lerp(this.Hh.YawZoneSpeedMin,this.Hh.YawZoneSpeedMax,MathUtils_1.MathUtils.Clamp(Math.abs(a)/this.Hh.YawDeadZoneMax,0,1));let r=e;return 2===this.r1h?r=this.u1h(e,t):3===this.r1h?(r=this.c1h(e,t,a,r),i=this.m1h()?this.Hh.YawSoftZoneMin:this.Hh.YawSoftZoneMax,s=MathUtils_1.MathUtils.WrapAngle(h-r),(a<0&&i<s||0<a&&s<i)&&(this.r1h=2)):4!==this.r1h&&5!==this.r1h||(r=this.d1h(e,h,t,a),(s=MathUtils_1.MathUtils.WrapAngle(h-r))>=this.Hh.YawSoftZoneMin&&s<=this.Hh.YawSoftZoneMax&&(this.r1h=2)),r=this.vQl(2===this.r1h||5===this.r1h,h,r,this.Hh.YawSoftZoneMin,this.Hh.YawSoftZoneMax,this.Hh.YawDeadZoneMin,this.Hh.YawDeadZoneMax)}u1h(t,i){return MathUtils_1.MathUtils.WrapAngle(t+(this.u9_()?this.m1h()?i:-i:0))}c1h(t,i,s,h){return this.g1h(s)?MathUtils_1.MathUtils.WrapAngle(t+i*this.Hh.YawDeadZoneTransToSoftZoneSpeedRatio):this.p1h(s)?MathUtils_1.MathUtils.WrapAngle(t-i*this.Hh.YawDeadZoneTransToSoftZoneSpeedRatio):h}d1h(t,i,s,h){if(h<0){const e=MathUtils_1.MathUtils.WrapAngle(t-s*this.Hh.YawTransToForwardSpeedRatio),a=MathUtils_1.MathUtils.WrapAngle(i-e);return 0<a?i:e}const e=MathUtils_1.MathUtils.WrapAngle(t+s*this.Hh.YawTransToForwardSpeedRatio),a=MathUtils_1.MathUtils.WrapAngle(i-e);return a<0?i:e}pQl(t,i,s,h){if(h<0){const e=MathUtils_1.MathUtils.WrapAngle(t-s),a=MathUtils_1.MathUtils.WrapAngle(i-e);return 0<a?i:e}const e=MathUtils_1.MathUtils.WrapAngle(t+s),a=MathUtils_1.MathUtils.WrapAngle(i-e);return a<0?i:e}vQl(t,i,s,h,e,a,r){var o=MathUtils_1.MathUtils.WrapAngle(i-s),h=t?h:a,a=t?e:r;return o<h?MathUtils_1.MathUtils.WrapAngle(i-h):a<o?MathUtils_1.MathUtils.WrapAngle(i-a):s}o1l(){return!(0<this.c1e.size)&&(1===this.Hh.CameraZoneMode?this.Hh.CharacterMoveEnterState===CharacterUnifiedStateTypes_1.ECharMoveState.Soar||this.Qhl.HasKuroRootMotion||this.t1h.IsInCameraDrivenAutoFlightMode()||0<this.$hl&&0<this.Xhl&&!this.IsYawRollback():2===this.Hh.CameraZoneMode&&0<this.$hl&&0<this.Xhl&&!this.IsYawRollback())}e1l(){return!(0<this.c1e.size)&&(1===this.Hh.CameraZoneMode?this.Hh.CharacterMoveEnterState===CharacterUnifiedStateTypes_1.ECharMoveState.Soar||this.Qhl.HasKuroRootMotion||this.t1h.IsInCameraDrivenAutoFlightMode()||0<this.zhl&&!this.IsPitchRollback():2===this.Hh.CameraZoneMode&&0<this.zhl&&!this.IsPitchRollback())}a1h(){return 1!==this.Hh.CameraZoneMode||!this.t1h.IsInCameraDrivenAutoFlightMode()}h1h(){return 1===this.Hh.CameraZoneMode&&this.IsYawInputEnable()&&this.IsYawRollback()}t1l(){return 1===this.Hh.CameraZoneMode&&!this.Qhl.HasKuroRootMotion&&this.IsPitchInputEnable()&&this.IsPitchRollback()}u9_(){return 1===this.Hh.CameraZoneMode}m1h(){return 1===this.Hh.CameraZoneMode&&this.i1h.InputDirectProxy.Y<0}l1h(){return 1===this.Hh.CameraZoneMode||(this.Hh.CameraZoneMode,!1)}g1h(t){return 1===this.Hh.CameraZoneMode&&0<this.i1h.InputDirectProxy.Y&&0<t}p1h(t){return 1===this.Hh.CameraZoneMode&&this.i1h.InputDirectProxy.Y<0&&t<0}n1l(){return(1===this.Hh.CameraZoneMode||2===this.Hh.CameraZoneMode)&&this.IsYawRollback()}i1l(){return 1===this.Hh.CameraZoneMode?this.Qhl.HasKuroRootMotion||this.IsPitchRollback():2===this.Hh.CameraZoneMode&&this.IsPitchRollback()}o1h(){return!!this.e1h?.Valid&&!!(this.t1h?.Valid&&this.i1h?.Valid&&this.Whl?.Valid&&this.Qhl?.Valid)}IsPitchRollback(){return this.zhl>=this.Hh.PitchRollbackEnableTime}IsPitchInputEnable(){return this.Yhl>=this.Hh.PitchInputEnableTime}IsYawRollback(){return this.Xhl>=this.Hh.YawRollbackEnableTime}IsYawInputEnable(){return this.$hl>=this.Hh.YawInputEnableTime}IsHasPitchMovement(){return!(!this.Whl?.Valid||!this.i1h?.Valid)&&(this.Whl.SoarBoostOn||!this.i1h.InputDirectProxy.IsNearlyZero())}IsHasPitchUpMovement(){return!!this.Whl?.Valid&&this.i1h.InputDirectProxy.X<0}IsHasPitchHorizontalMovement(){return!(!this.Whl?.Valid||!this.i1h?.Valid)&&this.Whl.SoarBalanceOn}Lock(t){this.c1e.add(t)}Unlock(t){this.c1e.delete(t)}Clear(){this.Hh=void 0,this.e1h=void 0,this.t1h=void 0,this.i1h=void 0,this.Whl=void 0,this.Qhl=void 0}}exports.CameraRotationZone=CameraRotationZone;
//# sourceMappingURL=CameraRotationZone.js.map