
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PlayerSoarMonitorController=exports.SLOW_STREAMING_HEIGHT_THRESHOULD=void 0;const UE=require("ue"),Protocol_1=require("../../../Core/Define/Net/Protocol"),ControllerBase_1=require("../../../Core/Framework/ControllerBase"),EventDefine_1=require("../../Common/Event/EventDefine"),EventSystem_1=require("../../Common/Event/EventSystem"),ModelManager_1=require("../../Manager/ModelManager"),CharacterUnifiedStateTypes_1=require("../../NewWorld/Character/Common/Component/Abilities/CharacterUnifiedStateTypes"),EntityToLoadFilterProxy_1=require("../Define/EntityToLoadFilterProxy"),SLOW_STREAMING_HEIGHT_THRESHOULD_CVAR=(exports.SLOW_STREAMING_HEIGHT_THRESHOULD=1500,"wp.Runtime.SoraGridBlackListHeight"),ENABLE_SLOW_STREAMING_ENTITY_FILTER=!0,SOAR_MAX_LOADING_ENTITY_COUNT=1,SOAR_LOADING_INTERVAL=10;class PlayerSoarMonitorLoadEntityFilter extends EntityToLoadFilterProxy_1.EntityToLoadFilterProxy{constructor(){super(...arguments),this.DebugName="PlayerSoarMonitorLoadEntityFilter"}ShouldEntityToBeLoad(e){return!ENABLE_SLOW_STREAMING_ENTITY_FILTER||!PlayerSoarMonitorController.EnableSlowStreaming||e.EntityType===Protocol_1.Aki.Protocol.kks.Proto_Player||e.EntityType===Protocol_1.Aki.Protocol.kks.Proto_SceneItem||e.EntityType===Protocol_1.Aki.Protocol.kks.Proto_PlayerEntity||e.EntityType===Protocol_1.Aki.Protocol.kks.Proto_SceneEntity}get MaxLoadingCount(){return PlayerSoarMonitorController.IsPlayerSoar?SOAR_MAX_LOADING_ENTITY_COUNT:super.MaxLoadingCount}get LoadingInterval(){return PlayerSoarMonitorController.IsPlayerSoar?SOAR_LOADING_INTERVAL:super.LoadingInterval}}class PlayerSoarMonitorController extends ControllerBase_1.ControllerBase{static get IsPlayerSoar(){return this.qJl}static get EnableSlowStreaming(){return this.BJl}static OnInit(){return this.InitTickOptimize(60,-1),this.DEa(),this.GJl.Register(),super.OnInit()}static DEa(){this.HeightThreshould=UE.KismetSystemLibrary.GetConsoleVariableIntValue(SLOW_STREAMING_HEIGHT_THRESHOULD_CVAR),this.HeightThreshould<=0&&(this.HeightThreshould=exports.SLOW_STREAMING_HEIGHT_THRESHOULD)}static OnTick(e){this.kA_(),this.kJl()}static OnClear(){return this.GJl.UnRegister(),super.OnClear()}static kA_(){var e=ModelManager_1.ModelManager.SceneTeamModel.GetCurrentEntity;e?(e=e.Entity.GetComponent(170),this.qJl=!!e&&e.MoveState===CharacterUnifiedStateTypes_1.ECharMoveState.Soar):this.qJl=!1}static kJl(){var e=this.qJl&&this.OJl();this.BJl!==e&&(this.BJl=e,this.GJl.Update(),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.SlowStreamingBySoar,this.BJl))}static OJl(){var e=ModelManager_1.ModelManager.SceneTeamModel.GetCurrentEntity;return!!e&&!!((e=e.Entity.GetComponent(173))&&e.GetHeightAboveGround(this.HeightThreshould+1)>this.HeightThreshould)}}(exports.PlayerSoarMonitorController=PlayerSoarMonitorController).qJl=!1,PlayerSoarMonitorController.BJl=!1,PlayerSoarMonitorController.GJl=new PlayerSoarMonitorLoadEntityFilter;
//# sourceMappingURL=PlayerSoarMonitorController.js.map