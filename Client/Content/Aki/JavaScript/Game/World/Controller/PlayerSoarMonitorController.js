
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PlayerSoarMonitorController=exports.SLOW_STREAMING_HEIGHT_THRESHOULD=void 0;const Protocol_1=require("../../../Core/Define/Net/Protocol"),ControllerBase_1=require("../../../Core/Framework/ControllerBase"),EventDefine_1=require("../../Common/Event/EventDefine"),EventSystem_1=require("../../Common/Event/EventSystem"),ModelManager_1=require("../../Manager/ModelManager"),CharacterUnifiedStateTypes_1=require("../../NewWorld/Character/Common/Component/Abilities/CharacterUnifiedStateTypes"),EntityToLoadFilterProxy_1=require("../Define/EntityToLoadFilterProxy"),ENABLE_SLOW_STREAMING_ENTITY_FILTER=(exports.SLOW_STREAMING_HEIGHT_THRESHOULD=1500,!0),SOAR_MAX_LOADING_ENTITY_COUNT=1,SOAR_LOADING_INTERVAL=10;class PlayerSoarMonitorLoadEntityFilter extends EntityToLoadFilterProxy_1.EntityToLoadFilterProxy{constructor(){super(...arguments),this.DebugName="PlayerSoarMonitorLoadEntityFilter"}ShouldEntityToBeLoad(e){return!ENABLE_SLOW_STREAMING_ENTITY_FILTER||!PlayerSoarMonitorController.EnableSlowStreaming||e.EntityType===Protocol_1.Aki.Protocol.kks.Proto_Player||e.EntityType===Protocol_1.Aki.Protocol.kks.Proto_SceneItem||e.EntityType===Protocol_1.Aki.Protocol.kks.Proto_PlayerEntity||e.EntityType===Protocol_1.Aki.Protocol.kks.Proto_SceneEntity}get MaxLoadingCount(){return PlayerSoarMonitorController.IsPlayerSoar?SOAR_MAX_LOADING_ENTITY_COUNT:super.MaxLoadingCount}get LoadingInterval(){return PlayerSoarMonitorController.IsPlayerSoar?SOAR_LOADING_INTERVAL:super.LoadingInterval}}class PlayerSoarMonitorController extends ControllerBase_1.ControllerBase{static get IsPlayerSoar(){return this.bWl}static get EnableSlowStreaming(){return this.TWl}static OnInit(){return this.InitTickOptimize(60,-1),this.xWl.Register(),super.OnInit()}static OnTick(e){this.Wa1(),this.LWl()}static OnClear(){return this.xWl.UnRegister(),super.OnClear()}static Wa1(){var e=ModelManager_1.ModelManager.SceneTeamModel.GetCurrentEntity;e?(e=e.Entity.GetComponent(164),this.bWl=!!e&&e.MoveState===CharacterUnifiedStateTypes_1.ECharMoveState.Soar):this.bWl=!1}static LWl(){var e=this.bWl&&this.AWl();this.TWl!==e&&(this.TWl=e,this.xWl.Update(),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.SlowStreamingBySoar,this.TWl))}static AWl(){var e=ModelManager_1.ModelManager.SceneTeamModel.GetCurrentEntity;return!!e&&!!((e=e.Entity.GetComponent(167))&&e.GetHeightAboveGround(exports.SLOW_STREAMING_HEIGHT_THRESHOULD+1)>exports.SLOW_STREAMING_HEIGHT_THRESHOULD)}}(exports.PlayerSoarMonitorController=PlayerSoarMonitorController).bWl=!1,PlayerSoarMonitorController.TWl=!1,PlayerSoarMonitorController.xWl=new PlayerSoarMonitorLoadEntityFilter;
//# sourceMappingURL=PlayerSoarMonitorController.js.map