
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PlayerSoarMonitorController=exports.SLOW_STREAMING_HEIGHT_THRESHOULD=void 0;const UE=require("ue"),Protocol_1=require("../../../Core/Define/Net/Protocol"),ControllerBase_1=require("../../../Core/Framework/ControllerBase"),EventDefine_1=require("../../Common/Event/EventDefine"),EventSystem_1=require("../../Common/Event/EventSystem"),ModelManager_1=require("../../Manager/ModelManager"),CharacterUnifiedStateTypes_1=require("../../NewWorld/Character/Common/Component/Abilities/CharacterUnifiedStateTypes"),EntityToLoadFilterProxy_1=require("../Define/EntityToLoadFilterProxy"),SLOW_STREAMING_HEIGHT_THRESHOULD_CVAR=(exports.SLOW_STREAMING_HEIGHT_THRESHOULD=1500,"wp.Runtime.SoraGridBlackListHeight"),ENABLE_SLOW_STREAMING_ENTITY_FILTER=!0,SOAR_MAX_LOADING_ENTITY_COUNT=1,SOAR_LOADING_INTERVAL=10;class PlayerSoarMonitorLoadEntityFilter extends EntityToLoadFilterProxy_1.EntityToLoadFilterProxy{constructor(){super(...arguments),this.DebugName="PlayerSoarMonitorLoadEntityFilter"}ShouldEntityToBeLoad(e){return!ENABLE_SLOW_STREAMING_ENTITY_FILTER||!PlayerSoarMonitorController.EnableSlowStreaming||e.EntityType===Protocol_1.Aki.Protocol.kks.Proto_Player||e.EntityType===Protocol_1.Aki.Protocol.kks.Proto_SceneItem||e.EntityType===Protocol_1.Aki.Protocol.kks.Proto_PlayerEntity||e.EntityType===Protocol_1.Aki.Protocol.kks.Proto_SceneEntity}get MaxLoadingCount(){return PlayerSoarMonitorController.IsPlayerSoar?SOAR_MAX_LOADING_ENTITY_COUNT:super.MaxLoadingCount}get LoadingInterval(){return PlayerSoarMonitorController.IsPlayerSoar?SOAR_LOADING_INTERVAL:super.LoadingInterval}}class PlayerSoarMonitorController extends ControllerBase_1.ControllerBase{static get IsPlayerSoar(){return this.OJl}static get EnableSlowStreaming(){return this.kJl}static OnInit(){return this.InitTickOptimize(60,-1),this.DEa(),this.NJl.Register(),super.OnInit()}static DEa(){this.HeightThreshould=UE.KismetSystemLibrary.GetConsoleVariableIntValue(SLOW_STREAMING_HEIGHT_THRESHOULD_CVAR),this.HeightThreshould<=0&&(this.HeightThreshould=exports.SLOW_STREAMING_HEIGHT_THRESHOULD)}static OnTick(e){this.GA_(),this.GJl()}static OnClear(){return this.NJl.UnRegister(),super.OnClear()}static GA_(){var e=ModelManager_1.ModelManager.SceneTeamModel.GetCurrentEntity;e?(e=e.Entity.GetComponent(173),this.OJl=!!e&&e.MoveState===CharacterUnifiedStateTypes_1.ECharMoveState.Soar):this.OJl=!1}static GJl(){var e=this.OJl&&this.FJl();this.kJl!==e&&(this.kJl=e,this.NJl.Update(),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.SlowStreamingBySoar,this.kJl))}static FJl(){var e=ModelManager_1.ModelManager.SceneTeamModel.GetCurrentEntity;return!!e&&!!((e=e.Entity.GetComponent(176))&&e.GetHeightAboveGround(this.HeightThreshould+1)>this.HeightThreshould)}}(exports.PlayerSoarMonitorController=PlayerSoarMonitorController).OJl=!1,PlayerSoarMonitorController.kJl=!1,PlayerSoarMonitorController.NJl=new PlayerSoarMonitorLoadEntityFilter;
//# sourceMappingURL=PlayerSoarMonitorController.js.map