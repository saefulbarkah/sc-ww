
"use strict";var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.CrashCollectionController=void 0;const cpp_1=require("cpp"),UE=require("ue"),Log_1=require("../../Core/Common/Log"),Stats_1=require("../../Core/Common/Stats"),Protocol_1=require("../../Core/Define/Net/Protocol"),ControllerBase_1=require("../../Core/Framework/ControllerBase"),GameBudgetInterfaceController_1=require("../../Core/GameBudgetAllocator/GameBudgetInterfaceController"),ResourceSystem_1=require("../../Core/Resource/ResourceSystem"),FNameUtil_1=require("../../Core/Utils/FNameUtil"),EventDefine_1=require("../Common/Event/EventDefine"),EventSystem_1=require("../Common/Event/EventSystem"),GameSettingsDeviceRender_1=require("../GameSettings/GameSettingsDeviceRender"),GameSettingsManager_1=require("../GameSettings/GameSettingsManager"),GlobalData_1=require("../GlobalData"),ModelManager_1=require("../Manager/ModelManager"),FormationDataController_1=require("../Module/Abilities/FormationDataController");class CrashCollectionController extends ControllerBase_1.ControllerBase{static BPa(){if(Stats_1.Stat.Enable)return FormationDataController_1.FormationDataController.GlobalIsInFight?this.bPa:this.qPa}static GPa(){if(Stats_1.Stat.Enable)return GameBudgetInterfaceController_1.GameBudgetInterfaceController.IsInFight?this.OPa:this.kPa}static NPa(){if(Stats_1.Stat.Enable)return ModelManager_1.ModelManager.PlotModel?.IsInPlot?this.FPa:this.VPa}static HPa(){if(Stats_1.Stat.Enable)return GameBudgetInterfaceController_1.GameBudgetInterfaceController.IsInPlot?this.jPa:this.WPa}static cDa(e){if(Stats_1.Stat.Enable)return Stats_1.Stat.CreateNoFlameGraph("Level: "+e)}static ZFa(){if(Stats_1.Stat.Enable)return 2===ResourceSystem_1.ResourceSystem.GetLoadMode()?this.e3a:this.t3a}static OnInit(){return this.sCe(),this.Zyl=GameSettingsManager_1.GameSettingsManager.Get(10),this.Zyl?this.Zyl.OnCurrentValueChange=this.cCe:Log_1.Log.CheckError()&&Log_1.Log.Error("Game",36,"[CrashCollectionController::Init] ImageQualityHandle Get Failed"),cpp_1.FKuroCrashCollectionController.Initialize(GlobalData_1.GlobalData.World,new UE.FName("ActorLocation"),new UE.FName("ActorRotation"),new UE.FName("CameraLocation"),new UE.FName("CameraRotation"),new UE.FName("World")),super.OnInit()}static OnClear(){return this.aCe(),super.OnClear()}static sCe(){EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.TodTimeChange,this.hCe),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.LoginSuccess,this.gSe),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.ReConnectSuccess,this.gSe),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnAddNewQuest,this.Xoo),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnQuestStateChange,this.DSe)}static aCe(){EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.TodTimeChange,this.hCe),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.LoginSuccess,this.gSe),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.ReConnectSuccess,this.gSe),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnAddNewQuest,this.Xoo),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnQuestStateChange,this.DSe)}static OnTick(e){this.lCe()}static lCe(){this.BPa(),this.GPa(),this.NPa(),this.HPa(),this.ZFa()}static SCe(){var e=ModelManager_1.ModelManager.TimeOfDayModel;e&&(e=e.GameTime.HourMinuteString,cpp_1.FCrashSightProxy.SetCustomDataByFName(this.ICe,e))}static eEl(){cpp_1.FCrashSightProxy.SetCustomDataByFName(this.RCe,this.tEl.join(", "))}static xGn(){var e=ModelManager_1.ModelManager.LoginModel.GetReconnectHost(),t=ModelManager_1.ModelManager.LoginModel.GetReconnectPort();cpp_1.FCrashSightProxy.SetCustomDataByFName(this.BGn,e+":"+t)}static RecordHttpInfo(e){cpp_1.FCrashSightProxy.SetCustomDataByFName(this.bGn,e)}}exports.CrashCollectionController=CrashCollectionController,(_a=CrashCollectionController).MJ=Stats_1.Stat.Create("CrashCollectionController.GatherCrashInfo"),CrashCollectionController.TCe=Stats_1.Stat.Create("CrashCollectionController.GatherQualityLevel"),CrashCollectionController.DCe=Stats_1.Stat.Create("CrashCollectionController.GatherQuestInfo"),CrashCollectionController.yCe=Stats_1.Stat.Create("CrashCollectionController.GatherTODInfo"),CrashCollectionController.PGn=Stats_1.Stat.Create("CrashCollectionController.GatherGateWayInfo"),CrashCollectionController.wGn=Stats_1.Stat.Create("CrashCollectionController.RecordHttpInfo"),CrashCollectionController.ICe=FNameUtil_1.FNameUtil.GetDynamicFName("TODTime"),CrashCollectionController.LCe=FNameUtil_1.FNameUtil.GetDynamicFName("QualityLevel"),CrashCollectionController.RCe=FNameUtil_1.FNameUtil.GetDynamicFName("QuestIds"),CrashCollectionController.BGn=FNameUtil_1.FNameUtil.GetDynamicFName("GateWay"),CrashCollectionController.bGn=FNameUtil_1.FNameUtil.GetDynamicFName("HttpInfo"),CrashCollectionController.bPa=Stats_1.Stat.Create("Origin IsFight: True"),CrashCollectionController.qPa=Stats_1.Stat.Create("Origin IsFight: False"),CrashCollectionController.FPa=Stats_1.Stat.Create("Origin IsCutscene: True"),CrashCollectionController.VPa=Stats_1.Stat.Create("Origin IsCutscene: False"),CrashCollectionController.OPa=Stats_1.Stat.Create("GameBudget IsFight: True"),CrashCollectionController.kPa=Stats_1.Stat.Create("GameBudget IsFight: False"),CrashCollectionController.jPa=Stats_1.Stat.Create("GameBudget IsCutscene: True"),CrashCollectionController.WPa=Stats_1.Stat.Create("GameBudget IsCutscene: False"),CrashCollectionController.e3a=Stats_1.Stat.Create("LoadModel: InGame"),CrashCollectionController.t3a=Stats_1.Stat.Create("LoadModel: InLoading"),CrashCollectionController.Zyl=void 0,CrashCollectionController.hCe=()=>{_a.SCe()},CrashCollectionController.cCe=e=>{var t=GameSettingsDeviceRender_1.GameSettingsDeviceRender.GameQualitySettingLevel;e!==t&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("Game",36,"GGGGG"),_a.cDa(t);cpp_1.FCrashSightProxy.SetCustomDataByFName(_a.LCe,e.toString())},CrashCollectionController.tEl=new Array,CrashCollectionController.Xoo=e=>{1===e.Type&&e.IsProgressing&&!_a.tEl.includes(e.Id)&&(_a.tEl.push(e.Id),_a.eEl())},CrashCollectionController.DSe=(e,t)=>{var r=ModelManager_1.ModelManager.QuestNewModel.GetQuest(e);r&&1===r.Type&&(t===Protocol_1.Aki.Protocol.hTs.nvs?_a.tEl.includes(e)||(_a.tEl.push(e),_a.eEl()):-1<(r=_a.tEl.indexOf(e))&&(_a.tEl.splice(r,1),_a.eEl()))},CrashCollectionController.gSe=()=>{_a.xGn()};
//# sourceMappingURL=CrashCollectionController.js.map