
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RedDotSystem=void 0;const cpp_1=require("cpp"),Log_1=require("../../Core/Common/Log"),List_1=require("../../Core/Container/List"),Macro_1=require("../../Core/Preprocessor/Macro"),ModelManager_1=require("../Manager/ModelManager");class RedDotEventData{constructor(t,e,s){this.Event=t,this.Id=e,this.RedDotName=s}HandleEvent(){this.Event(this.Id)}}const TICK_TOTAL_TIME=500;class RedDotSystem{static PushToEventQueue(t,e,s){var i=s+e;this.Ctl.has(i)||(this.Esh?.RedDotName===s&&this.Esh?.Id===e?Log_1.Log.CheckError()&&Log_1.Log.Error("RedDot",69,"红点处理存在循环调用, 详情见堆栈",["红点名",s]):(t=this.GetRedDotEventData(t,e,s),this.gtl.AddTail(t),this.Ctl.add(i)))}static ftl(){var t=this.gtl.GetHeadNextNode(),e=t.Element;this.Esh=e,this.gtl.RemoveNode(t),this.Ctl.delete(e.RedDotName+e.Id),e.HandleEvent(),this.Esh=void 0,this.Ish.push(e)}static Tick(t){if(1===ModelManager_1.ModelManager.GameModeModel?.LoadingPhase){var e=this.gtl.Count;if(!(e<=0)){let t=e;for(;0<this.ptl&&0<t;){var s=cpp_1.KuroTime.GetMicroseconds64(),s=(this.ftl(),cpp_1.KuroTime.GetMicroseconds64()-s);this.ptl-=s,t--}cpp_1.FKuroPerfSightHelper.PostValueFloat1("RedDot","RedDotCostPerFrame",(TICK_TOTAL_TIME-this.ptl)/1e3),this.ptl=TICK_TOTAL_TIME}}}static GetRedDotEventData(t,e,s){var i;return 0<this.Ish.length?((i=this.Ish.pop()).Event=t,i.Id=e,i.RedDotName=s,i):new RedDotEventData(t,e,s)}}(exports.RedDotSystem=RedDotSystem).gtl=new List_1.default(new RedDotEventData(t=>{},0,"")),RedDotSystem.Ish=[],RedDotSystem.Ctl=new Set,RedDotSystem.Esh=void 0,RedDotSystem.ptl=TICK_TOTAL_TIME,RedDotSystem.IsOpenLogCallTime=!1;
//# sourceMappingURL=RedDotSystem.js.map