
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const UE=require("ue"),Protocol_1=require("../../Core/Define/Net/Protocol"),QueryTypeDefine_1=require("../../Core/Define/QueryTypeDefine"),Vector_1=require("../../Core/Utils/Math/Vector"),TraceElementCommon_1=require("../../Core/Utils/TraceElementCommon"),TsBaseCharacter_1=require("../Character/TsBaseCharacter"),GlobalData_1=require("../GlobalData"),PROFILE_KEY="FightCameraLogicComponent_CheckCollision_ExecutionAdjust",AIRWALL_PORFILENAME="InvisibleWall";class TsAnimNotifyStateCaughtBinding extends UE.KuroAnimNotifyState{constructor(){super(...arguments),this.CaughtIds=void 0,this.DetectionRadius=500,this.SkillId=0}Constructor(){this.SkillId=0}K2_NotifyBegin(e,t,i){var r,e=e.GetOwner();return e instanceof TsBaseCharacter_1.default&&!!(e=e.CharacterActorComponent.Entity)&&(r=e.GetComponent(35),this.SkillId=r?.CurrentSkill?.SkillId??0,r?.SetCurAnInfo(this.exportIndex,t.GetName()),!!(r=e.GetComponent(46)))&&(0<this.DetectionRadius&&this.CheckPosition(r),r.BeginCaught(this.CaughtIds,this.SkillId),!0)}CheckPosition(i){for(let e=0;e<this.CaughtIds.Num();e++){var r=this.CaughtIds.Get(e),o=i.Entity.GetComponent(3),r=i.PendingCaughtList.get(r);if(!r)return;TsAnimNotifyStateCaughtBinding.InitTrace();var s=o?.ActorLocationProxy,n=TsAnimNotifyStateCaughtBinding.SphereTrace,a=(TraceElementCommon_1.TraceElementCommon.SetStartLocation(n,s),TraceElementCommon_1.TraceElementCommon.SetEndLocation(n,s),n.Radius=this.DetectionRadius,TraceElementCommon_1.TraceElementCommon.SphereTrace(n,PROFILE_KEY));if(!a)return;let t=!1;for(let e=0;e<n.HitResult.GetHitCount();e++)if((n.HitResult?.Components.Get(e).GetCollisionProfileName())?.toString().includes(AIRWALL_PORFILENAME)){t=!0;break}if(!t)return;var c,a=r[0].GetComponent(0);a?.GetEntityType()===Protocol_1.Aki.Protocol.kks.Proto_Monster&&(a=Vector_1.Vector.Create(a?.GetInitLocation()),s=Vector_1.Vector.Create(s),c=Vector_1.Vector.Create(),a.Subtraction(s,c),c.Normalize(),c.Multiply(this.DetectionRadius,c),a=Vector_1.Vector.Create(o?.ActorLocation).AdditionEqual(c),o?.SetActorLocation(a.ToUeVector(),"ExecutionAdjustMove",!1),s=r[0].GetComponent(3),o=Vector_1.Vector.Create(s?.ActorLocation).AdditionEqual(c),r[0].GetComponent(3)?.SetActorLocation(o.ToUeVector(),"ExecutionAdjustMove",!1))}}static InitTrace(){this.SphereTrace=UE.NewObject(UE.TraceSphereElement.StaticClass()),this.SphereTrace.bIsSingle=!1,this.SphereTrace.bIgnoreSelf=!0,this.SphereTrace.bTraceComplex=!0,this.SphereTrace.AddObjectTypeQuery(QueryTypeDefine_1.KuroObjectTypeQuery.WorldStatic),this.SphereTrace.AddObjectTypeQuery(QueryTypeDefine_1.KuroObjectTypeQuery.WorldStaticIgnoreBullet),this.SphereTrace.WorldContextObject=GlobalData_1.GlobalData.World}K2_NotifyEnd(e,t){var i,e=e.GetOwner();return e instanceof TsBaseCharacter_1.default&&!(!e.CharacterActorComponent||!(e=e.CharacterActorComponent.Entity)||(i=e.GetComponent(46),e.GetComponent(35)?.SetCurAnInfo(this.exportIndex,t.GetName()),!i)||(i.EndCaught(),0))}GetNotifyName(){return"抓取绑定"}}TsAnimNotifyStateCaughtBinding.SphereTrace=void 0,exports.default=TsAnimNotifyStateCaughtBinding;
//# sourceMappingURL=TsAnimNotifyStateCaughtBinding.js.map