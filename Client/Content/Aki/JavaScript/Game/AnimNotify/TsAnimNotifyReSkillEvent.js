
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const UE=require("ue"),Log_1=require("../../Core/Common/Log"),FNameUtil_1=require("../../Core/Utils/FNameUtil"),TsBaseCharacter_1=require("../Character/TsBaseCharacter"),ModelManager_1=require("../Manager/ModelManager"),BulletUtil_1=require("../NewWorld/Bullet/BulletUtil"),BaseSkillComponent_1=require("../NewWorld/Character/Common/Component/Skill/BaseSkillComponent");class TsAnimNotifyReSkillEvent extends UE.KuroAnimNotify{constructor(){super(...arguments),this.子弹数据名=void 0,this.子弹出生位置偏移=void 0,this.子弹初速度偏移=void 0,this.子弹id数组=void 0,this.子弹出生位置偏移数组=void 0,this.子弹初速度偏移数组=void 0,this.使用子弹id数组=!1,this.使用召唤者子弹=!1,this.随机子弹权重数组=void 0}Constructor(){}K2_Notify(t,i){let r=t.GetOwner(),e=void 0;if(r instanceof TsBaseCharacter_1.default){if(!(e=r.CharacterActorComponent?.Entity)?.Valid)return!1;var s=e.GetComponent(207)?.CreateAnimNotifyContent(i.GetName(),this.exportIndex);if(this.使用召唤者子弹){i=e.GetComponent(0).GetSummonerId();if(!(0<i))return!1;if(e=ModelManager_1.ModelManager.CreatureModel.GetEntity(i)?.Entity,r=e.GetComponent(3).Actor,!e?.Valid)return!1;if(!(r instanceof TsBaseCharacter_1.default))return!1}i=e.GetComponent(39);if(!i?.Valid)return!1;var o=i.GetCurrentMontageCorrespondingSkillId()?.toString()??"0",l="0"===o?i.GetSkillIdWithGroupId(BaseSkillComponent_1.SKILL_GROUP_MAIN).toString():o,a=new UE.TransformDouble;if(this.使用子弹id数组){var h=this.子弹id数组.Num(),i=this.GetRandomIndex(),n=this.子弹出生位置偏移数组.Num(),u=this.子弹初速度偏移数组.Num();if(0<=i&&i<h){let e=void 0,t=void 0;i<n&&(e=this.子弹出生位置偏移数组.Get(i)),i<u&&(t=this.子弹初速度偏移数组.Get(i)),BulletUtil_1.BulletUtil.CreateBulletFromAN(r,this.子弹id数组.Get(i),a,l,!1,s,void 0,e,t)}else for(let i=0;i<h;i++){let e=void 0,t=void 0;n>i&&(e=this.子弹出生位置偏移数组.Get(i)),u>i&&(t=this.子弹初速度偏移数组.Get(i)),BulletUtil_1.BulletUtil.CreateBulletFromAN(r,this.子弹id数组.Get(i),a,l,!1,s,void 0,e,t)}}else BulletUtil_1.BulletUtil.CreateBulletFromAN(r,this.子弹数据名.toString(),a,l,!1,s,void 0,this.子弹出生位置偏移,this.子弹初速度偏移);return!0}if(!(this.使用子弹id数组?this.子弹id数组.Num()<=0:FNameUtil_1.FNameUtil.IsNothing(this.子弹数据名))){o=UE.KuroRenderingRuntimeBPPluginBPLibrary.GetWorldType(r.GetWorld());if(2===o||4===o){var i=UE.KismetSystemLibrary.GetOuterObject(this),v=UE.KismetSystemLibrary.GetPathName(i);if(this.使用子弹id数组){var d=this.子弹id数组,f=d.Num(),o=this.GetRandomIndex();if(0<=o&&o<f)UE.BPL_BulletPreview_C.ShowBulletPreview(v,new UE.FName(d.Get(o)),r,t,r.GetWorld(),void 0);else for(let e=0;e<f;e++)UE.BPL_BulletPreview_C.ShowBulletPreview(v,new UE.FName(d.Get(e)),r,t,r.GetWorld(),void 0)}else UE.BPL_BulletPreview_C.ShowBulletPreview(v,this.子弹数据名,r,t,r.GetWorld(),void 0)}}return!1}GetNotifyName(){return"添加子弹"}GetRandomIndex(){var r=this.随机子弹权重数组.Num();if(!(r<=0))if(r!==this.子弹id数组.Num())Log_1.Log.CheckError()&&Log_1.Log.Error("Bullet",28,"随机子弹权重数量对不上！");else{let t=0;for(let e=0;e<r;e++){var s=this.随机子弹权重数组.Get(e);0<s&&(t+=s)}let i=Math.random()*t;for(let e=0;e<r;e++){var o=this.随机子弹权重数组.Get(e);if(!(o<=0)&&(i-=o)<=0)return e}}return-1}}exports.default=TsAnimNotifyReSkillEvent;
//# sourceMappingURL=TsAnimNotifyReSkillEvent.js.map