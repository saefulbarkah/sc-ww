
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const UE=require("ue"),Log_1=require("../../Core/Common/Log"),FNameUtil_1=require("../../Core/Utils/FNameUtil"),TsBaseCharacter_1=require("../Character/TsBaseCharacter"),ModelManager_1=require("../Manager/ModelManager"),BulletUtil_1=require("../NewWorld/Bullet/BulletUtil"),BaseSkillComponent_1=require("../NewWorld/Character/Common/Component/Skill/BaseSkillComponent");class TsAnimNotifyReSkillEvent extends UE.KuroAnimNotify{constructor(){super(...arguments),this.子弹数据名=void 0,this.子弹出生位置偏移=void 0,this.子弹初速度偏移=void 0,this.子弹id数组=void 0,this.子弹出生位置偏移数组=void 0,this.子弹初速度偏移数组=void 0,this.使用子弹id数组=!1,this.使用召唤者子弹=!1,this.随机子弹权重数组=void 0}Constructor(){}K2_Notify(t,i){let r=!1,s=t.GetOwner();if(this.使用召唤者子弹&&s instanceof TsBaseCharacter_1.default){let e=s.CharacterActorComponent?.Entity;if(!e?.Valid)return!1;var o=e.GetComponent(0).GetSummonerId();if(!(0<o))return!1;r=!0,e.GetComponent(39)?.SetCurAnInfo(this.exportIndex,i.GetName()),e=ModelManager_1.ModelManager.CreatureModel.GetEntity(o)?.Entity,s=e.GetComponent(3).Actor}if(s instanceof TsBaseCharacter_1.default){o=s.CharacterActorComponent?.Entity;if(!o?.Valid)return!1;o=o.GetComponent(39);if(!o?.Valid)return!1;o.SetCurAnInfo(this.exportIndex,i.GetName());var i=o.GetCurrentMontageCorrespondingSkillId()?.toString()??"0",l="0"===i?o.GetSkillIdWithGroupId(BaseSkillComponent_1.SKILL_GROUP_MAIN).toString():i,a=new UE.TransformDouble;if(this.使用子弹id数组){var e=this.子弹id数组.Num(),o=this.GetRandomIndex(),h=this.子弹出生位置偏移数组.Num(),n=this.子弹初速度偏移数组.Num();if(0<=o&&o<e){let e=void 0,t=void 0;o<h&&(e=this.子弹出生位置偏移数组.Get(o)),o<n&&(t=this.子弹初速度偏移数组.Get(o)),BulletUtil_1.BulletUtil.CreateBulletFromAN(s,this.子弹id数组.Get(o),a,l,!1,void 0,e,t,r)}else for(let i=0;i<e;i++){let e=void 0,t=void 0;h>i&&(e=this.子弹出生位置偏移数组.Get(i)),n>i&&(t=this.子弹初速度偏移数组.Get(i)),BulletUtil_1.BulletUtil.CreateBulletFromAN(s,this.子弹id数组.Get(i),a,l,!1,void 0,e,t,r)}}else BulletUtil_1.BulletUtil.CreateBulletFromAN(s,this.子弹数据名.toString(),a,l,!1,void 0,this.子弹出生位置偏移,this.子弹初速度偏移,r);return!0}if(!(this.使用子弹id数组?this.子弹id数组.Num()<=0:FNameUtil_1.FNameUtil.IsNothing(this.子弹数据名))){i=UE.KuroRenderingRuntimeBPPluginBPLibrary.GetWorldType(s.GetWorld());if(2===i||4===i){var o=UE.KismetSystemLibrary.GetOuterObject(this),u=UE.KismetSystemLibrary.GetPathName(o);if(this.使用子弹id数组){var v=this.子弹id数组,d=v.Num(),i=this.GetRandomIndex();if(0<=i&&i<d)UE.BPL_BulletPreview_C.ShowBulletPreview(u,new UE.FName(v.Get(i)),s,t,s.GetWorld(),void 0);else for(let e=0;e<d;e++)UE.BPL_BulletPreview_C.ShowBulletPreview(u,new UE.FName(v.Get(e)),s,t,s.GetWorld(),void 0)}else UE.BPL_BulletPreview_C.ShowBulletPreview(u,this.子弹数据名,s,t,s.GetWorld(),void 0)}}return!1}GetNotifyName(){return"添加子弹"}GetRandomIndex(){var r=this.随机子弹权重数组.Num();if(!(r<=0))if(r!==this.子弹id数组.Num())Log_1.Log.CheckError()&&Log_1.Log.Error("Bullet",28,"随机子弹权重数量对不上！");else{let t=0;for(let e=0;e<r;e++){var s=this.随机子弹权重数组.Get(e);0<s&&(t+=s)}let i=Math.random()*t;for(let e=0;e<r;e++){var o=this.随机子弹权重数组.Get(e);if(!(o<=0)&&(i-=o)<=0)return e}}return-1}}exports.default=TsAnimNotifyReSkillEvent;
//# sourceMappingURL=TsAnimNotifyReSkillEvent.js.map