
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const UE=require("ue"),AudioSystem_1=require("../../Core/Audio/AudioSystem"),Log_1=require("../../Core/Common/Log"),ModelManager_1=require("../Manager/ModelManager");class TsAnimNotifyAudioEvent extends UE.KuroAnimNotify{constructor(){super(...arguments),this.AudioEvent=void 0,this.SocketName=void 0,this.Follow=!0,this.TagProbabilityInfo=void 0}GetNotifyName(){return this.AudioEvent?"AudioEvent: "+(0,AudioSystem_1.parseAudioEventPath)(this.AudioEvent):"AudioEvent"}K2_Notify(t,i){if(!this.AudioEvent)return Log_1.Log.CheckWarn()&&Log_1.Log.Warn("Audio",56,"[Game.AnimNotify] 无效的 AudioEvent",["AnimNotify",this.GetName()],["AnimSequence",UE.KismetSystemLibrary.GetPathName(i)]),!1;var o,s=(0,AudioSystem_1.parseAudioEventPath)(this.AudioEvent);if(s){let e=!0;if(!(e=t.GetOwner()?.IsA(UE.TsBaseCharacter_C.StaticClass())&&(o=t.GetOwner().CharacterActorComponent?.Entity)?ModelManager_1.ModelManager.GameAudioModel?.CheckAudioProbabilityInfo(o.Id,s,this.TagProbabilityInfo)??!1:e))return!0;this.PostAudioEvent(s,t,i)}return!0}PostAudioEvent(e,t,i){var o=t.GetOwner();o?.IsValid()&&(this.Follow?(o=this.GetAkComponent(o,this.SocketName))?.IsValid()&&(o=AudioSystem_1.AudioSystem.PostEvent(e,o),Log_1.Log.CheckDebug())&&Log_1.Log.Debug("Audio",56,"[Game.AnimNotify] PostEvent",["EventName",e],["Handle",o],["AnimNotify",this.GetName()],["AnimSequence",UE.KismetSystemLibrary.GetPathName(i)]):(o=t.GetSocketTransform(this.SocketName),t=AudioSystem_1.AudioSystem.PostEvent(e,o),Log_1.Log.CheckDebug()&&Log_1.Log.Debug("Audio",56,"[Game.AnimNotify] PostEvent",["EventName",e],["Handle",t],["AnimNotify",this.GetName()],["AnimSequence",UE.KismetSystemLibrary.GetPathName(i)])))}GetAkComponent(e,t){let i=void 0;if(e.IsA(UE.TsBaseCharacter_C.StaticClass())){var o=e.CharacterActorComponent?.Entity?.GetComponent(44);if(!o?.Valid)return;i=o.GetAkComponent(t)}else e.IsA(UE.TsUiSceneRoleActor_C.StaticClass())?i=AudioSystem_1.AudioSystem.GetAkComponent(e,{SocketName:t,OnCreated:e=>{AudioSystem_1.AudioSystem.SetSwitch("actor_ui_switch","sys_ui",e)}}):e.IsA(UE.Actor.StaticClass())&&(i=AudioSystem_1.AudioSystem.GetAkComponent(e,{SocketName:t,OnCreated:e=>{AudioSystem_1.AudioSystem.SetSwitch("char_p1orp3","p1",e)}}));if(i?.IsValid())return i;Log_1.Log.CheckError()&&Log_1.Log.Error("Audio",56,"[Game.AnimNotify] GetAkComponent 失败",["Owner",e.GetName()],["Socket",t],["Class",e.GetClass().GetName()])}}exports.default=TsAnimNotifyAudioEvent;
//# sourceMappingURL=TsAnimNotifyAudioEvent.js.map