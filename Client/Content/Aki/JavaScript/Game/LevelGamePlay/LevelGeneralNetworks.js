
"use strict";var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.LevelGeneralNetworks=exports.WAIT_ENTITY_ERROR_TIME=void 0;const Log_1=require("../../Core/Common/Log"),EntitySelfEventConfigByKey_1=require("../../Core/Define/ConfigQuery/EntitySelfEventConfigByKey"),Protocol_1=require("../../Core/Define/Net/Protocol"),EntitySystem_1=require("../../Core/Entity/EntitySystem"),Net_1=require("../../Core/Net/Net"),GameplayTagUtils_1=require("../../Core/Utils/GameplayTagUtils"),MathUtils_1=require("../../Core/Utils/MathUtils"),IComponent_1=require("../../UniverseEditor/Interface/IComponent"),EventDefine_1=require("../Common/Event/EventDefine"),EventSystem_1=require("../Common/Event/EventSystem"),ModelManager_1=require("../Manager/ModelManager"),GeneralLogicTreeDefine_1=require("../Module/GeneralLogicTree/Define/GeneralLogicTreeDefine"),InstanceDungeonController_1=require("../Module/InstanceDungeon/InstanceDungeonController"),TsInteractionUtils_1=require("../Module/Interaction/TsInteractionUtils"),SceneItemDynamicAttachTargetComponent_1=require("../NewWorld/SceneItem/Common/Component/SceneItemDynamicAttachTargetComponent"),SceneItemJigsawBaseComponent_1=require("../NewWorld/SceneItem/Jigsaw/SceneItemJigsawBaseComponent"),SceneItemUtility_1=require("../NewWorld/SceneItem/Util/SceneItemUtility"),CombatLog_1=require("../Utils/CombatLog"),BlackboardController_1=require("../World/Controller/BlackboardController"),CreatureController_1=require("../World/Controller/CreatureController"),GameModeController_1=require("../World/Controller/GameModeController"),WaitEntityTask_1=require("../World/Define/WaitEntityTask"),AlertAreaController_1=require("./AlertArea/AlertAreaController"),LevelGamePlayUtils_1=require("./LevelGamePlayUtils"),LevelGeneralCommons_1=require("./LevelGeneralCommons"),LevelGeneralContextDefine_1=require("./LevelGeneralContextDefine"),LevelGeneralContextUtil_1=require("./LevelGeneralContextUtil"),LevelGeneralController_1=require("./LevelGeneralController");exports.WAIT_ENTITY_ERROR_TIME=9e4;class LevelGeneralNetworks{static Register(){Net_1.Net.Register(24737,this.QUe),Net_1.Net.Register(21618,LevelGeneralNetworks.XUe),Net_1.Net.Register(29116,LevelGeneralNetworks.$Ue),Net_1.Net.Register(26190,LevelGeneralNetworks.YUe),Net_1.Net.Register(16477,LevelGeneralNetworks.JUe),Net_1.Net.Register(27510,this.zUe),Net_1.Net.Register(29506,this.OTl),Net_1.Net.Register(20598,this.ZUe),Net_1.Net.Register(20247,this.Iqn),Net_1.Net.Register(24552,this.eAe),Net_1.Net.Register(25459,this.tAe),Net_1.Net.Register(15115,this.iAe),Net_1.Net.Register(28079,this.mza),Net_1.Net.Register(24934,this.dza),Net_1.Net.Register(21871,this.rAe),Net_1.Net.Register(21280,this.nAe),Net_1.Net.Register(21227,this.sAe),Net_1.Net.Register(17031,this.BPl),Net_1.Net.Register(27690,this.aAe),Net_1.Net.Register(19715,this.hAe),Net_1.Net.Register(26420,this.lAe),Net_1.Net.Register(19492,this._Ae),Net_1.Net.Register(15500,this.uAe),Net_1.Net.Register(27636,this.URn),Net_1.Net.Register(16935,this.sQs),Net_1.Net.Register(16939,this.mla),Net_1.Net.Register(23567,this.u3a),Net_1.Net.Register(17250,this.$Ja),Net_1.Net.Register(21178,this.$rh),Net_1.Net.Register(24015,this.tll),Net_1.Net.Register(29147,this.yMl),Net_1.Net.Register(29643,this.rEl),Net_1.Net.Register(22175,this.oEl),Net_1.Net.Register(29521,this.nEl),Net_1.Net.Register(16005,this.xTl),Net_1.Net.Register(24342,this.rwl),Net_1.Net.Register(25325,this.e5l)}static UnRegister(){Net_1.Net.UnRegister(24737),Net_1.Net.UnRegister(21618),Net_1.Net.UnRegister(29116),Net_1.Net.UnRegister(26190),Net_1.Net.UnRegister(27510),Net_1.Net.UnRegister(20598),Net_1.Net.UnRegister(20247),Net_1.Net.UnRegister(24552),Net_1.Net.UnRegister(15115),Net_1.Net.UnRegister(28079),Net_1.Net.UnRegister(24934),Net_1.Net.UnRegister(21871),Net_1.Net.UnRegister(21227),Net_1.Net.UnRegister(27690),Net_1.Net.UnRegister(26420),Net_1.Net.UnRegister(19492),Net_1.Net.UnRegister(15500),Net_1.Net.UnRegister(27636),Net_1.Net.UnRegister(16939),Net_1.Net.UnRegister(23567),Net_1.Net.UnRegister(17250),Net_1.Net.UnRegister(21178),Net_1.Net.UnRegister(24015),Net_1.Net.UnRegister(29147),Net_1.Net.UnRegister(29643),Net_1.Net.UnRegister(22175),Net_1.Net.UnRegister(29521),Net_1.Net.UnRegister(16005),Net_1.Net.UnRegister(24342),Net_1.Net.UnRegister(25325)}static cAe(e){var t,o=MathUtils_1.MathUtils.LongToNumber(e.F4n),o=ModelManager_1.ModelManager.CreatureModel.GetEntity(o)?.Entity?.GetComponent(145);o?(t=MathUtils_1.MathUtils.LongToNumber(e.bDs),o.SetControllerId(t),e.BDs&&o.ResetItemLocationAndRotation()):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",31,"[ControllerIdModifyNotify] 找不到Entity对应的SceneItemManipulatableComponent")}static Tqn(e,t){var o=ModelManager_1.ModelManager.CreatureModel?.GetEntity(e),r=o?.Entity?.GetComponent(147);o?.Valid&&r?r.SetAutonomousId(t):CombatLog_1.CombatLog.Error("Move",o?.Entity,"[ControllerIdModifyNotify] 场景物找不到对应的实体或移动同步组件",["entityId",e],["posSender",t])}static mAe(e){var t=MathUtils_1.MathUtils.LongToNumber(e.xDs),o=MathUtils_1.MathUtils.LongToNumber(e.wDs),e=e.BIs-1,r=ModelManager_1.ModelManager.CreatureModel.GetEntityByPbDataId(t);r?.Valid?EventSystem_1.EventSystem.EmitWithTarget(r.Entity,EventDefine_1.EEventName.OnManipulatableSceneItemPosInFoundation,o,e):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",31,"BeControlledPosInFoundationNotify下发的Id找不到对应的Entity",["EntityConfigId",t])}static dAe(e){var t=MathUtils_1.MathUtils.LongToNumber(e.F4n),t=ModelManager_1.ModelManager.CreatureModel.GetEntity(t),o=MathUtils_1.MathUtils.LongToNumber(e.bDs),o=ModelManager_1.ModelManager.CreatureModel.GetEntity(o),r=o?.Entity?.GetComponent(3);r&&!r.IsRoleAndCtrlByMe&&(r=o.Entity.GetComponent(58),e.q5n?r.ActiveHandFX(t.Entity):r.DeactiveHandFx())}static Cza(e){var t,o,r=MathUtils_1.MathUtils.LongToNumber(e.Co1),r=ModelManager_1.ModelManager.CreatureModel.GetEntityByPbDataId(r),a=r.Entity.GetComponent(126),r=r.Entity.GetComponent(150);r&&r.Valid&&(r=r.Config.Config.Type,t=MathUtils_1.MathUtils.LongToNumber(e.nLs.iLs),t=ModelManager_1.ModelManager.CreatureModel.GetEntityByPbDataId(t).Entity.GetComponent(127),o=new SceneItemJigsawBaseComponent_1.JigsawIndex(e.nLs.l8n.N5n,e.nLs.l8n.F5n),t.Rotation=e.nLs.l8n.V5n,a.PutDownItem(t,o,r))}static gza(e){var t,o,r=MathUtils_1.MathUtils.LongToNumber(e.Co1),r=ModelManager_1.ModelManager.CreatureModel.GetEntityByPbDataId(r),a=r.Entity.GetComponent(126),r=r.Entity.GetComponent(150);r&&r.Valid&&(r=r.Config.Config.Type,t=MathUtils_1.MathUtils.LongToNumber(e.nLs.iLs),t=ModelManager_1.ModelManager.CreatureModel.GetEntityByPbDataId(t).Entity.GetComponent(127),o=new SceneItemJigsawBaseComponent_1.JigsawIndex(e.nLs.l8n.N5n,e.nLs.l8n.F5n),t.Rotation=e.nLs.l8n.V5n,a.PickUpItem(t,o,r))}static gAe(e){var t=MathUtils_1.MathUtils.LongToNumber(e.G5n),t=ModelManager_1.ModelManager.CreatureModel.GetEntity(t).Entity.GetComponent(126),o=MathUtils_1.MathUtils.LongToNumber(e.O5n),o=ModelManager_1.ModelManager.CreatureModel.GetEntity(o).Entity.GetComponent(127),r=new SceneItemJigsawBaseComponent_1.JigsawIndex(e.k5n.N5n,e.k5n.F5n);o.Rotation=e.k5n.V5n,t.PickUpItem(o,r,IComponent_1.EItemFoundation.BuildingBlock),t.PutDownItem(o,r,IComponent_1.EItemFoundation.BuildingBlock)}static fAe(e){e=MathUtils_1.MathUtils.LongToNumber(e.j5n);ModelManager_1.ModelManager.CreatureModel.GetEntity(e).Entity.GetComponent(126).OnFinish()}static pAe(r,a,l,n){LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",7,"执行EntityGroupAction，等待创建Entity",["CreatureDataId",a],["PlayerId",r.W5n],["SessionId",r.w5n],["StartIndex",r.K5n],["EndIndex",r.mvs]),WaitEntityTask_1.WaitEntityTask.Create(a,t=>{if(t){t=ModelManager_1.ModelManager.CreatureModel.GetEntity(a);if(t){var o=t.Entity.GetComponent(0)?.GetPbEntityInitData();if(o){o=(0,IComponent_1.getComponent)(o.ComponentsData,"EntityGroupComponent");if(o&&o?.StateTriggers?.length){let e=o.StateTriggers[n]?.SuccessActions;(e=l?e:o.StateTriggers[n]?.FailActions)?.length&&(LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",7,"执行EntityGroupAction，Entity创建完毕",["CreatureDataId",a],["PlayerId",r.W5n],["SessionId",r.w5n],["StartIndex",r.K5n],["EndIndex",r.mvs]),LevelGeneralController_1.LevelGeneralController.ExecuteActionsByServerNotify(e,LevelGeneralContextDefine_1.EntityContext.Create(t.Id),r.W5n,r.w5n,r.K5n,r.mvs,r.tt1))}}}}},exports.WAIT_ENTITY_ERROR_TIME,!0,!0)}static MNl(o,r){LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",7,"执行EntityGroupFailureAction，等待创建Entity",["CreatureDataId",r],["PlayerId",o.W5n],["SessionId",o.w5n],["StartIndex",o.K5n],["EndIndex",o.mvs]),WaitEntityTask_1.WaitEntityTask.Create(r,e=>{var t;e&&(e=ModelManager_1.ModelManager.CreatureModel.GetEntity(r))&&(t=e.Entity.GetComponent(0)?.GetPbEntityInitData())&&(t=(0,IComponent_1.getComponent)(t.ComponentsData,"EntityGroupComponent")?.FailureState?.FailureOperations.Actions)?.length&&(LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",7,"执行EntityGroupFailureAction，Entity创建完毕",["CreatureDataId",r],["PlayerId",o.W5n],["SessionId",o.w5n],["StartIndex",o.K5n],["EndIndex",o.mvs]),LevelGeneralController_1.LevelGeneralController.ExecuteActionsByServerNotify(t,LevelGeneralContextDefine_1.EntityContext.Create(e.Id),o.W5n,o.w5n,o.K5n,o.mvs,o.tt1))},exports.WAIT_ENTITY_ERROR_TIME,!0,!0)}static RequestSceneItemStateChange(e,t){var o=Protocol_1.Aki.Protocol.fms.create();o.F4n=MathUtils_1.MathUtils.NumberToLong(ModelManager_1.ModelManager.CreatureModel.GetCreatureDataId(e)),o.Q5n=t,Net_1.Net.Call(29900,o,e=>{})}static RequestActiveOrDeactiveManipulateFx(e,t){var o=Protocol_1.Aki.Protocol.Dds.create();o.F4n=MathUtils_1.MathUtils.NumberToLong(ModelManager_1.ModelManager.CreatureModel.GetCreatureDataId(e)),o.q5n=t,Net_1.Net.Call(27432,o,e=>{})}static RequestAwakePbEntity(e,t){}static RequestSpawnPbEntity(e,t){t(!0)}static RequestChangeEntityState(t,e){var o=Protocol_1.Aki.Protocol.pds.create();o.F4n=t.EntityId,o.X5n=GameplayTagUtils_1.GameplayTagUtils.GetTagIdByName(t.State),Net_1.Net.Call(16391,o,e=>{e&&e.Q4n===Protocol_1.Aki.Protocol.Q4n.KRs&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("Level",7,"[LevelGeneralController.RequestChangeEntityState] 请求实体状态改变成功",["PbDataId:",t.EntityId],["TargetState:",t.State])})}static RequestEntitySendEvent(t,o){var e;void 0===EntitySelfEventConfigByKey_1.configEntitySelfEventConfigByKey.GetConfig(o)?Log_1.Log.CheckError()&&Log_1.Log.Error("Level",64,"[LevelGeneralController.RequestEntitySendEvent] 不能获取实体事件配置，请在s.实体自身事件文件夹中添加配置",["creatureDataId:",t],["eventKey:",o]):((e=Protocol_1.Aki.Protocol.tts.create()).F4n=t,e.$5n=o,Net_1.Net.Call(20297,e,e=>{e&&e.Q4n===Protocol_1.Aki.Protocol.Q4n.KRs&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("Level",35,"[LevelGeneralController.EntitySendEventResponse] 请求实体监听事件成功",["creatureDataId:",t],["eventKey:",o])}))}static RequestDoAction(e,t){}static RequestSetInitTagRequest(e){var t;e&&((t=Protocol_1.Aki.Protocol.Vds.create()).F4n=MathUtils_1.MathUtils.NumberToLong(e),Net_1.Net.Call(15870,t,e=>{}))}static RequestActionsFinish(e,t,o,r,a){var l=Protocol_1.Aki.Protocol.d$n.create();l.W5n=e,l.w5n=t,l.K5n=o,l.J5n=r,Net_1.Net.Call(26602,l,a)}static RequestEntityInteractOption(e,t,o,r){var a=Protocol_1.Aki.Protocol.Res.create();a.F4n=MathUtils_1.MathUtils.NumberToLong(e),a.z5n=t,r&&(a.Z5n=r),Net_1.Net.Call(25493,a,o)}static RequestEntityDynamicInteractOption(e,t,o){var r=Protocol_1.Aki.Protocol.Ues.create();r.F4n=MathUtils_1.MathUtils.NumberToLong(e),r.e6n=t,Net_1.Net.Call(21605,r,o)}static RequestEntityRandomInteractOption(e,t,o){var r=Protocol_1.Aki.Protocol.Aes.create();r.F4n=MathUtils_1.MathUtils.NumberToLong(e),r.z5n=t,Net_1.Net.Call(24239,r,o)}static RequestClientTeleportByClientTrigger(e,t,o,r,a,l,n){var i=Protocol_1.Aki.Protocol.RJl.create(),o=(i.P5n=o,i.g8n=r,i.mpl=Protocol_1.Aki.Protocol.ha1.dpl,Protocol_1.Aki.Protocol.la1.create()),r=Protocol_1.Aki.Protocol.Cpl.create(),a=(r.c5n=a,Protocol_1.Aki.Protocol.IOs.create()),_=(a.fvs=Protocol_1.Aki.Protocol.TOs.Proto_ClientTriggerActionCtx,Protocol_1.Aki.Protocol.Is1.create()),l=(_.SDs=l,Protocol_1.Aki.Protocol.DOs.create());l.v9n=t,l.w5n=e,_.eps=l,a.dpl=_,r.gpl=a,o.Cpl=r,i.ppl=o,Net_1.Net.Call(25782,i,n)}static RequestClientTeleportByNoRenderPortal(e,t,o,r){var a=Protocol_1.Aki.Protocol.RJl.create();a.P5n=Protocol_1.Aki.Protocol.Gks.create(),a.P5n.X=t.X,a.P5n.Y=t.Y,a.P5n.Z=t.Z,a.g8n=Protocol_1.Aki.Protocol.D2s.create(),a.g8n.Roll=o.Roll,a.g8n.Pitch=o.Pitch,a.g8n.Yaw=o.Yaw,a.mpl=Protocol_1.Aki.Protocol.ha1.Proto_NoRenderPortalComponent,a.ppl=Protocol_1.Aki.Protocol.la1.create(),a.ppl.MIl=Protocol_1.Aki.Protocol.MIl.create(),a.ppl.MIl.F4n=e,Net_1.Net.Call(25782,a,r)}static IsEntityEnableAwake(e){if(ModelManager_1.ModelManager.GameModeModel.IsMulti&&ModelManager_1.ModelManager.PlayerInfoModel.GetId()!==ModelManager_1.ModelManager.CreatureModel.GetWorldOwner())for(const t of e)ModelManager_1.ModelManager.CreatureModel.GetEntityData(t);return!0}static CheckCurrentPlayerIsParticipator(e){if(!e)return!1;let t=!1;switch(e.Type){case 2:t=LevelGeneralNetworks.vAe(e.QuestId);break;case 3:t=LevelGeneralNetworks.MAe(e.LevelPlayId);break;case 4:t=LevelGeneralNetworks.EAe(e.InstanceDungeonId);break;case 6:t=LevelGeneralNetworks.SAe(e.BtType,e.TreeConfigId);break;case 1:t=!0}return t}static SAe(e,t){let o=!1;switch(e){case Protocol_1.Aki.Protocol.hps.Proto_BtTypeQuest:o=LevelGeneralNetworks.vAe(t);break;case Protocol_1.Aki.Protocol.hps.Proto_BtTypeLevelPlay:o=LevelGeneralNetworks.MAe(t);break;case Protocol_1.Aki.Protocol.hps.Proto_BtTypeInst:o=LevelGeneralNetworks.EAe(t)}return o}static vAe(e){e=ModelManager_1.ModelManager.QuestNewModel.GetQuest(e);if(!e)return!1;let t=!1;switch(e.OnlineType){case"SingleHangUpOnline":t=!ModelManager_1.ModelManager.GameModeModel.IsMulti;break;case"SingleNotHangUpOnline":t=ModelManager_1.ModelManager.CreatureModel.IsMyWorld()}return t}static MAe(e){e=ModelManager_1.ModelManager.LevelPlayModel.GetProcessingLevelPlayInfo(e);if(!e)return!1;let t=!1;switch(e.OnlineType){case"Local":t=!ModelManager_1.ModelManager.GameModeModel.IsMulti;break;case"SingleOnline":t=ModelManager_1.ModelManager.CreatureModel.IsMyWorld();break;case"Multiplayer":t=!0}return t}static EAe(e){return!!GameModeController_1.GameModeController.IsInInstance()&&ModelManager_1.ModelManager.CreatureModel.GetInstanceId()===e}static RequestPlayerAccessEffectArea(e,t){var o=Protocol_1.Aki.Protocol.Ugs.create();o.zWn=MathUtils_1.MathUtils.NumberToLong(ModelManager_1.ModelManager.CreatureModel.GetCreatureDataId(e)),o.i6n=t?Protocol_1.Aki.Protocol.i6n.Proto_RangeEnter:Protocol_1.Aki.Protocol.i6n.Proto_RangeLeave,Net_1.Net.Call(20983,o,e=>{})}static aQs(e,t,o){e=ModelManager_1.ModelManager.CreatureModel.GetEntity(e)?.Entity?.GetComponent(215);e&&(o?e.ServerConnectEntities(t):e.ServerDisconnectEntities(t))}static PushEntityTimeDilation(e,t){var o=Protocol_1.Aki.Protocol.y$l.create();o.F4n=e,o.dKn=t,Net_1.Net.Send(17764,o)}static CheckEntityCanPushTimeDilation(e){return!ModelManager_1.ModelManager.GameModeModel.IsMulti&&1===e}static RequestEntityCameraAlertStateChange(o,r){var e=Protocol_1.Aki.Protocol.BZl.create();e.F4n=o,e.j2l=r,Net_1.Net.Call(24466,e,e=>{var t=!r&&e?.Q4n===Protocol_1.Aki.Protocol.Q4n.Proto_CameraAlertHasNotAlert||r&&e?.Q4n===Protocol_1.Aki.Protocol.Q4n.Proto_CameraAlertHasAlert;e&&(t||e.Q4n===Protocol_1.Aki.Protocol.Q4n.KRs)||Log_1.Log.CheckError()&&Log_1.Log.Error("Level",35,"[LevelGeneralNetworks.RequestEntityCameraAlertStateChange] 请求摄像头预警触发状态变更失败",["CreatureDataId",o],["IsAlert",r])})}}exports.LevelGeneralNetworks=LevelGeneralNetworks,(_a=LevelGeneralNetworks).XUe=o=>{WaitEntityTask_1.WaitEntityTask.Create(MathUtils_1.MathUtils.LongToNumber(o.F4n),e=>{var t;e?(e=ModelManager_1.ModelManager.CreatureModel.GetEntity(MathUtils_1.MathUtils.LongToNumber(o.F4n)))?.Valid&&(t=LevelGeneralContextUtil_1.LevelGeneralContextUtil.CreateByServerContext(o.cvs),ModelManager_1.ModelManager.InteractionModel.AddInteractOption(e.Entity,o.e6n,t,o.DIs,o.XCa)):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",36,"[EntityAddDynamicInteractNotify] 等待实体创建时，实体被移除（可能因为加载失败）",["id",MathUtils_1.MathUtils.LongToBigInt(o.F4n)])},exports.WAIT_ENTITY_ERROR_TIME,!0,!0)},LevelGeneralNetworks.$Ue=t=>{WaitEntityTask_1.WaitEntityTask.Create(MathUtils_1.MathUtils.LongToNumber(t.F4n),e=>{e?(e=ModelManager_1.ModelManager.CreatureModel.GetEntity(MathUtils_1.MathUtils.LongToNumber(t.F4n)))&&ModelManager_1.ModelManager.InteractionModel.RemoveInteractOption(e.Entity,t.e6n):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",36,"[EntityRemoveDynamicInteractNotify] 等待实体创建时，实体被移除（可能因为加载失败）",["id",MathUtils_1.MathUtils.LongToNumber(t.F4n)])},exports.WAIT_ENTITY_ERROR_TIME,!0,!0)},LevelGeneralNetworks.YUe=t=>{WaitEntityTask_1.WaitEntityTask.Create(MathUtils_1.MathUtils.LongToNumber(t.F4n),e=>{e?(e=ModelManager_1.ModelManager.CreatureModel.GetEntity(MathUtils_1.MathUtils.LongToNumber(t.F4n)))&&ModelManager_1.ModelManager.InteractionModel.ChangeOptionText(e.Entity,t.e6n,t.DIs):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",36,"[OnEntityChangeDynamicInteractTextNotify] 等待实体创建时，实体被移除（可能因为加载失败）",["id",MathUtils_1.MathUtils.LongToNumber(t.F4n)])},exports.WAIT_ENTITY_ERROR_TIME,!0,!0)},LevelGeneralNetworks.JUe=t=>{WaitEntityTask_1.WaitEntityTask.Create(MathUtils_1.MathUtils.LongToNumber(t.F4n),e=>{e?(e=ModelManager_1.ModelManager.CreatureModel.GetEntity(MathUtils_1.MathUtils.LongToNumber(t.F4n)))?.Valid&&ModelManager_1.ModelManager.InteractionModel.LockInteraction(e.Entity,t.gTs):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",36,"[EntityInteractFinishNotify] 等待实体创建时，实体被移除（可能因为加载失败）",["id",MathUtils_1.MathUtils.LongToBigInt(t.F4n)])},exports.WAIT_ENTITY_ERROR_TIME,!0,!0)},LevelGeneralNetworks.zUe=e=>{var t=ModelManager_1.ModelManager.CreatureModel.GetEntity(MathUtils_1.MathUtils.LongToNumber(e.F4n));t&&t.Entity.GetComponent(122)?.UpdateState(e.m5n,e.CTs)},LevelGeneralNetworks.OTl=e=>{var t=MathUtils_1.MathUtils.LongToNumber(e.F4n),o=ModelManager_1.ModelManager.CreatureModel?.GetEntity(t);o?.Valid&&o.Entity?o.Entity.GetComponent(147)?.ModifyBlackboardFromRemote(e.C6n,e.So1):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",19,"SceneItemBlackboardNotify下发的Id找不到对应的Entity",["Entity Id",t])},LevelGeneralNetworks.ZUe=t=>{var e=MathUtils_1.MathUtils.LongToNumber(t.F4n),o=MathUtils_1.MathUtils.LongToNumber(t.bDs);const r=new Array;r.push(e),0!==o&&r.push(o),WaitEntityTask_1.WaitEntityTask.Create(r,e=>{e?LevelGeneralNetworks.cAe(t):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",31,"[ControllerIdModifyNotify] 等待之后还是找不到对应的Entity",["ids",r])})},LevelGeneralNetworks.Iqn=e=>{const t=MathUtils_1.MathUtils.LongToNumber(e.F4n),o=MathUtils_1.MathUtils.LongToNumber(e.wIs);WaitEntityTask_1.WaitEntityTask.Create(t,e=>{e?LevelGeneralNetworks.Tqn(t,o):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",31,"[ControllerIdModifyNotify] 等待之后还是找不到对应的Entity",["entityId",t])})},LevelGeneralNetworks.eAe=t=>{var e=ModelManager_1.ModelManager.CreatureModel.GetInstanceId();if(e===t.r6n){const o=new Array;o.push(MathUtils_1.MathUtils.LongToNumber(t.xDs)),0!==t.wDs&&o.push(MathUtils_1.MathUtils.LongToNumber(t.wDs)),WaitEntityTask_1.WaitEntityTask.CreateWithPbDataId(o,e=>{e?LevelGeneralNetworks.mAe(t):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",31,"[RelationIdModifyNotif] 等待之后还是找不到对应的Entity",["ids",o])})}},LevelGeneralNetworks.tll=t=>{var e=ModelManager_1.ModelManager.CreatureModel.GetInstanceId();if(e===t.r6n){const o=new Array;o.push(MathUtils_1.MathUtils.LongToNumber(t.Oo1)),0!==t.wDs&&o.push(MathUtils_1.MathUtils.LongToNumber(t.wDs)),WaitEntityTask_1.WaitEntityTask.CreateWithPbDataId(o,e=>{e?LevelGeneralNetworks.ill(t):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",31,"[ItemRelateFoundationNotify] 等待之后还是找不到对应的Entity",["ids",o])})}},LevelGeneralNetworks.ill=e=>{var t=MathUtils_1.MathUtils.LongToNumber(e.Oo1),o=MathUtils_1.MathUtils.LongToNumber(e.wDs),t=ModelManager_1.ModelManager.CreatureModel.GetEntityByPbDataId(t),r=ModelManager_1.ModelManager.CreatureModel.GetEntityByPbDataId(o);r?.Valid?(r=r.Entity.GetComponent(249))?(r.EntityInSocket=t?.Entity,e.x9n===Protocol_1.Aki.Protocol.ma1.Proto_ItemRelateFoundationReason_Init&&r.InitMatch(o)):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",31,"ItemRelateFoundationNotify指定的Entity缺少SceneItemGenericOutletComponent",["EntityConfigId",o]):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",31,"ItemRelateFoundationNotify下发的Id找不到对应的Entity",["EntityConfigId",o])},LevelGeneralNetworks.tAe=e=>{var t=MathUtils_1.MathUtils.LongToNumber(e.F4n),o=ModelManager_1.ModelManager.CreatureModel.GetEntity(t);if(o?.Valid){var r=o?.Entity?.GetComponent(114);if(r){var a=new SceneItemDynamicAttachTargetComponent_1.AttachParam;switch(a.PosAttachType=2,a.PosAttachOffset=e.o6n,a.PosAbsolute=!1,a.RotAttachType=2,a.RotAttachOffset=e.n6n,a.RotAbsolute=!1,e.s6n){case Protocol_1.Aki.Protocol.nFs.Proto_AttachTargetEntity:r.IsRegTarget()&&r.UnRegTarget("[EntityAttachChangeNotify] AttachTargetEntity"),r.RegEntityTarget(e.h6n.a6n,e.h6n.l6n,a,"[EntityAttachChangeNotify] AttachTargetEntity");break;case Protocol_1.Aki.Protocol.nFs.Proto_AttachTargetActorPath:r.IsRegTarget()&&r.UnRegTarget("[EntityAttachChangeNotify] AttachTargetActorPath"),r.RegRefActorTarget(e._6n,a,"[EntityAttachChangeNotify] AttachTargetActorPath");break;case Protocol_1.Aki.Protocol.nFs.Proto_AttachTargetNone:r.UnRegTarget("[EntityAttachChangeNotify] AttachTargetNone")}}else Log_1.Log.CheckError()&&Log_1.Log.Error("Level",39,"EntityAttachChangeNotify指定的Entity缺少DynamicAttachComp",["EntityConfigId",t])}else Log_1.Log.CheckError()&&Log_1.Log.Error("Level",39,"EntityAttachChangeNotify下发的EntityId找不到对应的Entity",["EntityConfigId",t])},LevelGeneralNetworks.iAe=t=>{var e=MathUtils_1.MathUtils.LongToNumber(t.F4n),o=MathUtils_1.MathUtils.LongToNumber(t.bDs);const r=new Array;r.push(e),r.push(o),WaitEntityTask_1.WaitEntityTask.Create(r,e=>{e?LevelGeneralNetworks.dAe(t):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",31,"[FxShowNotify] 等待之后还是找不到对应的Entity",["ids",r])})},LevelGeneralNetworks.mza=t=>{var e=MathUtils_1.MathUtils.LongToNumber(t.Co1),o=MathUtils_1.MathUtils.LongToNumber(t.nLs.iLs);const r=new Array;r.push(e),r.push(o),WaitEntityTask_1.WaitEntityTask.CreateWithPbDataId(r,e=>{e?LevelGeneralNetworks.Cza(t):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",31,"[OnAddPlacementNotify] 等待之后还是找不到对应的Entity",["ids",r])})},LevelGeneralNetworks.dza=t=>{var e=MathUtils_1.MathUtils.LongToNumber(t.Co1),o=MathUtils_1.MathUtils.LongToNumber(t.nLs.iLs);const r=new Array;r.push(e),r.push(o),WaitEntityTask_1.WaitEntityTask.CreateWithPbDataId(r,e=>{e?LevelGeneralNetworks.gza(t):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",31,"[OnRemovePlacementFromBoardNotify] 等待之后还是找不到对应的Entity",["ids",r])})},LevelGeneralNetworks.rAe=t=>{var e=MathUtils_1.MathUtils.LongToNumber(t.G5n),o=MathUtils_1.MathUtils.LongToNumber(t.O5n);const r=new Array;r.push(e),r.push(o),WaitEntityTask_1.WaitEntityTask.Create(r,e=>{e?LevelGeneralNetworks.gAe(t):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",31,"[OnPlaceItemOnBoardNotify] 等待之后还是找不到对应的Entity",["ids",r])})},LevelGeneralNetworks.nAe=t=>{const o=MathUtils_1.MathUtils.LongToNumber(t.j5n);WaitEntityTask_1.WaitEntityTask.Create(o,e=>{e?_a.fAe(t):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",31,"[OnPlaceItemOnBoardNotify] 等待之后还是找不到对应的Entity",["baseId",o])})},LevelGeneralNetworks.QUe=t=>{var o=t.cvs,r=t.w5n;if(LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen){let e="";try{e=JSON.stringify(o)}catch{e="Context序列化解析失败"}Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",7,"服务端驱动执行行为组",["Context",e],["PlayerId",t.W5n],["SessionId",r],["Total",t.dvs],["StartIndex",t.K5n],["EndIndex",t.mvs],["NeedFinishReq",t.tt1])}switch(o.fvs){case Protocol_1.Aki.Protocol.TOs.Svs:LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",7,"服务端驱动执行行为组（动态交互）"),TsInteractionUtils_1.TsInteractionUtils.HandleEntityDynamicInteractByServerNotify(t,o.Svs.e6n);break;case Protocol_1.Aki.Protocol.TOs.Avs:var e=o.Avs._ps,a=ModelManager_1.ModelManager.LevelPlayModel.GetProcessingLevelPlayInfo(e);a?(l=a.LevelPlayOpenAction)&&0!==l.length&&(Log_1.Log.CheckInfo()&&Log_1.Log.Info("SceneGameplay",18,"开始执行玩法开启/刷新动作"),LevelGeneralController_1.LevelGeneralController.ExecuteActionsByServerNotify(l,LevelGeneralContextDefine_1.LevelPlayContext.Create(a.Id),t.W5n,t.w5n,t.K5n,t.mvs,t.tt1)):Log_1.Log.CheckError()&&Log_1.Log.Error("GeneralLogicTree",18,"服务器通知玩法执行行为时：对应的玩法不存在，联系程序检查Bug",["treeType",GeneralLogicTreeDefine_1.btTypeLogString[Protocol_1.Aki.Protocol.hps.Proto_BtTypeLevelPlay]],["treeId",e]);break;case Protocol_1.Aki.Protocol.TOs.Proto_LeaveInstEscActionCtx:var l=o.$ma?.Xma,a=ModelManager_1.ModelManager.InstanceDungeonModel.GetInstanceDungeonInfo();a?(e=a.FinishEscAction)&&0!==e.length?(Log_1.Log.CheckInfo()&&Log_1.Log.Info("SceneGameplay",18,"开始执行副本玩法执行ESC退出行为"),LevelGeneralController_1.LevelGeneralController.ExecuteActionsByServerNotify(e,LevelGeneralContextDefine_1.InstanceDungeonContext.Create(l),t.W5n,t.w5n,t.K5n,t.mvs,t.tt1)):Log_1.Log.CheckError()&&Log_1.Log.Error("GeneralLogicTree",7,"服务器通知副本玩法执行ESC退出行为时：对应的行为数据不存在或者长度为0，联系程序检查Bug",["treeType",GeneralLogicTreeDefine_1.btTypeLogString[Protocol_1.Aki.Protocol.hps.Proto_BtTypeInst]],["treeId",l]):Log_1.Log.CheckError()&&Log_1.Log.Error("GeneralLogicTree",7,"服务器通知玩法执行ESC退出行为时：对应的副本玩法不存在，联系程序检查Bug",["treeType",GeneralLogicTreeDefine_1.btTypeLogString[Protocol_1.Aki.Protocol.hps.Proto_BtTypeInst]],["treeId",l]);break;case Protocol_1.Aki.Protocol.TOs.Pvs:a=o.Pvs._ps,e=ModelManager_1.ModelManager.LevelPlayModel.GetProcessingLevelPlayInfo(a);e?(l=e.AfterGetRewardAction)&&0!==l.length&&(Log_1.Log.CheckInfo()&&Log_1.Log.Info("SceneGameplay",18,"开始执行玩法开启/刷新动作"),LevelGeneralController_1.LevelGeneralController.ExecuteActionsByServerNotify(l,LevelGeneralContextDefine_1.LevelPlayContext.Create(e.Id),t.W5n,t.w5n,t.K5n,t.mvs,t.tt1)):Log_1.Log.CheckError()&&Log_1.Log.Error("GeneralLogicTree",18,"服务器通知玩法执行行为时：对应的玩法不存在，联系程序检查Bug",["treeType",GeneralLogicTreeDefine_1.btTypeLogString[Protocol_1.Aki.Protocol.hps.Proto_BtTypeLevelPlay]],["treeId",a]);break;case Protocol_1.Aki.Protocol.TOs.Uvs:l=o.Uvs.B5n,e=ModelManager_1.ModelManager.QuestNewModel.GetQuest(l);if(!e)return void(Log_1.Log.CheckError()&&Log_1.Log.Error("GeneralLogicTree",18,"服务器通知任务执行行为时：对应的任务不存在，联系程序检查Bug",["treeType",GeneralLogicTreeDefine_1.btTypeLogString[Protocol_1.Aki.Protocol.hps.Proto_BtTypeQuest]],["treeId",l]));a=e.ActiveActions;a&&0!==a.length&&LevelGeneralController_1.LevelGeneralController.ExecuteActionsByServerNotify(a,LevelGeneralContextDefine_1.QuestContext.Create(l),t.W5n,t.w5n,t.K5n,t.mvs,t.tt1);break;case Protocol_1.Aki.Protocol.TOs.wvs:e=o.wvs.B5n,a=ModelManager_1.ModelManager.QuestNewModel.GetQuest(e);if(!a)return void(Log_1.Log.CheckError()&&Log_1.Log.Error("GeneralLogicTree",18,"服务器通知任务执行行为时：对应的任务不存在，联系程序检查Bug",["treeType",GeneralLogicTreeDefine_1.btTypeLogString[Protocol_1.Aki.Protocol.hps.Proto_BtTypeQuest]],["treeId",e]));l=a.AcceptActions;l&&0!==l.length&&LevelGeneralController_1.LevelGeneralController.ExecuteActionsByServerNotify(l,LevelGeneralContextDefine_1.QuestContext.Create(e),t.W5n,t.w5n,t.K5n,t.mvs,t.tt1);break;case Protocol_1.Aki.Protocol.TOs.xvs:a=o.xvs.B5n,l=ModelManager_1.ModelManager.QuestNewModel.GetQuest(a);if(!l)return void(Log_1.Log.CheckError()&&Log_1.Log.Error("GeneralLogicTree",18,"服务器通知任务执行行为时：对应的任务不存在，联系程序检查Bug",["treeType",GeneralLogicTreeDefine_1.btTypeLogString[Protocol_1.Aki.Protocol.hps.Proto_BtTypeQuest]],["treeId",a]));e=l.FinishActions;e&&0!==e.length&&LevelGeneralController_1.LevelGeneralController.ExecuteActionsByServerNotify(e,LevelGeneralContextDefine_1.QuestContext.Create(a),t.W5n,t.w5n,t.K5n,t.mvs,t.tt1);break;case Protocol_1.Aki.Protocol.TOs.Yvs:l=o.Yvs.B5n,e=ModelManager_1.ModelManager.QuestNewModel.GetQuest(l);if(!e)return void(Log_1.Log.CheckError()&&Log_1.Log.Error("GeneralLogicTree",18,"服务器通知任务执行行为时：对应的任务不存在，联系程序检查Bug",["treeType",GeneralLogicTreeDefine_1.btTypeLogString[Protocol_1.Aki.Protocol.hps.Proto_BtTypeQuest]],["treeId",l]));a=e.TerminateActions;a&&0!==a.length&&LevelGeneralController_1.LevelGeneralController.ExecuteActionsByServerNotify(a,LevelGeneralContextDefine_1.QuestContext.Create(l),t.W5n,t.w5n,t.K5n,t.mvs,t.tt1);break;case Protocol_1.Aki.Protocol.TOs.bvs:case Protocol_1.Aki.Protocol.TOs.Bvs:case Protocol_1.Aki.Protocol.TOs.qvs:case Protocol_1.Aki.Protocol.TOs.Gvs:case Protocol_1.Aki.Protocol.TOs.Ovs:case Protocol_1.Aki.Protocol.TOs.$vs:EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.BehaviorTreeStartActionSession,t);break;case Protocol_1.Aki.Protocol.TOs.Mvs:e=MathUtils_1.MathUtils.LongToNumber(o.Mvs.eps.w5n);LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",7,"服务端驱动执行行为组（EntityInteractAction）",["CreatureDataId",e]),TsInteractionUtils_1.TsInteractionUtils.HandleEntityInteractByServerNotify(t,e,o.Mvs.z5n);break;case Protocol_1.Aki.Protocol.TOs.Proto_EntityStateChangeAction:a=MathUtils_1.MathUtils.LongToNumber(o.yvs.eps.w5n);LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",7,"服务端驱动执行行为组（EntityStateChangeAction）",["CreatureDataId",a]),SceneItemUtility_1.SceneItemUtility.HandleSceneItemStateActionByServerNotify(t,a,o.yvs.tps);break;case Protocol_1.Aki.Protocol.TOs.Ivs:l=MathUtils_1.MathUtils.LongToNumber(o.Ivs.eps.w5n);LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",7,"服务端驱动执行行为组（EntityGroupAction）",["CreatureDataId",l]),LevelGeneralNetworks.pAe(t,l,o.Ivs.u6n,o.Ivs.ips);break;case Protocol_1.Aki.Protocol.TOs.zvs:e=MathUtils_1.MathUtils.LongToNumber(o.zvs.eps.w5n);LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",7,"服务端驱动执行行为组（EntityGroupFailureAction）",["CreatureDataId",e]),LevelGeneralNetworks.MNl(t,e);break;case Protocol_1.Aki.Protocol.TOs.Tvs:a=MathUtils_1.MathUtils.LongToNumber(o.Tvs.eps.w5n),l=MathUtils_1.MathUtils.LongToNumber(o.Tvs.rps);LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",7,"服务端驱动执行行为组（EntityTriggerAction）",["CreatureDataId",a]),SceneItemUtility_1.SceneItemUtility.HandleTriggerStateActionByServerNotify(t,a,l);break;case Protocol_1.Aki.Protocol.TOs.Proto_EntityLeaveTrigger:e=MathUtils_1.MathUtils.LongToNumber(o.Lvs.eps.w5n),a=MathUtils_1.MathUtils.LongToNumber(o.Lvs.rps);LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",7,"服务端驱动执行行为组（EntityLeaveTriggerAction）",["CreatureDataId",e]),SceneItemUtility_1.SceneItemUtility.HandleExitTriggerStateActionByServerNotify(t,e,a);break;case Protocol_1.Aki.Protocol.TOs.Hvs:l=MathUtils_1.MathUtils.LongToNumber(o.Hvs.eps.w5n);SceneItemUtility_1.SceneItemUtility.HandleExploreInteractActionByServerNotify(t,l);break;case Protocol_1.Aki.Protocol.TOs.Rvs:e=MathUtils_1.MathUtils.LongToNumber(o.Rvs.eps.w5n);SceneItemUtility_1.SceneItemUtility.HandleSceneItemDestructibleActionByServerNotify(t,e);break;case Protocol_1.Aki.Protocol.TOs.Dvs:a=MathUtils_1.MathUtils.LongToNumber(o.Dvs.eps.w5n);SceneItemUtility_1.SceneItemUtility.HandleTimeTrackControlActionByServerNotify(t,a,o.Dvs);break;case Protocol_1.Aki.Protocol.TOs.Proto_SceneItemLifeCycleComponentCreate:l=MathUtils_1.MathUtils.LongToNumber(o.Kvs.eps.w5n);LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",7,"服务端驱动执行行为组（LifeCycleCreateAction）",["CreatureDataId",l]),SceneItemUtility_1.SceneItemUtility.HandleLifeCycleStageActionByServerNotify(t,l,!0);break;case Protocol_1.Aki.Protocol.TOs.Proto_SceneItemLifeCycleComponentDetroy:e=MathUtils_1.MathUtils.LongToNumber(o.Qvs.eps.w5n);LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",7,"服务端驱动执行行为组（LifeCycleDestroyAction）",["CreatureDataId",e]),SceneItemUtility_1.SceneItemUtility.HandleLifeCycleStageActionByServerNotify(t,e,!1);break;case Protocol_1.Aki.Protocol.TOs.Jvs:a=MathUtils_1.MathUtils.LongToNumber(o.Jvs.eps.w5n),l=o.Jvs.c6n;LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",39,"服务端驱动执行行为组（EntityBeamReceiveAction）",["CreatureDataId",a],["ReceiveType",l]),SceneItemUtility_1.SceneItemUtility.HandleBeamReceiveActionByServerNotify(t,a,l);break;case Protocol_1.Aki.Protocol.TOs.Proto_TrampleActiveActionCtx:e=MathUtils_1.MathUtils.LongToNumber(o.Wga.eps.w5n);LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",39,"服务端驱动执行行为组（TrampleActiveAction）",["CreatureDataId",e]),SceneItemUtility_1.SceneItemUtility.HandleTrampleActivateActionByServerNotify(t,e,!0);break;case Protocol_1.Aki.Protocol.TOs.Proto_TrampleDeActiveActionCtx:a=MathUtils_1.MathUtils.LongToNumber(o.Qga.eps.w5n);LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",39,"服务端驱动执行行为组（TrampleDeActiveAction）",["CreatureDataId",a]),SceneItemUtility_1.SceneItemUtility.HandleTrampleActivateActionByServerNotify(t,a,!1);break;case Protocol_1.Aki.Protocol.TOs.Wvs:{l=o.Wvs.m6n;let e=void 0;try{e=JSON.parse(l)}catch{Log_1.Log.CheckError()&&Log_1.Log.Error("Gm",39,"GM驱动行为列表: 行为列表解析失败",["JsonStr",l]);break}if(!Array.isArray(e)||0===e.length)break;Log_1.Log.CheckInfo()&&Log_1.Log.Info("Gm",39,"开始执行GM驱动行为列表"),LevelGeneralController_1.LevelGeneralController.ExecuteActionsByServerNotify(e,LevelGeneralContextDefine_1.GmLevelActionContext.Create(),t.W5n,t.w5n,t.K5n,t.mvs,t.tt1);break}case Protocol_1.Aki.Protocol.TOs.Proto_EntityStateChangeConditionAction:e=MathUtils_1.MathUtils.LongToNumber(o.Zvs.eps.w5n);LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",7,"服务端驱动执行行为组（EntityStateChangeConditionAction）",["CreatureDataId",e]),SceneItemUtility_1.SceneItemUtility.HandleSceneItemStateChangeConditionActionByServerNotify(t,e,o.Zvs.tps,o.Zvs.t5n);break;case Protocol_1.Aki.Protocol.TOs.Proto_HookLockPointActionCtx:a=MathUtils_1.MathUtils.LongToNumber(o.gt1.eps.w5n),l=o.gt1.Mt1;LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",39,"服务端驱动执行行为组（HookLockPointActionCtx）",["CreatureDataId",a],["ActionType",l]),SceneItemUtility_1.SceneItemUtility.HandleHookLockPointActionByServerNotify(t,a,l);break;case Protocol_1.Aki.Protocol.TOs.pt1:e=MathUtils_1.MathUtils.LongToNumber(o.pt1.eps.w5n);LevelGeneralController_1.LevelGeneralController.LevelEventLogOpen&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("LevelEvent",31,"服务端驱动执行行为组（ExploreSkillCustomAction）",["CreatureDataId",e]),SceneItemUtility_1.SceneItemUtility.HandleExploreSkillCustomActionByServerNotify(t,e)}},LevelGeneralNetworks.sAe=l=>{const n=MathUtils_1.MathUtils.LongToNumber(l.j5n);WaitEntityTask_1.WaitEntityTask.Create(n,e=>{if(e){e=ModelManager_1.ModelManager.CreatureModel.GetEntity(n);if(e){var t=e.Entity.GetComponent(126);if(t)for(const a of l.aLs){var o=new SceneItemJigsawBaseComponent_1.JigsawIndex(a.zTs,a.ZTs),r=MathUtils_1.MathUtils.LongToNumber(a.eLs);t.DynamicModifySocketState(o,r)}}}})},LevelGeneralNetworks.BPl=t=>{const o=MathUtils_1.MathUtils.LongToNumber(t.j5n);WaitEntityTask_1.WaitEntityTask.Create(o,e=>{e&&(e=ModelManager_1.ModelManager.CreatureModel.GetEntity(o))&&(e=e.Entity.GetComponent(126))&&e.OnBoardCanMovePlacementNotify(t.to1)})},LevelGeneralNetworks.aAe=e=>{for(const t of e.KEs)ModelManager_1.ModelManager.FunctionModel?.UpdateFunctionOpenLockByBehaviorTree(t.d6n,!t.Sps)},LevelGeneralNetworks.$Ja=e=>{for(const t of e.KEs)t.h5n===Protocol_1.Aki.Protocol.Xs1.Proto_TeleportDungeon&&InstanceDungeonController_1.InstanceDungeonController.UpdateForbidDungeon(t.yIs,t.Br1?.Dr1)},LevelGeneralNetworks.hAe=e=>{e.gvs?LevelGamePlayUtils_1.LevelGamePlayUtils.ReleaseOperationRestriction():e.C6n&&LevelGamePlayUtils_1.LevelGamePlayUtils.LevelOperationRestriction(e.C6n)},LevelGeneralNetworks.lAe=e=>{const t=MathUtils_1.MathUtils.LongToNumber(e.g2s),o=e.i6n===Protocol_1.Aki.Protocol.i6n.Proto_RangeEnter,r=[];for(const a of e.HKs)r.push(MathUtils_1.MathUtils.LongToNumber(a));WaitEntityTask_1.WaitEntityTask.Create(t,e=>{e&&(e=ModelManager_1.ModelManager.CreatureModel.GetEntity(t))?.Valid&&(e=e.Entity.GetComponent(78))&&e.ServerUpdateEntitiesInRangeOnline(o,r)})},LevelGeneralNetworks._Ae=e=>{const t=MathUtils_1.MathUtils.LongToNumber(e.g2s),o=e.i6n===Protocol_1.Aki.Protocol.i6n.Proto_RangeEnter,r=e.f2s;WaitEntityTask_1.WaitEntityTask.Create(t,e=>{e&&(e=ModelManager_1.ModelManager.CreatureModel.GetEntity(t))?.Valid&&(e=e.Entity.GetComponent(78))&&e.ServerUpdatePlayerInRangeOnline(o,r)})},LevelGeneralNetworks.uAe=e=>{const t=MathUtils_1.MathUtils.LongToNumber(e.v2s),o=e.p2s===Protocol_1.Aki.Protocol.p2s.Proto_Up;WaitEntityTask_1.WaitEntityTask.Create(t,e=>{e&&(e=ModelManager_1.ModelManager.CreatureModel.GetEntity(t))?.Valid&&(e=e.Entity.GetComponent(141))&&e.ChangeTransition(o)})},LevelGeneralNetworks.URn=e=>{var t;e.WEs&&(t=MathUtils_1.MathUtils.LongToNumber(e.F4n),t=ModelManager_1.ModelManager.CreatureModel?.GetEntity(t))&&(t.Entity?.GetComponent(0))?.UpdateVar(e.jEs,e.WEs)},LevelGeneralNetworks.sQs=e=>{if(e.f$s){const t=[],o=[];for(const r of e.f$s){const a=MathUtils_1.MathUtils.LongToNumber(r.d$s);t.push(a);for(const l of r.YQa)o.push(MathUtils_1.MathUtils.LongToNumber(l.CVn)),t.push(MathUtils_1.MathUtils.LongToNumber(l.CVn));WaitEntityTask_1.WaitEntityTask.Create(t,e=>{e?LevelGeneralNetworks.aQs(a,o,r.C$s):Log_1.Log.CheckError()&&Log_1.Log.Error("Level",31,"[OnConnectorConnectEntityNotify] 等待之后还是找不到对应的Entity",["ids",t])})}}},LevelGeneralNetworks.mla=e=>{const a=MathUtils_1.MathUtils.LongToNumber(e.F4n);a&&WaitEntityTask_1.WaitEntityTask.Create(a,e=>{var t,o,r;e&&(e=ModelManager_1.ModelManager.CreatureModel.GetEntity(a))?.Valid&&(t=(r=ModelManager_1.ModelManager.SceneTeamModel.GetCurrentEntity?.Entity)?.GetComponent(58),r=r?.GetComponent(1),t?.Valid)&&r?.Valid&&t.CanManipulate()&&((o=MathUtils_1.MathUtils.CommonTempVector).Set(100,0,0),r=r.ActorTransform.TransformPositionNoScale(o.ToUeVector()),e.Entity.GetComponent(191)?.SetActorLocation(r),t.TryManipulateSpecificItem(e.Entity))})},LevelGeneralNetworks.u3a=e=>{const a=MathUtils_1.MathUtils.LongToNumber(e.F4n);if(a){const l=MathUtils_1.MathUtils.LongToNumber(e.ko1);l&&WaitEntityTask_1.WaitEntityTask.Create(l,e=>{var t,o,r;e&&(e=ModelManager_1.ModelManager.CreatureModel.GetEntity(a))?.Valid&&e.Entity?.Valid&&e.Entity?.IsInit&&(t=e.Entity.GetComponent(1))?.Valid&&(o=ModelManager_1.ModelManager.CreatureModel.GetEntity(l))?.Valid&&o.Entity?.Valid&&o?.IsInit&&(o=o.Entity.GetComponent(1))?.Valid&&(r=e.Entity.GetComponent(204))?.Valid&&(r.GetPortalEffectActor()?.Stop("移动传送门到新位置之前",!0),CreatureController_1.CreatureController.SetEntityEnable(e.Entity,!1,"移动传送门到新位置之前",!1),t.SetActorLocationAndRotation(o.ActorLocation,o.ActorRotation,"OnPortalReplaceNotify",!1),e.Entity.GetComponent(0)?.SetOwnerIncId(l),CreatureController_1.CreatureController.SetEntityEnable(e.Entity,!0,"移动传送门到新位置之后",!1))})}},LevelGeneralNetworks.$rh=t=>{const o=MathUtils_1.MathUtils.LongToNumber(t.F4n);o&&WaitEntityTask_1.WaitEntityTask.Create(o,e=>{e&&(e=ModelManager_1.ModelManager.CreatureModel.GetEntity(o))?.IsInit&&(e=e.Entity?.GetComponent(119))&&e.HandleAttributeChanged(t.ao1,t.lWn)})},LevelGeneralNetworks.yMl=e=>{AlertAreaController_1.AlertAreaController.UpdateAlertDataByServerNotify(e)},LevelGeneralNetworks.oEl=e=>{const t=MathUtils_1.MathUtils.LongToNumber(e.F4n);WaitEntityTask_1.WaitEntityTask.Create(t,e=>{e&&(e=ModelManager_1.ModelManager.CreatureModel.GetEntity(t))?.Valid&&(e=e.Entity.GetComponent(125))&&e.ModifyAiEnableState(!1)})},LevelGeneralNetworks.rEl=t=>{const o=MathUtils_1.MathUtils.LongToNumber(t.F4n);WaitEntityTask_1.WaitEntityTask.Create(o,e=>{e&&(e=ModelManager_1.ModelManager.CreatureModel.GetEntity(o))?.Valid&&(e=e.Entity.GetComponent(125))&&e.ModifyAiEnableState(!0,t.tVn?.co1)})},LevelGeneralNetworks.nEl=t=>{const o=MathUtils_1.MathUtils.LongToNumber(t.F4n);WaitEntityTask_1.WaitEntityTask.Create(o,e=>{e&&(e=ModelManager_1.ModelManager.CreatureModel.GetEntity(o))?.Valid&&(e=e.Entity.GetComponent(125))&&e.UpdateLastPassIndex(t.uo1)})},LevelGeneralNetworks.xTl=r=>{const a=MathUtils_1.MathUtils.LongToNumber(r.F4n);WaitEntityTask_1.WaitEntityTask.Create(a,e=>{var t,o;e&&(e=ModelManager_1.ModelManager.CreatureModel.GetEntity(a))?.Valid&&(t=e.Entity.GetComponent(160))&&(o="Collected"+r.jjn,r.mo1===Protocol_1.Aki.Protocol.oa1.Proto_SlotRefreshed?(t.ShowPart(r.jjn),BlackboardController_1.BlackboardController.SetBooleanValueByEntity(e.Id,o,!1)):(t.HidePart(r.jjn),BlackboardController_1.BlackboardController.SetBooleanValueByEntity(e.Id,o,!0)))})},LevelGeneralNetworks.rwl=e=>{for(const r of e.ut1){var t=MathUtils_1.MathUtils.LongToNumber(r.F4n);if(!r.dt1){t=EntitySystem_1.EntitySystem.Get(t);if(!t?.Valid)return void(Log_1.Log.CheckError()&&Log_1.Log.Error("LevelEvent",65,"Trigger Entity不存在"));CreatureController_1.CreatureController.SetEntityEnable(t,!0,"LevelEventSetClientEntityVisible",!0)}}for(const a of e.ct1){var o=MathUtils_1.MathUtils.LongToNumber(a.F4n);LevelGeneralCommons_1.LevelGeneralCommons.PrechangeStateTag(o,a.X5n,"ActionRelatedEntityInfoNotify")}},LevelGeneralNetworks.e5l=t=>{const o=MathUtils_1.MathUtils.LongToNumber(t.Go1);WaitEntityTask_1.WaitEntityTask.Create(o,e=>{e&&(e=ModelManager_1.ModelManager.CreatureModel.GetEntity(o))?.Valid&&(e=e.Entity.GetComponent(77))&&e.UpdateHookPointInfoByNotify(t)})};
//# sourceMappingURL=LevelGeneralNetworks.js.map