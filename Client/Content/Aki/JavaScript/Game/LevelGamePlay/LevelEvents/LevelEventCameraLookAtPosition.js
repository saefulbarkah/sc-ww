
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LevelEventCameraLookAtPosition=void 0;const Log_1=require("../../../Core/Common/Log"),CommonDefine_1=require("../../../Core/Define/CommonDefine"),TimerSystem_1=require("../../../Core/Timer/TimerSystem"),Vector_1=require("../../../Core/Utils/Math/Vector"),CameraController_1=require("../../Camera/CameraController"),EventDefine_1=require("../../Common/Event/EventDefine"),EventSystem_1=require("../../Common/Event/EventSystem"),ModelManager_1=require("../../Manager/ModelManager"),InputDistributeController_1=require("../../Ui/InputDistribute/InputDistributeController"),LevelGeneralBase_1=require("../LevelGeneralBase");class LevelEventCameraLookAtPosition extends LevelGeneralBase_1.LevelEventBase{constructor(){super(...arguments),this.LLe=Vector_1.Vector.Create(),this.dae=Vector_1.Vector.Create(),this.pLe="CameraLookAtPosition Ban Input",this.dW_=!0}ExecuteNew(o,e){this.dW_&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("Camera",57,"[CameraLookAt] LevelEventCameraLookAtPosition Start");const t=o;if(t){var o=t.Pos.X??0,a=t.Pos.Y??0,r=t.Pos.Z??0,i=t.FadeInTime,n=t.StayTime,s=t.FadeOutTime,m=t.CameraPos?.X,l=t.CameraPos?.Y,C=t.CameraPos?.Z,L=t.Fov;if(isNaN(o)||isNaN(a)||isNaN(r)||isNaN(i)||isNaN(n)||isNaN(s))Log_1.Log.CheckError()&&Log_1.Log.Error("Camera",14,"关卡事件[LevelEventCameraLookAtPosition]参数非法",["x",o],["y",a],["z",r],["fadeInTime",i],["stayTime",n],["fadeOutTime",s],["endPositionX",m],["endPositionY",l],["endPositionZ",C],["fov",L]),this.FinishExecute(!1);else{t.BanInput&&(this.dW_&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("Camera",57,"[CameraLookAt] LevelEventCameraLookAtPosition BanInput"),ModelManager_1.ModelManager.GeneralLogicTreeModel.DisableInput=!0,EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.ForceReleaseInput,this.pLe),InputDistributeController_1.InputDistributeController.RefreshInputTag()),t.HideUi&&(this.dW_&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("Camera",57,"[CameraLookAt] LevelEventCameraLookAtPosition HideUi"),ModelManager_1.ModelManager.BattleUiModel.ChildViewData.HideBattleView(1)),this.LLe.Set(o,a,r);let e=void 0;if(t.CameraPos?(e=this.dae).Set(t.CameraPos.X,t.CameraPos.Y,t.CameraPos.Z):e=void 0,CameraController_1.CameraController.FightCamera.LogicComponent.ExitSequenceDialogue(),CameraController_1.CameraController.FightCamera.LogicComponent.ApplyCameraGuide(this.LLe,i,n,s,t.LockCamera??!1,e,t.Fov,t.CancelBuffer??!1),this.IsAsync)t.BanInput&&(ModelManager_1.ModelManager.GeneralLogicTreeModel.DisableInput=!1,InputDistributeController_1.InputDistributeController.RefreshInputTag()),t.HideUi&&ModelManager_1.ModelManager.BattleUiModel.ChildViewData.ShowBattleView(1),this.FinishExecute(!0),this.dW_&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("Camera",57,"[CameraLookAt] LevelEventCameraLookAtPosition Stop",["params.BanInput",t.BanInput],["params.HideUi",t.HideUi],["params.CancelBlendOut",t.CancelBlendOut]);else{let e=i+n;t.CancelBlendOut||(e+=s),TimerSystem_1.TimerSystem.Delay(()=>{t.BanInput&&(ModelManager_1.ModelManager.GeneralLogicTreeModel.DisableInput=!1,InputDistributeController_1.InputDistributeController.RefreshInputTag()),t.HideUi&&ModelManager_1.ModelManager.BattleUiModel.ChildViewData.ShowBattleView(1),this.FinishExecute(!0),this.dW_&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("Camera",57,"[CameraLookAt] LevelEventCameraLookAtPosition Stop !IsAsync Finish",["params.BanInput",t.BanInput],["params.HideUi",t.HideUi],["params.CancelBlendOut",t.CancelBlendOut],["endTime",e])},e*CommonDefine_1.MILLIONSECOND_PER_SECOND),this.dW_&&Log_1.Log.CheckInfo()&&Log_1.Log.Info("Camera",57,"[CameraLookAt] LevelEventCameraLookAtPosition Stop !IsAsync",["params.BanInput",t.BanInput],["params.HideUi",t.HideUi],["params.CancelBlendOut",t.CancelBlendOut],["endTime",e])}}}else this.FinishExecute(!1)}ExecuteInGm(e,o){this.FinishExecute(!0)}}exports.LevelEventCameraLookAtPosition=LevelEventCameraLookAtPosition;
//# sourceMappingURL=LevelEventCameraLookAtPosition.js.map