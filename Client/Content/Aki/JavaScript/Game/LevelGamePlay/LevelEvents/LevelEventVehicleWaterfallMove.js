
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LevelEventVehicleWaterfallMove=void 0;const Log_1=require("../../../Core/Common/Log"),MathUtils_1=require("../../../Core/Utils/MathUtils"),Global_1=require("../../Global"),GravityUtils_1=require("../../Utils/GravityUtils"),GameSplineComponent_1=require("../Common/GameSplineComponent"),LevelGeneralBase_1=require("../LevelGeneralBase");class LevelEventVehicleWaterfallMove extends LevelGeneralBase_1.LevelEventBase{constructor(){super(...arguments),this.OPt=void 0,this.nx=void 0}ExecuteNew(e,t){this.OPt=e,this.nx=t,this.OPt?this.n0l(this.OPt,this.nx):this.FinishExecute(!1)}n0l(e,t){var i,l,o,s=Global_1.Global.BaseCharacter?.CharacterActorComponent,n=s?.Entity.GetComponent(217),a=n?.VehicleEntity?.GetComponent(232);a?(o=new GameSplineComponent_1.GameSplineComponent(e.SplineEntityId)).Initialize()?(i=o.GetNumberOfSplinePoints())<2?(Log_1.Log.CheckError()&&Log_1.Log.Error("Vehicle",50,"[LevelEventExecVehicleAction] 攀瀑样条点数量不合法",["SplineId",e.SplineEntityId],["PointNum",i]),this.FinishExecute(!1)):(l=o.GetWorldLocationAtSplinePoint(i-1),o=o.GetWorldLocationAtSplinePoint(i-2),l.Subtraction(o,MathUtils_1.MathUtils.CommonTempVector),GravityUtils_1.GravityUtils.ConvertToPlanarVectorForActor(s,MathUtils_1.MathUtils.CommonTempVector),MathUtils_1.MathUtils.CommonTempVector.Normalize()?(a.TryEnterWaterfallMove(e.SplineEntityId,MathUtils_1.MathUtils.CommonTempVector),this.FinishExecute(!0)):(Log_1.Log.CheckError()&&Log_1.Log.Error("Vehicle",50,"[LevelEventExecVehicleAction] 无法从计算得到攀瀑方向",["SplineId",e.SplineEntityId],["PointNum",i]),this.FinishExecute(!1))):(Log_1.Log.CheckError()&&Log_1.Log.Error("Vehicle",50,"[LevelEventExecVehicleAction] 攀瀑样条数据获取失败",["SplineId",e.SplineEntityId]),this.FinishExecute(!1)):(Log_1.Log.CheckError()&&Log_1.Log.Error("Vehicle",50,"[LevelEventExecVehicleAction] 无法获取玩家角色，或玩家角色未乘坐载具",["RolePbDataId",s?.CreatureData.GetPbDataId()],["IsOnVehicle",!!n?.VehicleEntity]),this.FinishExecute(!1))}}exports.LevelEventVehicleWaterfallMove=LevelEventVehicleWaterfallMove;
//# sourceMappingURL=LevelEventVehicleWaterfallMove.js.map