
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LevelEventLeisureInteract=void 0;const Log_1=require("../../../Core/Common/Log"),EntitySystem_1=require("../../../Core/Entity/EntitySystem"),IAction_1=require("../../../UniverseEditor/Interface/IAction"),Global_1=require("../../Global"),ModelManager_1=require("../../Manager/ModelManager"),RouletteController_1=require("../../Module/Roulette/RouletteController"),LevelGeneralBase_1=require("../LevelGeneralBase"),SKILL_ID_FIX_HOOK_1=100020,SKILL_ID_FIX_HOOK_2=100021,SKILL_ID_XA_KITE=210130,SKILL_ID_XA_CHARACTER_DIR=210330;class LevelEventLeisureInteract extends LevelGeneralBase_1.LevelEventBase{constructor(){super(...arguments),this.QYs=void 0,this.IXi=void 0,this.KYs=0}ExecuteNew(e,t,i){var r=e;if(r)if(Global_1.Global.BaseCharacter){var s=Global_1.Global.BaseCharacter.CharacterActorComponent.Entity,_=s.GetComponent(29),n=s.GetComponent(191);switch(r.Option.Type){case IAction_1.ELeisureInteract.SitDown:case IAction_1.ELeisureInteract.SitOnGround:var o=this.jZ_(t,r.SceneEntity);if(!o)return Log_1.Log.CheckError()&&Log_1.Log.Error("LevelEvent",36," LevelEventLeisureInteract, 尝试坐下时交互实体不存在"),void this.FinishExecute(!1);var a=this.Kul(r.Option.Type);_.EnterSitDownAction(o,a),this.FinishExecute(!0);break;case IAction_1.ELeisureInteract.Manipulate:Log_1.Log.CheckError()&&Log_1.Log.Error("LevelEvent",31,"[LevelEventLeisureInteract]控物动作已废弃");break;case IAction_1.ELeisureInteract.Catapult:case IAction_1.ELeisureInteract.SuperCatapult:{let e=0;switch(t.Type){case 5:e=t.TriggerEntityId;break;case 1:e=t.EntityId}var o=EntitySystem_1.EntitySystem.Get(e);_.StartCatapult(o,r.Option),this.FinishExecute(!0)}break;case IAction_1.ELeisureInteract.Bounce:_.StartBounce(r.Option),this.FinishExecute(!0);break;case IAction_1.ELeisureInteract.StandControl:_.PlayCustomCommonSkill(400202),this.FinishExecute(!0);break;case IAction_1.ELeisureInteract.StandControl2:n.AddTag(1334991742);_.PlayCustomCommonSkill(400202),this.FinishExecute(!0);break;case IAction_1.ELeisureInteract.Soar:a=s.GetComponent(39);9===this.BaseContext?.Type&&n.TagContainer.UpdateExactTag(2,283451623,-1),RouletteController_1.RouletteController.ExploreSkillSetRequest(1015),a.BeginSkill(SKILL_ID_XA_CHARACTER_DIR,{Context:"LeisureInteract行为触发翱翔"}),9===this.BaseContext?.Type&&n.TagContainer.UpdateExactTag(2,283451623,1),this.FinishExecute(!0);break;case IAction_1.ELeisureInteract.Glide:s.GetComponent(176).TrySetGlide(),this.FinishExecute(!0);break;case IAction_1.ELeisureInteract.HookLock:s.GetComponent(97)?.CanActivateFixHook()?(o=n.HasTag(-1958756056)?SKILL_ID_FIX_HOOK_2:SKILL_ID_FIX_HOOK_1,s.GetComponent(39).BeginSkill(o,{Context:"LeisureInteract行为触发定点钩锁"}),this.FinishExecute(!0)):(Log_1.Log.CheckError()&&Log_1.Log.Error("LevelEvent",39," LevelEventLeisureInteract, 没有可用定点钩锁"),this.FinishExecute(!1));break;case IAction_1.ELeisureInteract.KiteHook:n.HasTag(-1526637662)?(s.GetComponent(39).BeginSkill(SKILL_ID_XA_KITE,{Context:"LeisureInteract行为触发风筝钩锁"}),this.FinishExecute(!0)):(Log_1.Log.CheckError()&&Log_1.Log.Error("LevelEvent",39," LevelEventLeisureInteract, 没有可用风筝钩索点"),this.FinishExecute(!1));break;case IAction_1.ELeisureInteract.GetUp:_.IsSitDown&&_.PreLeaveSitDownAction(),this.FinishExecute(!0)}this.QYs=void 0,this.IXi=void 0,this.KYs=0}else Log_1.Log.CheckWarn()&&Log_1.Log.Warn("LevelEvent",36," LevelEventLeisureInteract, 尝试执行时主角未创建"),this.QYs=e,this.IXi=t,this.KYs=i;else Log_1.Log.CheckError()&&Log_1.Log.Error("LevelEvent",57," LevelEventLeisureInteract, 坐下参数为空")}OnTick(e){Global_1.Global.BaseCharacter&&this.QYs&&this.IXi&&this.ExecuteNew(this.QYs,this.IXi,this.KYs)}Kul(e){switch(e){case IAction_1.ELeisureInteract.SitDown:return 1;case IAction_1.ELeisureInteract.SitOnGround:return 2}return 0}jZ_(e,t){return t?(ModelManager_1.ModelManager.CreatureModel?.GetEntityByPbDataId(t))?.Entity:1===e.Type?EntitySystem_1.EntitySystem.Get(e.EntityId):void 0}}exports.LevelEventLeisureInteract=LevelEventLeisureInteract;
//# sourceMappingURL=LevelEventLeisureInteract.js.map