
"use strict";var _a;Object.defineProperty(exports,"__esModule",{value:!0}),exports.LevelPickInteractController=void 0;const Info_1=require("../../../Core/Common/Info"),EntitySystem_1=require("../../../Core/Entity/EntitySystem"),ControllerBase_1=require("../../../Core/Framework/ControllerBase"),Vector2D_1=require("../../../Core/Utils/Math/Vector2D"),Global_1=require("../../Global"),ModelManager_1=require("../../Manager/ModelManager"),InputDistributeController_1=require("../../Ui/InputDistribute/InputDistributeController"),InputMappingsDefine_1=require("../../Ui/InputDistribute/InputMappingsDefine"),UiManager_1=require("../../Ui/UiManager"),LevelPickInteractItem_1=require("./LevelPickInteractItem");class LevelPickInteractController extends ControllerBase_1.ControllerBase{static OnInit(){return this.PauseTick(),!0}static zla(){InputDistributeController_1.InputDistributeController.BindTouches([InputMappingsDefine_1.touchIdMappings.Touch1,InputMappingsDefine_1.touchIdMappings.Touch2],this.Eqt),InputDistributeController_1.InputDistributeController.BindActions([InputMappingsDefine_1.actionMappings.Ui左键点击],this.XOa)}static Jla(){InputDistributeController_1.InputDistributeController.UnBindTouches([InputMappingsDefine_1.touchIdMappings.Touch1,InputMappingsDefine_1.touchIdMappings.Touch2],this.Eqt),InputDistributeController_1.InputDistributeController.UnBindActions([InputMappingsDefine_1.actionMappings.Ui左键点击],this.XOa)}static EnterPickInteractModel(t,e=!1){var t=ModelManager_1.ModelManager.CreatureModel?.GetEntityByPbDataId(t);t&&("Chessboard"===EntitySystem_1.EntitySystem.GetComponent(t.Id,0)?.GetPbModelConfig()?.EntityType&&(t=EntitySystem_1.EntitySystem.GetComponent(t.Id,124))&&this.YOa(t),UiManager_1.UiManager.OpenView("PickInteractionView"),this.zOa=!0,this.JOa=e,this.zla())}static ExitPickInteractModel(){this.zOa&&(UiManager_1.UiManager.CloseView("PickInteractionView"),this.zOa=!1,this.ZOa.clear(),this.Jla(),this.eGa)&&(this.eGa.UnregisterRefreshPickBoundsEvent(),this.eGa=void 0)}static ResetPickInteractGame(){this.zOa&&this.eGa&&this.eGa.ResetTicTacToeGame()}static get zOa(){return this.Rgl}static set zOa(t){this.Rgl!==t&&((this.Rgl=t)?this.ResumeTick():this.PauseTick())}static OnTick(t){if(this.zOa&&this.JOa)for(const e of this.tGa())e.OnPick()}static tGa(){this.iGa.length=0;var e=Global_1.Global.CharacterController;if(e){let t=void 0;if(Info_1.Info.IsInKeyBoard()?((e=e.GetCursorPosition())&&(this.rGa.X=e.X,this.rGa.Y=e.Y),t=this.rGa):Info_1.Info.IsInTouch()&&(t=this.Fdr),t)for(const r of this.ZOa){var i=r[1];i.IsValid&&i.CheckInside(t)&&this.iGa.push(i)}}return this.iGa}static YOa(e){this.eGa=e,this.ZOa.clear();var t=e.GetPickItemActors();e.RegisterRefreshPickBoundsEvent(this.oGa);for(const r of t){var i=new LevelPickInteractItem_1.LevelPickInteractItem;i.Init(r,t=>{e.OnLevelPickClick(t)}),this.ZOa.set(r,i)}}}exports.LevelPickInteractController=LevelPickInteractController,(_a=LevelPickInteractController).JOa=!1,LevelPickInteractController.ZOa=new Map,LevelPickInteractController.iGa=new Array,LevelPickInteractController.rGa=Vector2D_1.Vector2D.Create(),LevelPickInteractController.Fdr=Vector2D_1.Vector2D.Create(),LevelPickInteractController.eGa=void 0,LevelPickInteractController.XOa=(t,e)=>{if(1===e)for(const i of _a.tGa())i.OnClick()},LevelPickInteractController.Eqt=(t,e)=>{1===e.TouchType&&(_a.Fdr.X=e.TouchPosition.X,_a.Fdr.Y=e.TouchPosition.Y)},LevelPickInteractController.Rgl=!1,LevelPickInteractController.oGa=t=>{_a.ZOa.has(t)&&_a.ZOa.get(t)?.RefreshBox(t)};
//# sourceMappingURL=LevelPickInteractController.js.map