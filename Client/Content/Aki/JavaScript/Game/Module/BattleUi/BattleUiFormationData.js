
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BattleUiFormationData=void 0;const UE=require("ue"),CommonParamById_1=require("../../../Core/Define/ConfigCommon/CommonParamById"),ResourceSystem_1=require("../../../Core/Resource/ResourceSystem"),DataTableUtil_1=require("../../../Core/Utils/DataTableUtil"),EventDefine_1=require("../../Common/Event/EventDefine"),EventSystem_1=require("../../Common/Event/EventSystem"),GlobalData_1=require("../../GlobalData"),ControllerHolder_1=require("../../Manager/ControllerHolder"),followerMap=new Map([[658750002,1],[658750003,1],[65875e4,2]]);class BattleUiFormationData{constructor(){this.sXe=void 0,this.EnvironmentPropertyList=[],this.UiEnvironmentPropertyMap=new Map,this.gU=!1,this.ORn=void 0,this.doh=0,this.Coh=!1,this.zhc=!1}Init(){this.gU=!0;var e=CommonParamById_1.configCommonParamById.GetStringConfig("EnvironmentPropertyInfoPath");ResourceSystem_1.ResourceSystem.LoadAsync(e,UE.DataTable,e=>{if(this.gU&&(this.sXe=e)){var t=new Array;DataTableUtil_1.DataTableUtil.GetDataTableAllRowNamesFromTable(e,t);for(const o of t){var i,r=Number(o);r&&(i=DataTableUtil_1.DataTableUtil.GetDataTableRow(e,o),this.UiEnvironmentPropertyMap.set(r,i),this.EnvironmentPropertyList.push(r))}}})}OnLeaveLevel(){}Clear(){this.gU=!1,this.sXe=void 0,this.EnvironmentPropertyList.length=0,this.UiEnvironmentPropertyMap.clear(),this.FRn(),this.AutoMovingSettingEnable=!1}GetUiEnvironmentProperty(e){if(this.gU)return GlobalData_1.GlobalData.IsPlayInEditor?DataTableUtil_1.DataTableUtil.GetDataTableRow(this.sXe,e.toString()):this.UiEnvironmentPropertyMap.get(e)}AddFollower(t){if(t!==this.ORn){this.FRn();var i=(this.ORn=t).Entity.GetComponent(219);let e=i?.AimType;e=e||(followerMap.get(t.PbDataId)??0),this.doh=e,this.goh(i?.IsEnable??!1)}}RemoveFollower(){this.FRn()}ChangePlayerFollowerEnable(e){this.ORn&&this.goh(e)}goh(e){this.Coh!==e&&(this.Coh=e,EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.BattleUiFollowerAimStateChanged,e,0===this.doh),1===this.doh?(this.Coh&&ControllerHolder_1.ControllerHolder.HudUnitController.TryCreateHud(1),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.SetFollowShootAimVisible,e)):3===this.doh?(this.Coh&&ControllerHolder_1.ControllerHolder.HudUnitController.TryCreateHud(2),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.SetFollowShootAutoAimVisible,e)):4===this.doh&&(this.Coh&&ControllerHolder_1.ControllerHolder.HudUnitController.TryCreateHud(3),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.SetFollowShootAutoAimVisible,e)))}GetFollowType(){return this.doh}GetFollowerAiming(){return this.Coh&&2!==this.doh}GetFollowerEnable(){return this.Coh}GetFollowerEntityHandle(){return this.ORn}FRn(){this.Coh&&this.goh(!1),this.ORn=void 0,1===this.doh?ControllerHolder_1.ControllerHolder.HudUnitController.TryDestroyHud(1):3===this.doh?ControllerHolder_1.ControllerHolder.HudUnitController.TryDestroyHud(2):4===this.doh&&ControllerHolder_1.ControllerHolder.HudUnitController.TryDestroyHud(3),this.doh=0}get AutoMovingSettingEnable(){return this.zhc}set AutoMovingSettingEnable(e){this.zhc!==e&&(this.zhc=e,EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.AutoMovingSettingChanged,e))}}exports.BattleUiFormationData=BattleUiFormationData;
//# sourceMappingURL=BattleUiFormationData.js.map