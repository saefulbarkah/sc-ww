
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StepMotionArtTextController=void 0;const UE=require("ue"),MathCommon_1=require("../../../../../../Core/Utils/Math/MathCommon"),StringUtils_1=require("../../../../../../Core/Utils/StringUtils"),IQuest_1=require("../../../../../../UniverseEditor/Interface/IQuest"),LevelGamePlayUtils_1=require("../../../../../LevelGamePlay/LevelGamePlayUtils"),LevelGeneralContextDefine_1=require("../../../../../LevelGamePlay/LevelGeneralContextDefine"),LevelSequencePlayer_1=require("../../../../Common/LevelSequencePlayer"),GeneralLogicTreeController_1=require("../../../../GeneralLogicTree/GeneralLogicTreeController"),StepControllerBase_1=require("./StepControllerBase"),SCORE="Score",LERP_TIME=.5;class StepMotionArtTextController extends StepControllerBase_1.StepControllerBase{constructor(t){super(),this.UiParent=t,this.e2_=!1,this.LevelSequencePlayer=void 0,this.JG_=void 0,this.nx=void 0,this.ZG_=!1,this.t2_=!0,this.i2_=0,this.r2_=0,this.o2_=0,this.n2_=0,this.s2_=0}get Enable(){return this.e2_}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,UE.UIText],[1,UE.UIArtText]]}async OnBeforeStartAsync(){await super.OnBeforeStartAsync(),this.LevelSequencePlayer=new LevelSequencePlayer_1.LevelSequencePlayer(this.RootItem)}OnAfterHide(){this.LevelSequencePlayer?.StopCurrentSequence(!0,!0),this.s2_=0,this.GetArtText(1)?.SetText(this.n2_.toString())}CheckTextVisible(){return!this.t2_}OnTick(t){var e;this.Enable&&this.JG_&&"number"==typeof(e=LevelGamePlayUtils_1.LevelGamePlayUtils.GetVarValue(this.JG_,this.nx))&&(this.n2_=e,this.o2_!==this.n2_&&this.a2_(),this.s2_=MathCommon_1.MathCommon.Clamp(this.s2_-t/1e3,0,LERP_TIME),e=MathCommon_1.MathCommon.Lerp(this.i2_,this.n2_,(LERP_TIME-this.s2_)/LERP_TIME),this.r2_=Math.floor(e),this.GetArtText(1)?.SetText(this.r2_.toString()),this.o2_=this.n2_)}async OnConfigRefresh(t,e){await super.OnConfigRefresh(t,e),await this.d2_()||await this.EndShow()}async d2_(){var t;return!(!this.Config||!this.ShowData||0!==this.ShowData.DataSource||!(t=this.Config.QuestScheduleType)||t.Type!==IQuest_1.EQuestScheduleType.Var||!t.ShowAsWordArt?.EffectiveTarget.ShowUiMotion||"number"!=typeof LevelGamePlayUtils_1.LevelGamePlayUtils.GetVarValue(t.Var,LevelGeneralContextDefine_1.GeneralLogicTreeContext.Create(this.ShowData.BtType,this.ShowData.Id,this.ShowData.TreeConfigId))||(this.nx=LevelGeneralContextDefine_1.GeneralLogicTreeContext.Create(this.ShowData.BtType,this.ShowData.Id,this.ShowData.TreeConfigId),await this.StartShow(this.ShowData,this.Config.TidTitle,t.Var,this.UiParent),0))}async StartShow(t,e,i,s){this.e2_=!0,this.ZG_||(await this.CreateByResourceIdAsync("UiItem_MissionScore",s),this.ZG_=!0);s=this.h2_(t,e,i);this.Slo(i,s),this.UpdateDescribeText(),await this.ShowAsync()}async EndShow(){this.e2_&&(this.e2_=!1,await this.HideAsync())}Slo(t,e){this.JG_=t;t=LevelGamePlayUtils_1.LevelGamePlayUtils.GetVarValue(this.JG_,this.nx);e?this.a2_():(this.i2_=t,this.r2_=t,this.s2_=0),this.n2_=t}a2_(){this.i2_=this.r2_,this.LevelSequencePlayer?.StopCurrentSequence(!0,!0),this.LevelSequencePlayer?.PlayLevelSequenceByName(SCORE),this.s2_=LERP_TIME}h2_(t,e,i){return!this.ShowData||this.ShowData.Id!==t.Id||this.Config?.TidTitle!==e||(void 0===this.JG_||void 0===i)&&this.JG_!==i||!LevelGamePlayUtils_1.LevelGamePlayUtils.CheckVarRefSame(this.JG_,i)}UpdateDescribeText(){var t;return this.e2_&&this.Config&&!StringUtils_1.StringUtils.IsBlank(this.Config.TidTitle)&&this.JG_&&this.ShowData?(t=GeneralLogicTreeController_1.GeneralLogicTreeController.FormatStepTextByVarValue(this.Config.TidTitle,this.JG_,"",!1),this.GetText(0)?.SetText(t),"number"==typeof(t=LevelGamePlayUtils_1.LevelGamePlayUtils.GetVarValue(this.JG_,this.nx))&&(this.GetArtText(1)?.SetText(t.toString()),!(this.t2_=!1))):!(this.t2_=!0)}}exports.StepMotionArtTextController=StepMotionArtTextController;
//# sourceMappingURL=StepMotionArtTextController.js.map