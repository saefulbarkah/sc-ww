
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SpecialEnergyBarDengDeng=void 0;const UE=require("ue"),Log_1=require("../../../../../../Core/Common/Log"),CharacterAttributeTypes_1=require("../../../../../NewWorld/Character/Common/Component/Abilities/CharacterAttributeTypes"),SpecialEnergyBarBase_1=require("../SpecialEnergyBarBase"),SpecialEnergyBarPercentMachine_1=require("../SpecialEnergyBarPercentMachine"),SpecialEnergyBarSlotItem_1=require("../SpecialEnergyBarSlotItem"),WIDTH=190,EFFECT_BASE_PERCENT=20/41,tagRed=1783680056;class SpecialEnergyBarDengDeng extends SpecialEnergyBarBase_1.SpecialEnergyBarBase{constructor(){super(...arguments),this.$cl=void 0,this.Xcl=void 0,this.Ycl=new SpecialEnergyBarPercentMachine_1.SpecialEnergyBarPercentMachine,this.zcl=0,this.Jcl=0,this.Zcl=!1,this.pml=!1,this.fml=!1,this.eml=(t,i,e)=>{this.Ycl.SetTargetPercent(this.tml()),this.iml()},this.rml=(t,i,e)=>{this.Ycl.SetTargetPercent(this.tml()),this.iml()},this.oml=(t,i)=>{i!==this.Zcl&&(this.Zcl=i,this.nml())}}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,UE.UIItem],[1,UE.UIItem],[2,UE.UIItem],[3,UE.UIItem],[4,UE.UIItem],[5,UE.UINiagara],[6,UE.UINiagara]]}OnInitData(){super.OnInitData(),this.zcl=CharacterAttributeTypes_1.EAttributeId.Proto_SpecialEnergy2,this.Jcl=CharacterAttributeTypes_1.EAttributeId.Proto_SpecialEnergy2Max,this.Zcl=this.TagComponent.HasTag(tagRed),this.Ycl.Init(this.tml())}async OnBeforeStartAsync(){var t=[];t.push(this.sml(this.GetItem(0))),t.push(this.aml(this.GetItem(1))),t.push(this.LoadEffects()),t.push(this.InitKeyItem(this.GetItem(2))),await Promise.all(t)}async sml(t){this.$cl=new SpecialEnergyBarSlotItem_1.SpecialEnergyBarSlotItem,await this.$cl.CreateThenShowByActorAsync(t.GetOwner())}async aml(t){this.Xcl=new SpecialEnergyBarSlotItem_1.SpecialEnergyBarSlotItem,await this.Xcl.CreateThenShowByActorAsync(t.GetOwner())}AddEvents(){super.AddEvents(),this.ListenForAttributeChanged(this.zcl,this.eml),this.ListenForAttributeChanged(this.Jcl,this.rml),this.ListenForTagAddOrRemoveChanged(tagRed,this.oml)}RemoveEvents(){super.RemoveEvents(),this.RemoveListenAttributeChanged(this.zcl,this.eml),this.RemoveListenAttributeChanged(this.Jcl,this.rml)}OnStart(){this.Config&&(this.$cl.SetEffectBasePercent(EFFECT_BASE_PERCENT),this.Xcl.SetEffectBasePercent(EFFECT_BASE_PERCENT),this.lml(this.$cl,this.Config.PointColorList[0],this.Config.PointColorList[1],this.Config.EffectColor),this.lml(this.Xcl,this.Config.PointColorList[2],this.Config.PointColorList[3],this.Config.OtherEffectColorList[0]),this.$cl.ReplaceFullEffect(this.NiagaraList[0]),this.Xcl.ReplaceFullEffect(this.NiagaraList[1]),this.nml(!0),this.hml(!0),this._ml(!0),this.uml(!0))}lml(t,i,e,s){i=UE.Color.FromHex(i),e=UE.Color.FromHex(e),s=new UE.LinearColor(UE.Color.FromHex(s));t.SetPointBgColor(i),t.SetBarColor(e),t.SetPointColor(e),t.SetBgAndUseEffectColor(s)}nml(t=!1){Log_1.Log.CheckDebug()&&Log_1.Log.Debug("Battle",17,"灯灯能量条改变状态",["isRed",this.Zcl]),this.GetItem(3)?.SetUIActive(!this.Zcl),this.GetItem(4)?.SetUIActive(this.Zcl),t||this.uml()}hml(t=!1){var i=this.PercentMachine.GetCurPercent(),i=(this.$cl.UpdatePercent(i,i>=this.Config.DisableKeyOnPercent),this.GetItem(3)?.SetAnchorOffsetX(-i*WIDTH),this.Zcl||t||this.uml(),0<i);!t&&i===this.pml||(this.pml=i,this.GetUiNiagara(5)?.SetUIActive(i))}_ml(t=!1){var i=this.Ycl.GetCurPercent(),i=(this.Xcl.UpdatePercent(i,i>=this.Config.DisableKeyOnPercent),this.GetItem(4)?.SetAnchorOffsetX(i*WIDTH),this.Zcl&&!t&&this.uml(t),0<i);!t&&i===this.fml||(this.fml=i,this.GetUiNiagara(6)?.SetUIActive(i))}uml(t=!1){this.KeyItem?.RefreshKeyEnable(this.GetKeyEnable(),t)}GetKeyEnable(){let t=0;return(t=(this.Zcl?this.Ycl:this.PercentMachine).GetCurPercent())>=this.Config.DisableKeyOnPercent}OnBarPercentChanged(){this.hml()}iml(){this._ml()}Tick(t){super.Tick(t),this.Ycl.Update(t)&&this.iml(),this.$cl?.Tick(t),this.Xcl?.Tick(t)}tml(){var t=this.AttributeComponent.GetCurrentValue(this.zcl),i=this.AttributeComponent.GetCurrentValue(this.Jcl);let e=0<i?t/i:0;return e}}exports.SpecialEnergyBarDengDeng=SpecialEnergyBarDengDeng;
//# sourceMappingURL=SpecialEnergyBarDengDeng.js.map