
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InstanceDungeonInfoItem=void 0;const ue_1=require("ue"),EventDefine_1=require("../../../Common/Event/EventDefine"),EventSystem_1=require("../../../Common/Event/EventSystem"),ConfigManager_1=require("../../../Manager/ConfigManager"),ModelManager_1=require("../../../Manager/ModelManager"),UiPanelBase_1=require("../../../Ui/Base/UiPanelBase"),ActivityMowingController_1=require("../../Activity/ActivityContent/Mowing/ActivityMowingController"),RoguelikeBlackFlowerItem_1=require("../../Roguelike/View/RoguelikeBlackFlowerItem"),TowerDefenceController_1=require("../../TowerDefence/TowerDefenceController"),InstanceDungeonEntranceRewardItem_1=require("../InstanceDungeonEntranceRewardItem"),InstanceDungeonEntranceTowerDefenceItem_1=require("../InstanceDungeonEntranceTowerDefenceItem"),InstanceDungeonBuffItem_1=require("./InstanceDungeonBuffItem"),InstanceDungeonCostItem_1=require("./InstanceDungeonCostItem"),InstanceDungeonLockItem_1=require("./InstanceDungeonLockItem"),InstanceDungeonMatchingItem_1=require("./InstanceDungeonMatchingItem"),InstanceDungeonMowingDropDownItem_1=require("./InstanceDungeonMowingDropDownItem"),InstanceDungeonRecommendLevelItem_1=require("./InstanceDungeonRecommendLevelItem"),InstanceDungeonRightTitleItem_1=require("./InstanceDungeonRightTitleItem"),InstanceDungeonStartButtonItem_1=require("./InstanceDungeonStartButtonItem");class InstanceDungeonInfoItem extends UiPanelBase_1.UiPanelBase{constructor(){super(...arguments),this.NUe=0,this.Qth=void 0,this.Kth=void 0,this.jzs=void 0,this.$th=void 0,this.Xth=void 0,this.gli=void 0,this.Yth=void 0,this.zth=void 0,this.Jth=void 0,this.Zth=void 0,this.ygl=void 0,this.fQl=[],this.vMl=()=>{var e=ConfigManager_1.ConfigManager.InstanceDungeonConfig.GetConfig(this.NUe);e&&this.iih(e.InstSubType)}}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,ue_1.UIItem],[1,ue_1.UIItem],[2,ue_1.UIItem],[3,ue_1.UIItem]]}async OnBeforeStartAsync(){var e=[];this.Qth=new InstanceDungeonRightTitleItem_1.InstanceDungeonRightTitleItem,e.push(this.Qth.CreateByResourceIdAsync("UiItem_InstanceDungeon_RightTitle",this.GetItem(0))),this.zth=new InstanceDungeonStartButtonItem_1.InstanceDungeonStartButtonItem,e.push(this.zth.CreateByResourceIdAsync("UiItem_InstanceDungeon_StartButton",this.GetItem(2))),this.Jth=new InstanceDungeonMatchingItem_1.InstanceDungeonMatchingItem,e.push(this.Jth.CreateByResourceIdAsync("UiItem_InstanceDungeon_MatchingItem",this.GetItem(2))),this.Zth=new InstanceDungeonLockItem_1.InstanceDungeonLockItem,e.push(this.Zth.CreateByResourceIdAsync("UiItem_InstanceDungeon_Lock",this.GetItem(2))),await Promise.all(e)}OnStart(){EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnRefreshInstancedRecommendLevel,this.vMl)}OnBeforeDestroy(){EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnRefreshInstancedRecommendLevel,this.vMl)}InitButton(e,t,n){this.zth.OnClickBtnSoloCallBack=e,this.zth.OnClickBtnMultipleCallBack=t,this.zth.OnClickBtnTeamCallBack=n}async RefreshItem(e){this.NUe=e;e=ConfigManager_1.ConfigManager.InstanceDungeonConfig.GetConfig(e);if(e){this.Qth.RefreshItem(e.MapName,e.DungeonDesc,e.RecommendElement),this.zth.RefreshItem(e.OnlineType),this.Egl(e),this.eih(e.MonsterTips,0<e.MonsterPreview.length),this.tih(e.InstSubType),this.iih(e.InstSubType),this.rih(),this.UpdateInstanceDungeonLockItemAndCostItem(),this.oih(e.InstSubType);for(const t of this.fQl)await t();this.fQl=[]}}eih(e,t){""!==e||t?this.Kth?(this.Kth?.SetActive(!0),this.Kth?.RefreshItem(e,t)):(this.Kth=new InstanceDungeonBuffItem_1.InstanceDungeonBuffItem,this.fQl.push(async()=>this.Kth.CreateThenShowByResourceIdAsync("UiItem_InstanceDungeon_Buff",this.GetItem(0)).then(()=>{this.Kth?.RefreshItem(e,t)}))):this.Kth?.SetActive(!1)}tih(e){if(21===e){const t=TowerDefenceController_1.TowerDefenseController.BuildPhantomForInstanceDungeonEntranceData(this.NUe);this.jzs?(this.jzs.SetActive(!0),this.jzs.RefreshItem(t)):(this.jzs=new InstanceDungeonEntranceTowerDefenceItem_1.InstanceDungeonEntranceTowerDefenceItem,this.fQl.push(async()=>this.jzs.CreateThenShowByResourceIdAsync("UiItem_InstanceDungeon_Reward",this.GetItem(0)).then(()=>{this.jzs.RefreshItem(t)})))}else this.jzs?.SetActive(!1)}iih(t){if(21===t||19===t||22===t){let e={TextId:"RecommendLevel",Level:0};21===t?e=TowerDefenceController_1.TowerDefenseController.BuildRecommendLevelForInstanceDungeonEntranceData(this.NUe):(t=ActivityMowingController_1.ActivityMowingController.GetMowingActivityData()?.GetLevelDiffRecommendLevel(this.NUe),e.Level=t??0),this.$th?(this.$th.SetActive(!0),this.$th.RefreshItem(e)):(this.$th=new InstanceDungeonRecommendLevelItem_1.InstanceDungeonRecommendLevelItem,this.fQl.push(async()=>this.$th.CreateThenShowByResourceIdAsync("UiItem_InstanceDungeon_RecommenLevel",this.GetItem(1)).then(()=>{this.$th.RefreshItem(e)})))}else this.$th?.SetActive(!1)}nih(){var e=ModelManager_1.ModelManager.InstanceDungeonEntranceModel.GetInstancePowerCost(this.NUe);if(!e||e<=0)this.Xth?.SetUiActive(!1);else{const t=ModelManager_1.ModelManager.ExchangeRewardModel.GetExchangeNormalConsume(this.NUe);this.Xth?(this.Xth.SetActive(!0),this.Xth.RefreshItem(t[0])):(this.Xth=new InstanceDungeonCostItem_1.InstanceDungeonCostItem,this.fQl.push(async()=>this.Xth.CreateThenShowByResourceIdAsync("UiItem_InstanceDungeon_Cost",this.GetItem(1)).then(()=>{this.Xth.RefreshItem(t[0])})))}}rih(){ModelManager_1.ModelManager.InstanceDungeonEntranceModel.GetInstanceDungeonReward(this.NUe)[0].length<=0?this.gli?.SetActive(!1):this.gli?(this.gli.SetActive(!0),this.gli.RefreshItem(this.NUe)):(this.gli=new InstanceDungeonEntranceRewardItem_1.InstanceDungeonEntranceRewardItem,this.fQl.push(async()=>this.gli.CreateThenShowByResourceIdAsync("UiItem_InstanceDungeon_Reward",this.GetItem(1)).then(()=>{this.gli.RefreshItem(this.NUe)})))}oih(e){var e=19===e,t=ModelManager_1.ModelManager.InstanceDungeonEntranceModel.CheckInstanceUnlock(this.NUe);e&&t?this.Yth?(this.Yth.SetActive(!0),this.Yth.RefreshItem(this.NUe)):(this.Yth=new InstanceDungeonMowingDropDownItem_1.InstanceDungeonMowingDropDownItem,this.fQl.push(async()=>(this.Yth.SkipDestroyActor=!0,this.Yth.CreateThenShowByResourceIdAsync("UiItem_InstanceDungeon_DropItem",this.GetItem(1)).then(()=>{this.Yth.RefreshItem(this.NUe),this.AddChild(this.Yth)})))):this.Yth?.SetActive(!1)}SetMatchingItemActive(e){var t=ModelManager_1.ModelManager.InstanceDungeonEntranceModel.CheckInstanceUnlock(this.NUe);this.zth?.SetActive(!e&&t),this.Jth?.SetActive(e)}UpdateInstanceDungeonLockItemAndCostItem(){var e=1===ModelManager_1.ModelManager.InstanceDungeonEntranceModel.GetMatchingState(),t=(this.Xth?.SetActive(!1),ModelManager_1.ModelManager.InstanceDungeonEntranceModel.CheckInstanceUnlock(this.NUe));t?(this.nih(),this.zth.SetActive(!e),this.Zth.SetActive(!1),this.Jth?.SetActive(e)):((t=ConfigManager_1.ConfigManager.InstanceDungeonConfig.GetUnlockConditionGroupHintText(this.NUe))&&this.Zth.RefreshItem(t),this.zth.SetActive(!1),this.Zth.SetActive(!0),this.Jth?.SetActive(!1))}Egl(e){var e=15===e.InstSubType,t=ModelManager_1.ModelManager.RoguelikeModel.HasBlackFlowerExchanged(this.NUe);e&&t?this.ygl?this.ygl.SetActive(!0):(this.ygl=new RoguelikeBlackFlowerItem_1.RoguelikeBlackFlowerInstanceItem,this.fQl.push(async()=>this.ygl.CreateThenShowByResourceIdAsync("UiItem_CheckpointsRReward",this.GetItem(3)).then(()=>{this.ygl?.GetRootItem().SetHierarchyIndex(0)}))):this.ygl?.SetActive(!1)}SetLockText(e){this.Zth.SetActive(!0),this.Zth.SetLockText(e)}}exports.InstanceDungeonInfoItem=InstanceDungeonInfoItem;
//# sourceMappingURL=InstanceDungeonInfoItem.js.map