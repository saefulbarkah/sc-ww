
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InstanceDungeonInfoItem=void 0;const ue_1=require("ue"),EventDefine_1=require("../../../Common/Event/EventDefine"),EventSystem_1=require("../../../Common/Event/EventSystem"),ConfigManager_1=require("../../../Manager/ConfigManager"),ControllerHolder_1=require("../../../Manager/ControllerHolder"),ModelManager_1=require("../../../Manager/ModelManager"),UiPanelBase_1=require("../../../Ui/Base/UiPanelBase"),ActivityMowingController_1=require("../../Activity/ActivityContent/Mowing/ActivityMowingController"),RoguelikeBlackFlowerItem_1=require("../../Roguelike/View/RoguelikeBlackFlowerItem"),TowerDefenceController_1=require("../../TowerDefence/TowerDefenceController"),GenericLayout_1=require("../../Util/Layout/GenericLayout"),LguiUtil_1=require("../../Util/LguiUtil"),InstanceDungeonMapDefine_1=require("../Define/InstanceDungeonMapDefine"),InstanceDungeonEntranceRewardItem_1=require("../InstanceDungeonEntranceRewardItem"),InstanceDungeonEntranceTowerDefenceItem_1=require("../InstanceDungeonEntranceTowerDefenceItem"),InstanceDungeonBottomTipItem_1=require("./InstanceDungeonBottomTipItem"),InstanceDungeonBuffItem_1=require("./InstanceDungeonBuffItem"),InstanceDungeonCostItem_1=require("./InstanceDungeonCostItem"),InstanceDungeonDescWidelyItem_1=require("./InstanceDungeonDescWidelyItem"),InstanceDungeonLockItem_1=require("./InstanceDungeonLockItem"),InstanceDungeonMatchingItem_1=require("./InstanceDungeonMatchingItem"),InstanceDungeonMowingDropDownItem_1=require("./InstanceDungeonMowingDropDownItem"),InstanceDungeonPicItem_1=require("./InstanceDungeonPicItem"),InstanceDungeonRecommendLevelItem_1=require("./InstanceDungeonRecommendLevelItem"),InstanceDungeonRightTitleItem_1=require("./InstanceDungeonRightTitleItem"),InstanceDungeonScoreListItem_1=require("./InstanceDungeonScoreListItem"),InstanceDungeonStartButtonItem_1=require("./InstanceDungeonStartButtonItem"),InstanceDungeonTitleWidelyItem_1=require("./InstanceDungeonTitleWidelyItem");class InstanceDungeonInfoItem extends UiPanelBase_1.UiPanelBase{constructor(){super(...arguments),this.NUe=0,this.Qth=void 0,this.Kth=void 0,this.jzs=void 0,this.$th=void 0,this.Xth=void 0,this.gli=void 0,this.Yth=void 0,this.zth=void 0,this.Jth=void 0,this.Zth=void 0,this.ygl=void 0,this.zU_=void 0,this.JU_=void 0,this.ZU_=void 0,this.G3_=void 0,this.F3_=void 0,this.N3_=void 0,this.V3_=void 0,this.lt_=[],this.eD_=()=>new InstanceDungeonBottomTipItem_1.InstanceDungeonBottomTipItem,this.vMl=()=>{var e=ConfigManager_1.ConfigManager.InstanceDungeonConfig.GetConfig(this.NUe);e&&this.iih(e.InstSubType)}}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,ue_1.UIItem],[1,ue_1.UIItem],[2,ue_1.UIItem],[3,ue_1.UIItem],[4,ue_1.UIVerticalLayout]]}async OnBeforeStartAsync(){var e=[];this.Qth=new InstanceDungeonRightTitleItem_1.InstanceDungeonRightTitleItem,e.push(this.Qth.CreateByResourceIdAsync("UiItem_InstanceDungeon_RightTitle",this.GetItem(0))),this.zth=new InstanceDungeonStartButtonItem_1.InstanceDungeonStartButtonItem,e.push(this.zth.CreateByResourceIdAsync("UiItem_InstanceDungeon_StartButton",this.GetItem(2))),this.Jth=new InstanceDungeonMatchingItem_1.InstanceDungeonMatchingItem,e.push(this.Jth.CreateByResourceIdAsync("UiItem_InstanceDungeon_MatchingItem",this.GetItem(2))),this.Zth=new InstanceDungeonLockItem_1.InstanceDungeonLockItem,e.push(this.Zth.CreateByResourceIdAsync("UiItem_InstanceDungeon_Lock",this.GetItem(2))),await Promise.all(e)}OnStart(){EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnRefreshInstancedRecommendLevel,this.vMl)}OnBeforeDestroy(){EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnRefreshInstancedRecommendLevel,this.vMl)}InitButton(e,t,n){this.zth.OnClickBtnSoloCallBack=e,this.zth.OnClickBtnMultipleCallBack=t,this.zth.OnClickBtnTeamCallBack=n}async RefreshItem(e){this.NUe=e;var t=ConfigManager_1.ConfigManager.InstanceDungeonConfig.GetConfig(e);if(t){ControllerHolder_1.ControllerHolder.InstanceDungeonEntranceController.CheckRightTitleAvailableByInstanceId(e)&&this.Qth.RefreshItem(t.MapName,t.DungeonDesc,t.RecommendElement),this.zth.RefreshItem(t.OnlineType),this.Egl(t),this.eih(t.MonsterTips,0<t.MonsterPreview.length),this.tih(t.InstSubType),this.tD_(t.InstSubType),this.iih(t.InstSubType),this.rih(),this.iD_(t.InstSubType),this.UpdateInstanceDungeonLockItemAndCostItem(),this.oih(t.InstSubType),this.j3_(e),this.H3_(e),this.$3_(e),this.W3_(e);for(const n of this.lt_)await n();this.lt_=[]}}eih(e,t){""!==e||t?this.Kth?(this.Kth?.SetActive(!0),this.Kth?.RefreshItem(e,t)):(this.Kth=new InstanceDungeonBuffItem_1.InstanceDungeonBuffItem,this.lt_.push(async()=>this.Kth.CreateThenShowByResourceIdAsync("UiItem_InstanceDungeon_Buff",this.GetItem(0)).then(()=>{this.Kth?.RefreshItem(e,t)}))):this.Kth?.SetActive(!1)}tih(e){if(21===e){const t=TowerDefenceController_1.TowerDefenseController.BuildPhantomForInstanceDungeonEntranceData(this.NUe);this.jzs?(this.jzs.SetActive(!0),this.jzs.RefreshItem(t)):(this.jzs=new InstanceDungeonEntranceTowerDefenceItem_1.InstanceDungeonEntranceTowerDefenceItem,this.lt_.push(async()=>this.jzs.CreateThenShowByResourceIdAsync("UiItem_InstanceDungeon_Reward",this.GetItem(0)).then(()=>{this.jzs.RefreshItem(t)})))}else this.jzs?.SetActive(!1)}tD_(e){22===e||!this.zU_?this.zU_?this.zU_.SetUIActive(!0):this.lt_.push(async()=>{var e=await LguiUtil_1.LguiUtil.LoadPrefabByResourceIdAsync("UiItem_InstanceDungeon_Rline",this.GetItem(1));this.zU_=e.GetComponentByClass(ue_1.UIItem.StaticClass()),this.zU_.SetUIActive(!0)}):this.zU_.SetUIActive(!1)}iih(t){if(21===t||19===t||22===t){let e={TextId:"RecommendLevel",Level:0};21===t?e=TowerDefenceController_1.TowerDefenseController.BuildRecommendLevelForInstanceDungeonEntranceData(this.NUe):22===t?(t=ModelManager_1.ModelManager.MowingRiskModel.BuildInstanceRecommendDataByInstanceId(this.NUe),e.TextId=t.TextId,e.Level=t.RecommendLevel):(t=ActivityMowingController_1.ActivityMowingController.GetMowingActivityData()?.GetLevelDiffRecommendLevel(this.NUe),e.Level=t??0),this.$th?(this.$th.SetActive(!0),this.$th.RefreshItem(e)):(this.$th=new InstanceDungeonRecommendLevelItem_1.InstanceDungeonRecommendLevelItem,this.lt_.push(async()=>this.$th.CreateThenShowByResourceIdAsync("UiItem_InstanceDungeon_RecommenLevel",this.GetItem(1)).then(()=>{this.$th.RefreshItem(e)})))}else this.$th?.SetActive(!1)}nih(){var e=ModelManager_1.ModelManager.InstanceDungeonEntranceModel.GetInstancePowerCost(this.NUe);if(!e||e<=0)this.Xth?.SetUiActive(!1);else{const t=ModelManager_1.ModelManager.ExchangeRewardModel.GetExchangeNormalConsume(this.NUe);this.Xth?(this.Xth.SetActive(!0),this.Xth.RefreshItem(t[0])):(this.Xth=new InstanceDungeonCostItem_1.InstanceDungeonCostItem,this.lt_.push(async()=>this.Xth.CreateThenShowByResourceIdAsync("UiItem_InstanceDungeon_Cost",this.GetItem(1)).then(()=>{this.Xth.RefreshItem(t[0])})))}}rih(){ModelManager_1.ModelManager.InstanceDungeonEntranceModel.GetInstanceDungeonReward(this.NUe)[0].length<=0?this.gli?.SetActive(!1):this.gli?(this.gli.SetActive(!0),this.gli.RefreshItem(this.NUe)):(this.gli=new InstanceDungeonEntranceRewardItem_1.InstanceDungeonEntranceRewardItem,this.lt_.push(async()=>this.gli.CreateThenShowByResourceIdAsync("UiItem_InstanceDungeon_Reward",this.GetItem(1)).then(()=>{this.gli.RefreshItem(this.NUe)})))}iD_(e){let t=void 0;var n,i;22===e&&(t=[],n=(e=ModelManager_1.ModelManager.MowingRiskModel).GetRiskHarvestInstConfigByInstanceId(this.NUe),i={TextId:"riskofrain_total_num",TextArgs:[e.GetMaxScoreByInstanceId(this.NUe).toString()]},t.push(i),n.Accumulate||(i={TextId:"riskofrain_ratio_num",TextArgs:[e.GetMonsterRatioByInstanceId(this.NUe).toString()]},t.push(i))),t&&0!==t.length?(this.GetVerticalLayout(4).RootUIComp.SetUIActive(!0),this.lt_.push(async()=>this.rD_().then(async()=>{this.oD_(),await this.ZU_?.RefreshByDataAsync(t??[])}))):this.GetVerticalLayout(4).RootUIComp.SetUIActive(!1)}async rD_(){this.JU_||(this.JU_=new InstanceDungeonBottomTipItem_1.InstanceDungeonBottomTipItem,await this.JU_.CreateByResourceIdAsync("UiItem_InstanceDungeon_Rtips",this.GetVerticalLayout(4).RootUIComp))}oD_(){var e;this.ZU_||(e=this.GetVerticalLayout(4),this.ZU_=new GenericLayout_1.GenericLayout(e,this.eD_))}oih(e){var e=19===e,t=ModelManager_1.ModelManager.InstanceDungeonEntranceModel.CheckInstanceUnlock(this.NUe);e&&t?this.Yth?(this.Yth.SetActive(!0),this.Yth.RefreshItem(this.NUe)):(this.Yth=new InstanceDungeonMowingDropDownItem_1.InstanceDungeonMowingDropDownItem,this.lt_.push(async()=>(this.Yth.SkipDestroyActor=!0,this.Yth.CreateThenShowByResourceIdAsync("UiItem_InstanceDungeon_DropItem",this.GetItem(1)).then(()=>{this.Yth.RefreshItem(this.NUe),this.AddChild(this.Yth)})))):this.Yth?.SetActive(!1)}SetMatchingItemActive(e){var t=ModelManager_1.ModelManager.InstanceDungeonEntranceModel.CheckInstanceUnlock(this.NUe);this.zth?.SetActive(!e&&t),this.Jth?.SetActive(e)}UpdateInstanceDungeonLockItemAndCostItem(){var e=1===ModelManager_1.ModelManager.InstanceDungeonEntranceModel.GetMatchingState();this.Xth?.SetActive(!1);let t=void 0,n=void 0,i=void 0;var s=ConfigManager_1.ConfigManager.InstanceDungeonConfig.GetConfig(this.NUe),s=(s&&(s=s.InstSubType,s=InstanceDungeonMapDefine_1.instanceGetterDataMap[s],t=s?.CheckInstanceUnlockGetter,n=s?.LockTextIdGetter,i=s?.LockTextArgsGetter),t?t(this.NUe):ModelManager_1.ModelManager.InstanceDungeonEntranceModel.CheckInstanceUnlock(this.NUe));s?(this.nih(),this.zth.SetActive(!e),this.Zth.SetActive(!1),this.Jth?.SetActive(e)):((s=n?n(this.NUe):ModelManager_1.ModelManager.InstanceDungeonEntranceModel.GetUnlockTextIdById(this.NUe))&&(e=i?i(this.NUe):ModelManager_1.ModelManager.InstanceDungeonEntranceModel.GetUnlockArgsById(this.NUe),this.Zth.RefreshItem(s,e)),this.zth.SetActive(!1),this.Zth.SetActive(!0),this.Jth?.SetActive(!1))}Egl(e){var e=15===e.InstSubType,t=ModelManager_1.ModelManager.RoguelikeModel.HasBlackFlowerExchanged(this.NUe);e&&t?this.ygl?this.ygl.SetActive(!0):(this.ygl=new RoguelikeBlackFlowerItem_1.RoguelikeBlackFlowerInstanceItem,this.lt_.push(async()=>this.ygl.CreateThenShowByResourceIdAsync("UiItem_CheckpointsRReward",this.GetItem(3)).then(()=>{this.ygl?.GetRootItem().SetHierarchyIndex(0)}))):this.ygl?.SetActive(!1)}H3_(e){const t=ControllerHolder_1.ControllerHolder.InstanceDungeonEntranceController.GetPictureItemDataGetter(e);t?this.G3_?(this.G3_.SetUiActive(!0),this.G3_.RefreshItem(t())):(this.G3_=new InstanceDungeonPicItem_1.InstanceDungeonPicItem,this.lt_.push(async()=>this.G3_?.CreateThenShowByResourceIdAsync("UiItem_CheckpointsRPic",this.GetItem(0)).then(()=>{this.G3_?.SetUiActive(!0),this.G3_?.RefreshItem(t())}))):this.G3_?.SetUiActive(!1)}$3_(e){const t=ControllerHolder_1.ControllerHolder.InstanceDungeonEntranceController.GetDescWidelyItemDataGetter(e);t?this.F3_?(this.F3_.SetUiActive(!0),this.F3_.RefreshItem(t())):(this.F3_=new InstanceDungeonDescWidelyItem_1.InstanceDungeonDescWidelyItem,this.lt_.push(async()=>this.F3_?.CreateThenShowByResourceIdAsync("UiItem_CheckpointsRText",this.GetItem(0)).then(()=>{this.F3_?.SetUiActive(!0),this.F3_?.RefreshItem(t())}))):this.F3_?.SetUiActive(!1)}j3_(e){const t=ControllerHolder_1.ControllerHolder.InstanceDungeonEntranceController.GetTitleWidelyItemDataGetter(e);t?this.N3_?(this.N3_.SetUiActive(!0),this.N3_.RefreshItem(t())):(this.N3_=new InstanceDungeonTitleWidelyItem_1.InstanceDungeonTitleWidelyItem,this.lt_.push(async()=>this.N3_?.CreateThenShowByResourceIdAsync("UiItem_CheckpointsRTitleA",this.GetItem(0)).then(()=>{this.N3_?.SetUiActive(!0),this.N3_?.RefreshItem(t())}))):this.N3_?.SetUiActive(!1)}W3_(e){const t=ControllerHolder_1.ControllerHolder.InstanceDungeonEntranceController.GetScoreListItemDataGetter(e);t?this.V3_?(this.V3_.SetUiActive(!0),this.V3_.RefreshItem(t())):(this.V3_=new InstanceDungeonScoreListItem_1.InstanceDungeonScoreListItem,this.lt_.push(async()=>{await this.V3_?.CreateThenShowByResourceIdAsync("UiItem_CheckpointsRRaceScore",this.GetItem(1)).then(()=>{this.V3_?.SetUiActive(!0),this.V3_?.RefreshItem(t())})})):this.V3_?.SetUiActive(!1)}SetLockText(e){this.Zth.SetActive(!0),this.Zth.SetLockText(e)}}exports.InstanceDungeonInfoItem=InstanceDungeonInfoItem;
//# sourceMappingURL=InstanceDungeonInfoItem.js.map