
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.InventoryMediumItemGrid=void 0;const Log_1=require("../../../../Core/Common/Log"),MultiTextLang_1=require("../../../../Core/Define/ConfigQuery/MultiTextLang"),StringUtils_1=require("../../../../Core/Utils/StringUtils"),ControllerHolder_1=require("../../../Manager/ControllerHolder"),ModelManager_1=require("../../../Manager/ModelManager"),LoopScrollMediumItemGrid_1=require("../../Common/MediumItemGrid/LoopScrollMediumItemGrid"),MediumItemGridRoleHeadComponent_1=require("../../Common/MediumItemGrid/MediumItemGridComponent/MediumItemGridRoleHeadComponent"),RED_TICK_HEX="bf5c5c",TICK_COLOR_HEX="663738",RED_TICK_ALPHA=.9;class InventoryMediumItemGrid extends LoopScrollMediumItemGrid_1.LoopScrollMediumItemGrid{constructor(){super(...arguments),this.rdi=void 0,this.ndi=void 0}OnRefresh(e,o,t){var i=(this.rdi=e).GetItemViewInfo(),n=i.ItemDataType,r=i.QualityId,s=1===e.GetItemOperationType(),a={Type:4,Data:e,ItemConfigId:e.GetConfigId(),StarLevel:r,IsNewVisible:i.IsNewItem,IsLockVisible:i.IsLock,CoolDown:this.GetRemainingCoolDownTime(),TotalCoolDown:this.GetTotalCoolDownTime(),IsRedDotVisible:i.HasRedDot,IsDisable:s&&!e.IsItemCanDestroy(),IsCheckTick:i.IsSelectOn};switch(n){case 0:var l=this.rdi.GetItemDataBase();i.SelectOnNum?(d=MultiTextLang_1.configMultiTextLang.GetLocalTextNew("Text_ItemRecycleChosen_text"),d=StringUtils_1.StringUtils.Format(d,i.SelectOnNum.toString(),e.GetCount().toString()),a.BottomText=d):a.BottomText=e.GetCount().toString(),a.IsTimeFlagVisible=l.IsLimitTimeItem(),a.BuffIconType=l.GetConfig().ItemBuffType,a.IsOmitBottomText=!1;break;case 2:var d=this.rdi.GetItemDataBase().GetUniqueId(),l=ModelManager_1.ModelManager.WeaponModel.GetWeaponDataByIncId(d);a.BottomTextId="Text_LevelShow_Text",a.BottomTextParameter=[l.GetLevel()],a.Level=l.GetResonanceLevel(),a.RoleHeadInfo={RoleConfigId:l.GetRoleId()};break;case 3:var m,d=this.rdi.GetItemDataBase().GetUniqueId(),l=ModelManager_1.ModelManager.PhantomBattleModel.GetPhantomBattleData(d),_=l.GetCurrentSlotData();if(a.Level=l.GetCost(),a.IsLevelTextUseChangeColor=!0,a.BottomText="+"+l.GetPhantomLevel().toString(),a.IsOmitBottomText=!0,0<_.length){var C=_[0]?.SlotState??0,I=_[1]?.SlotState??0,h=_[2]?.SlotState??0;switch(r){case 3:a.VisionSlotStateList=[C];break;case 4:a.VisionSlotStateList=[C,I];break;case 5:a.VisionSlotStateList=[C,I,h]}}ControllerHolder_1.ControllerHolder.PhantomBattleController.CheckIsEquip(d)&&(_=l.GetUniqueId(),d=ControllerHolder_1.ControllerHolder.PhantomBattleController.GetEquipRole(_),m=ModelManager_1.ModelManager.PhantomBattleModel.CheckPhantomIsMain(_),a.VisionRoleHeadInfo={RoleConfigId:d,VisionUniqueId:_},a.IsMainVisionVisible=m),a.VisionFetterGroupId=l.GetFetterGroupId();break;default:a.BottomText=e.GetCount().toString()}this.Apply(a),this.SetCheckTickPerformance(i.IsSelectOn,RED_TICK_HEX,RED_TICK_ALPHA,TICK_COLOR_HEX),this.SetSelected(o)}OnApply(){var e;ModelManager_1.ModelManager.InventoryModel.IsPrintInventoryItemGridDebugOnApply||0===this.rdi?.GetItemViewInfo().ItemDataType&&(e=this.GetItemGridComponent(MediumItemGridRoleHeadComponent_1.MediumItemGridRoleHeadComponent))&&e.GetActive()&&(Log_1.Log.CheckError()&&Log_1.Log.Error("Inventory",8,"[InventoryDebug]当应用时,打印道具框可见性信息====开始",["ItemConfigId",this.rdi?.GetConfigId()],["VisibleComponentSize",this.VisibleComponents.size],["ComponentSize",this.ComponentMap.size]),this.QAa(),ModelManager_1.ModelManager.InventoryModel.IsPrintInventoryItemGridDebugOnApply=!0)}OnAllComponentLoaded(){var e;ModelManager_1.ModelManager.InventoryModel.IsPrintInventoryItemGridDebugOnAllComponentLoaded||0===this.rdi?.GetItemViewInfo().ItemDataType&&(e=this.GetItemGridComponent(MediumItemGridRoleHeadComponent_1.MediumItemGridRoleHeadComponent))&&e.GetActive()&&(Log_1.Log.CheckError()&&Log_1.Log.Error("Inventory",8,"[InventoryDebug]所有道具框组件加载完成,打印道具框可见性信息====开始",["ItemConfigId",this.rdi?.GetConfigId()],["VisibleComponentSize",this.VisibleComponents.size],["ComponentSize",this.ComponentMap.size]),this.QAa(),ModelManager_1.ModelManager.InventoryModel.IsPrintInventoryItemGridDebugOnAllComponentLoaded=!0)}QAa(){for(const e of this.VisibleComponents)Log_1.Log.CheckInfo()&&Log_1.Log.Info("Inventory",8,"[InventoryDebug]道具框可见组件",["Name",e.constructor.name]);for(const o of this.ComponentMap.values())Log_1.Log.CheckInfo()&&Log_1.Log.Info("Inventory",8,"[InventoryDebug]道具框所有组件",["Name",o.constructor.name])}OnSelected(e){this.SetSelected(!0)}OnDeselected(e){this.SetSelected(!1)}GetRemainingCoolDownTime(){var e=this.rdi.GetConfigId();return ModelManager_1.ModelManager.BuffItemModel.GetBuffItemRemainCdTime(e)}GetTotalCoolDownTime(){var e=this.rdi.GetConfigId();return ModelManager_1.ModelManager.BuffItemModel.GetBuffItemTotalCdTime(e)}RefreshCoolDown(){var e=this.GetRemainingCoolDownTime(),o=this.GetTotalCoolDownTime();this.SetCoolDown(e,o)}BindOnItemButtonClickedCallback(e){this.ndi=e}OnExtendToggleStateChanged(e){this.ndi&&this.ndi(this.rdi)}}exports.InventoryMediumItemGrid=InventoryMediumItemGrid;
//# sourceMappingURL=InventoryMediumItemGrid.js.map