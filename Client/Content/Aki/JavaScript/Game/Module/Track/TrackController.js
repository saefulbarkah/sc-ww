
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TrackController=void 0;const Log_1=require("../../../Core/Common/Log"),ControllerBase_1=require("../../../Core/Framework/ControllerBase"),IComponent_1=require("../../../UniverseEditor/Interface/IComponent"),EventDefine_1=require("../../Common/Event/EventDefine"),EventSystem_1=require("../../Common/Event/EventSystem"),ControllerHolder_1=require("../../Manager/ControllerHolder"),ModelManager_1=require("../../Manager/ModelManager");class TrackController extends ControllerBase_1.ControllerBase{static OnInit(){return EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnEnterNearbyTrackRange,this.gRo),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnLeaveNearbyTrackRange,this.fRo),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.RemoveNearbyTrack,this.fRo),!0}static OnClear(){return EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnEnterNearbyTrackRange,this.gRo),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnLeaveNearbyTrackRange,this.fRo),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.RemoveNearbyTrack,this.fRo),!0}static StartTrack(e,t=!0){return!!e&&(Log_1.Log.CheckDebug()&&Log_1.Log.Debug("Track",63,"开始追踪:",["追踪类型:",e.TrackSource],["追踪Id:",e.Id],["追踪目标:",e.TrackTarget]),e.IsSubTrack=t,ModelManager_1.ModelManager.TrackModel.AddTrackData(e),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.TrackMark,e),!0)}static EndTrack(e,t){var r=ModelManager_1.ModelManager.TrackModel.GetTrackData(e,t);return!!r&&(Log_1.Log.CheckInfo()&&Log_1.Log.Info("Track",49,"取消追踪:",["追踪类型:",r.TrackSource],["追踪Id:",r.Id],["追踪目标:",r.TrackTarget]),ModelManager_1.ModelManager.TrackModel.RemoveTrackData(e,t),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.UnTrackMark,r),!0)}static SetTrackMarkOccupied(e,t,r){EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.SetTrackMarkOccupied,e,t,r)}}(exports.TrackController=TrackController).gRo=t=>{if(t){var r=t.GetComponent(155);if(r?.Valid&&"Compass"!==r.TrackConfigType){var n=t.GetComponent(1).CreatureData.GetPbEntityInitData(),n=(0,IComponent_1.getComponent)(n.ComponentsData,"InteractComponent"),e=t.GetComponent(191);if(!e||!e.HasTag(1196894179)){let e=3;n&&(e=n.Range/100),TrackController.StartTrack({TrackSource:3,Id:t.Id,IconPath:r?.IconPath??"",TrackHideDis:e,TrackTarget:ControllerHolder_1.ControllerHolder.CharacterController.GetActorByEntity(t),TrackType:r.TrackType,Offset:r.IconOffset,IsSubTrack:!1})}}}},TrackController.fRo=e=>{TrackController.EndTrack(3,e.Id)};
//# sourceMappingURL=TrackController.js.map