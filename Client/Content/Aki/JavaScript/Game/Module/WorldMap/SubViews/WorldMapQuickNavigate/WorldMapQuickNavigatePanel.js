
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WorldMapQuickNavigatePanel=void 0;const UE=require("ue"),EventDefine_1=require("../../../../Common/Event/EventDefine"),EventSystem_1=require("../../../../Common/Event/EventSystem"),ConfigManager_1=require("../../../../Manager/ConfigManager"),ModelManager_1=require("../../../../Manager/ModelManager"),UiSequencePlayer_1=require("../../../../Ui/Base/UiSequencePlayer"),ExploreProgressDefine_1=require("../../../ExploreProgress/ExploreProgressDefine"),DynScrollView_1=require("../../../Util/ScrollView/DynScrollView"),LoopScrollView_1=require("../../../Util/ScrollView/LoopScrollView"),WorldMapSecondaryUi_1=require("../../ViewComponent/WorldMapSecondaryUi"),PopupRightItemA_1=require("../Common/PopupRightItemA"),QuickNavigateDynamicData_1=require("./QuickNavigateDynamicData"),QuickNavigateDynamicItem_1=require("./QuickNavigateDynamicItem"),QuickNavigateDynamicScrollItem_1=require("./QuickNavigateDynamicScrollItem"),QuickNavigateLoopScrollAreaGridItem_1=require("./QuickNavigateLoopScrollAreaGridItem"),QuickNavigateLoopScrollAreaGridItemData_1=require("./QuickNavigateLoopScrollAreaGridItemData");class WorldMapQuickNavigatePanel extends WorldMapSecondaryUi_1.WorldMapSecondaryUi{constructor(){super(...arguments),this.rYa=void 0,this.SequencePlayer=void 0,this.MPi=void 0,this.oYa=void 0,this.cHe=()=>{return new QuickNavigateLoopScrollAreaGridItem_1.QuickNavigateLoopScrollAreaGridItem},this.Mma=(e,t,i)=>{return new QuickNavigateDynamicScrollItem_1.QuickNavigateDynamicScrollItem},this.nYa=e=>{0===e.ItemType?this.sYa(e.CountryId,e.Index):this.lkn(e.StateId,e.Index)},this.aYa=e=>{var t=this.oYa.TryGetCachedData(e).AreaNavigateInfo;this.hYa(t.AreaId,e)},this.AJa=()=>{this.GetItem(5).SetUIActive(!0)},this.zZa=()=>{this.GetItem(5).SetUIActive(!1)},this.JZa=()=>{var e=ModelManager_1.ModelManager.AreaModel.GetCurrentAreaId(ExploreProgressDefine_1.AREA_LEVEL)??0,e=ConfigManager_1.ConfigManager.MapConfig.WorldMapNavigateAreaMap.get(e);e&&this.Fp({FirstIndex:0,SecondIndex:0,CountryId:e.CountryId,ExpandCountry:!0,StateId:e.StateId??0,AreaId:e.AreaId})}}GetResourceId(){return"UiItem_MapChange"}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,UE.UIDynScrollViewComponent],[1,UE.UIItem],[2,UE.UIButtonComponent],[3,UE.UILoopScrollViewComponent],[4,UE.UIItem],[5,UE.UIItem]],this.BtnBindInfo=[[2,this.JZa]]}GetPopupRightItem(){return new PopupRightItemA_1.PopupRightItemA}async OnBeforeStartAsync(){var e;this.UiBgItem&&(await this.UiBgItem.CreateByResourceIdAsync("UiView_PopupR1",this.ParentUiItem,this.UsePool),e=this.GetOriginalActor().GetComponentByClass(UE.UIItem.StaticClass()),this.UiBgItem.AttachItem(e,this.GetRootItem()),this.UiBgItem.SetPopupViewBase(),this.UiBgItem.OverrideBackBtnCallBack(this.Close),this.UiBgItem.SetTitleLocalTxt("MapQuickChange_Text"),this.UiBgItem.SetTitleIcon("SP_IconMapChange"),this.AddChild(this.UiBgItem)),this.oYa=new LoopScrollView_1.LoopScrollView(this.GetLoopScrollViewComponent(3),this.GetItem(4).GetOwner(),this.cHe),this.MPi=new DynScrollView_1.DynamicScrollView(this.GetUIDynScrollViewComponent(0),this.GetItem(1),new QuickNavigateDynamicItem_1.QuickNavigateDynamicItem,this.Mma),await this.MPi.Init()}OnStart(){var e=this.GetRootItem();this.SequencePlayer=new UiSequencePlayer_1.UiSequencePlayer(e)}OnBeforeShow(){EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.WorldMapFirstNavigateSelect,this.nYa),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.WorldMapSecondNavigateSelect,this.aYa),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.WorldMapBeforeChangeMap,this.AJa),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.WorldMapAfterChangeMap,this.zZa)}OnAfterHide(){EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.WorldMapFirstNavigateSelect,this.nYa),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.WorldMapSecondNavigateSelect,this.aYa),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.WorldMapBeforeChangeMap,this.AJa),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.WorldMapAfterChangeMap,this.zZa)}IJa(){var e;void 0===this.rYa&&(this.rYa={FirstIndex:0,SecondIndex:0,CountryId:0,ExpandCountry:!0,StateId:0,AreaId:0},e=ModelManager_1.ModelManager.AreaModel.GetCurrentAreaId(ExploreProgressDefine_1.AREA_LEVEL),e=ConfigManager_1.ConfigManager.MapConfig.WorldMapNavigateAreaMap.get(e))&&(this.rYa.CountryId=e.CountryId,this.rYa.StateId=e.StateId??0,this.rYa.AreaId=e.AreaId)}OnShowWorldMapSecondaryUi(){this.IJa(),this.Neh(4)}OnCloseWorldMapSecondaryUi(){this.rYa=void 0}OnBeforeDestroy(){this.oYa?.ClearGridProxies(),this.oYa=void 0,this.MPi?.ClearChildren(),this.MPi=void 0}Neh(t){var e;if(4!==t&&3!==t||(e=this._Ya(t),this.MPi.RefreshByData(e)),2===t){var i=this._Ya(t);let e=0;for(const r of this.MPi.GetScrollItemItems())r.Update(i[e],e++)}4!==t&&1!==t&&2!==t||(e=this.uYa(t),this.oYa.RefreshByData(e))}_Ya(n){var e=ConfigManager_1.ConfigManager.MapConfig.WorldMapNavigateCountryMap;const h=[];return e.forEach((e,t)=>{var i=new QuickNavigateDynamicData_1.QuickNavigateDynamicData;if(i.ItemType=0,i.CountryId=t,i.Index=h.length,i.IsSelected=this.rYa.CountryId===t,i.RefreshType=n,i.HasState=void 0!==e.StateMap,h.push(i),void 0!==e.StateMap)for(var[,r]of e.StateMap){0===this.rYa.CountryId&&(this.rYa.CountryId=t,this.rYa.ExpandCountry=!0,this.rYa.StateId=r.StateId??0,this.rYa.AreaId=r.AreaNavigateList[0].AreaId,i.IsSelected=this.rYa.CountryId===t),i.StateId=r.StateId;var a=this.rYa.CountryId===t,s=this.rYa.ExpandCountry;a&&s&&(this.rYa.FirstIndex=h.length-1,(a=new QuickNavigateDynamicData_1.QuickNavigateDynamicData).ItemType=1,a.CountryId=t,a.StateId=r.StateId,a.Index=h.length,a.IsSelected=this.rYa.StateId===r.StateId,a.RefreshType=n,h.push(a),this.rYa.StateId===r.StateId)&&(this.rYa.FirstIndex=h.length-1)}else 0===this.rYa.CountryId&&(this.rYa.CountryId=t,this.rYa.ExpandCountry=!1,this.rYa.StateId=0,this.rYa.AreaId=e.AreaNavigateList[0].AreaId,i.IsSelected=this.rYa.CountryId===t)}),h}uYa(r){const a=[];var e=this.rYa.CountryId,t=this.rYa.StateId,e=ConfigManager_1.ConfigManager.MapConfig.WorldMapNavigateCountryMap.get(e);let i=e.AreaNavigateList;return(i=e.StateMap?e.StateMap.get(t).AreaNavigateList:i).forEach(e=>{var t=new QuickNavigateLoopScrollAreaGridItemData_1.QuickNavigateLoopScrollAreaGridItemData,i=(t.AreaNavigateInfo=e,t.Index=a.length,t.RefreshType=r,a.push(t),0===this.rYa.AreaId&&(this.rYa.AreaId=e.AreaId),this.rYa.AreaId===e.AreaId);i&&(this.rYa.FirstIndex=a.length-1),t.IsSelected=this.rYa.AreaId===e.AreaId}),a}Fp(e){var t=void 0!==ConfigManager_1.ConfigManager.MapConfig.WorldMapNavigateCountryMap.get(e.CountryId)?.StateMap,i=e.StateId!==this.rYa?.StateId,t=t&&e.ExpandCountry!==this.rYa?.ExpandCountry,r=e.CountryId!==this.rYa?.CountryId,a=t||r;this.rYa=e;let s=0;i||a?i&&!a?(s=2,this.Neh(s),this.TJa()):r?(s=4,this.Neh(s),this.TJa()):t&&(s=3,this.Neh(s)):(s=1,this.Neh(s),this.TJa())}sYa(e,t){var i=ConfigManager_1.ConfigManager.MapConfig.WorldMapNavigateCountryMap.get(e);let r=!this.rYa.ExpandCountry;var a,s,n=e!==this.rYa.CountryId;void 0!==i.StateMap?(n&&(r=!0),s=(a=i.StateMap.values().next().value).AreaNavigateList[0],this.Fp({FirstIndex:t,SecondIndex:0,CountryId:e,ExpandCountry:r,StateId:a.StateId,AreaId:s.AreaId})):this.Fp({FirstIndex:t,SecondIndex:0,CountryId:e,ExpandCountry:!1,StateId:0,AreaId:i.AreaNavigateList[0].AreaId}),n&&(this.SequencePlayer.IsSequenceInPlaying("Switch")?this.SequencePlayer.ReplaySequence("Switch"):this.SequencePlayer.PlaySequence("Switch"))}lkn(e,t){var i=e!==this.rYa.StateId,r=ConfigManager_1.ConfigManager.MapConfig.WorldMapNavigateCountryMap.get(this.rYa.CountryId).StateMap.get(e);this.Fp({FirstIndex:t,SecondIndex:0,CountryId:this.rYa.CountryId,ExpandCountry:this.rYa?.ExpandCountry??!0,StateId:e,AreaId:r.AreaNavigateList[0].AreaId}),i&&(this.SequencePlayer.IsSequenceInPlaying("Switch")?this.SequencePlayer.ReplaySequence("Switch"):this.SequencePlayer.PlaySequence("Switch"))}hYa(e,t){this.Fp({FirstIndex:this.rYa.FirstIndex,SecondIndex:t,CountryId:this.rYa.CountryId,ExpandCountry:this.rYa?.ExpandCountry??!0,StateId:this.rYa.StateId,AreaId:e})}TJa(e=!1){e&&this.Close();e=ConfigManager_1.ConfigManager.MapConfig.WorldMapNavigateAreaMap.get(this.rYa.AreaId);EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.WorldMapNavigate,e.MarkId,e.MarkType)}}exports.WorldMapQuickNavigatePanel=WorldMapQuickNavigatePanel;
//# sourceMappingURL=WorldMapQuickNavigatePanel.js.map