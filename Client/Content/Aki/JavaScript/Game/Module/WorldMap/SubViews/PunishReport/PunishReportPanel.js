
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PunishReportPanel=void 0;const Log_1=require("../../../../../Core/Common/Log"),MapMarkByMarkId_1=require("../../../../../Core/Define/ConfigQuery/MapMarkByMarkId"),Protocol_1=require("../../../../../Core/Define/Net/Protocol"),ConfigManager_1=require("../../../../Manager/ConfigManager"),ControllerHolder_1=require("../../../../Manager/ControllerHolder"),ModelManager_1=require("../../../../Manager/ModelManager"),ButtonItem_1=require("../../../Common/Button/ButtonItem"),MapController_1=require("../../../Map/Controller/MapController"),MarkUiUtils_1=require("../../../Map/Mark/Misc/MarkUiUtils"),MapLogger_1=require("../../../Map/Misc/MapLogger"),TeleportController_1=require("../../../Teleport/TeleportController"),LguiUtil_1=require("../../../Util/LguiUtil"),WorldMapSecondaryUi_1=require("../../ViewComponent/WorldMapSecondaryUi"),WorldMapController_1=require("../../WorldMapController"),WorldMapDefine_1=require("../../WorldMapDefine"),MapTipsActivateTipPanel_1=require("../Common/MapTipsActivateTipPanel"),PunishReportTargetListPanel_1=require("./PunishReportTargetListPanel");class PunishReportPanel extends WorldMapSecondaryUi_1.WorldMapSecondaryUi{constructor(){super(...arguments),this.u2o=void 0,this.ZAt=void 0,this.y8a=void 0,this.I8a=void 0,this.z7a=void 0,this.mth=void 0,this.T2o=()=>{this.u2o&&(this.u2o.IsLocked||(WorldMapController_1.WorldMapController.TryTeleport(this.u2o.MarkConfigId),this.Close()),MapLogger_1.MapLogger.Debug(63,"[地图系统]PunishReportPanel->传送没解锁",["markId",this.u2o.MarkId],["IsTracked",this.u2o.IsTracked]))},this.T8a=()=>{var t=MarkUiUtils_1.MarkUiUtils.FindNearbyValidGotoMark(this.Map,this.u2o);t&&MarkUiUtils_1.MarkUiUtils.QuickGotoTeleport(this.u2o,t,()=>{this.Close()})},this.P8e=()=>{this.CheckAndShowCrossMapTips(this.u2o);var t=this.u2o;Log_1.Log.CheckInfo()&&Log_1.Log.Info("Map",63,"[地图系统]PunishReportPanel->追踪标记",["markId",t.MarkId],["IsTracked",t.IsTracked]),MapController_1.MapController.RequestTrackMapMark(t.MarkType,t.MarkId,!t.IsTracked),this.Close()}}GetResourceId(){return"UiItem_GeneralPanel_Prefab"}OnRegisterComponent(){this.ComponentRegisterInfos=WorldMapDefine_1.secondaryUiPanelComponentsRegisterInfoA,this.BtnBindInfo=[]}async OnBeforeStartAsync(){return this.mth=new MapTipsActivateTipPanel_1.MapTipsActivateTipPanel,await this.mth.CreateByActorAsync(this.GetItem(31).GetOwner()),super.OnBeforeStartAsync()}OnStart(){this.RootItem.SetRaycastTarget(!1),this.ZAt=new ButtonItem_1.ButtonItem(this.GetButton(11).RootUIComp),this.ZAt.SetFunction(this.T2o),this.y8a=new ButtonItem_1.ButtonItem(this.GetButton(28).RootUIComp),this.y8a.SetFunction(this.P8e),this.I8a=new ButtonItem_1.ButtonItem(this.GetButton(29).RootUIComp),this.I8a.SetFunction(this.T8a),this.z7a=new PunishReportTargetListPanel_1.PunishReportTargetListPanel,this.z7a.Initialize(this.GetVerticalLayout(16))}async OnBeforeShowWorldMapSecondaryUiAsync(t){var i;28===t.MarkType&&(this.SetActive(!1),i=t.MapId,t=t.MarkConfig.GamePlayId,await ControllerHolder_1.ControllerHolder.LevelPlayReportController.CheckAndRequestLevelPlayVarAsync(i,t))}OnShowWorldMapSecondaryUi(t){this.u2o=t;var i,e=ModelManager_1.ModelManager.MapModel.GetMarkExtraShowState(this.u2o.MarkId),r=(e.ShowFlag===Protocol_1.Aki.Protocol.U5s.Proto_ShowDisable?this.ZAt.SetEnableClick(!1):this.ZAt.SetEnableClick(!0),this.L2o(),this.u2o.MarkConfigId),s=MapMarkByMarkId_1.configMapMarkByMarkId.GetConfig(r);s?(this.GetText(1).ShowTextNew(s.MarkTitle),(i=this.u2o.GetAreaText())&&this.GetText(3).SetText(i),i=s.MarkDesc.split("|")[this.u2o.IsPunishReportFinish()?1:0],LguiUtil_1.LguiUtil.SetLocalTextNew(this.GetText(4),i),this.SetSpriteByPath(this.u2o.IconPath,this.GetSprite(0),!1),s=t.IsMultiMap(),this.GetSprite(23).SetUIActive(s),s&&(i=ConfigManager_1.ConfigManager.UiResourceConfig.GetResourcePath(WorldMapDefine_1.MULTI_MAP_SELECT_ICON_PATH),this.SetSpriteByPath(i,this.GetSprite(23),!1)),s=e.ShowFlag===Protocol_1.Aki.Protocol.U5s.Proto_ShowDisable,this.GetSprite(24).SetUIActive(s),s?(i=ConfigManager_1.ConfigManager.UiResourceConfig.GetResourcePath(WorldMapDefine_1.BLOCK_MARK_ICON_PATH),this.SetSpriteByPath(i,this.GetSprite(24),!1)):this.UpdateTopRightIconActive(this.u2o),this.GetItem(12).SetUIActive(!1),this.GetVerticalLayout(7).RootUIComp.SetUIActive(!1),this.GetItem(6).SetUIActive(!1),this.GetVerticalLayout(5).RootUIComp.SetUIActive(!1),this.GetItem(9).SetUIActive(!1),this.GetItem(8).SetUIActive(!1),e=MarkUiUtils_1.MarkUiUtils.IsShowGoto(t),this.ZAt.SetActive(!e),this.GetItem(32).SetUIActive(e),this.mth.SetUiActive(!1),e&&(s=this.GetButton(29),i=TeleportController_1.TeleportController.CheckCanTeleport(),e=MarkUiUtils_1.MarkUiUtils.FindNearbyValidGotoMark(this.Map,t),this.mth.SetUiActive(!i||void 0===e),s.SetSelfInteractive(i&&void 0!==e)),this.GetItem(14).SetUIActive(!0),this.GetItem(26).SetUIActive(!1),this.GetVerticalLayout(16).RootUIComp.SetUIActive(!0),t=this.u2o.CanGetReward(),this.GetItem(25).SetUIActive(t),t&&LguiUtil_1.LguiUtil.SetLocalTextNew(this.GetText(30),"DarkShoreBossRewardNotGet"),this.v4e(),this.RootItem.SetUIActive(!0)):Log_1.Log.CheckError()&&Log_1.Log.Error("Map",63,"缺少标记配置",["MarkId",r])}L2o(){this.u2o&&(this.ZAt.SetLocalTextNew("Text_TeleportFastMove_Text"),this.y8a.SetLocalText(this.u2o.IsTracked?"InstanceDungeonEntranceCancelTrack":"InstanceDungeonEntranceTrack"))}v4e(){var i=this.u2o.GetPunishReportTarget();for(let t=0;t<i.States.length;++t){var e=i.States[t],r=i.ConditionTxtIds[t],s=this.z7a.AddItemByKey("Target_"+t),r=(s.SetDescLocalNewTxt(r),s.SetNumTxt("x1"),1===e?2:0);s.SetState(r)}}OnBeforeDestroy(){this.z7a.Clear(),this.ZAt.Destroy(),this.mth.Destroy(),this.y8a.Destroy(),this.I8a.Destroy()}UpdateTopRightIconActive(t){var i=t.MarkItemEntity.ViewLifeCircle.IsChildViewVisible(0),t=t.MarkItemEntity.Resource.TopRightIconPath;this.UpdateTopRightIcon(i,t)}UpdateTopRightIcon(t,i){this.GetSprite(24).SetUIActive(t),t&&this.SetSpriteByPath(i,this.GetSprite(24),!1)}}exports.PunishReportPanel=PunishReportPanel;
//# sourceMappingURL=PunishReportPanel.js.map