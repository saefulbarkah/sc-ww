
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MapTravelQuestPanel=void 0;const Log_1=require("../../../../../Core/Common/Log"),ConfigManager_1=require("../../../../Manager/ConfigManager"),ControllerHolder_1=require("../../../../Manager/ControllerHolder"),ModelManager_1=require("../../../../Manager/ModelManager"),ButtonItem_1=require("../../../Common/Button/ButtonItem"),MapController_1=require("../../../Map/Controller/MapController"),MarkUiUtils_1=require("../../../Map/Mark/Misc/MarkUiUtils"),LguiUtil_1=require("../../../Util/LguiUtil"),WorldMapSecondaryUi_1=require("../../ViewComponent/WorldMapSecondaryUi"),WorldMapDefine_1=require("../../WorldMapDefine"),MapTipsActivateTipPanel_1=require("../Common/MapTipsActivateTipPanel"),PopupListItemPanel_1=require("../Common/PopupListItemPanel"),RewardItemBar_1=require("../RewardItemBar");class MapTravelQuestPanel extends WorldMapSecondaryUi_1.WorldMapSecondaryUi{constructor(){super(...arguments),this.u2o=void 0,this.ZAt=void 0,this.y8a=void 0,this.I8a=void 0,this.RewardsView=void 0,this.Ieh=void 0,this.mth=void 0,this.T2o=()=>{this.CheckAndShowCrossMapTips(this.u2o),MapController_1.MapController.RequestTrackMapMark(this.u2o.MarkType,this.u2o.MarkId,!this.u2o.IsTracked),this.L2o(),this.Close()},this.P8e=()=>{this.CheckAndShowCrossMapTips(this.u2o);var t=this.u2o;Log_1.Log.CheckInfo()&&Log_1.Log.Info("Map",63,"[地图系统]TravelMapQuestPanel->追踪标记",["markId",t.MarkId],["IsTracked",t.IsTracked]),MapController_1.MapController.RequestTrackMapMark(t.MarkType,t.MarkId,!t.IsTracked),this.L2o(),this.Close()},this.T8a=()=>{var t=MarkUiUtils_1.MarkUiUtils.FindNearbyValidGotoMark(this.Map,this.u2o);t&&MarkUiUtils_1.MarkUiUtils.QuickGotoTeleport(this.u2o,t,()=>{this.Close()})}}GetResourceId(){return"UiItem_GeneralPanel_Prefab"}OnRegisterComponent(){this.ComponentRegisterInfos=WorldMapDefine_1.secondaryUiPanelComponentsRegisterInfoA}async OnBeforeStartAsync(){return this.RewardsView=new RewardItemBar_1.RewardItemBar,await this.RewardsView.CreateThenShowByActorAsync(this.GetItem(8).GetOwner()),this.Ieh=new PopupListItemPanel_1.PopupListItemPanel,await this.Ieh.CreateThenShowByActorAsync(this.GetItem(6).GetOwner()),this.mth=new MapTipsActivateTipPanel_1.MapTipsActivateTipPanel,await this.mth.CreateByActorAsync(this.GetItem(31).GetOwner()),super.OnBeforeStartAsync()}OnStart(){this.RootItem.SetRaycastTarget(!1),this.ZAt=new ButtonItem_1.ButtonItem(this.GetButton(11).RootUIComp),this.ZAt.SetActive(!0),this.ZAt.SetFunction(this.T2o),this.y8a=new ButtonItem_1.ButtonItem(this.GetButton(28).RootUIComp),this.y8a.SetFunction(this.P8e),this.I8a=new ButtonItem_1.ButtonItem(this.GetButton(29).RootUIComp),this.I8a.SetFunction(this.T8a)}OnShowWorldMapSecondaryUi(t){this.u2o=t,this.L2o(),this.GetText(1).SetText(this.u2o.GetTitleText()),this.GetText(4).ShowTextNew(this.u2o.MarkConfig.MarkDesc),this.SetSpriteByPath(this.u2o.IconPath,this.GetSprite(0),!1),this.GetItem(12).SetUIActive(!1),this.GetVerticalLayout(7).RootUIComp.SetUIActive(!1),this.Ieh.SetUiActive(!1),this.GetVerticalLayout(5).RootUIComp.SetUIActive(!1),this.GetItem(9).SetUIActive(!1),this.GetItem(8).SetUIActive(!1),this.GetItem(14).SetUIActive(!1),this.GetText(36).SetUIActive(!1),this.GetItem(25).SetUIActive(!1);var i=this.u2o.GetAreaText(),e=void 0!==i,e=(this.GetText(3).SetUIActive(e),this.GetItem(22).SetUIActive(e),e&&this.GetText(3).SetText(i),this.ZAt.SetActive(!1),this.GetItem(32).SetUIActive(!0),this.mth.SetUiActive(!1),this.GetButton(29)),i=ControllerHolder_1.ControllerHolder.TeleportController.CheckCanTeleport(),t=MarkUiUtils_1.MarkUiUtils.FindNearbyValidGotoMark(this.Map,t);this.mth.SetUiActive(!i||void 0===t),e.SetSelfInteractive(i&&void 0!==t),this.LYa(),this.RootItem.SetUIActive(!0)}L2o(){this.u2o&&(this.ZAt.SetLocalText(this.u2o.IsTracked?"InstanceDungeonEntranceCancelTrack":"InstanceDungeonEntranceTrack"),this.y8a.SetLocalText(this.u2o.IsTracked?"InstanceDungeonEntranceCancelTrack":"InstanceDungeonEntranceTrack"))}LYa(){var t,i=ConfigManager_1.ConfigManager.ActivityMapTravelConfig.GetQuestConfigByMapMarkId(this.u2o.MarkId);i&&(t=i.QuestId,t=1===(t=ModelManager_1.ModelManager.QuestNewModel.GetQuestState(t))||2===t,this.GetItem(14).SetUIActive(t),this.GetItem(37).SetUIActive(t),t)&&LguiUtil_1.LguiUtil.SetLocalTextNew(this.GetText(38),i.MapDesc)}}exports.MapTravelQuestPanel=MapTravelQuestPanel;
//# sourceMappingURL=MapTravelQuestPanel.js.map