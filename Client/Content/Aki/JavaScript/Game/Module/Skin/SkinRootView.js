
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SkinRootView=void 0;const UE=require("ue"),Info_1=require("../../../Core/Common/Info"),Time_1=require("../../../Core/Common/Time"),CommonParamById_1=require("../../../Core/Define/ConfigCommon/CommonParamById"),EventDefine_1=require("../../Common/Event/EventDefine"),EventSystem_1=require("../../Common/Event/EventSystem"),EffectContext_1=require("../../Effect/EffectContext/EffectContext"),EffectSystem_1=require("../../Effect/EffectSystem"),InputSettings_1=require("../../InputSettings/InputSettings"),ConfigManager_1=require("../../Manager/ConfigManager"),ModelManager_1=require("../../Manager/ModelManager"),UiViewBase_1=require("../../Ui/Base/UiViewBase"),InputDistributeController_1=require("../../Ui/InputDistribute/InputDistributeController"),InputMappingsDefine_1=require("../../Ui/InputDistribute/InputMappingsDefine"),TouchFingerDefine_1=require("../../Ui/TouchFinger/TouchFingerDefine"),TouchFingerManager_1=require("../../Ui/TouchFinger/TouchFingerManager"),EffectUtil_1=require("../../Utils/EffectUtil"),CommonTabComponentData_1=require("../Common/TabComponent/CommonTabComponentData"),CommonTabData_1=require("../Common/TabComponent/CommonTabData"),CommonTabTitleData_1=require("../Common/TabComponent/CommonTabTitleData"),TabComponentWithCaptionItem_1=require("../Common/TabComponent/TabComponentWithCaptionItem"),TabViewComponent_1=require("../Common/TabComponent/TabViewComponent"),HelpController_1=require("../Help/HelpController"),UiCameraControlRotationComponent_1=require("../UiCamera/UiCameraComponent/UiCameraControlRotationComponent"),UiCameraManager_1=require("../UiCamera/UiCameraManager"),UiCameraAnimationManager_1=require("../UiCameraAnimation/UiCameraAnimationManager"),UiSceneManager_1=require("../UiComponent/UiSceneManager"),SkinTabItem_1=require("./Role/Item/SkinTabItem");class SkinRootView extends UiViewBase_1.UiViewBase{constructor(){super(...arguments),this.TabViewComponent=void 0,this.TabComponent=void 0,this.TabDataList=[],this.yil=void 0,this.U8i=!1,this.L6e=0,this.A8i=void 0,this.Nlo=0,this.c8l=!1,this.R6e=e=>new SkinTabItem_1.SkinTabItem,this.pqe=e=>{this.L6e=Time_1.Time.Now;var t=this.TabDataList[e],i=t.ChildViewName,e=this.TabComponent.GetTabItemByIndex(e);this.TabViewComponent.ToggleCallBack(t,i,e,this.yil),this.U8i=this.P8i(),this.TabComponent.SetHelpButtonShowState("RoleSkinTabView"===i)},this.yqe=e=>{e=this.TabDataList[e];return new CommonTabData_1.CommonTabData(e.Icon,new CommonTabTitleData_1.CommonTabTitleData(e.TabName))},this.cmo=()=>{this.U8i=!1,this.A8i?.PauseTick()},this.mmo=e=>{this.Z0l(e.ViewName)&&this.u8l()},this.CanToggleChange=e=>{var t;return!!Info_1.Info.IsInGamepad()||(t=CommonParamById_1.configCommonParamById.GetIntConfig("panel_interval_time"),!this.L6e)||Time_1.Time.Now-this.L6e>=t},this.x8i=void 0,this.w8i=e=>{this.U8i&&(this.x8i=e.GetLocalPointInPlane())},this.B8i=e=>{var t;!this.U8i||1<TouchFingerManager_1.TouchFingerManager.GetTouchFingerCount()||InputSettings_1.InputSettings.IsInputKeyDown("RightMouseButton")?this.x8i=void 0:(t=this.x8i,this.x8i=e.GetLocalPointInPlane(),t&&(e=this.x8i.X-t.X,t=this.x8i.Y-t.Y,0!=e&&this.A8i.AddYawInput(e),0!=t)&&this.A8i.AddPitchInput(t))},this.b8i=e=>{this.U8i&&(this.x8i=void 0)},this.N8i=e=>{this.U8i&&0!==e.scrollAxisValue&&this.A8i.AddZoomInput(-e.scrollAxisValue)},this.q8i=e=>{0!==e&&this.U8i&&Info_1.Info.IsInGamepad()&&this.A8i.AddPitchInput(-e)},this.G8i=e=>{0!==e&&this.U8i&&Info_1.Info.IsInGamepad()&&this.A8i.AddYawInput(e)},this.PUn=(e,t)=>{0!==t&&this.U8i&&Info_1.Info.IsInGamepad()&&this.A8i.AddZoomInput(t)},this._mo=()=>{var e;this.U8i&&(e=UiCameraAnimationManager_1.UiCameraAnimationManager.GetLastHandleData())&&UiCameraAnimationManager_1.UiCameraAnimationManager.PushCameraHandleByHandleName(e.HandleName,!0,!0,"1001")},this.Eqt=(e,t)=>{this.U8i&&2===t.TouchType&&this.Egt()},this.pcr=()=>{"RoleWeaponTabView"!==this.TabViewComponent.GetCurrentTabViewName()&&HelpController_1.HelpController.OpenHelpById(146)}}OnRegisterComponent(){this.yil=this.OpenParam,this.yil.RegisterView(this),this.ComponentRegisterInfos=[[0,UE.UIItem],[1,UE.UIItem],[2,UE.UIDraggableComponent]]}OnStart(){var e=new CommonTabComponentData_1.CommonTabComponentData(this.R6e,this.pqe,this.yqe);this.TabComponent=new TabComponentWithCaptionItem_1.TabComponentWithCaptionItem(this.GetItem(0),e,this.yil.CloseView),this.TabComponent.SetHelpButtonCallBack(this.pcr),this.TabComponent.SetCanChange(this.CanToggleChange),this.TabViewComponent=new TabViewComponent_1.TabViewComponent(this.GetItem(1)),this.d8l()}OnHandleLoadScene(){var e;this.yil.NeedLoadRole&&((e=UiSceneManager_1.UiSceneManager.GetActorByTag("RoleFloorCase"))&&(this.Nlo=EffectUtil_1.EffectUtil.SpawnUiEffect("RoleSystemFloorEffect","[RoleRootView.LoadFloorEffect]",e.D_GetTransform(),new EffectContext_1.EffectContext(void 0,e))),UiSceneManager_1.UiSceneManager.GetActorByTag("RoleCase"))&&this.yil.TsUiSceneRoleActor&&this.yil.TsUiSceneRoleActor.Model.CheckGetComponent(1)?.SetTransformByTag("RoleCase")}d8l(){this.yil.NeedLoadRole?this.c8l||(this.c8l=!0,this.yil.TsUiSceneRoleActor=UiSceneManager_1.UiSceneManager.InitRoleSystemRoleActor(1),UiSceneManager_1.UiSceneManager.GetActorByTag("RoleCase")&&this.yil.TsUiSceneRoleActor.Model.CheckGetComponent(1)?.SetTransformByTag("RoleCase")):this.yil.TsUiSceneRoleActor=UiSceneManager_1.UiSceneManager.GetRoleSystemRoleActor()}OnHandleReleaseScene(){this.yil.NeedLoadRole&&EffectSystem_1.EffectSystem.IsValid(this.Nlo)&&EffectSystem_1.EffectSystem.StopEffectById(this.Nlo,"[RoleRootView.HandleReleaseScene]",!1)}OnBeforeShow(){this.UpdateDynamicTabComponent(),UiCameraAnimationManager_1.UiCameraAnimationManager.IsPlayingAnimation()||this.u8l()}UpdateDynamicTabComponent(){this.TabDataList=ModelManager_1.ModelManager.RoleSkinModel.GetSkinTabList(),this.TabComponent.RefreshTabItemByLength(this.TabDataList.length,()=>{let t=0;for(let e=0;e<this.TabDataList.length;e++)if(this.TabDataList[e].ChildViewName===this.yil.CurSelectTabViewName){t=e;break}this.TabComponent.SelectToggleByIndex(t,!0)})}OnAddEventListener(){this.yil.AddEventListener(),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnPlayCameraAnimationStart,this.cmo),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnActivateUiCameraAnimationHandle,this.mmo);var e=this.GetDraggable(2);e.OnPointerBeginDragCallBack.Bind(this.w8i),e.OnPointerDragCallBack.Bind(this.B8i),e.OnPointerEndDragCallBack.Bind(this.b8i),e.OnPointerScrollCallBack.Bind(this.N8i),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.NavigationTriggerRoleLookUp,this.q8i),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.NavigationTriggerRoleTurn,this.G8i),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.NavigationTriggerRoleZoom,this.PUn),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.NavigationTriggerRoleReset,this._mo),InputDistributeController_1.InputDistributeController.BindTouches([InputMappingsDefine_1.touchIdMappings.Touch1,InputMappingsDefine_1.touchIdMappings.Touch2],this.Eqt)}OnRemoveEventListener(){this.yil.RemoveEventListener(),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnPlayCameraAnimationStart,this.cmo),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnActivateUiCameraAnimationHandle,this.mmo);var e=this.GetDraggable(2);e.OnPointerBeginDragCallBack.Unbind(),e.OnPointerDragCallBack.Unbind(),e.OnPointerEndDragCallBack.Unbind(),e.OnPointerScrollCallBack.Unbind(),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.NavigationTriggerRoleLookUp,this.q8i),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.NavigationTriggerRoleTurn,this.G8i),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.NavigationTriggerRoleZoom,this.PUn),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.NavigationTriggerRoleReset,this._mo),InputDistributeController_1.InputDistributeController.UnBindTouches([InputMappingsDefine_1.touchIdMappings.Touch1,InputMappingsDefine_1.touchIdMappings.Touch2],this.Eqt)}OnBeforeHide(){this.LastHide&&this.yil.BeforeDestroy(),this.A8i?.PauseTick()}OnBeforeDestroy(){this.m8l()}m8l(){this.yil.NeedLoadRole&&this.c8l&&(this.c8l=!1,UiSceneManager_1.UiSceneManager.DestroyRoleSystemRoleActor(this.yil.TsUiSceneRoleActor),this.yil.TsUiSceneRoleActor=void 0)}HideView(){this.TabComponent.SetUiActive(!1)}ShowView(){this.TabComponent.SetUiActive(!0)}u8l(){var e,t=UiCameraManager_1.UiCameraManager.Get(),t=(this.A8i=t.AddUiCameraComponent(UiCameraControlRotationComponent_1.UiCameraControlRotationComponent,!1),this.yil.IsWearWeaponSkin?ConfigManager_1.ConfigManager.PayShopConfig.GetBuySkinDetailWeaponCameraConfigId():ConfigManager_1.ConfigManager.PayShopConfig.GetBuySkinDetailRoleCameraConfigId()),t=ConfigManager_1.ConfigManager.UiRoleCameraConfig.GetRoleCameraConfig(t);this.A8i.InitDataByConfig(t),this.A8i.SetNeedFloorReflection(!0),this.U8i=this.P8i(),this.U8i&&(e=(t=UiSceneManager_1.UiSceneManager.GetRoleSystemRoleActor()).D_K2_GetActorLocation(),t=(t.Model?.CheckGetComponent(12)).RoleConfigId,t=ConfigManager_1.ConfigManager.RoleConfig.GetRoleConfig(t).RoleBody,t=ConfigManager_1.ConfigManager.UiRoleCameraConfig.GetRoleCameraOffsetConfig(t),this.A8i.UpdateData(e,t.镜头浮动最大高度,t.镜头浮动最低高度,t.镜头浮动最长臂长,t.镜头浮动最短臂长),this.A8i.Activate(),this.A8i.ResumeTick())}Z0l(e){for(const t of this.TabDataList)if(t.ChildViewName===e)return!0;return!1}P8i(){return!UiCameraAnimationManager_1.UiCameraAnimationManager.IsPlayingAnimation()&&"RoleSkinTabView"===this.TabViewComponent.GetCurrentTabViewName()}Egt(){var e;1<TouchFingerManager_1.TouchFingerManager.GetTouchFingerCount()&&(e=TouchFingerManager_1.TouchFingerManager.GetFingerExpandCloseValue(TouchFingerDefine_1.EFingerIndex.One,TouchFingerDefine_1.EFingerIndex.Two),this.A8i.AddZoomInput(-e))}}exports.SkinRootView=SkinRootView;
//# sourceMappingURL=SkinRootView.js.map