
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SkinRootViewModel=void 0;const EventDefine_1=require("../../Common/Event/EventDefine"),EventSystem_1=require("../../Common/Event/EventSystem"),ConfigManager_1=require("../../Manager/ConfigManager"),ModelManager_1=require("../../Manager/ModelManager"),BlackScreenController_1=require("../BlackScreen/BlackScreenController"),WeaponSkinDefine_1=require("./Tab/Weapon/WeaponSkinDefine"),WeaponSkinGridData_1=require("./Tab/Weapon/WeaponSkinGridData");class SkinRootViewModel{constructor(){this.Yzt=void 0,this.TsUiSceneRoleActor=void 0,this.CurSelectTabViewName=void 0,this.NeedLoadRole=!1,this.CloseView=()=>{this.NeedLoadRole&&BlackScreenController_1.BlackScreenController.AddBlackScreenAsync("Start","CloseRoleSkinView"),this.Yzt.CloseMe(()=>{this.NeedLoadRole&&BlackScreenController_1.BlackScreenController.RemoveBlackScreen("Close","CloseRoleSkinView")})},this.SelectRoleSkinId=0,this.IsWearWeaponSkin=!1,this.WeaponIncId=0,this.EquipSkinId=0,this.RoleId=0,this.SelectedSkinId=0,this.SkinDataList=[],this.$tl=void 0,this.IsInShowWeapon=!1,this.Xtl=(t,i)=>{var e;this.RoleId===t&&(t=this.Ytl(this.EquipSkinId),e=this.Ytl(i),this.$tl?.RefreshGridSelect(t,e),this.$tl?.RefreshConfirmBox(!0),this.$tl?.ShowEquipTips(),this.EquipSkinId=i)},this.ztl=t=>{var i;this.RoleId===t&&(t=this.Ytl(this.EquipSkinId),i=this.Ytl(WeaponSkinDefine_1.WEAPON_SKIN_DEFAULT_ID),this.$tl?.RefreshGridSelect(t,i),this.$tl?.RefreshConfirmBox(!0),this.$tl?.ShowEquipTips(),this.EquipSkinId=WeaponSkinDefine_1.WEAPON_SKIN_DEFAULT_ID)},this.WeaponHideUiClick=t=>{1===t?(this.$tl?.ShowView(),this.Yzt.ShowView()):(this.$tl?.HideView(),this.Yzt.HideView())},this.WeaponSwitchShowClick=t=>{1===t?(this.IsInShowWeapon=!0,this.$tl?.SwitchWeaponShow(this.WeaponIncId,this.SelectedSkinId)):(this.IsInShowWeapon=!1,this.$tl?.SwitchRoleWeaponShow(this.SelectedSkinId))},this.WeaponConfirmClick=()=>{this.$tl?.TrySendPbEquipTakeOnRequest(this.RoleId,this.SelectedSkinId)},this.GridItemClick=t=>{t=t.Data.SkinId;this.Jtl(t),this.$tl?.SwitchWeaponSkinModel(this.WeaponIncId,t,this.IsInShowWeapon),this.SelectedSkinId=t},this.GridItemCanExecuteChange=t=>{t=t.SkinId;return this.SelectedSkinId!==t}}RegisterView(t){this.Yzt=t}SetViewData(t,i,e,s){this.RoleId=t,this.WeaponIncId=i,this.CurSelectTabViewName=e,this.NeedLoadRole=s,this.nTl()}AddEventListener(){EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.EquipWeaponSkin,this.Xtl),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.UninstallWeaponSkin,this.ztl)}RemoveEventListener(){EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.EquipWeaponSkin,this.Xtl),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.UninstallWeaponSkin,this.ztl)}BeforeDestroy(){this.$tl?.ReleaseWeaponObserver();var t=ModelManager_1.ModelManager.WeaponModel.GetWeaponInstanceByRoleId(this.RoleId);this.$tl?.RecoverySceneRoleActorBySkin(t.GetIncId(),this.EquipSkinId)}Ztl(t,i){return new WeaponSkinGridData_1.WeaponSkinData(t,i)}nTl(){var t=(ModelManager_1.ModelManager.WeaponModel?.GetWeaponDataByIncId(this.WeaponIncId)).GetWeaponConfig().WeaponType,t=ConfigManager_1.ConfigManager.SkinConfig.GetWeaponSkinConfigListByType(t);const i=this.Ztl(WeaponSkinDefine_1.WEAPON_SKIN_DEFAULT_ID,this.RoleId);this.SkinDataList.push(i);for(const e of t)if(!e.HideInSkinView){const i=this.Ztl(e.Id,this.RoleId);this.SkinDataList.push(i)}}InitSelectedWeaponSkinId(){var t=ModelManager_1.ModelManager.WeaponSkinModel.GetSkinIdByRoleId(this.RoleId),t=(this.EquipSkinId=t,this.Ytl(t));this.SelectedSkinId=this.SkinDataList[t].SkinId}Ytl(i){var t=this.SkinDataList.findIndex(t=>t.SkinId===i);return t<0?0:t}Jtl(t){var i=this.Ytl(t),e=this.SkinDataList[i];this.$tl?.RefreshBottom(e,this.EquipSkinId===t),this.$tl?.RefreshText(e.Name,e.Description),this.$tl?.SelectedGrid(i)}RegisterWeaponSkinTabView(t){this.$tl=t,this.InitSelectedWeaponSkinId(),this.$tl.InitWeaponModel(this.WeaponIncId,this.SelectedSkinId)}InitGridSelected(){this.Jtl(this.SelectedSkinId)}GetSkinSkipDataList(t){var i=[];for(const s of ConfigManager_1.ConfigManager.SkinConfig.GetWeaponSkinConfig(t).ItemAccess){var e=ConfigManager_1.ConfigManager.GetWayConfig.GetConfigById(s);e&&(e={Id:s,ConfigId:t,Type:e?.Type,Text:e.Description,SortIndex:e.SortIndex},i.push(e))}return i.sort((t,i)=>{var e=t.SortIndex,s=i.SortIndex;return e===s?i.Id-t.Id:s-e}),i}SetCaptionItemActive(t){t?this.Yzt.ShowView():this.Yzt.HideView()}}exports.SkinRootViewModel=SkinRootViewModel;
//# sourceMappingURL=SkinRootViewModel.js.map