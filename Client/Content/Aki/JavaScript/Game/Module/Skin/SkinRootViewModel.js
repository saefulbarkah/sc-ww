
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SkinRootViewModel=void 0;const EventDefine_1=require("../../Common/Event/EventDefine"),EventSystem_1=require("../../Common/Event/EventSystem"),ConfigManager_1=require("../../Manager/ConfigManager"),ModelManager_1=require("../../Manager/ModelManager"),WeaponSkinDefine_1=require("./Tab/Weapon/WeaponSkinDefine"),WeaponSkinGridData_1=require("./Tab/Weapon/WeaponSkinGridData");class SkinRootViewModel{constructor(){this.Yzt=void 0,this.CloseView=()=>{this.Yzt.CloseMe()},this.fil=0,this.vil=0,this.dFe=0,this.Mil=0,this.SkinDataList=[],this.Sil=void 0,this.IsInShowWeapon=!1,this.yil=(t,i)=>{var e;this.dFe===t&&(t=this.Eil(this.vil),e=this.Eil(i),this.Sil?.RefreshGridSelect(t,e),this.Sil?.RefreshConfirmBox(!0),this.Sil?.ShowEquipTips(),this.vil=i)},this.Iil=t=>{var i;this.dFe===t&&(t=this.Eil(this.vil),i=this.Eil(WeaponSkinDefine_1.WEAPON_SKIN_DEFAULT_ID),this.Sil?.RefreshGridSelect(t,i),this.Sil?.RefreshConfirmBox(!0),this.Sil?.ShowEquipTips(),this.vil=WeaponSkinDefine_1.WEAPON_SKIN_DEFAULT_ID)},this.WeaponHideUiClick=t=>{1===t?(this.Sil?.ShowView(),this.Yzt.ShowView()):(this.Sil?.HideView(),this.Yzt.HideView())},this.WeaponSwitchShowClick=t=>{1===t?(this.IsInShowWeapon=!0,this.Sil?.SwitchWeaponShow(this.fil,this.Mil)):(this.IsInShowWeapon=!1,this.Sil?.SwitchRoleWeaponShow(this.Mil))},this.WeaponConfirmClick=()=>{this.Sil?.TrySendPbEquipTakeOnRequest(this.dFe,this.Mil)},this.GridItemClick=t=>{t=t.Data.SkinId;this.Til(t),this.Sil?.SwitchWeaponSkinModel(this.fil,t,this.IsInShowWeapon),this.Mil=t},this.GridItemCanExecuteChange=t=>{t=t.SkinId;return this.Mil!==t}}RegisterView(t){this.Yzt=t}SetViewData(t){this.fil=t}AddEventListener(){EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.EquipWeaponSkin,this.yil),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.UninstallWeaponSkin,this.Iil)}RemoveEventListener(){EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.EquipWeaponSkin,this.yil),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.UninstallWeaponSkin,this.Iil)}BeforeDestroy(){this.Sil?.ReleaseWeaponObserver();var t=ModelManager_1.ModelManager.WeaponModel.GetWeaponInstanceByRoleId(this.dFe);this.Sil?.RecoverySceneRoleActorBySkin(t.GetIncId(),this.vil)}Lil(t,i){return new WeaponSkinGridData_1.WeaponSkinData(t,i)}Uil(){var t=(ModelManager_1.ModelManager.WeaponModel?.GetWeaponDataByIncId(this.fil)).GetWeaponConfig().WeaponType,t=ConfigManager_1.ConfigManager.SkinConfig.GetWeaponSkinConfigListByType(t);const i=this.Lil(WeaponSkinDefine_1.WEAPON_SKIN_DEFAULT_ID,this.dFe);this.SkinDataList.push(i);for(const e of t){const i=this.Lil(e.Id,this.dFe);this.SkinDataList.push(i)}}Dil(){var t=ModelManager_1.ModelManager.WeaponModel.GetWeaponDataByIncId(this.fil),t=(this.dFe=t.GetRoleId(),ModelManager_1.ModelManager.WeaponSkinModel.GetSkinIdByRoleId(this.dFe));this.vil=t,this.Mil=t}Eil(i){return this.SkinDataList.findIndex(t=>t.SkinId===i)}Til(t){var i=this.Eil(t),e=this.SkinDataList[i];this.Sil?.RefreshBottom(e,this.vil===t),this.Sil?.RefreshText(e.Name,e.Description),this.Sil?.SelectedGrid(i)}RegisterWeaponSkinTabView(t){this.Sil=t,this.Dil(),this.Uil(),this.Sil.InitWeaponModel(this.fil,this.Mil)}InitGridSelected(){this.Til(this.vil)}GetSkinSkipDataList(t){var i=[];for(const s of ConfigManager_1.ConfigManager.SkinConfig.GetWeaponSkinConfig(t).ItemAccess){var e=ConfigManager_1.ConfigManager.GetWayConfig.GetConfigById(s);e&&(e={Id:s,ConfigId:t,Type:e?.Type,Text:e.Description,SortIndex:e.SortIndex},i.push(e))}return i.sort((t,i)=>{var e=t.SortIndex,s=i.SortIndex;return e===s?i.Id-t.Id:s-e}),i}}exports.SkinRootViewModel=SkinRootViewModel;
//# sourceMappingURL=SkinRootViewModel.js.map