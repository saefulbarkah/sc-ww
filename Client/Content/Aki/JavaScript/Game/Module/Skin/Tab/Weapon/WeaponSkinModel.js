
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WeaponSkinModel=void 0;const Log_1=require("../../../../../Core/Common/Log"),ModelBase_1=require("../../../../../Core/Framework/ModelBase"),EventDefine_1=require("../../../../Common/Event/EventDefine"),EventSystem_1=require("../../../../Common/Event/EventSystem"),LocalStorageDefine_1=require("../../../../Common/LocalStorageDefine"),ConfigManager_1=require("../../../../Manager/ConfigManager"),ModelManager_1=require("../../../../Manager/ModelManager"),WeaponSkinDefine_1=require("./WeaponSkinDefine");class WeaponSkinModel extends ModelBase_1.ModelBase{constructor(){super(...arguments),this.cil=new Map,this.mil=new Map}OnClear(){return ModelManager_1.ModelManager.NewFlagModel.SaveNewFlagConfig(LocalStorageDefine_1.ELocalStoragePlayerKey.WeaponSkinRedDot),!0}dil(e){return!ModelManager_1.ModelManager.NewFlagModel.HasNewFlag(LocalStorageDefine_1.ELocalStoragePlayerKey.WeaponSkinRedDot,e)&&(ModelManager_1.ModelManager.NewFlagModel.AddNewFlag(LocalStorageDefine_1.ELocalStoragePlayerKey.WeaponSkinRedDot,e),!0)}xrl(e,n){var o;n===WeaponSkinDefine_1.WEAPON_SKIN_DEFAULT_ID?(o=ModelManager_1.ModelManager.WeaponModel.GetWeaponDataByRoleDataId(e).GetItemConfig().ModelId,EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.FightWeaponSkinChange,e,o)):(o=ConfigManager_1.ConfigManager.SkinConfig.GetWeaponSkinConfig(n).ModelId,EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.FightWeaponSkinChange,e,o))}$sl(e){for(const n of e)this.mil.set(n.mjn,n.Qsl),this.xrl(n.mjn,n.Qsl)}UpdateWeaponSkinData(e,n){this.mil.set(e,n),this.xrl(e,n)}NotifyWeaponSkinData(e){e&&this.$sl(e)}EquipWeaponSkinData(e){e&&(this.$sl(e),e=e[0],EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.EquipWeaponSkin,e.mjn,e.Qsl))}DeleteWeaponSkinData(e){this.mil.delete(e),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.UninstallWeaponSkin,e),this.xrl(e,WeaponSkinDefine_1.WEAPON_SKIN_DEFAULT_ID),Log_1.Log.CheckInfo()&&Log_1.Log.Info("WeaponSkin,",10,"武器皮肤卸载",["roleId",e])}GetSkinIdByRoleId(e){var n=ModelManager_1.ModelManager.RoleModel.GetRoleDataById(e);return n&&n.IsTrialRole()?n.GetWeaponData()?.GetSkinId()??WeaponSkinDefine_1.WEAPON_SKIN_DEFAULT_ID:this.mil.get(e)||WeaponSkinDefine_1.WEAPON_SKIN_DEFAULT_ID}GetRoleIdBySkinId(e){for(const n of this.mil)if(n[1]===e)return n[0]}NotifyAllUnlockSkinData(e){for(const n of e)this.cil.set(n,1);Log_1.Log.CheckInfo()&&Log_1.Log.Info("WeaponSkin,",10,"武器皮肤登录推送",["skinIdList",e])}SetUnlockSkinData(e){for(const n of e)this.cil.set(n,1),this.dil(n);Log_1.Log.CheckInfo()&&Log_1.Log.Info("WeaponSkin,",10,"武器皮肤添加",["skinIdList",e])}GetSkinCountById(e){return this.cil.get(e)??0}HasWeaponSkinRedDot(e){for(const n of ConfigManager_1.ConfigManager.SkinConfig.GetWeaponSkinConfigListByType(e))if(this.cil.has(n.Id)&&!n.HideInSkinView&&ModelManager_1.ModelManager.NewFlagModel.HasNewFlag(LocalStorageDefine_1.ELocalStoragePlayerKey.WeaponSkinRedDot,n.Id))return!0;return!1}RedDotWeaponSkinCondition(e){var e=ModelManager_1.ModelManager.WeaponModel.GetWeaponInstanceByRoleId(e);return void 0!==e&&(e=e.GetWeaponConfig().WeaponType,this.HasWeaponSkinRedDot(e))}}exports.WeaponSkinModel=WeaponSkinModel;
//# sourceMappingURL=WeaponSkinModel.js.map