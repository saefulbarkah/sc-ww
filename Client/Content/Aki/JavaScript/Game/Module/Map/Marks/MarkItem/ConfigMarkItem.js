
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ConfigMarkItem=void 0;const Vector_1=require("../../../../../Core/Utils/Math/Vector"),ConfigManager_1=require("../../../../Manager/ConfigManager"),ModelManager_1=require("../../../../Manager/ModelManager"),ConfigMarkItemView_1=require("../MarkItemView/ConfigMarkItemView"),MarkItem_1=require("./MarkItem");class ConfigMarkItem extends MarkItem_1.MarkItem{constructor(t,i,e,r,s,h=1){super(e,r,s,h),this.MarkConfig=void 0,this.InnerMarkId=0,this.IsServerSaveShowState=!1,this.ConditionShouldShow=!0,this.InnerMarkId=t,this.ShowPriority=i.ShowPriority,this.MarkConfig=i,this.IconPath=this.MarkConfig.LockMarkPic,this.MapId=this.MarkConfig.MapId}get IsFogUnlock(){return 1===this.MarkConfig.FogShow||ModelManager_1.ModelManager.MapModel.CheckFogUnlocked(this.MarkConfig.FogHide)}get IsLocked(){return!ModelManager_1.ModelManager.MapModel.CheckTeleportUnlocked(this.MarkConfig.MarkId)}get MarkItemType(){return 1}IsMultiMap(){return 0!==this.GetMultiMapId()||this.LocateInGround()}LocateInGround(){return 0===this.MarkConfig.MultiMapFloorId&&0<this.GetConnectMultiMapIds().length}ConnectGround(){if(this.IsMultiMap()){var t=this.MarkConfig.MultiMapFloorId;if(0!==t)if(0===ConfigManager_1.ConfigManager.MapConfig.GetSubMapConfigById(t)?.Floor)return!0;for(const i of this.GetConnectMultiMapIds())if(0===ConfigManager_1.ConfigManager.MapConfig.GetSubMapConfigById(i)?.Floor)return!0;return!1}return!0}GetMultiMapId(){return 0===this.MarkConfig.MultiMapFloorId&&0<this.GetConnectMultiMapIds().length?this.GetConnectMultiMapIds()[0]:this.MarkConfig.MultiMapFloorId}GetConnectMultiMapIds(){return this.MarkConfig.ConnetMultiMapFloorId}get MarkId(){return this.InnerMarkId}get MarkConfigId(){return this.MarkConfig.MarkId}get MarkType(){return this.MarkConfig.ObjectType}Initialize(){this.MarkConfig.Scale&&this.SetConfigScale(this.MarkConfig.Scale),this.MarkConfig.CornerScale&&this.SetCornerScale(this.MarkConfig.CornerScale),this.InitShowCondition(),this.InitPosition(this.MarkConfig),this.InitIcon()}InitPosition(t){t.EntityConfigId?this.SetTrackData(t.EntityConfigId):t.MarkVector&&this.SetTrackData(Vector_1.Vector.Create(t.MarkVector)),this.UpdateTrackState()}InitIcon(){this.MarkConfig.RelativeSubType<=0||(this.IconPath=this.MarkConfig.LockMarkPic)}IsRelativeFunctionOpen(){var t;return this.MarkConfig.RelativeSubType<=0||!((t=ConfigManager_1.ConfigManager.MapConfig?.GetMapMarkFuncTypeConfigById(this.MarkConfig.RelativeSubType))&&0<t.FunctionId)||ModelManager_1.ModelManager.FunctionModel.IsOpen(t.FunctionId)}OnCreateView(){this.InnerView=new ConfigMarkItemView_1.ConfigMarkItemView(this)}GetLocaleDesc(){return this.MarkConfig.MarkDesc}GetTitleText(){return ConfigManager_1.ConfigManager.MapConfig.GetLocalText(this.MarkConfig.MarkTitle)}GetAreaText(){if("number"==typeof this.TrackTarget)return ModelManager_1.ModelManager.MapModel.GetMarkAreaText(this.MapId,this.TrackTarget)}GDi(t){return this.MarkConfig.ShowRange[0]<t&&this.MarkConfig.ShowRange[1]>t}get IsConditionShouldShow(){return this.ConditionShouldShow}InitShowCondition(){var t=this.MarkConfig.ShowCondition;t<0?this.IsServerSaveShowState=!0:0===t?this.ConditionShouldShow=!0:(this.IsServerSaveShowState=!1,this.ConditionShouldShow=ModelManager_1.ModelManager.MapModel.IsMarkUnlockedByServer(this.MarkId))}CheckCanShowView(){var t;return!!this.CanConditionShowView()&&(t=this.GetCurrentMapShowScale(),t=this.GDi(t)||this.IsTracked,2!==this.MapType||(this.IsCanShowViewIntermediately!==(t=t||this.IsIgnoreScaleShow)&&(this.NeedPlayShowOrHideSeq=t?"ShowView":"HideView"),t))}CanConditionShowView(){var t=this.MapType;return!(1===this.MarkConfig.MapShow&&1!==t||2===this.MarkConfig.MapShow&&1===t||(this.InitShowCondition(),!this.ConditionShouldShow)||this.IsServerSaveShowState&&!ModelManager_1.ModelManager.MapModel.GetMarkExtraShowState(this.MarkId).IsShow||!this.IsFogUnlock)}GetShowScale(){return this.MarkConfig.ShowRange[0]+this.MarkConfig.ShowRange[1]/2}IsLordGym(){return 3===this.MarkConfig.RelativeSubType}}exports.ConfigMarkItem=ConfigMarkItem;
//# sourceMappingURL=ConfigMarkItem.js.map