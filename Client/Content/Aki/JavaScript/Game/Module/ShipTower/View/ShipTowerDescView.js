
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ShipTowerDescView=void 0;const UE=require("ue"),Log_1=require("../../../../Core/Common/Log"),EventDefine_1=require("../../../Common/Event/EventDefine"),EventSystem_1=require("../../../Common/Event/EventSystem"),ConfigManager_1=require("../../../Manager/ConfigManager"),ControllerHolder_1=require("../../../Manager/ControllerHolder"),ModelManager_1=require("../../../Manager/ModelManager"),UiViewBase_1=require("../../../Ui/Base/UiViewBase"),PopupCaptionItem_1=require("../../../Ui/Common/PopupCaptionItem"),UiManager_1=require("../../../Ui/UiManager"),ButtonItem_1=require("../../Common/Button/ButtonItem"),GenericScrollViewNew_1=require("../../Util/ScrollView/GenericScrollViewNew"),ShipTowerDefine_1=require("../ShipTowerDefine"),ShipTowerDescLeftPanel_1=require("./ShipTowerDescLeftPanel"),ShipTowerDescTeamItem_1=require("./ShipTowerDescTeamItem"),ShipTowerTeamPanel_1=require("./ShipTowerTeamPanel");class ShipTowerDescView extends UiViewBase_1.UiViewBase{constructor(){super(...arguments),this.OpenParam=void 0,this.Gs_=void 0,this.Fs_=void 0,this.zJa=void 0,this.Ns_=void 0,this.Vs_=void 0,this.js_=void 0,this.Hs_=void 0,this.Qs_=void 0,this.SelectedLeftRoleData=void 0,this.$s_=0,this.XW_=void 0,this.Xs_=()=>{this.Ys_()},this.zs_=()=>{ModelManager_1.ModelManager.ShipTowerModel.OpenViewReset({StageData:this.Gs_})},this.Js_=()=>{this.Gs_.StartChallenge()},this.Zs_=()=>{this.Fs_?.UpdateRoleListFilter();var t=this.Fs_?.GetRoleIdList();t?.length&&(this.XW_=t.find(t=>ModelManager_1.ModelManager.RoleModel?.IsMainRole(t)),ControllerHolder_1.ControllerHolder.RoleController.OpenRoleMainViewByParam({AgentType:0,RoleIdList:t,TeamPositionType:1}))},this.ta_=()=>{this.Gs_.StartChallenge()},this.ia_=()=>{this.Gs_.OpenViewTeamRecommend()},this.ra_=()=>{var t=new ShipTowerDescTeamItem_1.ShipTowerDescTeamItem;return t.RoleClickCallBack=this.OnRoleClick,t.BuffClickCallBack=this.na_,t.MechanismClickCallBack=this.gD_,t},this.OnRoleClick=t=>{this.Qs_?.Index!==t.Index&&(this.Qs_=t,this.YW_()),this.sa_()},this.na_=t=>{ModelManager_1.ModelManager.ShipTowerModel.OpenViewBuff({BuffId:t.BuffDataEdit?.Id,StageId:this.Gs_.Id,OperationType:1,TeamData:t,OnUseBuff:this.aa_})},this.gD_=t=>{this.Gs_.OpenViewMonsterDesc(t.InstId)},this.aa_=(t,e)=>{e?.UseBuff(t);t=e?.Index??-1;this.Ns_?.GetScrollItemByIndex(t)?.UpdateBuff(),UiManager_1.UiManager.CloseView("ShipTowerBuffView")},this.ha_=t=>{var e,i;this.SelectedLeftRoleData=t,this.Qs_&&(e=this.Qs_.Index,t=t.GetDataId(),i=ModelManager_1.ModelManager.ShipTowerModel.IsOtherTeamRoleData(t),this.Qs_.UpdateRoleListByModel(),i&&this.Gs_.UpdateOtherTeamRoleRepeat(e,t),this.Gs_.UpdateAllTeamRoleToModel(),this.Ns_?.RefreshByData(this.Gs_.TeamDataList))},this.la_=t=>{var e;Log_1.Log.CheckDebug()&&Log_1.Log.Debug("ShipTower",69,"OnRoleTeamSelect",["formationData",t]),this.Qs_&&(e=this.Qs_.Index,this.Gs_.TeamDataList[e].UpdateRoleListByFormationData(t),this.Gs_.UpdateOtherTeamRoleRepeat(e),this.Gs_.UpdateAllTeamRoleToModel(),this.Fs_?.OnlyUpdateTeamList(),this.Ns_?.RefreshByData(this.Gs_.TeamDataList))},this.$H_=()=>{this.J5_&&this.WH_()},this.kG_=t=>{this.Gs_.Id===t&&this.Slo()},this.Z5_=t=>{this.Gs_.Id===t&&(this.J5_&&this.Qs_&&(this.Qs_.UpdateRoleListToRoleSelectModel(),this.Gs_.UpdateOtherTeamRoleToModel(this.Qs_.Index),this.Gs_.UpdateAllTeamRoleToModel()),this.Slo())}}get J5_(){return ModelManager_1.ModelManager.ShipTowerModel.IsShowLeftTeamPanel}set J5_(t){ModelManager_1.ModelManager.ShipTowerModel.IsShowLeftTeamPanel=t}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,UE.UIItem],[1,UE.UIItem],[2,UE.UIScrollViewWithScrollbarComponent],[3,UE.UIButtonComponent],[4,UE.UIButtonComponent],[5,UE.UIButtonComponent],[6,UE.UIButtonComponent],[7,UE.UIItem],[8,UE.UIItem],[9,UE.UIItem],[10,UE.UIButtonComponent],[11,UE.UIItem],[12,UE.UIItem]],this.BtnBindInfo=[[3,this.Xs_],[10,this.Xs_],[6,this.ia_]]}Ss_(){this.Gs_=ModelManager_1.ModelManager.ShipTowerModel.GetStageDataById(this.OpenParam.StageId),this.OpenParam?.ApplyTeamEditStageId?this.Gs_.CopyTeamRoleToEdit(this.OpenParam.ApplyTeamEditStageId):this.OpenParam?.IsOpenCover||this.Gs_.UpdateToEdit(),this.J5_=!1,Log_1.Log.CheckDebug()&&Log_1.Log.Debug("ShipTower",69,"ShipTowerDescView",["DataParam",this.OpenParam])}async OnBeforeStartAsync(){this.Ss_(),this.zJa=new PopupCaptionItem_1.PopupCaptionItem(this.GetItem(0)),this.zJa.SetCloseCallBack(this.CloseMe.bind(this)),this.zJa.SetHelpBtnActive(!1),this.Fs_=new ShipTowerTeamPanel_1.ShipTowerTeamPanel,await this.Fs_.Init(this.GetItem(7),this.Gs_),this.Fs_.RoleSelectCallBack=this.ha_,this.Fs_.TeamSelectCallBack=this.la_,this.Fs_.RoleListUpdateCallback=this.$H_,this.Fs_.EmptyStateItem=this.F8_(),this.Ns_=new GenericScrollViewNew_1.GenericScrollViewNew(this.GetScrollViewWithScrollbar(2),this.ra_,this.GetItem(11).GetOwner()),this.Vs_=new ShipTowerDescLeftPanel_1.ShipTowerDescLeftPanel,await this.Vs_.Init(this.GetItem(1),this.Gs_),this.js_=new ButtonItem_1.ButtonItem(this.GetButton(4)?.RootUIComp),this.Hs_=new ButtonItem_1.ButtonItem(this.GetButton(5)?.RootUIComp),this._a_()}OnStart(){this.EA_()}EA_(){this.OpenParam?.IsOpenCover&&ModelManager_1.ModelManager.ShipTowerModel.OpenViewCover({StageData:this.Gs_})}OnAddEventListener(){EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.ShipTowerStageUpdate,this.kG_),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.ShipTowerSureResetStage,this.kG_),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.ShipTowerSureCoverChallenge,this.kG_),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.ShipTowerTeamRecommendApplyFinish,this.Z5_)}OnRemoveEventListener(){EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.ShipTowerStageUpdate,this.kG_),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.ShipTowerSureResetStage,this.kG_),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.ShipTowerSureCoverChallenge,this.kG_),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.ShipTowerTeamRecommendApplyFinish,this.Z5_)}OnBeforeShow(){this.XW_&&ModelManager_1.ModelManager.RoleModel.GetCurSelectMainRoleId()!==this.XW_&&(this.XW_=void 0,this.Gs_.UpdateMainRoleToEdit(),this.YW_(),this.Fs_?.UpdateRoleListByMainRoleChange()),this.Slo()}OnBeforeDestroy(){ModelManager_1.ModelManager.ShipTowerModel.ChallengeStageData!==this.Gs_&&this.Gs_?.UpdateToEdit()}Slo(){this._a_(),this.Ns_?.RefreshByData(this.Gs_.TeamDataList,void 0,!0),this.J5_?this.sa_():this.Ys_()}_a_(){var t=this.Gs_.CanReset();this.$s_=t?1:0}sa_(){this.J5_||this.PlaySequence("Team"),this.J5_=!0,this.Vs_?.SetActive(!1),this.Fs_?.UpdateViewAndShow(this.Qs_),this.WH_(),this.ua_(this.Hs_,this.$s_,this.Gs_.IsUnLocked()),this.ca_(!0)}WH_(){this.ua_(this.js_,3,!!this.Fs_?.GetRoleIdList().length)}Ys_(){this.J5_=!1,this.Fs_?.SetActive(!1),this.Vs_?.UpdateViewAndShow(this.Gs_),this.ua_(this.js_,2,this.Gs_.CanReset()),this.ua_(this.Hs_,this.$s_,this.Gs_.IsUnLocked()),this.ca_(!1),this.F8_()?.SetUIActive(!1)}ca_(t){this.GetItem(8)?.SetUIActive(t),this.GetItem(9)?.SetUIActive(t),this.Qs_&&(t?this.aq_():this.TA_()?.SetTeamToggleIsSelect(!1))}F8_(){return this.GetItem(12)}aq_(){this.Gs_.TeamDataList.forEach((t,e)=>{e!==this.Qs_?.Index&&(this.Ns_?.GetScrollItemByIndex(e))?.SetTeamToggleIsSelect(!1)})}TA_(){var t;if(this.Qs_)return t=this.Qs_.Index,this.Ns_?.GetScrollItemByIndex(t)}YW_(){this.Qs_&&(this.Qs_.UpdateRoleListToRoleSelectModel(),this.Gs_.UpdateOtherTeamRoleToModel(this.Qs_.Index),this.Gs_.UpdateAllTeamRoleToModel())}ua_(t,e,i=!0){if(t.SetActive(i),i)switch(e){case 3:this.hq_(t,ShipTowerDefine_1.shipTowerTextKey.RoleDetail),t.SetFunction(this.Zs_);break;case 0:this.hq_(t,ShipTowerDefine_1.shipTowerTextKey.StartChallenge),t.SetFunction(this.Js_);break;case 2:this.hq_(t,ShipTowerDefine_1.shipTowerTextKey.Reset),t.SetFunction(this.zs_);break;case 1:this.hq_(t,ShipTowerDefine_1.shipTowerTextKey.AgainChallenge),t.SetFunction(this.ta_)}}hq_(t,e){e=ConfigManager_1.ConfigManager.TextConfig.GetMultiTextByKey(e,e);t.SetText(e)}GetGuideUiItemAndUiItemForShowEx(t){switch(t[0]){case"TabCompRight":return this.Fs_?.GetGuideUiItemAndUiItemForShowEx(t);case"Desc":case"Item":case"TeamAndItem":case"TeamAndItemOuter":return 2!==t.length||isNaN(Number(t[1]))?void 0:(this.Ns_?.GetScrollItemByIndex(Number(t[1])))?.GetGuideUiItemAndUiItemForShowEx(t)}}}exports.ShipTowerDescView=ShipTowerDescView;
//# sourceMappingURL=ShipTowerDescView.js.map