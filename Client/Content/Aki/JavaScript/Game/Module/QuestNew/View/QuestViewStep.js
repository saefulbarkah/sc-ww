
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.QuestViewStep=void 0;const ue_1=require("ue"),StepBaseItem_1=require("../../BattleUi/Views/MissionView/TreeStep/StepBaseItem"),LguiUtil_1=require("../../Util/LguiUtil"),QuestViewChildStep_1=require("./QuestViewChildStep");class QuestViewStep extends StepBaseItem_1.StepBaseItem{constructor(){super(...arguments),this.Qct=[]}OnRegisterComponent(){super.OnRegisterComponent(),this.ComponentRegisterInfos.push([2,ue_1.UIItem]),this.ComponentRegisterInfos.push([3,ue_1.UIItem]),this.ComponentRegisterInfos.push([4,ue_1.UIItem])}async OnBeforeStartAsync(){await super.OnBeforeStartAsync(),this.GetItem(3)?.SetUIActive(!0),this.GetItem(4)?.SetUIActive(!0);var t=this.GetItem(2),e=new QuestViewChildStep_1.QuestViewChildStep;await e.CreateThenShowByActorAsync(t.GetOwner(),1),await e.HideAsync(),this.Qct.push(e)}OnBeforeDestroy(){}async Update(t){t?(this.SetActive(!0),await this.Refresh(t,t.MainStepText),this.GetItem(3)?.SetUIActive(this.IsDescribeTextVisible),t=await this.Xct(),this.GetItem(4)?.SetUIActive(this.IsDescribeTextVisible||t)):this.SetActive(!1)}async Xct(){var i,s=this.GetItem(2);if(!s)return!1;const r=this.ShowData;if(!r||!r.SubStepTexts)return this.Qct.forEach(t=>{t.SetActive(!1)}),!1;let a=s.GetHierarchyIndex();const h=[];for(let e=0;e<r.SubStepTexts.length;e++){let t=void 0;this.Qct.length>e?t=this.Qct[e]:((i=LguiUtil_1.LguiUtil.CopyItem(s,s.GetParentAsUIItem())).SetHierarchyIndex(++a),t=new QuestViewChildStep_1.QuestViewChildStep,h.push(t.CreateThenShowByActorAsync(i.GetOwner(),1)),this.Qct.push(t))}return await Promise.all(h),h.length=0,r.SubStepTexts.forEach((t,e)=>{h.push(this.Qct[e].Refresh(r,t))}),await Promise.all(h),this.Qct.forEach((t,e)=>{e=e<r.SubStepTexts.length;t.SetActive(e&&t.IsDescribeTextVisible)}),!0}}exports.QuestViewStep=QuestViewStep;
//# sourceMappingURL=QuestViewStep.js.map