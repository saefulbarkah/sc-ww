
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DreamLinkDungeonView=void 0;const puerts_1=require("puerts"),UE=require("ue"),CustomPromise_1=require("../../../../Core/Common/CustomPromise"),Log_1=require("../../../../Core/Common/Log"),ResourceSystem_1=require("../../../../Core/Resource/ResourceSystem"),TimerSystem_1=require("../../../../Core/Timer/TimerSystem"),FNameUtil_1=require("../../../../Core/Utils/FNameUtil"),Vector2D_1=require("../../../../Core/Utils/Math/Vector2D"),MathUtils_1=require("../../../../Core/Utils/MathUtils"),ObjectUtils_1=require("../../../../Core/Utils/ObjectUtils"),EventDefine_1=require("../../../Common/Event/EventDefine"),EventSystem_1=require("../../../Common/Event/EventSystem"),Global_1=require("../../../Global"),GlobalData_1=require("../../../GlobalData"),ConfigManager_1=require("../../../Manager/ConfigManager"),ModelManager_1=require("../../../Manager/ModelManager"),PreloadControllerClassPart1_1=require("../../../Preload/PreloadControllerClassPart1"),UiTickViewBase_1=require("../../../Ui/Base/UiTickViewBase"),PopupCaptionItem_1=require("../../../Ui/Common/PopupCaptionItem"),UiManager_1=require("../../../Ui/UiManager"),EffectUtil_1=require("../../../Utils/EffectUtil"),CommonItemSmallItemGrid_1=require("../../Common/ItemGrid/CommonItemSmallItemGrid"),LevelSequencePlayer_1=require("../../Common/LevelSequencePlayer"),HelpController_1=require("../../Help/HelpController"),ScrollingTipsController_1=require("../../ScrollingTips/ScrollingTipsController"),UiSceneManager_1=require("../../UiComponent/UiSceneManager"),UiModelUtil_1=require("../../UiModel/UiModelUtil"),GenericLayout_1=require("../../Util/Layout/GenericLayout"),LguiUtil_1=require("../../Util/LguiUtil"),DreamLinkController_1=require("../DreamLinkController"),DreamLinkDungeonRolePanel_1=require("./DreamLinkDungeonRolePanel"),DreamLinkScoreRewardItem_1=require("./DreamLinkScoreRewardItem"),DreamLinkCatProgressItem_1=require("./SubView/DreamLinkCatProgressItem"),PER_PAGE_COUNT=3,MAX_PAGE_COUNT=2,DOOR_OPEN_SEQUENCE_PATH="/Game/Aki/Map/UISceneLevel/UI_Scene/LevelSequence/Ani_Door.Ani_Door",DOOR_CLOSE_SEQUENCE_PATH="/Game/Aki/Map/UISceneLevel/UI_Scene/LevelSequence/Ani_Door_close.Ani_Door_close",RED_WEATHER_SEQUENCE_PATH="/Game/Aki/Map/UISceneLevel/UI_Scene/LevelSequence/Ani_UIMap_Roguelike_rad.Ani_UIMap_Roguelike_rad",BLUE_WEATHER_SEQUENCE_PATH="/Game/Aki/Map/UISceneLevel/UI_Scene/LevelSequence/Ani_UIMap_Roguelike.Ani_UIMap_Roguelike",SELECT_WAVE_EFFECT_PATH="/Game/Aki/Render/Shaders/PostProcess/WaterWave/M_WaterWave.M_WaterWave",SHAKE_CAMERA_SEQUENCE="/Game/Aki/Map/UISceneLevel/UI_Scene/LevelSequence/Ani_UIMap_Roguelike_loop.Ani_UIMap_Roguelike_loop",SWITCH_SEQUENCE="/Game/Aki/Map/UISceneLevel/UI_Scene/LevelSequence/Ani_UIMap_Roguelike_l.Ani_UIMap_Roguelike_l",UNLICK_SEQUNECE="/Game/Aki/Map/UISceneLevel/UI_Scene/LevelSequence/Ani_UIMap_Roguelike_CamA.Ani_UIMap_Roguelike_CamA",DREAMLINK_DUNGEON_HELP_ID=135;class DreamLinkDungeonView extends UiTickViewBase_1.UiTickViewBase{constructor(){super(...arguments),this.lqe=void 0,this.AZa=void 0,this.DZa=void 0,this.RHt=void 0,this.Fgl=void 0,this.hrl=void 0,this.lul=void 0,this.npl=void 0,this.RZa=0,this.eBo=0,this.AHt=void 0,this.UZa=void 0,this.xZa=void 0,this.PZa=0,this.bth=void 0,this.Itl=[],this.Mrl=void 0,this.qsi=void 0,this.Yal=void 0,this.zal=void 0,this.H3e=void 0,this.Xul=void 0,this.spl=!0,this.hul=void 0,this._ul=void 0,this.uul=void 0,this.vpl=void 0,this.cul=new UE.FrameTime,this.OnSelectRoleDungeon=e=>{var i,t;1!==this.bth&&(i=DreamLinkController_1.DreamLinkController.GetCurrentActivityData())&&(this.RZa=i.GetRoleInstDataIndex(e),t=ConfigManager_1.ConfigManager.DreamLinkConfig?.GetDreamLinkRoleDungeonConfig(e),this.LoadModel(t.RoleId,t.AnimationPath,e),this.PlaySelectWaveEffect(),this.RefreshReward(),this.RefreshEnterButton(),(i.GetRoleInstDataByIndex(this.RZa)?.lyl?(this.lul?.SequencePlayer?.Stop(),this.npl):(this.npl?.SequencePlayer?.Stop(),this.lul))?.SequencePlayer?.Play())},this.Cll=()=>{this.GetExtendToggle(7)?.SetToggleState(0,!0)},this.Jal=()=>{var e=1===this.GetExtendToggle(7)?.GetToggleState();this.GetItem(11)?.SetUIActive(e),e&&this.RefreshReward(),this.GetButton(12)?.RootUIComp.SetUIActive(e)},this.BZa=()=>{this.eBo--,this.eBo=Math.max(0,this.eBo),this.RZa=this.eBo*PER_PAGE_COUNT,this.RefreshView(),this.RefreshEnvironment()},this.bZa=()=>{this.eBo++,this.eBo=Math.min(MAX_PAGE_COUNT,this.eBo),this.RZa=this.eBo*PER_PAGE_COUNT,this.RefreshView(),this.RefreshEnvironment()},this.qZa=()=>{var e,i=DreamLinkController_1.DreamLinkController.GetCurrentActivityData();i&&(1===this.bth?(e=i.GetActivityConfig())&&!i.IsDreamLinkFunctionUnlock(3)&&UiManager_1.UiManager.OpenView("QuestView",e.FirstWhiteCatQuestId):(e=i.GetRoleInstDataByIndex(this.RZa))&&(e.K6n?e.lyl?ScrollingTipsController_1.ScrollingTipsController.ShowTipsById("DreamLinkDungeonFinishedTips"):(this.UiViewSequence?.PlaySequencePurely("FadeOut",!0),this.Xul&&(TimerSystem_1.TimerSystem.Remove(this.Xul),this.Xul=void 0),this.Xul=TimerSystem_1.TimerSystem.Delay(()=>{DreamLinkController_1.DreamLinkController.RoguelikeRoleInstStartRequest(this.RZa)},800)):ScrollingTipsController_1.ScrollingTipsController.ShowTipsById("DreamLinkDungeonUnlockTips")))}}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,UE.UIItem],[1,UE.UISprite],[2,UE.UIItem],[3,UE.UIItem],[4,UE.UIButtonComponent],[5,UE.UIButtonComponent],[6,UE.UIButtonComponent],[9,UE.UIItem],[8,UE.UIItem],[10,UE.UIHorizontalLayout],[11,UE.UIItem],[7,UE.UIExtendToggle],[12,UE.UIButtonComponent],[13,UE.UINiagara],[14,UE.UINiagara],[15,UE.UIText],[16,UE.UIItem],[17,UE.UIItem],[18,UE.UIItem],[19,UE.UIItem]],this.BtnBindInfo=[[4,this.BZa],[5,this.bZa],[6,this.qZa],[7,this.Jal],[12,this.Cll]]}OnAddEventListener(){EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnSelectRoleDreamDungeon,this.OnSelectRoleDungeon)}OnRemoveEventListener(){EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnSelectRoleDreamDungeon,this.OnSelectRoleDungeon)}async OnBeforeStartAsync(){var e,i,t,s=DreamLinkController_1.DreamLinkController.GetCurrentActivityData();s?(this.H3e=new GenericLayout_1.GenericLayout(this.GetHorizontalLayout(10),()=>new CommonItemSmallItemGrid_1.CommonItemSmallItemGrid),this.zal=new LevelSequencePlayer_1.LevelSequencePlayer(this.GetButton(6).RootUIComp),this.Yal=new DreamLinkCatProgressItem_1.DreamLinkCatProgressItem,e=this.Yal.CreateByActorAsync(this.GetItem(8).GetOwner()),this.AddChild(this.Yal),this.lqe=new PopupCaptionItem_1.PopupCaptionItem,this.lqe.SetCloseCallBack(()=>{this.CloseMe()}),this.lqe.SetHelpCallBack(()=>{HelpController_1.HelpController.OpenHelpById(DREAMLINK_DUNGEON_HELP_ID)}),i=this.lqe.CreateByActorAsync(this.GetItem(0).GetOwner()),this.AddChild(this.lqe),this.DZa=new DreamLinkDungeonRolePanel_1.DreamLinkRoleInstancePanel,this.AHt=ModelManager_1.ModelManager.CameraModel.CurrentCameraActor,t=this.DZa.CreateByActorAsync(this.GetItem(3).GetOwner()),this.AddChild(this.DZa),this.qsi=new DreamLinkScoreRewardItem_1.DreamLinkScoreRewardItem(s),s=this.qsi.CreateByActorAsync(this.GetItem(9).GetOwner()),this.AddChild(this.qsi),UiSceneManager_1.UiSceneManager.HasDreamLinkRoleSkeletalHandle()||UiSceneManager_1.UiSceneManager.InitDreamLinkRoleSkeletalHandle(),this.AZa=UiSceneManager_1.UiSceneManager.GetDreamLinkRoleSkeletalHandle(),await Promise.all([s,t,i,e]),this.InitDefaultSelectIndex(),this.cul.FrameNumber.Value=10):Log_1.Log.CheckError()&&Log_1.Log.Error("DreamLink",34,"DreamLinkDungeonView.OnBeforeStartAsync data is null")}async OnBeforeShowAsyncImplementImplement(){const i=new CustomPromise_1.CustomPromise,s=(ResourceSystem_1.ResourceSystem.LoadAsync(SELECT_WAVE_EFFECT_PATH,UE.MaterialInterface,e=>{e&&(this.xZa=UE.KismetMaterialLibrary.CreateDynamicMaterialInstance(this.RootActor,e),this.PZa=UE.KuroRenderingRuntimeBPPluginBPLibrary.AddPostprocessMaterial(this.RootActor,this.xZa,1,!0),i.SetResult(!0))}),new CustomPromise_1.CustomPromise),r=(ResourceSystem_1.ResourceSystem.LoadAsync(SHAKE_CAMERA_SEQUENCE,UE.LevelSequence,e=>{var i,t;ObjectUtils_1.ObjectUtils.IsValid(e)&&(e=e,i=(0,puerts_1.$ref)(void 0),UE.LevelSequencePlayer.CreateLevelSequencePlayer(GlobalData_1.GlobalData.World,e,new UE.MovieSceneSequencePlaybackSettings,i),i=(0,puerts_1.$unref)(i),(t=new UE.MovieSceneSequencePlaybackSettings).bAutoPlay=!1,i.PlaybackSettings=t,i.SetTickableWhenPaused(!0),i.SetSequence(e),UE.KuroSequenceRuntimeFunctionLibrary.SetSequenceInUiScene(e,!0),this.hrl=i,s.SetResult(!0))}),new CustomPromise_1.CustomPromise),o=(ResourceSystem_1.ResourceSystem.LoadAsync(SWITCH_SEQUENCE,UE.LevelSequence,e=>{var i,t;ObjectUtils_1.ObjectUtils.IsValid(e)&&(e=e,UE.KuroSequencePerformanceManager.OpenKuroPerformanceMode(e),i=(0,puerts_1.$ref)(void 0),UE.LevelSequencePlayer.CreateLevelSequencePlayer(GlobalData_1.GlobalData.World,e,new UE.MovieSceneSequencePlaybackSettings,i),i=(0,puerts_1.$unref)(i),(t=new UE.MovieSceneSequencePlaybackSettings).bAutoPlay=!1,t.bPauseAtEnd=!0,i.PlaybackSettings=t,i.SetTickableWhenPaused(!0),i.SetSequence(e),UE.KuroSequenceRuntimeFunctionLibrary.SetSequenceInUiScene(e,!0),this.lul=i,r.SetResult(!0))}),new CustomPromise_1.CustomPromise),t=(ResourceSystem_1.ResourceSystem.LoadAsync(UNLICK_SEQUNECE,UE.LevelSequence,e=>{var i,t;ObjectUtils_1.ObjectUtils.IsValid(e)&&(e=e,UE.KuroSequencePerformanceManager.OpenKuroPerformanceMode(e),i=(0,puerts_1.$ref)(void 0),UE.LevelSequencePlayer.CreateLevelSequencePlayer(GlobalData_1.GlobalData.World,e,new UE.MovieSceneSequencePlaybackSettings,i),i=(0,puerts_1.$unref)(i),(t=new UE.MovieSceneSequencePlaybackSettings).bAutoPlay=!1,t.bPauseAtEnd=!0,i.PlaybackSettings=t,i.SetTickableWhenPaused(!0),i.SetSequence(e),UE.KuroSequenceRuntimeFunctionLibrary.SetSequenceInUiScene(e,!0),this.npl=i,o.SetResult(!0))}),new CustomPromise_1.CustomPromise);var e=EffectUtil_1.EffectUtil.GetEffectPath("DreamLinkLockMaterialController");ResourceSystem_1.ResourceSystem.LoadAsync(e,UE.PD_CharacterControllerData_C,e=>{e&&t.SetResult(!0)}),await Promise.all([r.Promise,t.Promise,o.Promise,i.Promise,s.Promise])}OnBeforeShow(){this.hrl.bOverrideInstanceData=!0;var e=this.hrl.DefaultInstanceData,i=UE.KuroCollectActorComponent.GetActorWithTag(FNameUtil_1.FNameUtil.GetDynamicFName("KuroUiSceneRoot"),1),t=(this.lul.bOverrideInstanceData=!0,this.lul.DefaultInstanceData),s=(this.npl.bOverrideInstanceData=!0,this.npl.DefaultInstanceData),t=(t.TransformOrigin=i.GetTransform(),e.TransformOrigin=i.GetTransform(),s.TransformOrigin=i.GetTransform(),this.Mrl=UE.KuroCollectActorComponent.GetActorWithTag(FNameUtil_1.FNameUtil.GetDynamicFName("SequenceCamera"),1),this.UZa=UE.KuroCollectActorComponent.GetActorWithTag(FNameUtil_1.FNameUtil.GetDynamicFName("DoorCamera"),1),this.RefreshView(),this.RefreshEnvironment(!0),this.RefreshRoleList(),DreamLinkController_1.DreamLinkController.GetCurrentActivityData());t&&(t.GetRoleInstDataByIndex(this.RZa)?.lyl?(this.npl?.SequencePlayer?.Play(),this.spl||this.npl?.SequencePlayer?.JumpToFrame(this.npl.SequencePlayer.GetEndTime().Time)):(this.lul?.SequencePlayer?.Play(),this.spl||this.lul?.SequencePlayer?.JumpToFrame(this.lul.SequencePlayer.GetEndTime().Time)),this.spl=!1)}OnAfterShow(){this.InitProgressAnim()}OnAfterHide(){this.RHt?.IsValid()&&(this.RHt.Stop(),this.RHt=void 0),this.uul?.IsValid()&&(this.uul.Kill(),this.uul=void 0),this.lul?.IsValid()&&(this.lul.SequencePlayer.Stop(),this.lul.K2_DestroyActor(),this.lul=void 0),this.hrl?.IsValid()&&(this.hrl.SequencePlayer.Stop(),this.hrl.K2_DestroyActor(),this.hrl=void 0),this.Fgl?.IsValid()&&(this.Fgl.K2_DestroyActor(),this.Fgl=void 0),this.Xul&&(TimerSystem_1.TimerSystem.Remove(this.Xul),this.Xul=void 0),this.ClearWaveEffect(),UE.KuroRenderingRuntimeBPPluginBPLibrary.RemovePostprocessMaterial(this.RootActor,this.PZa),this.xZa=void 0,PreloadControllerClassPart1_1.CameraController.SetViewTarget(this.AHt,"DreamLinkDungeonView.OnBeforeDestroy")}OnBeforeDestroy(){var e=this.AZa?.Model?.CheckGetComponent(1);e?.MainMeshComponent?.IsValid()&&(e.MainMeshComponent.ForcedLodModel=0),this.Itl.forEach(e=>{e=e.Model?.CheckGetComponent(1);e?.MainMeshComponent?.IsValid()&&(e.MainMeshComponent.ForcedLodModel=0)}),UiSceneManager_1.UiSceneManager.DestroyDreamLinkRoleSkeletalHandle(),this.AZa=void 0,this.Itl=[],UiSceneManager_1.UiSceneManager.DestroyAllDreamLinkWeaponSkeletalHandle(),PreloadControllerClassPart1_1.CameraController.SetViewTarget(this.AHt,"DreamLinkDungeonView.OnBeforeDestroy"),UE.KuroSequencePerformanceManager.CloseKuroPerformanceMode()}InitProgressAnim(){var e,i=DreamLinkController_1.DreamLinkController.GetCurrentActivityData();i&&i.DungeonProgressRecord!==i.GetCurrentCatProgress()&&(i=i.GetLastFinishInst()%PER_PAGE_COUNT,e=this.GetItem(8),this.hul=this.DZa.GetLocationByIndex(i),this.GetUiNiagara(13).K2_SetWorldLocation(this.hul,!1,void 0,!1),this._ul=e?.GetRelativeTransform().GetLocation().op_Addition(new UE.Vector(e?.Width/2,-e?.Height/2,0)),this.GetUiNiagara(13)?.SetUIActive(!0),this.uul=UE.LTweenBPLibrary.LocalPositionTo(this.GetUiNiagara(13),this._ul,1,0,4),this.uul?.OnCompleteCallBack.Bind(()=>{this.GetUiNiagara(13)?.SetUIActive(!1),this.GetUiNiagara(14)?.SetUIActive(!0),this.Yal?.PlayAddProgressAnim()}))}InitDefaultSelectIndex(){var e=DreamLinkController_1.DreamLinkController.GetCurrentActivityData();e&&(e=e.DungeonProgressRecord===e.GetCurrentCatProgress()?e.GetLastUnlockInst():e.GetLastFinishInst(),this.eBo=Math.floor(e/PER_PAGE_COUNT),this.RZa=e,this.eBo===MAX_PAGE_COUNT?this.bth=1:(this.bth=0,this.RZa=e),this.eBo===MAX_PAGE_COUNT?this.bth=1:this.bth=0)}RefreshView(){this.RefreshPreNextButton(),this.RefreshDoorState(),this.RefreshEnterButton(),this.RefreshReward()}RefreshReward(){var e=DreamLinkController_1.DreamLinkController.GetCurrentActivityData();if(e){const i=e.GetRoleInstDataByIndex(this.RZa);i&&(e=ConfigManager_1.ConfigManager.InstanceDungeonConfig?.GetConfig(i.r6n))&&(e=ConfigManager_1.ConfigManager.ExchangeRewardConfig.GetExchangeRewardPreviewRewardList(e.FirstRewardId??0),this.H3e?.RefreshByData(e,()=>{this.H3e?.GetLayoutItemMap().forEach(e=>{e.SetReceivedVisible(i.lyl)})}))}}RefreshEnterButton(){var e,i,t=DreamLinkController_1.DreamLinkController.GetCurrentActivityData();t&&(e=0===t.GetInstStage()?0:1,this.vpl!==e&&(0==e?(this.vpl=0,this.zal?.PlayLevelSequenceByName("Blue")):(this.vpl=1,this.zal?.PlayLevelSequenceByName("Red"))),1===this.bth?(this.GetButton(6)?.RootUIComp.SetUIActive(!t.IsDreamLinkFunctionUnlock(8)),this.GetItem(16).SetUIActive(!1),this.GetText(15).SetText("")):(e=t.GetRoleInstDataByIndex(this.RZa))&&(i=ConfigManager_1.ConfigManager.InstanceDungeonConfig?.GetConfig(e.r6n))&&(LguiUtil_1.LguiUtil.SetLocalTextNew(this.GetText(15),i.MapName),this.GetButton(6)?.RootUIComp.SetUIActive(!e.lyl),this.GetItem(16).SetUIActive(!1),this.GetItem(18).SetUIActive(t.CheckDungeonRedDotStateByPage(this.eBo-1,PER_PAGE_COUNT)),this.GetItem(19).SetUIActive(t.CheckDungeonRedDotStateByPage(this.eBo+1,PER_PAGE_COUNT))))}RefreshEnvironment(e=!1){if(0!==this.bth||e){const t=DreamLinkController_1.DreamLinkController.GetCurrentActivityData();var i;!t||this.eBo>=MAX_PAGE_COUNT||(e=1===this.bth,this.bth=0,i=()=>{this.RHt&&(this.RHt.Stop(),this.RHt=void 0),t.GetFinishInstCount()>=PER_PAGE_COUNT?this.PlaySceneLevelSequence(RED_WEATHER_SEQUENCE_PATH):this.PlaySceneLevelSequence(BLUE_WEATHER_SEQUENCE_PATH),this.RefreshRoleList(),this.GetItem(17)?.SetAlpha(1),PreloadControllerClassPart1_1.CameraController.SetViewTarget(this.Mrl,"DreamLinkDungeonView.RefreshEnvironment")},e?this.PlayBlackScreen(i,"DreamLinkDungeonView.RefreshEnvironment"):i())}else this.RefreshRoleList()}RefreshPreNextButton(){this.GetButton(4)?.RootUIComp.SetUIActive(0<this.eBo);var e,i=DreamLinkController_1.DreamLinkController.GetCurrentActivityData();this.eBo===MAX_PAGE_COUNT-1?this.GetButton(5)?.RootUIComp.SetUIActive(i.IsAllInstFinished()):(e=i.GetFinishInstCount(),i=i.GetLastUnlockInst(),this.GetButton(5)?.RootUIComp.SetUIActive((this.eBo+1)*PER_PAGE_COUNT<=e&&this.eBo*PER_PAGE_COUNT<=i&&this.eBo!==MAX_PAGE_COUNT))}RefreshRoleList(e=!0){var i;1===this.bth?this.GetItem(2)?.SetUIActive(!1):(i=DreamLinkController_1.DreamLinkController.GetCurrentActivityData())&&(0<(i=i.GetInstListByPages(this.eBo,PER_PAGE_COUNT)).length?(this.DZa.Refresh(i,e?this.RZa%PER_PAGE_COUNT:0),this.PlaySelectWaveEffect(),this.GetItem(2)?.SetUIActive(!0)):this.GetItem(2)?.SetUIActive(!1))}RefreshDoorState(){this.eBo<MAX_PAGE_COUNT||DreamLinkController_1.DreamLinkController.GetCurrentActivityData()&&(this.GetItem(17)?.SetAlpha(0),this.RefreshRoleList(),this.bth=1,this.ClearWaveEffect(),this.PlayDoorSequence())}async PlayDoorSequence(){await this.PlayBlackScreen(()=>{PreloadControllerClassPart1_1.CameraController.SetViewTarget(this.UZa,"DreamLinkDungeonView.PlayDoorSequence")},"DreamLinkDungeonView.PlayDoorSequence");var e=DreamLinkController_1.DreamLinkController.GetCurrentActivityData();e&&(e=e.GetActivityConfig())&&(ModelManager_1.ModelManager.InstanceDungeonEntranceModel?.CheckInstanceFinished(e.FirstWhiteCatDungeonId)?this.PlaySceneLevelSequence(DOOR_CLOSE_SEQUENCE_PATH,!0,!0):this.PlaySceneLevelSequence(DOOR_OPEN_SEQUENCE_PATH,!0,!0))}async PlayBlackScreen(e,i){await PreloadControllerClassPart1_1.BlackScreenController.AddBlackScreenAsync("Start",i),e(),PreloadControllerClassPart1_1.BlackScreenController.RemoveBlackScreen("Close",i)}LoadModel(i,e,s){const r=this.AZa.Model?.CheckGetComponent(11);r&&r.RoleConfigId===i||(this.Itl.forEach(e=>{e=e.Model?.CheckGetComponent(0);e&&e.SetVisible(!1)}),ResourceSystem_1.ResourceSystem.LoadAsync(e,UE.AnimationAsset,t=>{var e;!t||r&&r.RoleConfigId===i||(e=this.AZa.Model?.CheckGetComponent(12))&&e.LoadModelByRoleConfigId(i,!0,()=>{var e=this.AZa.Model?.CheckGetComponent(10),e=(e&&e.PlayAnimation(t,!0),this.AZa.Model?.CheckGetComponent(1)),e=(e&&(e.SetTransformByTag("RoleCase"),e.MainMeshComponent?.IsValid())&&(e.MainMeshComponent.ForcedLodModel=1),this.AZa.Model?.CheckGetComponent(5)),i=EffectUtil_1.EffectUtil.GetEffectPath("ChangeRoleMaterialController"),i=ResourceSystem_1.ResourceSystem.GetLoadedAsset(i,UE.PD_CharacterControllerData_C),i=(e&&i&&e.AddRenderingMaterialByData(i),UiModelUtil_1.UiModelUtil.PlayEffectOnRoot(this.AZa.Model,"ChangeRoleEffect"),DreamLinkController_1.DreamLinkController.GetCurrentActivityData());i&&(i.GetRoleInstDataByIndex(this.RZa).lyl||(i=EffectUtil_1.EffectUtil.GetEffectPath("DreamLinkLockMaterialController"),i=ResourceSystem_1.ResourceSystem.GetLoadedAsset(i,UE.PD_CharacterControllerData_C),e&&i&&e.AddRenderingMaterialByData(i)),this.LoadItemModel(s))})}))}LoadItemModel(e){const o=ConfigManager_1.ConfigManager.DreamLinkConfig?.GetDreamLinkRoleDungeonConfig(e);if(o){let i=0;o.WeaponShowConfig.forEach((e,s)=>{this.Itl.length<=i&&this.Itl.push(UiSceneManager_1.UiSceneManager.InitDreamLinkWeaponSkeletalHandle());const r=this.Itl[i];i++,ResourceSystem_1.ResourceSystem.LoadAsync(e,UE.AnimationAsset,t=>{var e;t&&(e=r.Model?.CheckGetComponent(2))&&e.LoadModelByModelId(parseInt(s),!0,()=>{var e=r.Model?.CheckGetComponent(10),e=(e&&e.PlayAnimation(t,!0),r.Model?.CheckGetComponent(1)),i=this.AZa?.Model?.CheckGetComponent(1),i=(e?.MainMeshComponent?.IsValid()&&(e.MainMeshComponent.ForcedLodModel=1),e&&i&&(o.WeaponShowCase.has(s)?(e.Actor?.K2_AttachToComponent(i.MainMeshComponent,new UE.FName(o.WeaponShowCase.get(s)),0,0,0,!1),e.Actor?.K2_SetActorRelativeTransform(MathUtils_1.MathUtils.DefaultTransform,!1,void 0,!1)):e.SetTransformByTag("RoleCase")),r.Model?.CheckGetComponent(0)),e=(i&&i.SetVisible(!0),UiModelUtil_1.UiModelUtil.PlayEffectOnRoot(r.Model,"ChangeRoleEffect"),DreamLinkController_1.DreamLinkController.GetCurrentActivityData());e&&(i=r.Model?.CheckGetComponent(5),e.GetRoleInstDataByIndex(this.RZa).lyl||(e=EffectUtil_1.EffectUtil.GetEffectPath("DreamLinkLockMaterialController"),e=ResourceSystem_1.ResourceSystem.GetLoadedAsset(e,UE.PD_CharacterControllerData_C),i&&e&&i.AddRenderingMaterialByData(e)))})})})}}PlaySceneLevelSequence(e,s=!1,r=!1,o=!0){this.RHt&&(this.RHt.Stop(),this.RHt=void 0),ResourceSystem_1.ResourceSystem.LoadAsync(e,UE.LevelSequence,e=>{var i,t;ObjectUtils_1.ObjectUtils.IsValid(e)&&(e=e,i=(0,puerts_1.$ref)(void 0),UE.LevelSequencePlayer.CreateLevelSequencePlayer(GlobalData_1.GlobalData.World,e,new UE.MovieSceneSequencePlaybackSettings,i),i=(0,puerts_1.$unref)(i),(t=new UE.MovieSceneSequencePlaybackSettings).bRestoreState=r,t.bPauseAtEnd=s,i.PlaybackSettings=t,i.SetTickableWhenPaused(!0),i.SetSequence(e),UE.KuroSequenceRuntimeFunctionLibrary.SetSequenceInUiScene(e,!0),this.hrl?.SequencePlayer?.PlayLooping(-1),i.SequencePlayer?.Play(),o&&(i.bOverrideInstanceData=!0,t=i.DefaultInstanceData,e=UE.KuroCollectActorComponent.GetActorWithTag(FNameUtil_1.FNameUtil.GetDynamicFName("KuroUiSceneRoot"),1),t.TransformOrigin=e.GetTransform()),this.RHt=i.SequencePlayer,this.Fgl=i)})}PlaySelectWaveEffect(){var e,i,t,s=this.DZa.GetScreenPositionByIndex(this.RZa%3);s&&(t=Global_1.Global.CharacterController,e=(0,puerts_1.$ref)(void 0),i=(0,puerts_1.$ref)(void 0),t.GetViewportSize(e,i),t=(0,puerts_1.$unref)(e),e=(0,puerts_1.$unref)(i),i=Vector2D_1.Vector2D.Create(t,e),t=UE.KismetMathLibrary.Divide_Vector2DVector2D(s,i.ToUeVector2D()),this.xZa?.SetScalarParameterValue(FNameUtil_1.FNameUtil.GetDynamicFName("Center1X"),t?.X),this.xZa?.SetScalarParameterValue(FNameUtil_1.FNameUtil.GetDynamicFName("Center1Y"),t?.Y),this.xZa?.SetScalarParameterValue(FNameUtil_1.FNameUtil.GetDynamicFName("CommonStrength"),.05))}ClearWaveEffect(){this.xZa?.SetScalarParameterValue(FNameUtil_1.FNameUtil.GetDynamicFName("CommonStrength"),0),this.xZa?.SetScalarParameterValue(FNameUtil_1.FNameUtil.GetDynamicFName("ClickStrength"),0)}}exports.DreamLinkDungeonView=DreamLinkDungeonView;
//# sourceMappingURL=DreamLinkDungeonView.js.map