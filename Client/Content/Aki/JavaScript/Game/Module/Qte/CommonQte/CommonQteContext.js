
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CommonQteContext=void 0;const Log_1=require("../../../../Core/Common/Log"),TimeUtil_1=require("../../../Common/TimeUtil"),ModelManager_1=require("../../../Manager/ModelManager"),CommonQteController_1=require("./CommonQteController"),CommonQteDefine_1=require("./CommonQteDefine");class CommonQteContext{constructor(){this.HandleId=0,this.QteId=0,this.Config=void 0,this.State=0,this.PassTime=0,this.Duration=0,this.IsPermanent=!1,this.ResponseCount=0,this.TargetCount=0,this.SuccessCallback=void 0,this.FailCallback=void 0,this.Source=void 0}SetConfig(t){(this.Config=t).BaseConfig.Duration<0?this.IsPermanent=!0:this.Duration=t.BaseConfig.Duration*TimeUtil_1.TimeUtil.InverseMillisecond,0===t.BaseConfig.QteType&&(this.TargetCount=1)}Response(){this.IsPending()?(this.ResponseCount+=1,this.ResponseCount>=this.TargetCount&&this.$El()):Log_1.Log.CheckDebug()&&Log_1.Log.Debug("CommonQte",67,"Qte无法接收响应",["Handle",this.QteId],["Id",this.QteId],["State",this.State])}IsPending(){return 0===this.State}IsSuccess(){return 1===this.State}IsFail(){return 2===this.State}IsInvalid(){return 3===this.State}IsActive(){return this.HandleId===ModelManager_1.ModelManager.CommonQteModel?.GetQteHandle()}$El(){1!==this.State&&(this.State=1,Log_1.Log.CheckDebug()&&Log_1.Log.Debug("CommonQte",67,"通用Qte触发成功",["Handle",this.HandleId],["Id",this.QteId]),this.SuccessCallback&&this.SuccessCallback(this),this.SuccessCallback=void 0,CommonQteController_1.CommonQteController.StopQte(this.HandleId))}XEl(){2!==this.State&&(this.State=2,Log_1.Log.CheckDebug()&&Log_1.Log.Debug("CommonQte",67,"通用Qte触发失败",["Handle",this.HandleId],["Id",this.QteId]),this.FailCallback&&this.FailCallback(this),this.FailCallback=void 0,CommonQteController_1.CommonQteController.StopQte(this.HandleId))}UpdateTime(t){this.Config?this.IsPermanent||(this.PassTime+=t,this.PassTime>this.Duration&&this.XEl()):(this.State=3,Log_1.Log.CheckError()&&Log_1.Log.Error("CommonQte",67,"Context中获取不到Config",["Id",this.QteId]),CommonQteController_1.CommonQteController.StopCurrentQte())}Clear(){this.IsPending()&&(this.State=3),this.Config=void 0,this.SuccessCallback=void 0,this.FailCallback=void 0}GetAction(){if(this.Config){let t=0;return 0<(t=0===this.Config.BaseConfig.QteType?this.Config.BaseConfig.SingleClickConfig.UIConfig.Action:t)&&t<CommonQteDefine_1.qteInputActions.length?CommonQteDefine_1.qteInputActions[t]:void 0}}GetViewName(){return this.Config&&0===this.Config.BaseConfig.QteType?this.YEl(this.Config.BaseConfig.SingleClickConfig):void 0}YEl(t){t=t.ViewType;if(0===t)return"CommonQteView"}GetUiConfig(){if(this.Config){let t=void 0;return t=0===this.Config.BaseConfig.QteType?this.Config.BaseConfig.SingleClickConfig.UIConfig:t}}}exports.CommonQteContext=CommonQteContext;
//# sourceMappingURL=CommonQteContext.js.map