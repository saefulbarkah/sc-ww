
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FollowShootAutoAimHandle=void 0;const Log_1=require("../../../../Core/Common/Log"),Stats_1=require("../../../../Core/Common/Stats"),Vector2D_1=require("../../../../Core/Utils/Math/Vector2D"),EventDefine_1=require("../../../Common/Event/EventDefine"),EventSystem_1=require("../../../Common/Event/EventSystem"),ModelManager_1=require("../../../Manager/ModelManager"),LockOnController_1=require("../../LockOn/LockOnController"),FollowShootAutoAimUnit_1=require("../HudUnit/FollowShootAutoAimUnit"),HudUnitUtils_1=require("../Utils/HudUnitUtils"),HudUnitHandleBase_1=require("./HudUnitHandleBase");class FollowShootAutoAimHandle extends HudUnitHandleBase_1.HudUnitHandleBase{constructor(){super(...arguments),this.noi=void 0,this.sDe=void 0,this.IPl=void 0,this.jma=new Vector2D_1.Vector2D,this.zpe=(t,e)=>{this.sDe===e&&this.m$e()},this.PFa=t=>{if(Log_1.Log.CheckDebug()&&Log_1.Log.Debug("HudUnit",17,"FollowShootAutoAim",["bVisible",t]),t){var e=ModelManager_1.ModelManager.BattleUiModel.FormationData?.GetFollowerEntityHandle();if(this.iKa(e),!this.noi)return void this.Soi()}this.noi&&this.noi.SetVisible(t)}}OnInitialize(){super.OnInitialize();var t=ModelManager_1.ModelManager.BattleUiModel.FormationData?.GetFollowerEntityHandle();this.iKa(t)}iKa(t){t!==this.sDe&&(this.m$e(),t?.Valid?(this.sDe=t,this.IPl=this.sDe.Entity?.GetComponent(210),this.c$e(),this.HGa()):(this.sDe=void 0,this.IPl=void 0))}HGa(){}OnDestroyed(){this.yoi()}OnAddEvents(){EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.SetFollowShootAutoAimVisible,this.PFa)}OnRemoveEvents(){EventSystem_1.EventSystem.RemoveAllTargetUseKey(this),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.SetFollowShootAutoAimVisible,this.PFa)}c$e(){EventSystem_1.EventSystem.AddWithTargetUseHoldKey(this,this.sDe,EventDefine_1.EEventName.RemoveEntity,this.zpe)}m$e(){EventSystem_1.EventSystem.RemoveWithTargetUseKey(this,this.sDe,EventDefine_1.EEventName.RemoveEntity,this.zpe)}OnTick(t){this.doi()}Soi(){this.noi=this.NewHudUnitWithReturn(FollowShootAutoAimUnit_1.FollowShootAutoAimUnit,"UiView_SightB",!0,()=>{this.HGa()}),this.noi.SetVisible(!0)}yoi(){this.noi&&(this.DestroyHudUnit(this.noi),this.noi=void 0)}doi(){var t;this.noi?.GetVisible()&&(t=this.BRl(this.IPl?.LockOnTarget),this.noi.SetTargetAimVisible(t))}BRl(t){return!!t&&(t=LockOnController_1.LockOnController.GetLockOnTargetLocation(t),!!HudUnitUtils_1.HudUnitUtils.PositionUtil.ProjectWorldToScreen(t,this.jma))&&(this.noi?.SetTargetItemOffset(this.jma.X,this.jma.Y),!0)}}(exports.FollowShootAutoAimHandle=FollowShootAutoAimHandle).Ult=Stats_1.Stat.Create("[BattleView]FollowShootAimHandleTick");
//# sourceMappingURL=FollowShootAutoAimHandle.js.map