
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SdkMailView=void 0;const UE=require("ue"),CustomPromise_1=require("../../../../Core/Common/CustomPromise"),PlatformSdkManagerNew_1=require("../../../../Launcher/Platform/PlatformSdk/PlatformSdkManagerNew"),PlatformSdkReportData_1=require("../../../../Launcher/Platform/PlatformSdk/PlatformSdkReportData"),TimeUtil_1=require("../../../Common/TimeUtil"),ControllerHolder_1=require("../../../Manager/ControllerHolder"),UiTickViewBase_1=require("../../../Ui/Base/UiTickViewBase"),UiManager_1=require("../../../Ui/UiManager"),ConfirmBoxDefine_1=require("../../ConfirmBox/ConfirmBoxDefine"),ScrollingTipsController_1=require("../../ScrollingTips/ScrollingTipsController"),LguiUtil_1=require("../../Util/LguiUtil"),SdkViewData_1=require("../SdkViewData");class SdkMailView extends UiTickViewBase_1.UiTickViewBase{constructor(){super(...arguments),this.Anl=0,this.xnl=[],this.Pnl=[],this.C0t=void 0,this.Yai=i=>{this.qcl()},this.Gcl=()=>{this.qcl()},this.N8e=()=>{var i;1===this.GetExtendToggle(7).GetToggleState()&&(i=new PlatformSdkReportData_1.PlatformReportClickProtocol,PlatformSdkManagerNew_1.PlatformSdkManagerNew.GetPlatformSdk().ReportToThirdParty(i))},this.wnl=()=>{var i,e;1!==this.GetExtendToggle(7).GetToggleState()?ScrollingTipsController_1.ScrollingTipsController.ShowTipsByTextId("PSN_Tip_NeedAgreeProtol"):(i=TimeUtil_1.TimeUtil.GetServerTime())-this.Anl<60||(e=this.GetInputText(1).GetText(),/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?(this.Anl=i,this.Bnl(e)):ScrollingTipsController_1.ScrollingTipsController.ShowTipsByTextId("PSN_Tip_MailNotValid"))},this.eDo=()=>{this.CloseMe()},this.sOt=()=>{const e=this.GetInputText(1).GetText();var i;if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)){const t=this.GetInputText(2).GetText();6!==t.length?ScrollingTipsController_1.ScrollingTipsController.ShowTipsByTextId("PSN_Tip_MailCodeError"):(i=SdkViewData_1.SdkLoadPopUpViewData.Create(5,"Sdk_Bind_Mail_Loading"),UiManager_1.UiManager.OpenView("SdkLoadPopUpView",i,()=>{var i=new PlatformSdkReportData_1.PlatformReportClickLogin;PlatformSdkManagerNew_1.PlatformSdkManagerNew.GetPlatformSdk().ReportToThirdParty(i),PlatformSdkManagerNew_1.PlatformSdkManagerNew.GetPlatformSdk().BindAccountThenLogin((i,e,t,r)=>{r?(UiManager_1.UiManager.CloseView("SdkMailView"),UiManager_1.UiManager.CloseView("SdkLoginView"),ControllerHolder_1.ControllerHolder.LoginController.OnSdkLoginResult(r.code,r.cuid,r.username)):r?""!==i&&((r=new ConfirmBoxDefine_1.ConfirmBoxDataNew(227)).SetTextArgs(i),ControllerHolder_1.ControllerHolder.ConfirmBoxController.ShowNetWorkConfirmBoxView(r)):(i=new ConfirmBoxDefine_1.ConfirmBoxDataNew(214),ControllerHolder_1.ControllerHolder.ConfirmBoxController.ShowNetWorkConfirmBoxView(i)),UiManager_1.UiManager.CloseView("SdkLoadPopUpView")},e,t)}))}else ScrollingTipsController_1.ScrollingTipsController.ShowTipsByTextId("PSN_Tip_MailNotValid")},this.bnl=()=>{this.C0t&&0<this.C0t.ProtocolData.length&&ControllerHolder_1.ControllerHolder.KuroSdkController.SdkOpenUrlWnd("",this.C0t.ProtocolData[0].Url)},this.qnl=()=>{this.C0t&&1<this.C0t.ProtocolData.length&&ControllerHolder_1.ControllerHolder.KuroSdkController.SdkOpenUrlWnd("",this.C0t.ProtocolData[1].Url)},this.Gnl=()=>{this.C0t&&2<this.C0t.ProtocolData.length&&ControllerHolder_1.ControllerHolder.KuroSdkController.SdkOpenUrlWnd("",this.C0t.ProtocolData[2].Url)}}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,UE.UIButtonComponent],[1,UE.UITextInputComponent],[2,UE.UITextInputComponent],[3,UE.UIButtonComponent],[4,UE.UIButtonComponent],[5,UE.UIButtonComponent],[6,UE.UIItem],[7,UE.UIExtendToggle],[8,UE.UIButtonComponent],[9,UE.UIButtonComponent],[10,UE.UIText],[11,UE.UIText],[12,UE.UIText],[13,UE.UIText]],this.BtnBindInfo=[[0,this.eDo],[9,this.sOt],[3,this.bnl],[4,this.qnl],[5,this.Gnl],[8,this.wnl],[7,this.N8e]]}OnStart(){this.C0t=this.OpenParam,this.xnl=[this.GetButton(3),this.GetButton(4),this.GetButton(5)],this.Pnl=[this.GetText(10),this.GetText(11),this.GetText(12)],this.Onl(),this.knl();var i=new PlatformSdkReportData_1.PlatformReportLoginWindow;PlatformSdkManagerNew_1.PlatformSdkManagerNew.GetPlatformSdk().ReportToThirdParty(i),this.qcl(),this.GetInputText(1).OnTextChange.Bind(this.Gcl),this.GetInputText(2).OnTextChange.Bind(this.Gcl),this.GetExtendToggle(7).OnStateChange.Add(this.Yai)}qcl(){var i=this.GetInputText(1).GetText(),e=this.GetInputText(2).GetText(),t=this.GetExtendToggle(7).GetToggleState();0<i.length&&0<e.length&&1===t?this.GetButton(9).SetSelfInteractive(!0):this.GetButton(9).SetSelfInteractive(!1)}async Bnl(i){var e=SdkViewData_1.SdkLoadPopUpViewData.Create(5,"Sdk_Send_MailCode_Loading");const t=new CustomPromise_1.CustomPromise;UiManager_1.UiManager.OpenView("SdkLoadPopUpView",e,()=>{t.SetResult()}),await t.Promise;e=await PlatformSdkManagerNew_1.PlatformSdkManagerNew.GetPlatformSdk().RequestEmailCode(i);e.IfSuccess&&0===e.Code?ScrollingTipsController_1.ScrollingTipsController.ShowTipsByTextId("Sdk_Send_MailCode_Success"):(e.IfSuccess?""!==e.Msg?((i=new ConfirmBoxDefine_1.ConfirmBoxDataNew(227)).SetTextArgs(e.Msg),ControllerHolder_1.ControllerHolder.ConfirmBoxController.ShowNetWorkConfirmBoxView(i)):(i=new ConfirmBoxDefine_1.ConfirmBoxDataNew(214),ControllerHolder_1.ControllerHolder.ConfirmBoxController.ShowNetWorkConfirmBoxView(i)):(i=new ConfirmBoxDefine_1.ConfirmBoxDataNew(214),ControllerHolder_1.ControllerHolder.ConfirmBoxController.ShowNetWorkConfirmBoxView(i)),ScrollingTipsController_1.ScrollingTipsController.ShowTipsByText(e.Msg)),UiManager_1.UiManager.CloseView("SdkLoadPopUpView")}knl(){for(let i=0;i<this.xnl.length;i++)this.xnl[i].RootUIComp.SetUIActive(!1),this.Pnl[i].SetUIActive(!1);if(this.C0t)for(let i=0;i<this.xnl.length;i++)i<this.C0t.ProtocolData.length?(this.xnl[i].RootUIComp.SetUIActive(!0),this.Pnl[i].SetUIActive(!0),this.Pnl[i].SetText(this.C0t.ProtocolData[i].Title)):(this.xnl[i].RootUIComp.SetUIActive(!1),this.Pnl[i].SetUIActive(!1))}Onl(){var i=TimeUtil_1.TimeUtil.GetServerTime(),e=this.GetInputText(1).GetText();i-this.Anl<60||0===e.length?this.GetButton(8).SetSelfInteractive(!1):this.GetButton(8).SetSelfInteractive(!0)}y3e(){var i=TimeUtil_1.TimeUtil.GetServerTime(),i=Math.floor(60-(i-this.Anl));i<=0?this.GetText(13).ShowTextNew("Send_MailCode"):LguiUtil_1.LguiUtil.SetLocalTextNew(this.GetText(13),"Send_MailCode_Cd",i.toString())}OnTick(i){this.Onl(),this.y3e()}}exports.SdkMailView=SdkMailView;
//# sourceMappingURL=SdkMailView.js.map