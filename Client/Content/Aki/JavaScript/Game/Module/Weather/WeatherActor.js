
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WeatherActor=void 0;const UE=require("ue"),ActorSystem_1=require("../../../Core/Actor/ActorSystem"),Log_1=require("../../../Core/Common/Log"),Time_1=require("../../../Core/Common/Time"),ResourceSystem_1=require("../../../Core/Resource/ResourceSystem"),TickSystem_1=require("../../../Core/Tick/TickSystem"),MathUtils_1=require("../../../Core/Utils/MathUtils"),ConfigManager_1=require("../../Manager/ConfigManager");class WeatherComponent{constructor(){this.BlendWeightNonScale=1,this.Component=void 0}}class WeatherActor{constructor(){this.xko=void 0,this.L8l=new WeatherComponent,this.A8l=new WeatherComponent,this.wko=void 0,this.Bko=void 0,this.bko=0,this.qko=0,this.Gko=0,this.Nko=0,this.Uqe=-0,this.Oko=-0,this.kko=!1,this.Rqe=TickSystem_1.TickSystem.InvalidId,this.G2e=!1,this.wta=0,this.R8l=!1,this.x8l=1,this.J_=()=>{this.Uqe+=Time_1.Time.DeltaTime;var t=this.Uqe/(1e3*this.Oko),t=MathUtils_1.MathUtils.Clamp(t,0,1),i=MathUtils_1.MathUtils.Lerp(this.bko,this.Gko,t),s=MathUtils_1.MathUtils.Lerp(this.qko,this.Nko,t),h=Time_1.Time.DeltaTimeSeconds;this.x8l=this.R8l?this.x8l-h:this.x8l+h,this.x8l=MathUtils_1.MathUtils.Clamp(this.x8l,0,1),this.Fko(i),this.Vko(s),1<=t&&(this.R8l&&this.x8l<=0||!this.R8l&&1<=this.x8l)&&this.jm()},this.Fko=t=>{this.wko&&(this.wko.BlendWeightNonScale=t,this.wko.Component.BlendWeight=t*this.x8l)},this.Vko=t=>{this.Bko&&(this.Bko.BlendWeightNonScale=t,this.Bko.Component.BlendWeight=t*this.x8l)},this.v9e=()=>{this.jm(),this.wko=void 0,this.Bko=void 0,this.xko=void 0}}Hko(){this.xko?.IsValid()||(this.xko=ActorSystem_1.ActorSystem.Get(UE.BP_Weather_C.StaticClass(),MathUtils_1.MathUtils.DefaultTransformDouble,void 0),this.xko.OnDestroyed.Add(this.v9e),this.L8l.Component=this.xko.KuroPostProcess_1,this.L8l.Component.BlendWeight=this.L8l.BlendWeightNonScale=1,this.A8l.Component=this.xko.KuroPostProcess_2,this.A8l.Component.BlendWeight=this.A8l.BlendWeightNonScale=0)}BanWeather(){this.Destroy(),this.kko=!this.kko}SetActorState(t){this.G2e!==t&&(this.xko?.IsValid()&&this.xko.SetActorHiddenInGame(!t),this.G2e=t)}Bta(){0!==this.wta&&(ResourceSystem_1.ResourceSystem.CancelAsyncLoad(this.wta),this.wta=0)}ChangeWeather(t,i){this.jm(),Log_1.Log.CheckInfo()&&Log_1.Log.Info("Weather",27,"改变天气",["targetId",t],["tweentime",i]),this.kko||(t=ConfigManager_1.ConfigManager.WeatherModuleConfig.GetWeatherConfig(t))&&(t=t.DAPath,this.Hko(),this.L8l.BlendWeightNonScale>=this.A8l.BlendWeightNonScale?(this.wko=this.L8l,this.Bko=this.A8l):(this.wko=this.A8l,this.Bko=this.L8l),this.Bta(),this.wta=ResourceSystem_1.ResourceSystem.LoadAsync(t,UE.KuroWeatherDataAsset,t=>{t?.IsValid()&&this.Bko&&this.Bko.Component&&(this.wta=0,this.Bko.Component.WeatherDataAsset=t)}),0===i?(this.Fko(0),this.Vko(1)):(this.bko=this.wko.BlendWeightNonScale,this.Gko=0,this.qko=this.Bko.BlendWeightNonScale,this.Nko=1,this.Oko=i,this.Uqe=0,this.Rqe===TickSystem_1.TickSystem.InvalidId&&(this.Rqe=TickSystem_1.TickSystem.Add(this.J_,"WeatherActor").Id)))}SetWeatherForbidden(t){this.R8l=t,this.Rqe===TickSystem_1.TickSystem.InvalidId&&(this.Rqe=TickSystem_1.TickSystem.Add(this.J_,"WeatherActor").Id)}jm(){this.Rqe!==TickSystem_1.TickSystem.InvalidId&&(TickSystem_1.TickSystem.Remove(this.Rqe),this.Rqe=TickSystem_1.TickSystem.InvalidId)}Destroy(){this.xko?.IsValid()&&this.xko.K2_DestroyActor(),this.G2e=!1,this.xko=void 0}}exports.WeatherActor=WeatherActor;
//# sourceMappingURL=WeatherActor.js.map