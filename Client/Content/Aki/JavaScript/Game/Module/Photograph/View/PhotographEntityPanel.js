
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EntityIconItem=exports.EntityInfoItem=exports.PhotographEntityPanel=void 0;const UE=require("ue"),Log_1=require("../../../../Core/Common/Log"),PublicUtil_1=require("../../../Common/PublicUtil"),UiPanelBase_1=require("../../../Ui/Base/UiPanelBase"),LevelSequencePlayer_1=require("../../Common/LevelSequencePlayer"),GenericLayoutNew_1=require("../../Util/Layout/GenericLayoutNew"),LguiUtil_1=require("../../Util/LguiUtil"),PhotographController_1=require("../PhotographController");class PhotographEntityPanel extends UiPanelBase_1.UiPanelBase{constructor(){super(...arguments),this.MKi=void 0,this.EKi=void 0,this.SKi=new Map,this.yKi=new Map,this.qxt=(t,i,e)=>{var s=new EntityInfoItem;return s.SetRootActor(i.GetOwner(),!0),s.InitSpr(),s.Refresh(t),{Key:e,Value:s}}}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,UE.UIItem],[1,UE.UIVerticalLayout],[2,UE.UIItem],[3,UE.UIItem],[4,UE.UIItem],[5,UE.UIItem]]}OnStart(){this.MKi=new GenericLayoutNew_1.GenericLayoutNew(this.GetVerticalLayout(1),this.qxt),this.EKi=this.GetItem(5),PhotographController_1.PhotographController.CloseBlackScreen()}OnBeforeDestroy(){this.MKi&&(this.MKi.ClearChildren(),this.MKi=void 0),this.SKi.clear(),this.yKi.clear(),this.EKi=void 0}Refresh(i){this.SKi.clear();for(let t=0;t<i.length;t++)this.SKi.set(i[t].Text,t);this.MKi.RebuildLayoutByDataNew(i)}SetInfoPanelVisible(t){this.GetVerticalLayout(1).RootUIComp.SetUIActive(t)}UpdateIcons(t){t.length<=0&&this.yKi.forEach(t=>{this.Move(t,new UE.Vector2D(0,0),!0,!1,!1)});for(const e of t){var i;this.yKi.has(e.Id)?this.Move(this.yKi.get(e.Id),e.Vector,e.NotShow,e.IsOptional,e.IsOptionalFinished):((i=new EntityIconItem(LguiUtil_1.LguiUtil.CopyItem(this.EKi,this.GetItem(0)))).CreateByActorAsync(i.GetItsItem().GetOwner()),i?(i.SetUiActive(!0),i.InitSpr(),this.yKi.set(e.Id,i),this.Move(i,e.Vector,!0,e.IsOptional,e.IsOptionalFinished)):Log_1.Log.CheckInfo()&&Log_1.Log.Info("Photo",45,"tempUiItem为空",["名称：",e.Id]))}}Move(t,i,e,s,h){var o=t.GetItsItem();o.SetUIActive(!0),o.SetAnchorOffset(new UE.Vector2D(i.X,i.Y)),h||e?t.UpdateNowIcon(0):s?t.UpdateNowIcon(2):t.UpdateNowIcon(PhotographController_1.PhotographController.IsLastChecked?2:1)}GetInfoItemByDesc(t){t=this.SKi.get(t);if(void 0!==t)return this.MKi.GetLayoutItemByIndex(t)}}exports.PhotographEntityPanel=PhotographEntityPanel;class EntityInfoItem extends UiPanelBase_1.UiPanelBase{constructor(){super(),this.UiSequencePlayer=void 0,this.EDr=!1}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,UE.UIItem],[1,UE.UIItem],[2,UE.UIText]]}InitSpr(){this.UiSequencePlayer||(this.UiSequencePlayer=new LevelSequencePlayer_1.LevelSequencePlayer(this.GetRootItem())),this.UiSequencePlayer.StopCurrentSequence(!1,!0),this.UiSequencePlayer.PlayLevelSequenceByName("Fail"),this.EDr=!1}Refresh(t){var i=PublicUtil_1.PublicUtil.GetConfigTextByKey(t.Text);i?t.IsOptionFinished?this.SetTextLine(t.Text):this.GetText(2).SetText(i):this.RefreshFinishState(t.IsFinish)}RefreshFinishState(t){t&&!this.EDr?(this.UiSequencePlayer.StopCurrentSequence(!1,!0),this.UiSequencePlayer.PlayLevelSequenceByName("Complete"),this.EDr=!0):!t&&this.EDr&&(this.UiSequencePlayer.StopCurrentSequence(!1,!0),this.UiSequencePlayer.PlayLevelSequenceByName("Fail"),this.EDr=!1)}SetTextLine(t){t=PublicUtil_1.PublicUtil.GetConfigTextByKey(t);t&&(this.GetText(2).SetText("<s>"+t+"</s>"),this.UiSequencePlayer.StopCurrentSequence(!1,!0),this.UiSequencePlayer.PlayLevelSequenceByName("Complete"),this.UiSequencePlayer.StopCurrentSequence(!1,!0),this.EDr=!0)}}exports.EntityInfoItem=EntityInfoItem;class EntityIconItem extends UiPanelBase_1.UiPanelBase{constructor(t){super(),this.UiSequencePlayer=void 0,this.Item=void 0,this.ItsColor=0,this.Item=t,this.UiSequencePlayer=new LevelSequencePlayer_1.LevelSequencePlayer(t)}GetItsItem(){return this.Item}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,UE.UIItem],[1,UE.UIItem]]}InitSpr(){this.GetItem(0)?.SetUIActive(!1),this.GetItem(1)?.SetUIActive(!1)}UpdateNowIcon(t){switch(t){case 2:0===this.ItsColor?(this.UiSequencePlayer.StopCurrentSequence(!1,!0),this.UiSequencePlayer.PlayLevelSequenceByName("NtoG"),this.ItsColor=2):1===this.ItsColor&&(this.UiSequencePlayer.StopCurrentSequence(!1,!0),this.UiSequencePlayer.PlayLevelSequenceByName("YtoG"),this.ItsColor=2);break;case 1:0===this.ItsColor?(this.UiSequencePlayer.StopCurrentSequence(!1,!0),this.UiSequencePlayer.PlayLevelSequenceByName("NtoY"),this.ItsColor=1):2===this.ItsColor&&(this.UiSequencePlayer.StopCurrentSequence(!1,!0),this.UiSequencePlayer.PlayLevelSequenceByName("GtoY"),this.ItsColor=1);break;case 0:2===this.ItsColor?(this.UiSequencePlayer.StopCurrentSequence(!1,!0),this.UiSequencePlayer.PlayLevelSequenceByName("GtoN"),this.ItsColor=0):1===this.ItsColor&&(this.UiSequencePlayer.StopCurrentSequence(!1,!0),this.UiSequencePlayer.PlayLevelSequenceByName("YtoN"),this.ItsColor=0)}}}exports.EntityIconItem=EntityIconItem;
//# sourceMappingURL=PhotographEntityPanel.js.map