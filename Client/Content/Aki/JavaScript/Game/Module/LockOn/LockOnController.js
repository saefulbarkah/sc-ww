
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LockOnController=void 0;const UE=require("ue"),Protocol_1=require("../../../Core/Define/Net/Protocol"),QueryTypeDefine_1=require("../../../Core/Define/QueryTypeDefine"),Vector2D_1=require("../../../Core/Utils/Math/Vector2D"),TraceElementCommon_1=require("../../../Core/Utils/TraceElementCommon"),ModelManager_1=require("../../Manager/ModelManager"),HudUnitUtils_1=require("../HudUnit/Utils/HudUnitUtils"),PROFILE_KEY="LockOnController_IsBlock",SCENE_ITEM_ACTOR_KEY="Center";class LockOnController{static LockOnCircle(e,t,r){var o=[];ModelManager_1.ModelManager.CreatureModel.GetEntitiesInRange(t,63,o);let i=Number.MAX_VALUE,n=void 0;var c=e.D_K2_GetActorLocation();for(const u of o)if(this.IsValidLockOnTarget(u)){var s=u.Entity.GetComponent(0);switch(s?.GetEntityType()){case Protocol_1.Aki.Protocol.kks.Proto_Player:case Protocol_1.Aki.Protocol.kks.Proto_Npc:continue;case Protocol_1.Aki.Protocol.kks.Proto_SceneItem:if(void 0===u.Entity.GetComponent(143)||7!==s.GetBaseInfo().Camp)continue;break;case Protocol_1.Aki.Protocol.kks.Proto_Animal:case Protocol_1.Aki.Protocol.kks.Proto_Monster:if(this.CheckFriendCamp(s.GetBaseInfo().Camp))continue}var a=this.GetLockOnTargetLocation(u),l=HudUnitUtils_1.HudUnitUtils.PositionUtil.ProjectWorldToScreen(a,this.jma);if(l&&!(this.jma.Size()>r)){const t=c.op_Subtraction(a).Size();if(!(t>i)){l=this.Coi(e,c,a);if(l?.bBlockingHit){var a=u.Entity.GetComponent(1).Owner,l=l.Actors.Get(0),_=ModelManager_1.ModelManager.CreatureModel.GetEntityActorByChildActor(l);if(a!==l&&a!==_)continue}i=t,n=u}}}return n}static Coi(e,t,r){if(this.uoe||(this.uoe=UE.NewObject(UE.TraceLineElement.StaticClass()),this.uoe.bIsSingle=!0,this.uoe.bIgnoreSelf=!0,this.uoe.SetTraceTypeQuery(QueryTypeDefine_1.KuroTraceTypeQuery.IkGround)),this.uoe.WorldContextObject=e,TraceElementCommon_1.TraceElementCommon.SetStartLocation(this.uoe,t),TraceElementCommon_1.TraceElementCommon.SetEndLocation(this.uoe,r),TraceElementCommon_1.TraceElementCommon.LineTrace(this.uoe,PROFILE_KEY))return this.uoe.HitResult}static CheckFriendCamp(e){return 0===e||2===e||4===e}static GetLockOnTargetLocation(e){let t=void 0;var r=e.Entity.GetComponent(191);return t=(t=r&&(r=r.GetInteractionMainActor())&&(r=r.GetActorByKey(SCENE_ITEM_ACTOR_KEY))?r.D_K2_GetActorLocation():t)||e.Entity.GetComponent(1).ActorLocation}static IsValidLockOnTarget(e){var t;return!!e?.Valid&&!(!e?.IsInit||!e?.Entity?.Active||(t=e.Entity.GetComponent(0))?.GetRemoveState()||!t?.GetVisible()||(t=e.Entity.GetComponent(194))&&t.HasAnyTag([1008164187,-1243968098]))}}(exports.LockOnController=LockOnController).jma=new Vector2D_1.Vector2D,LockOnController.uoe=void 0;
//# sourceMappingURL=LockOnController.js.map