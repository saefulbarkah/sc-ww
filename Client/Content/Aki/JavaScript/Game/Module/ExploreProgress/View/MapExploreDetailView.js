
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MapExploreDetailView=void 0;const UE=require("ue"),Log_1=require("../../../../Core/Common/Log"),MathUtils_1=require("../../../../Core/Utils/MathUtils"),EventDefine_1=require("../../../Common/Event/EventDefine"),EventSystem_1=require("../../../Common/Event/EventSystem"),ConfigManager_1=require("../../../Manager/ConfigManager"),ModelManager_1=require("../../../Manager/ModelManager"),UiTickViewBase_1=require("../../../Ui/Base/UiTickViewBase"),PopupCaptionItem_1=require("../../../Ui/Common/PopupCaptionItem"),UiManager_1=require("../../../Ui/UiManager"),UiModel_1=require("../../../Ui/UiModel"),HelpController_1=require("../../Help/HelpController"),ScrollingTipsController_1=require("../../ScrollingTips/ScrollingTipsController"),UiNavigationNewController_1=require("../../UiNavigation/New/UiNavigationNewController"),LoopScrollView_1=require("../../Util/ScrollView/LoopScrollView"),ExploreProgressController_1=require("../ExploreProgressController"),MapAreaRewardPanel_1=require("./MapAreaRewardPanel"),MapExploreDetailItem_1=require("./MapExploreDetailItem"),MapExplorePlayProgressPanel_1=require("./MapExplorePlayProgressPanel");class MapExploreDetailView extends UiTickViewBase_1.UiTickViewBase{constructor(){super(...arguments),this.Nkl=void 0,this.Fkl=[],this.Vkl=0,this.Hkl=void 0,this.ExploreScroll=void 0,this.zJa=void 0,this.jkl=void 0,this.Wkl=void 0,this.Ekl=()=>{ExploreProgressController_1.ExploreProgressController.ReceiveAreaStageRewardAsyncRequest(this.Nkl.GetStageRewardDataList().filter(t=>1===t.State).map(t=>t.Id))},this._jl=()=>{var t=this.cjl(),t=(this.ExploreScroll?.ScrollToGridIndex(t),this.ExploreScroll?.DeselectCurrentGridProxy(!1),this.ExploreScroll?.SelectGridProxy(t),this.ExploreScroll?.UnsafeGetGridProxy(t));t&&UiNavigationNewController_1.UiNavigationNewController.SetNavigationFocusForView(t.GetBtnRootItem(),!0)},this.Qkl=()=>{return new MapExploreDetailItem_1.MapExploreDetailItem},this.Kkl=()=>{UiManager_1.UiManager.OpenView("MapAreaShowView",{CountryId:this.Nkl.CountryId,AreaId:this.Nkl.AreaId,OnClickArea:this.ujl})},this.$kl=()=>{UiManager_1.UiManager.OpenView("MapExploreStoryView",{AreaData:this.Nkl},this.N5l)},this.Xkl=()=>{var t=this.jkl?.GetPhantomSkillHelpId();t&&HelpController_1.HelpController.OpenHelpById(t)},this.Ykl=()=>{this.jkl&&UiManager_1.UiManager.OpenView("ExploreMissionView",this.jkl.AreaId,this.N5l)},this.zkl=()=>{UiManager_1.UiManager.OpenView("MapPlayPointDetailView",{ExploreAreaItemData:this.jkl},this.N5l)},this.N5l=(t,i)=>{t&&UiModel_1.UiModel.NormalStack.Peek().AddChildViewById(i)},this.Jkl=()=>{UiManager_1.UiManager.IsViewShow("WorldMapView")?this.jkl?.TrackPlayPoint():ModelManager_1.ModelManager.ExploreProgressModel.SetTrackExploreAreaItemData(this.jkl),this.CloseMe()},this.Zkl=()=>{this.CloseMe()},this.eOl=()=>{this.tOl(-1),this.PlaySequence("SwitchLeft")},this.iOl=()=>{this.tOl(1),this.PlaySequence("SwitchRight")},this.ujl=t=>{this.IsDestroyOrDestroying||(UiManager_1.UiManager.CloseView("MapAreaShowView"),this.Nkl?.AreaId!==t&&this.oOl(t)&&this.IsShow&&this.nOl())},this.sOl=t=>{this.Hkl?.UpdateRewardIds(t)},this.aOl=t=>{this.Nkl?.AreaId===t&&this.Hkl?.RefreshProgressBarDynamic(this.Nkl.GetProgress())},this.lOl=t=>{this.jkl=t,this.hOl()},this._Ol=t=>{this.Nkl?.AreaId===t&&this.hOl()},this.uOl=()=>{this.cOl()},this.djl=(t,i)=>{this.Nkl?.AreaId===t?this.mjl(i):this.Cjl(t,i)}}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,UE.UIItem],[1,UE.UIButtonComponent],[2,UE.UIButtonComponent],[3,UE.UILoopScrollViewComponent],[4,UE.UIButtonComponent],[5,UE.UIText],[6,UE.UIButtonComponent],[7,UE.UIItem],[8,UE.UIText],[9,UE.UIItem],[10,UE.UIButtonComponent],[11,UE.UITexture],[12,UE.UIText],[13,UE.UIItem],[14,UE.UIText],[15,UE.UIButtonComponent],[16,UE.UIItem],[17,UE.UIButtonComponent],[18,UE.UIButtonComponent],[19,UE.UIItem],[20,UE.UIItem],[21,UE.UIItem],[22,UE.UIItem],[23,UE.UIText],[24,UE.UIItem],[25,UE.UIText],[26,UE.UISprite],[27,UE.UIItem]],this.BtnBindInfo=[[1,this.eOl],[2,this.iOl],[4,this.$kl],[6,this.Kkl],[15,this.Xkl],[10,this.Ykl],[17,this.zkl],[18,this.Jkl]]}async OnBeforeStartAsync(){var t=this.OpenParam,i=t.AreaId;this.oOl(i)&&(this.Hkl=new MapAreaRewardPanel_1.MapAreaRewardPanel,await this.Hkl.CreateThenShowByActorAsync(this.GetItem(7).GetOwner()),this.Hkl.InitCommonRewardPopup(this.RootItem),this.zJa=new PopupCaptionItem_1.PopupCaptionItem(this.GetItem(0)),this.zJa.SetCloseCallBack(this.Zkl),this.Wkl=new MapExplorePlayProgressPanel_1.MapExplorePlayProgressPanel,await this.Wkl.Init(this.GetItem(16)),t?.ExploreType&&(this.jkl=this.Nkl.GetExploreAreaItemData(t.ExploreType)),this.InitExploreScroll())}OnStart(){this.GetText(25)?.SetText("0")}mOl(){this.Hkl?.ChangeParamData({InitValue:this.Nkl.GetProgress(),MaxValue:this.Nkl.MaxExploreProgress,RewardDataList:this.Nkl.GetStageRewardDataList(),GetRewardCallback:this.Ekl})}OnAddEventListener(){EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnReceiveAreaStageRewardResponse,this.sOl),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnAreaExploreProgressUpdate,this.aOl),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.MapExploreDetailItemClick,this.lOl),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.AreaPlayPointUpdate,this._Ol),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.AreaStoryProgressSave,this.uOl),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OpenExploreAreaDetailViewFromMap,this.djl)}OnRemoveEventListener(){EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnReceiveAreaStageRewardResponse,this.sOl),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnAreaExploreProgressUpdate,this.aOl),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.MapExploreDetailItemClick,this.lOl),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.AreaPlayPointUpdate,this._Ol),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.AreaStoryProgressSave,this.uOl),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OpenExploreAreaDetailViewFromMap,this.djl)}OnBeforeShow(){this.nOl()||this.CloseMe()}OnBeforeDestroy(){this.Hkl=void 0,this.zJa=void 0}InitExploreScroll(){var t=this.GetLoopScrollViewComponent(3);this.ExploreScroll=new LoopScrollView_1.LoopScrollView(t,this.GetItem(20).GetOwner(),this.Qkl)}dOl(){this.ExploreScroll?.RefreshByData(this.Nkl.GetAllExploreAreaItemData(),!1,this._jl,!0)}cjl(){var t=this.Nkl.GetAllExploreAreaItemData();let i=0;return-1===(i=this.jkl?t.findIndex(t=>t.ExploreType===this.jkl.ExploreType):i)&&(i=0,this.jkl=t[i]),i}tOl(t){var i=this.Fkl.length,t=this.Vkl+t;(t=MathUtils_1.MathUtils.Clamp(t,0,i-1))!==this.Vkl&&(this.Vkl=t,this.Nkl=this.Fkl[t],this.nOl())}nOl(){if(!this.Nkl)return!1;Log_1.Log.CheckDebug()&&Log_1.Log.Debug("ExploreProgress",69,"UpdateAreaData",["AreaId",this.Nkl.AreaId],["AreaName",ConfigManager_1.ConfigManager.TextConfig?.GetMultiTextByKey(this.Nkl.GetNameId())]),this.GetButton(1)?.RootUIComp.SetUIActive(0<this.Vkl),this.GetButton(2)?.RootUIComp.SetUIActive(this.Vkl<this.Fkl.length-1),this.Nkl.CheckUpdatePlayPointData(),this.COl(),this.mOl(),this.dOl();var t=this.Nkl.GetProgress();return this.GetSprite(26)?.SetFillAmount(t/100),this.gOl(),this.cOl(),!0}COl(){this.GetText(5)?.ShowTextNew(this.Nkl.GetNameId());var t=this.Nkl.GetProgress(),i=t+"%",i=(this.GetText(8)?.SetText(i),this.GetText(25));i.SetChangeColor(0<t,i.changeColor)}oOl(t){var i=ModelManager_1.ModelManager.ExploreProgressModel.GetExploreAreaData(t);return i?(this.Nkl=i,this.Fkl.length<=0&&(this.Fkl=ModelManager_1.ModelManager.ExploreProgressModel.GetAllAreaDataListSortCountryState(),this.Fkl.forEach(t=>{t.ClearFlagUpdatePlayPointData()})),this.Vkl=this.Fkl.findIndex(t=>t.AreaId===this.Nkl.AreaId),!0):(ScrollingTipsController_1.ScrollingTipsController.ShowTipsByText("Area Id Cannot Be Found: "+t),!1)}OnTick(t){this.Hkl?.OnTickRefresh(t)}mjl(t,i=!0){t&&t!==this.jkl.ExploreType&&(t=this.Nkl.GetExploreAreaItemData(t))&&(this.jkl=t,i)&&this._jl()}Cjl(t,i){this.oOl(t)&&(this.mjl(i,!1),this.nOl())}hOl(){var t,i=this.jkl.IsUnlocked();this.GetItem(21)?.SetUIActive(i),this.GetItem(22)?.SetUIActive(!i),i?(this.SetTextureByPath(this.jkl.DescBg,this.GetTexture(11)),this.GetText(12)?.ShowTextNew(this.jkl.DescId),i=this.jkl.IsCompleted(),t=this.jkl.HasPhantomSkill(),this.GetItem(24)?.SetUIActive(i),this.GetItem(13)?.SetUIActive(!i&&t),this.pOl(),t=this.jkl.IsShowTrackBtn&&!i,this.GetButton(18)?.RootUIComp.SetUIActive(t),i=this.GetText(14),(t=this.jkl.GetIsPhantomSkillUnlock()?this.jkl.GetUnlockTextId():this.jkl.GetLockTextId())&&i.ShowTextNew(t),i.SetUIActive(!!t),i=6===this.jkl.ExploreType,this.GetButton(10).RootUIComp.SetUIActive(i)):this.GetText(23)?.ShowTextNew(this.jkl.GetLockDetailId())}pOl(){var t=this.jkl.IsShowProgressBar;this.GetItem(19)?.SetUIActive(t),t&&(this.Wkl?.UpdateData(this.jkl.GetPlayProgressDataIgnoreHiddenList()),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.OnUpdateExploreProgressBar))}gOl(){for(const t of this.Fkl)if(t.AreaId!==this.Nkl.AreaId&&t.HasCanTakeStageReward())return void this.GetItem(9)?.SetUIActive(!0);this.GetItem(9)?.SetUIActive(!1)}cOl(){var t=this.Nkl.HasNewStoryUnlocked();this.GetItem(27)?.SetUIActive(t)}get IsShowProgressBar(){return this.jkl?.IsShowProgressBar}}exports.MapExploreDetailView=MapExploreDetailView;
//# sourceMappingURL=MapExploreDetailView.js.map