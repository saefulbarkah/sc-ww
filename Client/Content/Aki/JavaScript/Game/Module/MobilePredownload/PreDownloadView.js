
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PreDownloadView=void 0;const UE=require("ue"),CustomPromise_1=require("../../../Core/Common/CustomPromise"),TimerSystem_1=require("../../../Core/Timer/TimerSystem"),NetworkDefine_1=require("../../../Launcher/NetworkDefine"),PreDownloadManager_1=require("../../../Launcher/PreDownload/PreDownloadManager"),EventDefine_1=require("../../Common/Event/EventDefine"),EventSystem_1=require("../../Common/Event/EventSystem"),ConfigManager_1=require("../../Manager/ConfigManager"),ControllerHolder_1=require("../../Manager/ControllerHolder"),ModelManager_1=require("../../Manager/ModelManager"),UiViewBase_1=require("../../Ui/Base/UiViewBase"),ConfirmBoxDefine_1=require("../ConfirmBox/ConfirmBoxDefine"),PreDownloadDefine_1=require("./PreDownloadDefine");class PreDownloadView extends UiViewBase_1.UiViewBase{constructor(){super(...arguments),this.I5t=()=>{ControllerHolder_1.ControllerHolder.PreDownloadController.ClosePreDownloadView()},this.idc=()=>{ControllerHolder_1.ControllerHolder.PreDownloadController.OnModeChange()},this.rdc=()=>{ModelManager_1.ModelManager.PreDownloadModel.SwitchResumeOrPause()},this.odc=()=>{var e=ModelManager_1.ModelManager.PreDownloadModel.GetDownloadMode(),r=PreDownloadManager_1.PreDownloadManager.Get().IsDownloading(),e=ConfigManager_1.ConfigManager.TextConfig.GetMultiTextByKey(0===e?PreDownloadDefine_1.SPEEDMODE_TXT:PreDownloadDefine_1.NORMALMODE_TXT),r=ConfigManager_1.ConfigManager.TextConfig.GetMultiTextByKey(r?PreDownloadDefine_1.PAUSING_TXT:PreDownloadDefine_1.DOWNLOADING_TXT);this.GetText(8)?.SetText(e),this.GetText(9)?.SetText(r)}}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,UE.UIButtonComponent],[1,UE.UIButtonComponent],[2,UE.UIButtonComponent],[3,UE.UITexture],[4,UE.UIText],[5,UE.UIText],[6,UE.UITexture],[7,UE.UIText],[8,UE.UIText],[9,UE.UIText]],this.BtnBindInfo=[[0,this.I5t],[1,this.idc],[2,this.rdc]]}OnStart(){var e=ConfigManager_1.ConfigManager.UiResourceConfig.GetResourcePath(PreDownloadDefine_1.PREVIEW_BGID);this.SetTextureByPath(e,this.GetTexture(6)),PreDownloadManager_1.PreDownloadManager.Get().SetView(this)}OnBeforeShow(){this.Sdc()}OnAfterShow(){PreDownloadManager_1.PreDownloadManager.Get().IsDownloading()||(UE.KuroLauncherLibrary.GetNetworkConnectionType()===NetworkDefine_1.ENetworkType.Cell?ControllerHolder_1.ControllerHolder.PreDownloadController.OnCellNetTypeChanged():ModelManager_1.ModelManager.PreDownloadModel.GetHasStartDownload()||(ModelManager_1.ModelManager.PreDownloadModel.StartPreDownload(),this.odc()))}OnBeforeDestroy(){ModelManager_1.ModelManager.PreDownloadModel.ClearView()}OnAddEventListener(){EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.PreDownloadStateUpdate,this.odc)}OnRemoveEventListener(){EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.PreDownloadStateUpdate,this.odc)}async c2a(){return new Promise(e=>{TimerSystem_1.TimerSystem.Next(()=>{e()})})}async UpdatePatchDownProgress(e,r,o,n,a,i){var t=this.GetText(7),s=ConfigManager_1.ConfigManager.TextConfig.GetMultiTextByKey("PreDownload_Downloading");t?.SetText(s),this.GetTexture(3)?.SetFillAmount(r);this.GetText(5)?.SetText(o);t=`${n}(${a}/${i})  ${(100*r).toFixed(2).toString()}%`;this.GetText(4)?.SetText(t),1<=r&&e&&await this.c2a()}async BinPatchProgress(e,r,o){var n=this.GetText(7),a=ConfigManager_1.ConfigManager.TextConfig.GetMultiTextByKey("PreDownload_BinPatch");n?.SetText(a),this.GetTexture(3)?.SetFillAmount(r);this.GetText(5)?.SetText("");n=(100*r).toFixed(2).toString()+"%";this.GetText(4)?.SetText(n),1<=r&&e&&await this.c2a()}async ShowDialog(e,r,o,n,a,i,...t){r=ControllerHolder_1.ControllerHolder.PreDownloadController.GetLocalText(r),o=ControllerHolder_1.ControllerHolder.PreDownloadController.GetLocalText(o,...t);const s=new CustomPromise_1.CustomPromise;return i?((t=new ConfirmBoxDefine_1.ConfirmBoxDataNew(274)).SetTitle(r),t.SetTextArgs(o),t.SetBtnText(1,ControllerHolder_1.ControllerHolder.PreDownloadController.GetLocalText(i)),t.FunctionMap.set(1,()=>{s.SetResult(!0)}),ControllerHolder_1.ControllerHolder.ConfirmBoxController.ShowConfirmBoxNew(t)):((i=new ConfirmBoxDefine_1.ConfirmBoxDataNew(275)).SetTitle(r),i.SetTextArgs(o),i.SetBtnText(1,ControllerHolder_1.ControllerHolder.PreDownloadController.GetLocalText(n)),i.SetBtnText(2,ControllerHolder_1.ControllerHolder.PreDownloadController.GetLocalText(a)),i.FunctionMap.set(1,()=>{s.SetResult(!1)}),i.FunctionMap.set(2,()=>{s.SetResult(!0)}),ControllerHolder_1.ControllerHolder.ConfirmBoxController.ShowConfirmBoxNew(i)),s.Promise}Sdc(){this.odc();var e,r=ModelManager_1.ModelManager.PreDownloadModel.IsBinPatching(),o=this.GetText(7),n=this.GetTexture(3),a=this.GetText(5),i=this.GetText(4);r&&ModelManager_1.ModelManager.PreDownloadModel.BinPatch?(r=ModelManager_1.ModelManager.PreDownloadModel.BinPatch,e=ConfigManager_1.ConfigManager.TextConfig.GetMultiTextByKey("PreDownload_BinPatch"),o?.SetText(e),n?.SetFillAmount(r.Rate),a?.SetText(""),e=(100*r.Rate).toFixed(2).toString()+"%",i?.SetText(e)):ModelManager_1.ModelManager.PreDownloadModel.UpdateData?(r=ModelManager_1.ModelManager.PreDownloadModel.UpdateData,e=ConfigManager_1.ConfigManager.TextConfig.GetMultiTextByKey("PreDownload_Downloading"),o?.SetText(e),n?.SetFillAmount(r.Rate),a?.SetText(r.FileName),e=`${r.SpeedText}(${r.SizeCurrent}/${r.SizeTotal})  ${(100*r.Rate).toFixed(2).toString()}%`,i?.SetText(e)):(o?.SetText(""),n?.SetFillAmount(0),a?.SetText(""),i?.SetText(""))}}exports.PreDownloadView=PreDownloadView;
//# sourceMappingURL=PreDownloadView.js.map