
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PanelQteResultHandler=void 0;const Log_1=require("../../../Core/Common/Log"),Global_1=require("../../Global"),ModelManager_1=require("../../Manager/ModelManager"),CooperationController_1=require("../Battle/Cooperation/CooperationController");class PanelQteResultHandler{Handle(r){Log_1.Log.CheckDebug()&&Log_1.Log.Debug("PanelQte",17,"通用界面QTE结算",["qteId",r.QteId],["success",r.Success]);var a=r.Success?r.Config.SuccessActions:r.Config.FailActions,t=a.Num();for(let e=0;e<t;e++){var o=a.Get(e);this.kUe(o,r)}}kUe(e,t){let o=void 0;if(o=0===e.Target?t.GetSourceEntity():this.TOi()){let r=void 0,a=void 0;var l=e.AddTags,n=l.Num();for(let e=0;e<n;e++){var s=l.Get(e);(r=r??o.GetComponent(191)).AddTag(s.TagId)}var i=e.RemoveTags,v=i.Num();for(let e=0;e<v;e++){var d=i.Get(e);(r=r??o.GetComponent(191)).RemoveTag(d.TagId)}var _=e.AddBuffs,u=_.Num();if(0<u){var c=t.GetSourceEntity()?.GetComponent(0).GetCreatureDataId(),f=t.PreMessageId;if(c)if(0<=t.BuffIndex){var C=_.Get(t.BuffIndex);(a=a??o.GetComponent(160)).AddBuff(C,{InstigatorId:c,Reason:"界面QTE结算时添加",PreMessageId:f})}else for(let e=0;e<u;e++){var g=_.Get(e);(a=a??o.GetComponent(160)).AddBuff(g,{InstigatorId:c,Reason:"界面QTE结算时添加",PreMessageId:f})}}var M=e.CustomActions,p=M.Num();for(let e=0;e<p;e++){var h=M.Get(e);this.LOi(h,t,o)}}}LOi(e,r,a){switch(e){case 0:var t=a.GetComponent(160);t&&t.RemoveBuffByEffectType(36,"界面QTE解除冰冻buff");break;case 1:this.DOi();break;case 2:this.TOi()?.GetComponent(34)?.BeginSkill(100001,{Context:"PanelQteResultHandler.HandleCustomAction.Rush"});break;case 3:this.TOi()?.GetComponent(34)?.BeginSkill(100020,{Context:"PanelQteResultHandler.HandleCustomAction.Hook"});break;case 4:this.TOi()?.GetComponent(164)?.TryJumpInFreeRunning()}}DOi(){var e=ModelManager_1.ModelManager.SceneTeamModel.GetCurrentTeamItem;if(!e?.EntityHandle?.Entity?.GetComponent(191)?.HasTag(-1697149502)){var a=ModelManager_1.ModelManager.SceneTeamModel.GetTeamItems(),t=a.length,o=a.indexOf(e);for(let r=1;r<t;r++){let e=o+r;e>=t&&(e-=t);var l=a[e];if(0===l?.CanGoBattle())return void CooperationController_1.CooperationController.TryCooperate(l.GetCreatureDataId())}}}TOi(){var e=Global_1.Global.BaseCharacter;if(e?.IsValid())return e.CharacterActorComponent?.Entity}}exports.PanelQteResultHandler=PanelQteResultHandler;
//# sourceMappingURL=PanelQteResultHandler.js.map