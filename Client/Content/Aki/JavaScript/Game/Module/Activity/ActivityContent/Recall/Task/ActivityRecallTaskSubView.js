
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ActivityRecallTaskSubView=void 0;const UE=require("ue"),TimerSystem_1=require("../../../../../../Core/Timer/TimerSystem"),TimeUtil_1=require("../../../../../Common/TimeUtil"),ConfigManager_1=require("../../../../../Manager/ConfigManager"),ModelManager_1=require("../../../../../Manager/ModelManager"),ExploreProgressController_1=require("../../../../ExploreProgress/ExploreProgressController"),GenericLayout_1=require("../../../../Util/Layout/GenericLayout"),DynScrollView_1=require("../../../../Util/ScrollView/DynScrollView"),ActivityRecallDefine_1=require("../ActivityRecallDefine"),ActivityRecallTaskDynamicItem_1=require("./ActivityRecallTaskDynamicItem"),ActivityRecallTaskDynamicScrollItem_1=require("./ActivityRecallTaskDynamicScrollItem"),ActivityRecallTaskHorItemPanel_1=require("./ActivityRecallTaskHorItemPanel");class ActivityRecallTaskSubView extends ActivityRecallDefine_1.ActivityMainSubViewBase{constructor(){super(...arguments),this.VZt=void 0,this.fma=void 0,this.vma=void 0,this.sma=void 0,this.pma=void 0,this.Mma=(e,i,t)=>{var r=new ActivityRecallTaskDynamicScrollItem_1.ActivityRecallTaskDynamicScrollItem;return this.fma.push(r),r},this.Sma=()=>{return new ActivityRecallTaskHorItemPanel_1.ActivityRecallTaskHorItemPanel},this.kOe=()=>{this.mGe()}}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,UE.UIDynScrollViewComponent],[1,UE.UIText],[2,UE.UIHorizontalLayout],[3,UE.UIItem],[4,UE.UIText]]}async OnBeforeStartAsync(){this.fma=[],this.VZt=new DynScrollView_1.DynamicScrollView(this.GetUIDynScrollViewComponent(0),this.GetItem(3),new ActivityRecallTaskDynamicItem_1.ActivityRecallTaskDynamicItem,this.Mma),await ExploreProgressController_1.ExploreProgressController.AllExploreProgressAsyncRequest(),await this.VZt.Init()}OnBeforeShow(){super.OnBeforeShow(),this.sma=TimerSystem_1.RealTimeTimerSystem.Forever(this.kOe,TimeUtil_1.TimeUtil.InverseMillisecond)}OnAfterHide(){super.OnAfterHide(),this.jm()}OnBeforeDestroy(){this.VZt&&(this.VZt.ClearChildren(),this.VZt=void 0),this.fma=void 0}jm(){TimerSystem_1.RealTimeTimerSystem.Has(this.sma)&&(TimerSystem_1.RealTimeTimerSystem.Remove(this.sma),this.sma=void 0)}OnStart(){super.OnStart(),this.pma=new GenericLayout_1.GenericLayout(this.GetHorizontalLayout(2),this.Sma)}Ema(){var e=this.GetText(4),i=this.ActivityRecallData.GetRecallTaskScore();e.SetText("x"+i),this.vma=this.vma??[],ConfigManager_1.ConfigManager.ActivityRecallConfig.GetAllRecallScoreRewardConfigList().forEach((e,i)=>{i>=this.vma.length&&this.vma.push(new ActivityRecallDefine_1.ActivityRecallTaskScoreRewardGridData);i=this.vma[i];i.Config=e,i.RewardState=this.ActivityRecallData.GetRecallTaskScoreRewardState(e)}),this.pma.RefreshByData(this.vma)}yma(){var e=this.Ima();this.VZt.RefreshByData(e)}mGe(){var e=this.GetText(1),[i,t]=ModelManager_1.ModelManager.ActivityModel.GetTimeVisibleAndRemainTime(this.ActivityRecallData);e.SetText(t),e.SetUIActive(i)}Ima(){var e=[],i=this.ActivityRecallData.GetRecallTaskConfigMap();for(const s in ActivityRecallDefine_1.EActivityRecallTaskType){var t=Number(s),r=i.get(t);void 0!==r&&0<r.length&&this.Tma(e,t,r)}return e}Tma(t,r,e){var i=new ActivityRecallDefine_1.ActivityRecallTaskDynamicData,i=(i.ItemType=0,i.TaskType=r,t.push(i),[...e]);i.sort((e,i)=>{return this.ActivityRecallData.GetTaskRewardShowPriority(e.Id)-this.ActivityRecallData.GetTaskRewardShowPriority(i.Id)}),i.forEach(e=>{var i=new ActivityRecallDefine_1.ActivityRecallTaskDynamicData;i.ItemType=1,i.TaskType=r,i.Config=e,t.push(i)})}OnRefreshByData(e){this.Og()}Og(){this.Ema(),this.yma(),this.mGe()}}exports.ActivityRecallTaskSubView=ActivityRecallTaskSubView;
//# sourceMappingURL=ActivityRecallTaskSubView.js.map