
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FishingDockView=void 0;const UE=require("ue"),StringUtils_1=require("../../../../../../Core/Utils/StringUtils"),EventDefine_1=require("../../../../../Common/Event/EventDefine"),EventSystem_1=require("../../../../../Common/Event/EventSystem"),ConfigManager_1=require("../../../../../Manager/ConfigManager"),ModelManager_1=require("../../../../../Manager/ModelManager"),RedDotController_1=require("../../../../../RedDot/RedDotController"),UiViewBase_1=require("../../../../../Ui/Base/UiViewBase"),PopupCaptionItem_1=require("../../../../../Ui/Common/PopupCaptionItem"),UiManager_1=require("../../../../../Ui/UiManager"),LevelSequencePlayer_1=require("../../../../Common/LevelSequencePlayer"),LguiUtil_1=require("../../../../Util/LguiUtil"),ActivityFishingController_1=require("../Activity/ActivityFishingController"),FishingRewardLimitTimeButton_1=require("../Activity/View/Components/FishingRewardLimitTimeButton"),FishingController_1=require("../FishingController"),FishingDefine_1=require("../FishingDefine"),FishingCurrencyItem_1=require("./FishingCurrencyItem"),FishingDockQuestItem_1=require("./FishingDockQuestItem"),FishingDockReputationItem_1=require("./FishingDockReputationItem"),FishingPermanentRewardButton_1=require("./FishingPermanentRewardButton");class FishingDockView extends UiViewBase_1.UiViewBase{constructor(){super(...arguments),this.lqe=void 0,this.Pd_=void 0,this.wd_=void 0,this.Atl=void 0,this.nx_=void 0,this.GV_=void 0,this.J9_=void 0,this.Awe=()=>{FishingController_1.FishingController.IsInFishingShip()?FishingController_1.FishingController.ConfirmToTeleportToPort(()=>{FishingController_1.FishingController.TeleportToPortPosition(ModelManager_1.ModelManager.FishingModel.DockId),UiManager_1.UiManager.OpenView("FishingLoadingView",!1,()=>{this.CloseMe()})}):UiManager_1.UiManager.OpenView("FishingLoadingView",!1,()=>{this.CloseMe()})},this.nZl=()=>{UiManager_1.UiManager.OpenView("SailingView")},this.hZl=()=>{FishingController_1.FishingController.OpenFishingHandBookView()},this.lZl=()=>{FishingController_1.FishingController.OpenDockyardView()},this._Zl=()=>{FishingController_1.FishingController.OpenFishingTechRootView()},this.cZl=()=>{FishingController_1.FishingController.OpenDockyardShopView()},this.Ux_=()=>{this.eQ_()}}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,UE.UIItem],[1,UE.UIItem],[2,UE.UIItem],[3,UE.UIItem],[4,UE.UIItem],[5,UE.UIText],[6,UE.UIItem],[7,UE.UIText],[8,UE.UIButtonComponent],[9,UE.UIText],[10,UE.UIButtonComponent],[11,UE.UIText],[12,UE.UIButtonComponent],[13,UE.UIText],[14,UE.UIButtonComponent],[15,UE.UIButtonComponent],[16,UE.UIText],[17,UE.UIItem],[18,UE.UIItem]],this.BtnBindInfo=[[8,this.hZl],[10,this.lZl],[12,this._Zl],[14,this.cZl],[15,this.nZl]]}OnAddEventListener(){EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.FishingRefreshBackpackData,this.Ux_)}OnRemoveEventListener(){EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.FishingRefreshBackpackData,this.Ux_)}async OnBeforeStartAsync(){this.wd_=new FishingDockReputationItem_1.FishingDockReputationItem,await this.wd_.CreateThenShowByActorAsync(this.GetItem(1).GetOwner()),this.Pd_=new FishingDockQuestItem_1.FishingDockQuestItem,await this.Pd_.CreateThenShowByActorAsync(this.GetItem(2).GetOwner());var i=ActivityFishingController_1.ActivityFishingController.GetCurrentActivityData(),e=this.GetItem(6),i=(i?(this.Atl=new FishingRewardLimitTimeButton_1.FishingRewardLimitTimeButton(i),await this.Atl.CreateByActorAsync(e.GetOwner())):e.SetUIActive(!1),this.GetItem(4));this.nx_=new FishingPermanentRewardButton_1.FishingPermanentRewardButton,await this.nx_.CreateByActorAsync(i.GetOwner()),this.AddChild(this.nx_),this.lqe=new PopupCaptionItem_1.PopupCaptionItem(this.GetItem(0)),this.lqe.SetCloseCallBack(this.Awe),this.J9_=new FishingCurrencyItem_1.FishingCurrencyItem,await this.J9_.CreateThenShowByResourceIdAsync("UIItem_CommonCurrencyItem",this.lqe.GetCostContent()),this.GV_=new LevelSequencePlayer_1.LevelSequencePlayer(this.GetItem(3)),FishingController_1.FishingController.HideEffectInWorld()}OnStart(){this.Atl?.RefreshActive(),this.GV_?.PlayLevelSequenceByName("Start"),RedDotController_1.RedDotController.BindRedDot("FishingTech",this.GetItem(17))}OnBeforeShow(){this.Og(),this.Atl?.RefreshActive(),this.C8_(),this.z8_(),this.J9_?.RefreshItem()}OnBeforeDestroy(){ModelManager_1.ModelManager.FishingModel.DockId=0,RedDotController_1.RedDotController.UnBindGivenUi("FishingTech",this.GetItem(17)),FishingController_1.FishingController.ShowEffectInWorld()}C8_(){var i=ModelManager_1.ModelManager.DockyardModel.ShopId,i=ModelManager_1.ModelManager.PayShopModel.CheckShopItemCheckFlag(i);this.GetItem(18).SetUIActive(i)}Og(){this.Pd_?.RefreshItem(),this.wd_?.RefreshItem();var i=ModelManager_1.ModelManager.FunctionModel.IsOpen(10077),i=(this.GetButton(14)?.RootUIComp.SetUIActive(i),this.eQ_(),ModelManager_1.ModelManager.FunctionModel.IsOpen(10078)),i=(this.GetButton(12)?.RootUIComp.SetUIActive(i),ModelManager_1.ModelManager.FishingModel.AllFishingTechCount),e=ModelManager_1.ModelManager.FishingModel.UnlockFishingTechCount,e=(this.GetText(13).SetText(e+"/"+i),ModelManager_1.ModelManager.FunctionModel.IsOpen(10079)),i=(this.GetButton(8)?.RootUIComp.SetUIActive(e),this.nx_?.SetUiActive(e),ModelManager_1.ModelManager.FishingModel.AllFishingItemCount),e=ModelManager_1.ModelManager.FishingModel.UnLockFishingItemCount,e=(this.GetText(9).SetText(e+"/"+i),ModelManager_1.ModelManager.FishingModel.RoleTalkIds);e?.sort((i,e)=>e-i),e&&e[0]?(this.GetItem(3).SetUIActive(!0),i=ConfigManager_1.ConfigManager.FishingConfig.GetFishingNotice(e[0]),LguiUtil_1.LguiUtil.SetLocalTextNew(this.GetText(16),i.AlertTip)):this.GetItem(3).SetUIActive(!1)}z8_(){ModelManager_1.ModelManager.FishingModel.RefreshTechCanLevelUp()}eQ_(){var i=ModelManager_1.ModelManager.DockyardModel.BackpackSize,e=ModelManager_1.ModelManager.DockyardModel.BackpackUseSize,t=e/i*100>=ModelManager_1.ModelManager.FishingModel.FishingBagRedPercentage;let n="";n=t?StringUtils_1.StringUtils.Format(FishingDefine_1.FISHING_TECH_MATERIAL_NOT_ENOUGHT,e+""):StringUtils_1.StringUtils.Format(FishingDefine_1.FISHING_TECH_MATERIAL_WHITE_ENOUGHT,e+""),this.GetText(11).SetText(n+"/"+i)}}exports.FishingDockView=FishingDockView;
//# sourceMappingURL=FishingDockView.js.map