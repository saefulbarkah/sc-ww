
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ActivityRecallSubView=void 0;const UE=require("ue"),EventDefine_1=require("../../../../Common/Event/EventDefine"),EventSystem_1=require("../../../../Common/Event/EventSystem"),ModelManager_1=require("../../../../Manager/ModelManager"),RedDotController_1=require("../../../../RedDot/RedDotController"),UiManager_1=require("../../../../Ui/UiManager"),ButtonItem_1=require("../../../Common/Button/ButtonItem"),ActivitySubViewBase_1=require("../../View/SubView/ActivitySubViewBase"),ActivityDescriptionTypeA_1=require("../UniversalComponents/Content/ActivityDescriptionTypeA"),ActivityTitleTypeA_1=require("../UniversalComponents/Title/ActivityTitleTypeA"),ActivityRecallHelper_1=require("./Misc/ActivityRecallHelper"),ActivityRecallEntryItemPanel_1=require("./Panels/ActivityRecallEntryItemPanel");class ActivityRecallSubView extends ActivitySubViewBase_1.ActivitySubViewBase{constructor(){super(...arguments),this.LNe=void 0,this.lda=void 0,this.iCa=void 0,this.uPa=void 0,this.Ida=new Map,this.Tda=()=>{UiManager_1.UiManager.OpenView("ActivityRecallMainView",5)},this.Lda=()=>{UiManager_1.UiManager.OpenView("ActivityRecallMainView",4)},this.Rda=()=>{var t=this.lda.GetRecallTaskProgressFloat01();this.GetText(5).SetText(100*t+"%"),this.GetTexture(7).SetFillAmount(t)},this.itt=()=>{this.bNe(),this.lda&&this.OnRefreshView()},this.TDa=()=>{this.lda&&this.Rda()}}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,UE.UIItem],[1,UE.UIItem],[2,UE.UIItem],[3,UE.UIItem],[4,UE.UIItem],[5,UE.UIText],[6,UE.UIItem],[7,UE.UITexture],[8,UE.UIItem],[9,UE.UIButtonComponent],[10,UE.UIItem]],this.BtnBindInfo=[[9,this.Tda]]}async OnBeforeStartAsync(){var t=this.GetItem(0),e=(this.LNe=new ActivityTitleTypeA_1.ActivityTitleTypeA,this.GetItem(8)),e=(this.uPa=new ButtonItem_1.ButtonItem(e),this.uPa.SetFunction(this.Lda),this.Ida.set(1,new ActivityRecallEntryItemPanel_1.ActivityRecallEntryItemPanel),this.Ida.set(2,new ActivityRecallEntryItemPanel_1.ActivityRecallEntryItemPanel),this.Ida.set(3,new ActivityRecallEntryItemPanel_1.ActivityRecallEntryItemPanel),this.GetItem(3).GetOwner()),i=this.GetItem(2).GetOwner(),s=this.GetItem(4).GetOwner(),n=this.GetItem(6).GetOwner();this.iCa=new ActivityDescriptionTypeA_1.ActivityDescriptionTypeA,await Promise.all([this.LNe.CreateThenShowByActorAsync(t.GetOwner()),ActivityRecallHelper_1.ActivityRecallHelper.ActivityRecallController.RequestGachaInfo(),this.iCa.CreateThenShowByActorAsync(n),this.Ida.get(1).CreateByActorAsync(e),this.Ida.get(2).CreateByActorAsync(i),this.Ida.get(3).CreateByActorAsync(s)])}OnStart(){this.iCa.SetContentByTextId("Activity_101800001_Desc"),RedDotController_1.RedDotController.BindRedDot("ActivityRecallSignEntry",this.GetItem(10)),this.uPa.BindRedDot("ActivityRecallTask")}OnBeforeDestroy(){for(var[,t]of this.Ida)t.DestroyAsync();this.Ida.clear(),RedDotController_1.RedDotController.UnBindGivenUi("ActivityRecallSignEntry",this.GetItem(10)),this.uPa.UnBindRedDot()}OnRefreshView(){this.bNe(),this.mGe(),this.Dda(),this.Rda()}OnTimer(t){this.mGe()}OnAddEventListener(){EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.RecallActivityInfoUpdate,this.itt),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnCommonItemCountAnyChange,this.TDa)}OnRemoveEventListener(){EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.RecallActivityInfoUpdate,this.itt),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnCommonItemCountAnyChange,this.TDa)}mGe(){this.LNe.SetTitleByText(this.lda.GetTitle());var[t,e]=ModelManager_1.ModelManager.ActivityModel.GetTimeVisibleAndRemainTime(this.lda);this.LNe.SetTimeTextVisible(t),t&&this.LNe.SetTimeTextByText(e)}Dda(){this.Ada(1),this.Ada(2),this.Uda()}Ada(t){var e=ModelManager_1.ModelManager.ActivityRecallModel.GetRecallEntryConfigByEntryType(t);this.Ida.get(t).RefreshData(t,e)}Uda(){var t=ActivityRecallHelper_1.ActivityRecallHelper.GetSortedOpenRecallEntryConfigList()[0];this.Ida.get(3).RefreshData(3,t)}bNe(){this.lda=ActivityRecallHelper_1.ActivityRecallHelper.ActivityRecallData}}exports.ActivityRecallSubView=ActivityRecallSubView;
//# sourceMappingURL=ActivityRecallSubView.js.map