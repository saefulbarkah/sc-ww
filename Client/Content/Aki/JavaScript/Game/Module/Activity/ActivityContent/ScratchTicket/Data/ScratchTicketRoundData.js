
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ScratchTicketRoundData=void 0;const MathUtils_1=require("../../../../../../Core/Utils/MathUtils"),TimeUtil_1=require("../../../../../Common/TimeUtil"),ConfigManager_1=require("../../../../../Manager/ConfigManager"),ModelManager_1=require("../../../../../Manager/ModelManager"),RewardItemData_1=require("../../../../ItemReward/RewardData/RewardItemData"),ActivityScratchTicketDefine_1=require("../ActivityScratchTicketDefine"),ScratchTicketCellData_1=require("./ScratchTicketCellData");class ScratchTicketRoundData{constructor(){this.Id=0,this.Dol=0,this.Config=void 0,this.Rol=[],this.Y2i=0,this.Aol=[],this.xol=0,this.ull=new Map,this.f7=0,this.UCl=void 0}Init(t){this.Id=t.gol,this.Config=ConfigManager_1.ConfigManager.ActivityScratchTicketConfig.GetScratchTicketRoundConfig(this.Id),void 0!==this.Config&&(this.f7=this.Config.Size*this.Config.Size,this.Dol=Number(MathUtils_1.MathUtils.LongToBigInt(t.yzs)),this.Pol(),this.cll(),this.UpdateCellDataReward(t.myl),this.UpdateRemainReward(t.Cyl))}Pol(){this.Rol=[];for(let t=0;t<this.f7;t++){var e=new ScratchTicketCellData_1.ScratchTicketCellData(t);this.Rol.push(e)}}cll(){this.ull.clear(),this.Config.RewardSortList.forEach((t,e)=>{this.ull.set(t,e)})}UpdateCellDataReward(t){for(const i of Object.keys(t)){var e=Number.parseInt(i);e<0||e>=this.Rol.length||(this.Rol[e].SetRewardItem(t[i]),this.Y2i++)}}UpdateRemainReward(t){this.Aol=[];for(const r of Object.keys(t)){var e=Number.parseInt(r),i=t[r];this.Aol.push([{ItemId:e,IncId:0},i])}this.Aol.sort((t,e)=>{return(this.ull.get(t[0].ItemId)??Number.MAX_VALUE)-(this.ull.get(e[0].ItemId)??Number.MAX_VALUE)})}UpdateRoundState(t){TimeUtil_1.TimeUtil.GetServerTimeStamp()<=this.Dol||2!==t?this.xol=0:this.Y2i>=this.Config.Size*this.Config.Size?this.xol=2:this.xol=1}GetUnlockTime(){return this.Dol}GetPreRoundState(){var t=ModelManager_1.ModelManager.ActivityScratchTicketModel.GetScratchRoundData(this.Config.PreRoundId);return void 0===t?2:t.GetRoundState()}GetRoundState(){return this.xol}GetCellDataList(){return this.Rol}GetRemainRewardList(){return this.Aol}GetRewardDataList(t){var e=[];for(const s of Object.keys(t)){var i=Number.parseInt(s),r=t[s],i=new RewardItemData_1.RewardItemData(i,r);e.push(i)}return e.sort((t,e)=>{return(this.ull.get(t.ConfigId)??Number.MAX_VALUE)-(this.ull.get(e.ConfigId)??Number.MAX_VALUE)}),e}GetRewardResultList(t,e){if(!this.wol(t))return[];switch(e){case 0:return this.Bol(t,ActivityScratchTicketDefine_1.FIRST_SHOW_REWARD_INTERVAL,"HamsterA");case 1:return this.bol(t);case 3:return this.qol(t);case 2:return this.Gol(t);case 5:return this.Ool(t);case 4:return this.kol(t);case 6:return this.Nol(t);default:return[]}}Bol(t,e,i){var r=[];return this.wol(t)&&(t=this.Fol(t,0,!0),t=this.Ldl([t],e,i),r.push(t)),r}bol(t){var e=this.Bol(t,ActivityScratchTicketDefine_1.HAMSTER_B_SEQUENCE_INTERVAL,"HamsterB");return this.Rdl(e,t,!1),this.Rdl(e,t,!0),e}Rdl(t,e,i){var r=[];this.Vol(r,e,1,i),this.Vol(r,e,2,i),this.Vol(r,e,3,i),this.Vol(r,e,4,i),r.length<=0||(e=this.Udl(!1,!i),i=this.Ldl(r,e),t.push(i))}kol(t){var e=this.Bol(t,ActivityScratchTicketDefine_1.HAMSTER_B_SEQUENCE_INTERVAL,"HamsterB");return this.Ddl(e,t,!1),this.Ddl(e,t,!0),e}Ddl(t,e,i){var r=[];this.Vol(r,e,1,i),this.Vol(r,e,2,i),this.Vol(r,e,3,i),this.Vol(r,e,4,i),this.Vol(r,e,5,i),this.Vol(r,e,6,i),this.Vol(r,e,7,i),this.Vol(r,e,8,i),r.length<=0||(e=this.Udl(!1,!i),i=this.Ldl(r,e),t.push(i))}qol(t){var e=this.Bol(t,ActivityScratchTicketDefine_1.HAMSTER_B_SEQUENCE_INTERVAL,"HamsterB");return this.Adl(e,t,!1),this.Adl(e,t,!0),e}Adl(t,e,i){var r=[];this.xdl(r,e,1,i),this.xdl(r,e,2,i),this.jol(t,r,i)}Gol(t){var e=this.Bol(t,ActivityScratchTicketDefine_1.HAMSTER_B_SEQUENCE_INTERVAL,"HamsterB");return this.Pdl(e,t,!1),this.lgl(e,ActivityScratchTicketDefine_1.TOUCH_BOUNDARY_INTERVAL,"InnerGlow"),this.Pdl(e,t,!0),e}Pdl(t,e,i){var r=[];this.xdl(r,e,3,i),this.xdl(r,e,4,i),this.jol(t,r,i)}Ool(t){var e=this.Bol(t,ActivityScratchTicketDefine_1.HAMSTER_B_SEQUENCE_INTERVAL,"HamsterB");return this.wdl(e,t,!1),this.lgl(e,ActivityScratchTicketDefine_1.TOUCH_BOUNDARY_INTERVAL,"InnerGlow"),this.wdl(e,t,!0),e}wdl(t,e,i){var r=[];this.xdl(r,e,3,i),this.xdl(r,e,4,i),this.xdl(r,e,1,i),this.xdl(r,e,2,i),this.jol(t,r,i)}Nol(t){t=this.Bol(t,ActivityScratchTicketDefine_1.HAMSTER_C_SEQUENCE_INTERVAL,"HamsterC");return this.Bdl(t,!1),this.lgl(t,ActivityScratchTicketDefine_1.TOUCH_BOUNDARY_INTERVAL,"InnerGlow"),this.Bdl(t,!0),t}Bdl(t,e){var i,r,s=[];for(const a of this.GetCellDataList())e&&!a.IsLock()||(i=this.Fol(a.Index,0,!0),s.push(i));0<s.length&&(r=this.Udl(!1,!e),r=this.Ldl(s,r),t.push(r))}jol(t,e,i){let r=e;for(var s=this.Udl(!1,!i);0<r.length;){var a=this.Ldl(r,s),h=(t.push(a),[]);for(const n of r)this.xdl(h,n.Index,n.DirectionType,i);r=h}}xdl(t,e,i,r){let s=e;do{s=this.Wol(s,i);var a=this.GetCellDataByIndex(s);if(void 0!==a)if(!r||a.IsLock())return a=this.Fol(s,i,r),void t.push(a)}while(0<=s)}Vol(t,e,i,r){var e=this.Wol(e,i),s=this.GetCellDataByIndex(e);void 0===s||r&&!s.IsLock()||(s=this.Fol(e,i,r),t.push(s))}lgl(t,e,i){e=this.Ldl([],e,i);t.push(e)}GetDiagonalResultList(){if(void 0===this.UCl){this.UCl=[];var e=this.Config.Size;for(let t=0;t<2*e;t++)this.DCl(this.UCl,t)}return this.UCl}DCl(t,e){var i=[];for(let t=0;t<=e;t++){var r=e-t,r=this.ACl(t,r);r<0||i.push({Index:r,DirectionType:0,SequenceType:7})}var s=this.Ldl(i,ActivityScratchTicketDefine_1.REVEAL_DELAY_INTERVAL);t.push(s)}wol(t,e=0){return 0<=t&&t<this.f7}Ldl(t,e,i="Empty"){return{RewardList:t,DelayInterval:e,SequenceName:i}}Fol(t,e,i){return{Index:t,DirectionType:e,SequenceType:i?ActivityScratchTicketDefine_1.directionToSequenceMap.get(e):6}}Udl(t,e){return t?ActivityScratchTicketDefine_1.FIRST_SHOW_REWARD_INTERVAL:e?ActivityScratchTicketDefine_1.CELL_SHOW_WARNING_INTERVAL:ActivityScratchTicketDefine_1.CELL_SHOW_REWRD_INTERVAL}GetCellDataByIndex(t){if(this.wol(t))return this.Rol[t]}ACl(t,e){var i=this.Config.Size;return e<0||i<=e||t<0||i<=t?-1:t*i+e}Wol(t,e){var i=this.Config.Size;let r=t%i,s=Math.floor(t/i);switch(e){case 0:break;case 3:s--;break;case 4:s++;break;case 1:r--;break;case 2:r++;break;case 5:s--,r--;break;case 6:s++,r--;break;case 7:s--,r++;break;case 8:s++,r++}return this.ACl(s,r)}}exports.ScratchTicketRoundData=ScratchTicketRoundData;
//# sourceMappingURL=ScratchTicketRoundData.js.map