
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FishingTimeLimitView=void 0;const UE=require("ue"),EventDefine_1=require("../../../../../../Common/Event/EventDefine"),EventSystem_1=require("../../../../../../Common/Event/EventSystem"),TimeUtil_1=require("../../../../../../Common/TimeUtil"),ControllerHolder_1=require("../../../../../../Manager/ControllerHolder"),ModelManager_1=require("../../../../../../Manager/ModelManager"),PreloadConfigStatementPart4_1=require("../../../../../../Preload/PreloadConfigStatementPart4"),UiTickViewBase_1=require("../../../../../../Ui/Base/UiTickViewBase"),PopupCaptionItem_1=require("../../../../../../Ui/Common/PopupCaptionItem"),TabViewComponent_1=require("../../../../../Common/TabComponent/TabViewComponent"),ActivityFishingController_1=require("../ActivityFishingController"),FishingRewardMainTabItem_1=require("./Components/FishingRewardMainTabItem");class FishingTimeLimitView extends UiTickViewBase_1.UiTickViewBase{constructor(){super(...arguments),this.CaptionItem=void 0,this.TabItemList=[],this.TabViewComponent=void 0,this.ActivityDataBase=void 0,this.yvt=[],this.Ntl=!0,this.Ftl="",this.Cua=0,this.jFi=()=>{var i=this.ActivityDataBase.GetTimeLimitRewardRedDotState(),t=this.ActivityDataBase.GetLimitTimeShopRedDotState();this.TabItemList[0].SetRedDotVisible(i),this.TabItemList[1].SetRedDotVisible(t)},this.pqe=i=>{i!==this.Cua&&this.dx_(this.Cua,!1,!0),this.Cua=i;var t=this.yvt[i];this.P6e(t,i)}}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,UE.UIItem],[1,UE.UIItem],[2,UE.UIItem],[3,UE.UIItem],[4,UE.UIText]]}async OnBeforeStartAsync(){var i;this.ActivityDataBase=ActivityFishingController_1.ActivityFishingController.GetCurrentActivityData(),this.ActivityDataBase&&((i=[]).push(this.zDn()),i.push(this.qvt()),i.push(ControllerHolder_1.ControllerHolder.PayShopController.SendRequestPayShopInfo(!0)),this.Gvt(),this.mx_(),await Promise.all(i))}async zDn(){this.CaptionItem=new PopupCaptionItem_1.PopupCaptionItem(this.GetItem(0)),await this.CaptionItem.SetCurrencyItemList([this.ActivityDataBase.MilestoneRewardItemId]),this.CaptionItem.SetCloseCallBack(()=>{this.CloseMe()})}async qvt(){var i=new FishingRewardMainTabItem_1.FishingRewardMainTabItem,t=(this.TabItemList.push(i),i.TabIndex=0,i.SetSelectedCallBack(this.pqe),new FishingRewardMainTabItem_1.FishingRewardMainTabItem);this.TabItemList.push(t),t.TabIndex=1,t.SetSelectedCallBack(this.pqe),await Promise.all([i.CreateThenShowByActorAsync(this.GetItem(2).GetOwner()),t.CreateThenShowByActorAsync(this.GetItem(3).GetOwner())]),this.jFi()}Gvt(){this.TabViewComponent=new TabViewComponent_1.TabViewComponent(this.GetItem(1))}OnStart(){this.Ftl=PreloadConfigStatementPart4_1.configMultiTextLang.GetLocalTextNew("ActivityRemainingTime"),this.u3e()}OnBeforeShow(){this.jFi()}OnAddEventListener(){EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.FishingTimeLimitRewardListRefresh,this.jFi),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.FishingTimeLimitRewardProgressRefresh,this.jFi),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.FishingTimeLimitShopRefresh,this.jFi)}OnRemoveEventListener(){EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.FishingTimeLimitRewardListRefresh,this.jFi),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.FishingTimeLimitRewardProgressRefresh,this.jFi),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.FishingTimeLimitShopRefresh,this.jFi)}mx_(){this.yvt=this.ActivityDataBase.GetRewardTabList(),this.dx_(0,!0,!0)}dx_(i,t,e){this.TabItemList[i].SetToggleState(t?1:0,e)}P6e(i,t){var e=i.ChildViewName,e=(this.TabViewComponent.ToggleCallBack(i,e,this.TabItemList[t],this.ActivityDataBase),i.Icon),t=(e&&this.CaptionItem.SetTitleIcon(e),i.TabName);t&&this.CaptionItem.SetTitleByTextIdAndArgNew(t)}OnTick(i){this.Ntl&&this.u3e()}u3e(){var i=this.ActivityDataBase.GetLimitTimeEndTime();i-TimeUtil_1.TimeUtil.GetServerTime()<0?(this.Ntl=!1,ControllerHolder_1.ControllerHolder.ActivityController.ShowActivityRefreshAndBackToBattleView()):(i=ModelManager_1.ModelManager.ActivityModel.GetRemainTimeText(i,this.Ftl),this.GetText(4).SetText(i))}}exports.FishingTimeLimitView=FishingTimeLimitView;
//# sourceMappingURL=FishingTimeLimitView.js.map