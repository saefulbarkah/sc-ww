
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ActivityRecallMainView=void 0;const UE=require("ue"),TimerSystem_1=require("../../../../../Core/Timer/TimerSystem"),StringUtils_1=require("../../../../../Core/Utils/StringUtils"),EventDefine_1=require("../../../../Common/Event/EventDefine"),EventSystem_1=require("../../../../Common/Event/EventSystem"),TimeUtil_1=require("../../../../Common/TimeUtil"),ConfigManager_1=require("../../../../Manager/ConfigManager"),ModelManager_1=require("../../../../Manager/ModelManager"),UiViewBase_1=require("../../../../Ui/Base/UiViewBase"),CommonTabComponentData_1=require("../../../Common/TabComponent/CommonTabComponentData"),CommonTabData_1=require("../../../Common/TabComponent/CommonTabData"),CommonTabTitleData_1=require("../../../Common/TabComponent/CommonTabTitleData"),CommonTabItemBase_1=require("../../../Common/TabComponent/TabItem/CommonTabItemBase"),ActivityRecallDefine_1=require("./ActivityRecallDefine"),ActivityRecallAreaSubView_1=require("./Area/ActivityRecallAreaSubView"),ActivityRecallMainLineSubView_1=require("./MainLine/ActivityRecallMainLineSubView"),ActivityRecallHelper_1=require("./Misc/ActivityRecallHelper"),ActivityRecallMainCaptionListPanel_1=require("./Panels/ActivityRecallMainCaptionListPanel"),ActivityRecallTabItemPanel_1=require("./Panels/ActivityRecallTabItemPanel"),ActivityRecallRoleSubView_1=require("./Role/ActivityRecallRoleSubView"),ActivityRecallSignInSubView_1=require("./SignIn/ActivityRecallSignInSubView"),ActivityRecallTaskSubView_1=require("./Task/ActivityRecallTaskSubView");class ActivityRecallMainView extends UiViewBase_1.UiViewBase{constructor(){super(...arguments),this.GOe=void 0,this.lda=void 0,this._da=new Map,this.uda=void 0,this.cda=void 0,this.dda=void 0,this.TDe=void 0,this.lBa=!1,this.kOe=()=>{this.lda.CheckIfInShowTime()||this.CloseMe()},this.itt=()=>{this.lda=ActivityRecallHelper_1.ActivityRecallHelper.ActivityRecallData,this.Og()},this.TDa=i=>{var e;this.lda&&(e=this._da.get(this.uda))&&4===this.uda&&i===ActivityRecallDefine_1.RECALL_SCORE_ITEM_ID&&e.RefreshByData(this.lda)},this.jdi=(i,e)=>{return new ActivityRecallTabItemPanel_1.ActivityRecallTabItemPanel},this.zno=i=>{this.lBa?this.lBa=!1:this.mda(i)},this.yqe=i=>{var i=this.dda[i],e=i.Title,i=this.CTa(i.EntryType),i=void 0!==i?ConfigManager_1.ConfigManager.UiResourceConfig.GetResourcePath(i):"";return new CommonTabData_1.CommonTabData(i,new CommonTabTitleData_1.CommonTabTitleData(e))},this.QCa=(t,a)=>{var s=this.fda(this.uda);if(a===s){let i="";switch(a){case 0:case 1:i=this.KCa(t);break;case 2:var n=t.GachaId,n=ConfigManager_1.ConfigManager.GachaConfig.GetGachaViewInfo(n);i=n?n.UnderBgTexturePath:ConfigManager_1.ConfigManager.UiResourceConfig.GetResourcePath("T_CircumfluenceSignInBg");break;default:i=ConfigManager_1.ConfigManager.UiResourceConfig.GetResourcePath("T_CircumfluenceSignInBg")}let e=void 0;(2===a?(e=this.GetTexture(3),this.GetTexture(1)):(e=this.GetTexture(1),this.GetTexture(3))).SetUIActive(!1);s=!StringUtils_1.StringUtils.IsEmpty(i);e.SetUIActive(s),s&&this.SetTextureByPath(i,e),this.UiViewSequence.StopSequenceByKey("Switch"),this.PlaySequenceAsync("Switch",!0)}},this.Ifa=()=>{this.Tfa(),this.cda.SelectToggleByIndex(0)}}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,UE.UIItem],[1,UE.UITexture],[2,UE.UIItem],[3,UE.UITexture]]}async OnBeforeStartAsync(){this.lda=ActivityRecallHelper_1.ActivityRecallHelper.ActivityRecallData;var i=this.OpenParam,e=ActivityRecallHelper_1.ActivityRecallHelper.IsRecallEntryType(i);await this.sso(),e?3===i?(this.lBa=!0,this.cda.SelectToggleByIndex(2,void 0,!0),await this.mda(i,1)):this.cda.SelectToggleByIndex(i,!0):await this.mda(i),this.cda.SetPnlListUiActive(e)}OnBeforeShow(){var i,e=this.fda(this.uda),e=this._da.get(e);e&&(i=e.IsShowOrShowing,e.SetActive(!0),i||(this.UiViewSequence.StopSequenceByKey("Switch"),this.PlaySequenceAsync("Switch",!0),e.OnParentShow())),this.GOe=TimerSystem_1.TimerSystem.Forever(this.kOe,TimeUtil_1.TimeUtil.InverseMillisecond)}jm(){TimerSystem_1.TimerSystem.Has(this.GOe)&&(TimerSystem_1.TimerSystem.Remove(this.GOe),this.GOe=void 0)}OnAfterHide(){this.jm();var i=this.fda(this.uda),i=this._da.get(i);i&&i.SetActive(!1)}OnBeforeDestroy(){if(this.Cda(),this.cda){var i;for([,i]of this.cda?.GetTabItemMap())i.Clear();this.cda.Destroy(),this.cda=void 0}this.Lfa()}OnAddEventListener(){EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.RecallActivityInfoUpdate,this.itt),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnCommonItemCountAnyChange,this.TDa)}OnRemoveEventListener(){EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.RecallActivityInfoUpdate,this.itt),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnCommonItemCountAnyChange,this.TDa)}async gda(i,e){const t=this.fda(i);this._da.has(t)||await this.vda(i).then(i=>{i&&this._da.set(t,i)});i=this._da.get(t);await i.ShowAsync(),i.RefreshByData(this.lda,e)}async pda(i){i=this.fda(i);this._da.has(i)&&await this._da.get(i).HideAsync()}fda(i){return 2===i||3===i?2:i}Cda(){this._da.forEach(i=>{i.UnBindPassRecallBaseCallBack(),i.CloseMeAsync()}),this._da.clear()}async vda(i){let e=void 0;var t=this.GetItem(2);switch(i){case 5:await(e=new ActivityRecallSignInSubView_1.ActivityRecallSignInSubView).CreateThenShowByResourceIdAsync("UiItem_CircumfluenceSignin",t);break;case 1:await(e=new ActivityRecallAreaSubView_1.ActivityRecallAreaSubView).CreateThenShowByResourceIdAsync("UiItem_CircumfluenceArea",t);break;case 0:await(e=new ActivityRecallMainLineSubView_1.ActivityRecallMainLineSubView).CreateThenShowByResourceIdAsync("UiItem_CircumfluenceArea",t);break;case 4:await(e=new ActivityRecallTaskSubView_1.ActivityRecallTaskSubView).CreateThenShowByResourceIdAsync("UiItem_CircumfluenceMission",t);break;case 2:case 3:(e=new ActivityRecallRoleSubView_1.ActivityRecallRoleSubView).OpenParam=3,await e.CreateThenShowByResourceIdAsync("UiItem_CircumfluenceArea",t)}return e.BindPassRecallBaseCallBack(this.QCa),e}async mda(i,e=0){i!==this.uda&&(void 0!==this.uda&&await this.pda(this.uda),await this.gda(i,e),this.uda=i,this.qEi())}qEi(){let i=void 0;5===this.uda&&(i="RecallActivity_Sign_Title"),4===this.uda&&(i="RecallActivity_Task_Title");var e=this.gTa(),e=void 0!==e?ConfigManager_1.ConfigManager.UiResourceConfig.GetResourcePath(e):"";i&&this.cda.UpdateTitle(e,new CommonTabTitleData_1.CommonTabTitleData(i))}CTa(i){switch(i){case 1:return"SP_CircumfluenceIconyeqianA";case 2:return"SP_CircumfluenceIconyeqianB";case 3:case 4:return"SP_FuncIconRoleC"}}gTa(){switch(this.uda){case 0:return"SP_CircumfluenceIconyeqianA";case 1:return"SP_CircumfluenceIconyeqianB";case 2:case 3:return"SP_FuncIconRoleC"}}Og(){var i;this.lda&&(i=this._da.get(this.uda))&&i.RefreshByData(this.lda)}async sso(){var i=new CommonTabComponentData_1.CommonTabComponentData(this.jdi,this.zno,this.yqe);this.dda=ActivityRecallHelper_1.ActivityRecallHelper.GetRecallOpenEntryViewConfigList(),this.cda=new ActivityRecallMainCaptionListPanel_1.ActivityRecallMainCaptionListPanel;var e=this.GetItem(0).GetOwner();this.cda.Init(i),await this.cda.CreateThenShowByActorAsync(e),await this.Tfa()}async Tfa(){this.dda=ActivityRecallHelper_1.ActivityRecallHelper.GetRecallOpenEntryViewConfigList();var e=new Array;let t=void 0;for(let i=0;i<this.dda.length;i++){var a=new CommonTabItemBase_1.CommonTabItemData,s=(a.Index=i,a.Data=this.cda.GetTabComponentData(i),this.dda[i]),[s,n]=ActivityRecallHelper_1.ActivityRecallHelper.CheckIfEntryOpen(s);s&&(void 0!==n&&0<n&&(t=void 0===t?n:Math.min(n,t)),e.push(a))}await this.cda.RefreshTabItemByDataAsync(e),void 0!==t&&0<t&&(this.Lfa(),this.TDe=TimerSystem_1.RealTimeTimerSystem.Delay(this.Ifa,t*TimeUtil_1.TimeUtil.InverseMillisecond))}KCa(i){var e=ModelManager_1.ModelManager.PlayerInfoModel.GetPlayerGender();return 1===e?i.BgPath:0===e?i.BgPathF:""}Lfa(){this.TDe&&(TimerSystem_1.RealTimeTimerSystem.Remove(this.TDe),this.TDe=void 0)}}exports.ActivityRecallMainView=ActivityRecallMainView;
//# sourceMappingURL=ActivityRecallMainView.js.map