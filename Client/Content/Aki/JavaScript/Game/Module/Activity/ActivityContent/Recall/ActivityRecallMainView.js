
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ActivityRecallMainView=void 0;const UE=require("ue"),TimerSystem_1=require("../../../../../Core/Timer/TimerSystem"),StringUtils_1=require("../../../../../Core/Utils/StringUtils"),EventDefine_1=require("../../../../Common/Event/EventDefine"),EventSystem_1=require("../../../../Common/Event/EventSystem"),TimeUtil_1=require("../../../../Common/TimeUtil"),ConfigManager_1=require("../../../../Manager/ConfigManager"),ModelManager_1=require("../../../../Manager/ModelManager"),UiViewBase_1=require("../../../../Ui/Base/UiViewBase"),CommonTabComponentData_1=require("../../../Common/TabComponent/CommonTabComponentData"),CommonTabData_1=require("../../../Common/TabComponent/CommonTabData"),CommonTabTitleData_1=require("../../../Common/TabComponent/CommonTabTitleData"),CommonTabItemBase_1=require("../../../Common/TabComponent/TabItem/CommonTabItemBase"),ActivityRecallAreaSubView_1=require("./Area/ActivityRecallAreaSubView"),ActivityRecallMainLineSubView_1=require("./MainLine/ActivityRecallMainLineSubView"),ActivityRecallHelper_1=require("./Misc/ActivityRecallHelper"),ActivityRecallMainCaptionListPanel_1=require("./Panels/ActivityRecallMainCaptionListPanel"),ActivityRecallTabItemPanel_1=require("./Panels/ActivityRecallTabItemPanel"),ActivityRecallRoleSubView_1=require("./Role/ActivityRecallRoleSubView"),ActivityRecallSignInSubView_1=require("./SignIn/ActivityRecallSignInSubView"),ActivityRecallTaskSubView_1=require("./Task/ActivityRecallTaskSubView");class ActivityRecallMainView extends UiViewBase_1.UiViewBase{constructor(){super(...arguments),this.GOe=void 0,this.G1a=void 0,this.O1a=new Map,this.k1a=void 0,this.N1a=void 0,this.F1a=void 0,this.TDe=void 0,this.KTa=!1,this.kOe=()=>{this.G1a.CheckIfInShowTime()||this.CloseMe()},this.itt=()=>{this.G1a=ActivityRecallHelper_1.ActivityRecallHelper.ActivityRecallData,this.Og()},this.cIa=()=>{this.Og()},this.jdi=(i,e)=>{return new ActivityRecallTabItemPanel_1.ActivityRecallTabItemPanel},this.zno=i=>{this.KTa?this.KTa=!1:this.V1a(i)},this.yqe=i=>{var i=this.F1a[i],e=i.Title,i=this.FSa(i.EntryType),i=void 0!==i?ConfigManager_1.ConfigManager.UiResourceConfig.GetResourcePath(i):"";return new CommonTabData_1.CommonTabData(i,new CommonTabTitleData_1.CommonTabTitleData(e))},this.jca=(e,t)=>{var a=this.W1a(this.k1a);if(t===a){let i="";switch(t){case 0:case 1:i=this.Wca(e);break;case 2:var s=e.GachaId,s=ConfigManager_1.ConfigManager.GachaConfig.GetGachaViewInfo(s);i=s?s.UnderBgTexturePath:ConfigManager_1.ConfigManager.UiResourceConfig.GetResourcePath("T_CircumfluenceSignInBg");break;default:i=ConfigManager_1.ConfigManager.UiResourceConfig.GetResourcePath("T_CircumfluenceSignInBg")}StringUtils_1.StringUtils.IsEmpty(i)||(a=this.GetTexture(1),this.SetTextureByPath(i,a)),this.UiViewSequence.StopSequenceByKey("Switch"),this.PlaySequenceAsync("Switch",!0)}},this.bCa=()=>{this.BCa(),this.N1a.SelectToggleByIndex(0)}}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,UE.UIItem],[1,UE.UITexture],[2,UE.UIItem]]}async OnBeforeStartAsync(){this.G1a=ActivityRecallHelper_1.ActivityRecallHelper.ActivityRecallData;var i=this.OpenParam,e=ActivityRecallHelper_1.ActivityRecallHelper.IsRecallEntryType(i);await this.sso(),e?3===i?(this.KTa=!0,this.N1a.SelectToggleByIndex(2,void 0,!0),await this.V1a(i,1)):this.N1a.SelectToggleByIndex(i,!0):await this.V1a(i),this.N1a.SetPnlListUiActive(e)}OnBeforeShow(){var i,e=this.W1a(this.k1a),e=this.O1a.get(e);e&&(i=e.IsShowOrShowing,e.SetActive(!0),i||(this.UiViewSequence.StopSequenceByKey("Switch"),this.PlaySequenceAsync("Switch",!0),e.OnParentShow())),this.GOe=TimerSystem_1.TimerSystem.Forever(this.kOe,TimeUtil_1.TimeUtil.InverseMillisecond)}jm(){TimerSystem_1.TimerSystem.Has(this.GOe)&&(TimerSystem_1.TimerSystem.Remove(this.GOe),this.GOe=void 0)}OnAfterHide(){this.jm();var i=this.W1a(this.k1a),i=this.O1a.get(i);i&&i.SetActive(!1)}OnBeforeDestroy(){if(this.H1a(),this.N1a){var i;for([,i]of this.N1a?.GetTabItemMap())i.Clear();this.N1a.Destroy(),this.N1a=void 0}this.qCa()}OnAddEventListener(){EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnActivityUpdate,this.itt),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnCommonItemCountAnyChange,this.cIa)}OnRemoveEventListener(){EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnActivityUpdate,this.itt),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnCommonItemCountAnyChange,this.cIa)}async j1a(i,e){const t=this.W1a(i);this.O1a.has(t)||await this.Q1a(i).then(i=>{i&&this.O1a.set(t,i)});i=this.O1a.get(t);await i.ShowAsync(),i.RefreshByData(this.G1a,e)}async K1a(i){i=this.W1a(i);this.O1a.has(i)&&await this.O1a.get(i).HideAsync()}W1a(i){return 2===i||3===i?2:i}H1a(){this.O1a.forEach(i=>{i.UnBindPassRecallBaseCallBack(),i.CloseMeAsync()}),this.O1a.clear()}async Q1a(i){let e=void 0;var t=this.GetItem(2);switch(i){case 5:await(e=new ActivityRecallSignInSubView_1.ActivityRecallSignInSubView).CreateThenShowByResourceIdAsync("UiItem_CircumfluenceSignin",t);break;case 1:await(e=new ActivityRecallAreaSubView_1.ActivityRecallAreaSubView).CreateThenShowByResourceIdAsync("UiItem_CircumfluenceArea",t);break;case 0:await(e=new ActivityRecallMainLineSubView_1.ActivityRecallMainLineSubView).CreateThenShowByResourceIdAsync("UiItem_CircumfluenceArea",t);break;case 4:await(e=new ActivityRecallTaskSubView_1.ActivityRecallTaskSubView).CreateThenShowByResourceIdAsync("UiItem_CircumfluenceMission",t);break;case 2:case 3:(e=new ActivityRecallRoleSubView_1.ActivityRecallRoleSubView).OpenParam=3,await e.CreateThenShowByResourceIdAsync("UiItem_CircumfluenceArea",t)}return e.BindPassRecallBaseCallBack(this.jca),e}async V1a(i,e=0){i!==this.k1a&&(void 0!==this.k1a&&await this.K1a(this.k1a),await this.j1a(i,e),this.k1a=i,this.qEi())}qEi(){let i=void 0;5===this.k1a&&(i="RecallActivity_Sign_Title"),4===this.k1a&&(i="RecallActivity_Task_Title");var e=this.VSa(),e=void 0!==e?ConfigManager_1.ConfigManager.UiResourceConfig.GetResourcePath(e):"";i&&this.N1a.UpdateTitle(e,new CommonTabTitleData_1.CommonTabTitleData(i))}FSa(i){switch(i){case 1:return"SP_CircumfluenceIconyeqianA";case 2:return"SP_CircumfluenceIconyeqianB";case 3:case 4:return"SP_FuncIconRoleC"}}VSa(){switch(this.k1a){case 0:return"SP_CircumfluenceIconyeqianA";case 1:return"SP_CircumfluenceIconyeqianB";case 2:case 3:return"SP_FuncIconRoleC"}}Og(){var i;this.G1a&&(i=this.O1a.get(this.k1a))&&i.RefreshByData(this.G1a)}async sso(){var i=new CommonTabComponentData_1.CommonTabComponentData(this.jdi,this.zno,this.yqe);this.F1a=ActivityRecallHelper_1.ActivityRecallHelper.GetRecallOpenEntryViewConfigList(),this.N1a=new ActivityRecallMainCaptionListPanel_1.ActivityRecallMainCaptionListPanel;var e=this.GetItem(0).GetOwner();this.N1a.Init(i),await this.N1a.CreateThenShowByActorAsync(e),await this.BCa()}async BCa(){this.F1a=ActivityRecallHelper_1.ActivityRecallHelper.GetRecallOpenEntryViewConfigList();var e=new Array;let t=void 0;for(let i=0;i<this.F1a.length;i++){var a=new CommonTabItemBase_1.CommonTabItemData,s=(a.Index=i,a.Data=this.N1a.GetTabComponentData(i),this.F1a[i]),[s,n]=ActivityRecallHelper_1.ActivityRecallHelper.CheckIfEntryOpen(s);s&&(void 0!==n&&0<n&&(t=void 0===t?n:Math.min(n,t)),e.push(a))}await this.N1a.RefreshTabItemByDataAsync(e),void 0!==t&&0<t&&(this.qCa(),this.TDe=TimerSystem_1.RealTimeTimerSystem.Delay(this.bCa,t*TimeUtil_1.TimeUtil.InverseMillisecond))}Wca(i){var e=ModelManager_1.ModelManager.PlayerInfoModel.GetPlayerGender();return 1===e?i.BgPath:0===e?i.BgPathF:""}qCa(){this.TDe&&(TimerSystem_1.RealTimeTimerSystem.Remove(this.TDe),this.TDe=void 0)}}exports.ActivityRecallMainView=ActivityRecallMainView;
//# sourceMappingURL=ActivityRecallMainView.js.map