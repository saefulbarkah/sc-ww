
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BabelTowerData=void 0;const Protocol_1=require("../../../../../Core/Define/Net/Protocol"),MathUtils_1=require("../../../../../Core/Utils/MathUtils"),LocalStorage_1=require("../../../../Common/LocalStorage"),LocalStorageDefine_1=require("../../../../Common/LocalStorageDefine"),TimeUtil_1=require("../../../../Common/TimeUtil"),ConfigManager_1=require("../../../../Manager/ConfigManager"),ActivityData_1=require("../../ActivityData");class BabelTowerData extends ActivityData_1.ActivityBaseData{constructor(){super(...arguments),this.NormalLevelDataMap=new Map,this.HardLevelDataMap=new Map,this.NormalQuest=new Map,this.DailyQuest=new Map,this.BuffUnlock=new Map,this.DeTermUnlock=new Map,this.RoleLockData=new Map,this.CurrentItemCount=0}PhraseEx(t){for(const e of t.EX_.xX_)(ConfigManager_1.ConfigManager.BabelTowerConfig.GetBabelTowerLevelConfig(e.ELl).IsDifficult?this.HardLevelDataMap:this.NormalLevelDataMap).set(e.ELl,e),this.RoleLockData.set(e.ELl,e.TX_);for(const r of t.EX_.E$s)this.NormalQuest.set(r.s5n,r);for(const o of t.EX_.BX_)this.DailyQuest.set(o.s5n,o);for(const i of t.EX_.DX_)this.BuffUnlock.set(i.PX_,i.AX_);for(const a of t.EX_.UX_)this.DeTermUnlock.set(a.RX_,a.AX_);this.CurrentItemCount=t.EX_.Ofc}GetNextLevelOpenTimeText(){var t,e,r=TimeUtil_1.TimeUtil.GetServerTimeStamp();for([,t]of this.NormalLevelDataMap){var o=MathUtils_1.MathUtils.LongToNumber(t.yzs);if(r<o)return TimeUtil_1.TimeUtil.GetRemainTimeDataFormat((o-r)*TimeUtil_1.TimeUtil.Millisecond).CountDownText}for([,e]of this.HardLevelDataMap){var i=MathUtils_1.MathUtils.LongToNumber(e.yzs);if(r<i)return TimeUtil_1.TimeUtil.GetRemainTimeDataFormat((i-r)*TimeUtil_1.TimeUtil.Millisecond).CountDownText}}GetNormalLevelPassText(){var t,e=this.NormalLevelDataMap.size;let r=0;for([,t]of this.NormalLevelDataMap)t.dMs&&r++;return r+"/"+e}GetHardLevelStarText(){let t=0;for(var[,e]of this.HardLevelDataMap)t+=e.wX_;return t+""}GetBuffIsLock(t){return!this.BuffUnlock.get(t)}GetBuffIsUse(t){for(var[e,r]of this.HardLevelDataMap)if(r.Dks.includes(t))return e;return-1}GetBuffUseLevel(t){for(var[e,r]of this.HardLevelDataMap)if(r.Dks.includes(t))return e;return-1}GetDeTermIsLock(t){return!this.DeTermUnlock.get(t)}GetDeTermIsUse(t,e){t=this.NormalLevelDataMap.get(t)??this.HardLevelDataMap.get(t);return!!t&&t.IX_.includes(e)}GetQuestAnyRedDot(){for(var[,t]of this.DailyQuest)if(t.H6n===Protocol_1.Aki.Protocol.I$s.Proto_ActivityTaskFinish)return!0;return!1}GetDifficultyNewLevelRedDot(t){var e=TimeUtil_1.TimeUtil.GetServerTimeStamp();if(0===t)for(var[r,o]of this.NormalLevelDataMap){o=MathUtils_1.MathUtils.LongToNumber(o.yzs);if(o<=e)if(!(LocalStorage_1.LocalStorage.GetPlayer(LocalStorageDefine_1.ELocalStoragePlayerKey.BabelTowerNewLevelHasClick)?.get(r)??!1))return!0}else for(var[i,a]of this.HardLevelDataMap){a=MathUtils_1.MathUtils.LongToNumber(a.yzs);if(a<=e)if(!(LocalStorage_1.LocalStorage.GetPlayer(LocalStorageDefine_1.ELocalStoragePlayerKey.BabelTowerNewLevelHasClick)?.get(i)??!1))return!0}return!1}GetNewLevelRedDot(t){var e=ConfigManager_1.ConfigManager.BabelTowerConfig.GetBabelTowerLevelConfig(t).IsDifficult;let r=!1;var o=TimeUtil_1.TimeUtil.GetServerTimeStamp();return(r=e?MathUtils_1.MathUtils.LongToNumber(this.HardLevelDataMap.get(t).yzs)<=o:MathUtils_1.MathUtils.LongToNumber(this.NormalLevelDataMap.get(t).yzs)<=o)&&!(LocalStorage_1.LocalStorage.GetPlayer(LocalStorageDefine_1.ELocalStoragePlayerKey.BabelTowerNewLevelHasClick)?.get(t)??!1)}GetNewLevel(){let t=0;var e,r,o,i,a=TimeUtil_1.TimeUtil.GetServerTimeStamp();let s=0;for([e,r]of this.NormalLevelDataMap){var f=MathUtils_1.MathUtils.LongToNumber(r.yzs);f<=a&&t<f&&(s=e,t=f)}for([o,i]of this.HardLevelDataMap){var l=MathUtils_1.MathUtils.LongToNumber(i.yzs);l<=a&&t<l&&(s=o,t=l)}return s}GetHardNewLevel(){let t=0;var e,r,o=TimeUtil_1.TimeUtil.GetServerTimeStamp();let i=0;for([e,r]of this.HardLevelDataMap){var a=MathUtils_1.MathUtils.LongToNumber(r.yzs);a<=o&&t<a&&(i=e,t=a)}return i}GetNormalNewLevel(){let t=0;var e,r,o=TimeUtil_1.TimeUtil.GetServerTimeStamp();let i=0;for([e,r]of this.NormalLevelDataMap){var a=MathUtils_1.MathUtils.LongToNumber(r.yzs);a<=o&&t<a&&(i=e,t=a)}return i}GetQuestTabRedDot(t){if(0===t){for(var[,e]of this.DailyQuest)if(e.H6n===Protocol_1.Aki.Protocol.I$s.Proto_ActivityTaskFinish)return!0}else for(var[r,o]of this.NormalQuest){r=ConfigManager_1.ConfigManager.BabelTowerConfig.GetBabelTowerNormalQuest(r),r=ConfigManager_1.ConfigManager.BabelTowerConfig.GetBabelTowerLevelConfig(r.LevelId);if(r.IsDifficult&&2===t){if(o.H6n===Protocol_1.Aki.Protocol.I$s.Proto_ActivityTaskFinish)return!0}else if(!r.IsDifficult&&1===t&&o.H6n===Protocol_1.Aki.Protocol.I$s.Proto_ActivityTaskFinish)return!0}return!1}GetDailyDeTerm(){var t,e,r,o=[];for([t,e]of this.DailyQuest)e.H6n===Protocol_1.Aki.Protocol.I$s.Proto_ActivityTaskRunning&&(r=ConfigManager_1.ConfigManager.BabelTowerConfig.GetBabelTowerDailyQuest(t),o.push(...r.ShowDeTerm));return o}GetDailyLevel(){var t,e,r,o=[];for([t,e]of this.DailyQuest)e.H6n===Protocol_1.Aki.Protocol.I$s.Proto_ActivityTaskRunning&&(r=ConfigManager_1.ConfigManager.BabelTowerConfig.GetBabelTowerDailyQuest(t),o.push(r.JumpToLevelId));return o}GetExDataRedPointShowState(){return this.GetQuestAnyRedDot()}}exports.BabelTowerData=BabelTowerData;
//# sourceMappingURL=BabelTowerData.js.map