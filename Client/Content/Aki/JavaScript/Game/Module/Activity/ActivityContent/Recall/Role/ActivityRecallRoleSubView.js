
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ActivityRecallRoleSubView=void 0;const CustomPromise_1=require("../../../../../../Core/Common/CustomPromise"),Log_1=require("../../../../../../Core/Common/Log"),StringUtils_1=require("../../../../../../Core/Utils/StringUtils"),ConfigManager_1=require("../../../../../Manager/ConfigManager"),ModelManager_1=require("../../../../../Manager/ModelManager"),GachaDefine_1=require("../../../../Gacha/GachaDefine"),SpineRoleGachaPoolItem_1=require("../../../../Gacha/GachaMainView/SpineRoleGachaPoolItem"),UpRoleGachaPoolItem_1=require("../../../../Gacha/GachaMainView/UpRoleGachaPoolItem"),RoleController_1=require("../../../../RoleUi/RoleController"),ActivityRoleDescribeComponent_1=require("../../UniversalComponents/ActivityRoleDescribeComponent"),ActivityRecallDefine_1=require("../ActivityRecallDefine"),ActivityRecallHelper_1=require("../Misc/ActivityRecallHelper"),ActivityRecallTabGroupPanel_1=require("../Panels/ActivityRecallTabGroupPanel"),ActivityRecallRoleActivityInfoPanel_1=require("./ActivityRecallRoleActivityInfoPanel");class ActivityRecallRoleSubView extends ActivityRecallDefine_1.ActivityMainSubViewBase{constructor(){super(...arguments),this.tma=void 0,this.Oda=void 0,this.ima=void 0,this.Gda=void 0,this.Xda=void 0,this.wda=void 0,this.oCa=void 0,this.$Ql=void 0,this.XQl=0,this.Wwn=i=>{var e,t,i=this.Gda[i].Config,a=(this.ima.RefreshByData(i),ModelManager_1.ModelManager.GachaModel.GetGachaInfo(i.GachaId));void 0===a?Log_1.Log.CheckDebug()&&Log_1.Log.Debug("ActivityRecall",63,"[回流活动]ActivityRecallRoleSubView->TabCallBack 不存在该抽卡数据",["GachaId: ",i.GachaId]):void 0===(e=0<(t=a.UsePoolId)?a.GetPoolInfo(t):a.GetFirstValidPool())?Log_1.Log.CheckDebug()&&Log_1.Log.Debug("ActivityRecall",63,"[回流活动]ActivityRecallRoleSubView->TabCallBack 不存在该卡池数据",["GachaId: ",i.GachaId],["usePoolId: ",t]):(this.YQl(a,e),this.wda=i,t=ActivityRecallHelper_1.ActivityRecallHelper.GetGachaRoleId(i.GachaId),this.tma.Update(t),this.InvokePassRecallBaseCallBack(i,2),this.SequencePlayer.StopSequenceByKey("Start"),a=new CustomPromise_1.CustomPromise,this.SequencePlayer.PlaySequenceAsync("Start",a))},this.rma=()=>{var i=ActivityRecallHelper_1.ActivityRecallHelper.GetGachaTrialRoleId(this.wda.GachaId);RoleController_1.RoleController.OpenRoleMainView(1,0,[i])}}OnRegisterComponent(){this.ComponentRegisterInfos=ActivityRecallDefine_1.activityRecallMainViewComponentsInfo,this.BtnBindInfo=[[2,this.rma]]}async OnBeforeStartAsync(){this.Xda=this.OpenParam;var i=this.GetItem(4);this.XQl=i.GetAnchorOffsetX();i=this.GetItem(1).GetOwner();this.tma=new ActivityRoleDescribeComponent_1.ActivityRoleDescribeComponent,await this.tma.CreateThenShowByActorAsync(i,void 0,!0);i=this.GetItem(6).GetOwner();this.ima=new ActivityRecallRoleActivityInfoPanel_1.ActivityRecallRoleActivityInfoPanel,await this.ima.CreateThenShowByActorAsync(i)}OnStart(){super.OnStart();var i=this.GetHorizontalLayout(0),e=this.GetItem(5);this.Oda=new ActivityRecallTabGroupPanel_1.ActivityRecallTabGroupPanel(i,e,this.Wwn),this.Oda.Init(),this.GetItem(3).SetUIActive(!0)}OnBeforeDestroy(){this.Oda.Destroy(),this.Oda=void 0}OnRefreshByData(i,e){var t=ActivityRecallHelper_1.ActivityRecallHelper.GetSortedOpenRecallBaseConfigList(),a=t[0],t=t[1],l=(this.Gda=[],new ActivityRecallDefine_1.ActivityRecallTabSwitchItemCommonData),a=(l.RecallEntryType=this.Xda,l.Config=a,ActivityRecallHelper_1.ActivityRecallHelper.GetRoleConfigByGachaId(a.GachaId));l.Title=a.Name,this.Gda.push(l),void 0!==t&&((a=new ActivityRecallDefine_1.ActivityRecallTabSwitchItemCommonData).RecallEntryType=this.Xda,a.Config=t,l=ActivityRecallHelper_1.ActivityRecallHelper.GetRoleConfigByGachaId(t.GachaId),a.Title=l.Name,this.Gda.push(a)),this.GetItem(7).SetUIActive(1<this.Gda.length),this.Oda.RefreshByData(this.Gda,e)}OnParentShow(){super.OnParentShow(),this.oCa?.PlayStartSeqAsync()}async YQl(i,e){var t,i=new GachaDefine_1.GachaPoolData(i,e),e=e.Id,e=ConfigManager_1.ConfigManager.GachaConfig.GetGachaViewInfo(e);StringUtils_1.StringUtils.IsBlank(e.SpinePrefabResource)?0!==this.$Ql&&(await this.oCa?.DestroyAsync(),this.oCa=void 0,this.oCa=new UpRoleGachaPoolItem_1.UpRoleGachaPoolItem(2),t=this.GetItem(4),await this.oCa.CreateThenShowByResourceIdAsync("UiItem_LuckdrawPixF",t),this.$Ql=0):(await this.oCa?.DestroyAsync(),this.oCa=new SpineRoleGachaPoolItem_1.SpineRoleGachaPoolItem(2),t=e.SpinePrefabResource,e=this.GetItem(8),await this.oCa.CreateThenShowByResourceIdAsync(t,e),this.oCa.GetRootItem().SetAnchorOffsetX(this.XQl),this.$Ql=1),this.oCa.SetDescUiActive(!1),this.oCa.Update(i),this.oCa.PlayStartSeqAsync()}}exports.ActivityRecallRoleSubView=ActivityRecallRoleSubView;
//# sourceMappingURL=ActivityRecallRoleSubView.js.map