
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ScratchTicketData=void 0;const Log_1=require("../../../../../../Core/Common/Log"),ConfigManager_1=require("../../../../../Manager/ConfigManager"),ModelManager_1=require("../../../../../Manager/ModelManager"),ActivityData_1=require("../../../ActivityData"),ScratchTicketConditionData_1=require("./ScratchTicketConditionData"),ScratchTicketRoundData_1=require("./ScratchTicketRoundData");class ScratchTicketData extends ActivityData_1.ActivityBaseData{constructor(){super(...arguments),this.yol=[],this.Eol=[],this.Lo=void 0}PhraseEx(t){t=t.VSl;void 0!==t&&this.InitData(t)}NeedSelfControlFirstRedPoint(){return!0}InitData(t){this.Lo=ConfigManager_1.ConfigManager.ActivityScratchTicketConfig.GetScratchTicketConfig(this.Id),void 0!==this.Lo&&(this.Iol(t.gyl),this.Tol(t.fyl))}Iol(t){if(!(0<this.yol.length)){this.yol=[];for(const r of t){var i=new ScratchTicketRoundData_1.ScratchTicketRoundData;i.Init(r),this.yol.push(i)}this.yol.sort((t,i)=>t.Config.PreRoundId-i.Config.PreRoundId),this.UpdateAllRoundState()}}UpdateAllRoundState(){for(let t=0;t<this.yol.length;t++){var i,r=this.yol[t];0===t?r.UpdateRoundState(2):(i=this.yol[t-1],r.UpdateRoundState(i.GetRoundState()))}}UpdateCellReward(t,i){t=this.GetRoundDataById(t);void 0!==t&&(t.UpdateCellDataReward(i.pyl),t.UpdateRemainReward(i.Cyl),this.UpdateAllRoundState())}Tol(t){if(!(0<this.Eol.length)){this.Eol=[];for(const r of t){var i=new ScratchTicketConditionData_1.ScratchTicketConditionData;i.Init(r),this.Eol.push(i)}}}RefreshConditionData(t){for(const r of t){var i=this.Uol(r.s5n);void 0!==i&&i.RefreshCondition(r)}}GetExDataRedPointShowState(){var t=this.GetRemainCount();return this.HasRoundInProgress()&&0<t}IsInit(){return 0<this.yol.length}Uol(t){for(const i of this.Eol)if(i.Id===t)return i;Log_1.Log.CheckError()&&Log_1.Log.Error("ScratchTicket",58,"ScratchTicketData无法获取条件id",["id",t])}GetScratchCardActivityConfig(){return this.Lo}GetRoundDataById(t){for(const i of this.yol)if(i.Id===t)return i}GetFirstProgressRoundDataIndex(){var i=this.yol.length;if(i<=0)return-1;for(let t=0;t<i;t++)if(2!==this.yol[t].GetRoundState())return t;return i-1}GetRoundDataIndex(i){for(let t=0;t<this.yol.length;t++)if(this.yol[t]===i)return t;return-1}GetFirstProgressRoundData(){var t=this.GetFirstProgressRoundDataIndex();if(!(t<0))return this.yol[t]}GetRoundDataList(){return this.yol}GetConditionDataList(){return this.Eol}IsAllRoundFinish(){for(const t of this.yol)if(2!==t.GetRoundState())return!1;return!0}HasRoundInProgress(){for(const t of this.yol)if(1===t.GetRoundState())return!0;return!1}GetRemainCount(){var t=this.Lo.ItemId;return ModelManager_1.ModelManager.InventoryModel.GetCommonItemCount(t)}GetCostItemId(){return this.Lo.ItemId}}exports.ScratchTicketData=ScratchTicketData;
//# sourceMappingURL=ScratchTicketData.js.map