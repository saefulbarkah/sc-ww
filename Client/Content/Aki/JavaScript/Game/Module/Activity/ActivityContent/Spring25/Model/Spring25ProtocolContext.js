
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Spring25ProtocolContext=void 0;const Log_1=require("../../../../../../Core/Common/Log"),Protocol_1=require("../../../../../../Core/Define/Net/Protocol"),EventDefine_1=require("../../../../../Common/Event/EventDefine"),EventSystem_1=require("../../../../../Common/Event/EventSystem"),UiManager_1=require("../../../../../Ui/UiManager"),ActivityData_1=require("../../../ActivityData");var Proto_ActivityTaskState=Protocol_1.Aki.Protocol.I$s;class Spring25ProtocolContext extends ActivityData_1.ActivityBaseData{constructor(t){super(),this.H5l=void 0,this.IsSkinRewarded=!1,this.CanInvite=!1,this.qGl=new Map,this.GGl=new Set,this.H5l=t}Dispose(){this.CanInvite=!1,this.qGl.clear(),this.GGl.clear()}PhraseEx(t){Log_1.Log.CheckDebug()&&Log_1.Log.Debug("Spring25",64,"解析春节活动数据",["ActivityData",t]);t=t.Gt1;t&&(this.ZVa(t),UiManager_1.UiManager.IsViewShow("Spring25DialogueView")||UiManager_1.UiManager.IsViewShow("Spring25EnvelopeView")||this.H5l.ResetCurrentSignId(),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.Spring25ActivityParseDone),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.RefreshCommonActivityRedDot,this.Id))}GetExDataRedPointShowState(){return this.H5l.HasRedDot}get SignCountRemain(){return this.CanInvite?1:0}get FinishTaskCount(){let t=0;for(var[,e]of this.qGl)e.H6n>Proto_ActivityTaskState.Proto_ActivityTaskRunning&&++t;return t}get InvitedCount(){return this.GGl.size}get TaskCache(){return this.qGl}get InvitedRoleSet(){return this.GGl}get HasAnyReward(){for(var[,t]of this.qGl)if(t.H6n===Proto_ActivityTaskState.Proto_ActivityTaskFinish)return!0;return this.H5l.IsAllInvited&&!this.IsSkinRewarded}get IsInviteAvailable(){return this.CanInvite}GetTaskCurrentByTaskId(t){return this.qGl.get(t)?.lMs??0}GetTaskTargetByTaskId(t){return this.qGl.get(t)?.j6n??0}GetTaskStateByTaskId(t){return this.qGl.get(t)?.H6n??Proto_ActivityTaskState.Proto_ActivityTaskRunning}GetTaskRewardPreviewByTaskId(t){var e=[],t=this.qGl.get(t);if(void 0!==t){var i=t.cr1;for(const s of Object.keys(i)){var r=[{IncId:0,ItemId:Number.parseInt(s)},i[s]];e.push(r)}}return e}IsRoleInvitedById(t){return this.GGl.has(t)}ZVa(t){this.CanInvite=t.vi1,this.qGl.clear();for(const e of t.pi1)this.qGl.set(e.s5n,e);this.GGl.clear();for(const i of t.yi1)this.GGl.add(i);this.IsSkinRewarded=t.Si1,Log_1.Log.CheckDebug()&&Log_1.Log.Debug("Spring25",64,"解析春节活动数据的结果",["TaskCacheInternal",this.qGl],["InvitedRoleSetInternal",this.GGl],["IsSkinRewarded",this.IsSkinRewarded],["CanInvite",this.CanInvite])}SyncTaskStateByTaskId(t){Log_1.Log.CheckDebug()&&Log_1.Log.Debug("Spring25",64,"同步邀请角色奖励",["rewarded id",t]);t=this.TaskCache.get(t);void 0!==t&&(t.lMs++,t.H6n=Proto_ActivityTaskState.Proto_ActivityTaskTaken)}SyncSkinReward(){this.IsSkinRewarded=!0}}exports.Spring25ProtocolContext=Spring25ProtocolContext;
//# sourceMappingURL=Spring25ProtocolContext.js.map