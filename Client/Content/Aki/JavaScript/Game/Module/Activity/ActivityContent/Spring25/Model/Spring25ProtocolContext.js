
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Spring25ProtocolContext=void 0;const Log_1=require("../../../../../../Core/Common/Log"),Protocol_1=require("../../../../../../Core/Define/Net/Protocol"),EventDefine_1=require("../../../../../Common/Event/EventDefine"),EventSystem_1=require("../../../../../Common/Event/EventSystem"),UiManager_1=require("../../../../../Ui/UiManager"),ActivityData_1=require("../../../ActivityData");var Proto_ActivityTaskState=Protocol_1.Aki.Protocol.I$s;class Spring25ProtocolContext extends ActivityData_1.ActivityBaseData{constructor(t){super(),this.i5l=void 0,this.IsSkinRewarded=!1,this.CanInvite=!1,this.xGl=new Map,this.wGl=new Set,this.i5l=t}Dispose(){this.CanInvite=!1,this.xGl.clear(),this.wGl.clear()}PhraseEx(t){Log_1.Log.CheckDebug()&&Log_1.Log.Debug("Spring25",64,"解析春节活动数据",["ActivityData",t]);t=t.HS_;t&&(this.ZVa(t),UiManager_1.UiManager.IsViewShow("Spring25DialogueView")||UiManager_1.UiManager.IsViewShow("Spring25EnvelopeView")||this.i5l.ResetCurrentSignId(),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.Spring25ActivityParseDone),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.RefreshCommonActivityRedDot,this.Id))}GetExDataRedPointShowState(){return this.i5l.HasRedDot}get SignCountRemain(){return this.CanInvite?1:0}get FinishTaskCount(){let t=0;for(var[,e]of this.xGl)e.H6n>Proto_ActivityTaskState.Proto_ActivityTaskRunning&&++t;return t}get InvitedCount(){return this.wGl.size}get TaskCache(){return this.xGl}get InvitedRoleSet(){return this.wGl}get HasAnyReward(){for(var[,t]of this.xGl)if(t.H6n===Proto_ActivityTaskState.Proto_ActivityTaskFinish)return!0;return this.i5l.IsAllInvited&&!this.IsSkinRewarded}get IsInviteAvailable(){return this.CanInvite}GetTaskCurrentByTaskId(t){return this.xGl.get(t)?.lMs??0}GetTaskTargetByTaskId(t){return this.xGl.get(t)?.j6n??0}GetTaskStateByTaskId(t){return this.xGl.get(t)?.H6n??Proto_ActivityTaskState.Proto_ActivityTaskRunning}GetTaskRewardPreviewByTaskId(t){var e=[],t=this.xGl.get(t);if(void 0!==t){var i=t.SE_;for(const s of Object.keys(i)){var r=[{IncId:0,ItemId:Number.parseInt(s)},i[s]];e.push(r)}}return e}IsRoleInvitedById(t){return this.wGl.has(t)}ZVa(t){this.CanInvite=t.TM_,this.xGl.clear();for(const e of t.IM_)this.xGl.set(e.s5n,e);this.wGl.clear();for(const i of t.bM_)this.wGl.add(i);this.IsSkinRewarded=t.LM_,Log_1.Log.CheckDebug()&&Log_1.Log.Debug("Spring25",64,"解析春节活动数据的结果",["TaskCacheInternal",this.xGl],["InvitedRoleSetInternal",this.wGl],["IsSkinRewarded",this.IsSkinRewarded],["CanInvite",this.CanInvite])}SyncTaskStateByTaskId(t){Log_1.Log.CheckDebug()&&Log_1.Log.Debug("Spring25",64,"同步邀请角色奖励",["rewarded id",t]);t=this.TaskCache.get(t);void 0!==t&&(t.lMs++,t.H6n=Proto_ActivityTaskState.Proto_ActivityTaskTaken)}SyncSkinReward(){this.IsSkinRewarded=!0}}exports.Spring25ProtocolContext=Spring25ProtocolContext;
//# sourceMappingURL=Spring25ProtocolContext.js.map