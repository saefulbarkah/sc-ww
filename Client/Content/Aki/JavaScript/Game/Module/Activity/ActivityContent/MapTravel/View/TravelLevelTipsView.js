
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TravelLevelTipsView=void 0;const UE=require("ue"),CustomPromise_1=require("../../../../../../Core/Common/CustomPromise"),CommonParamById_1=require("../../../../../../Core/Define/ConfigCommon/CommonParamById"),TimerSystem_1=require("../../../../../../Core/Timer/TimerSystem"),MathUtils_1=require("../../../../../../Core/Utils/MathUtils"),EventDefine_1=require("../../../../../Common/Event/EventDefine"),EventSystem_1=require("../../../../../Common/Event/EventSystem"),UiViewBase_1=require("../../../../../Ui/Base/UiViewBase"),LguiUtil_1=require("../../../../Util/LguiUtil");class TravelLevelTipsView extends UiViewBase_1.UiViewBase{constructor(){super(...arguments),this.PAt=0,this.UQa=0,this.W4l=0,this.Q4l=0,this.K4l=0,this.$4l=0,this.X4l=0,this.Y4l=0,this.z4l=0,this.$An=t=>{"TipsChange"===t&&this.J4l()},this.TickHandle=void 0,this.BarAnimTime=CommonParamById_1.configCommonParamById.GetIntConfig("TravelExpBarDisplayTime"),this.RunBarAnim=!1,this.RunBarAnimTime=0,this.StartValue=0,this.TargetValue=0,this.EndValue=0,this.BarAnimPromise=new CustomPromise_1.CustomPromise,this.Refresh=t=>{this.RunBarAnim&&(this.RunBarAnimTime+=t,t=MathUtils_1.MathUtils.Lerp(this.StartValue,this.TargetValue,this.RunBarAnimTime/this.BarAnimTime),this.Z4l(t,this.EndValue),this.RunBarAnimTime>=this.BarAnimTime)&&this.eVl()}}OnRegisterComponent(){this.ComponentRegisterInfos=[[0,UE.UIText],[1,UE.UIText],[2,UE.UISprite]]}OnStart(){var t=this.OpenParam,i=(this.UQa=t.LastTravelLevel,this.W4l=t.TravelLevel,this.Q4l=t.LastExpCount,this.K4l=t.GetExpItemCount(),this.X4l=t.LastCurrentExpCount,t.TravelLevelData.get(this.UQa)),i=(this.$4l=i.TargetExp,this.Y4l=t.GetCurrentExp(),this.z4l=t.GetCurrentTargetExp(),this.W4l>this.UQa),t=this.K4l>this.Q4l;i?this.PAt=t?2:1:t?this.PAt=0:this.CloseMe()}OnAddEventListener(){EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnActivitySequenceEmitEvent,this.$An)}OnRemoveEventListener(){EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnActivitySequenceEmitEvent,this.$An)}OnBeforeShow(){switch(this.TickHandle=TimerSystem_1.TimerSystem.Forever(this.Refresh,TimerSystem_1.MIN_TIME),this.Z4l(0,1),this.eCo(this.UQa),this.PAt){case 2:this.tVl(this.K4l-this.Q4l),this.iVl(!0),this.Z4l(this.X4l,this.$4l);break;case 0:this.tVl(this.Y4l-this.X4l),this.iVl(!0),this.Z4l(this.X4l,this.z4l);break;case 1:this.iVl(!1),this.Z4l(this.X4l,this.$4l)}}OnAfterShow(){switch(this.PAt){case 2:this.rVl();break;case 0:this.oVl();break;case 1:this.rVl()}}OnBeforeDestroy(){this.S0t()}async oVl(){var t=this.Y4l>=this.z4l;await this.nVl(this.X4l,this.Y4l,this.z4l),t&&await this.UiViewSequence.PlaySequenceAsync("Full",new CustomPromise_1.CustomPromise),this.CloseMe()}async rVl(){await this.nVl(this.X4l,this.$4l,this.$4l),this.eCo(this.W4l),this.UiViewSequence.PlaySequence("LevelChange"),this.Z4l(0,this.z4l),await this.nVl(0,this.Y4l,this.z4l),this.Y4l>=this.z4l&&await this.UiViewSequence.PlaySequenceAsync("Full",new CustomPromise_1.CustomPromise),this.CloseMe()}async nVl(t,i,s){this.StartValue=t,this.TargetValue=Math.min(i,s),this.EndValue=s,this.RunBarAnim=!0,this.RunBarAnimTime=0,this.BarAnimPromise.SetResult(),this.BarAnimPromise=new CustomPromise_1.CustomPromise,await this.BarAnimPromise.Promise}eVl(){this.RunBarAnim=!1,this.BarAnimPromise.SetResult()}S0t(){this.TickHandle&&(TimerSystem_1.TimerSystem.Remove(this.TickHandle),this.TickHandle=void 0)}Z4l(t,i){t=MathUtils_1.MathUtils.Clamp(t/i,0,1);this.GetSprite(2).SetFillAmount(t)}iVl(t){this.GetText(1).SetUIActive(t)}tVl(t){LguiUtil_1.LguiUtil.SetLocalTextNew(this.GetText(1),"MapTravelLevelUp_Text",t)}J4l(){LguiUtil_1.LguiUtil.SetLocalTextNew(this.GetText(1),"MapTravelLevelCanUp_Text"),this.iVl(!0)}eCo(t){this.GetText(0).SetText(t.toString())}}exports.TravelLevelTipsView=TravelLevelTipsView;
//# sourceMappingURL=TravelLevelTipsView.js.map