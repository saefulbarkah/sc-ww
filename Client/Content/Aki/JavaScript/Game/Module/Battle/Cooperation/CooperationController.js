
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CooperationController=void 0;const Log_1=require("../../../../Core/Common/Log"),ModelManager_1=require("../../../Manager/ModelManager"),FormationDataController_1=require("../../Abilities/FormationDataController"),BuffItemControl_1=require("../../BuffItem/BuffItemControl"),ScrollingTipsController_1=require("../../ScrollingTips/ScrollingTipsController");class CooperationController{static TryCooperate(e){if(ModelManager_1.ModelManager.SceneTeamModel.ChangingRole)Log_1.Log.CheckInfo()&&Log_1.Log.Info("SceneTeam",48,"在换人请求返回前尝试换人");else{var o=ModelManager_1.ModelManager.SceneTeamModel,r=o.GetCurrentTeamItem,a=r?.EntityHandle;if(a&&r.GetCreatureDataId()!==e){var t=o.GetTeamItem(e,{ParamType:3});if(t?.EntityHandle)if(t.IsMyRole()){a=a.Entity.CheckGetComponent(194);if(!a.HasTag(1008164187)&&!a.HasTag(191377386)){var l=ModelManager_1.ModelManager.TowerModel.CheckInTower();if(a.HasTag(-1697149502))l&&!FormationDataController_1.FormationDataController.GlobalIsInFight&&ScrollingTipsController_1.ScrollingTipsController.ShowTipsById("CannotChangeRoleBeforeStartBattle");else{a=o.CurrentGroupType;if(-1!==a&&3!==a)return t.IsDead()?ModelManager_1.ModelManager.SceneTeamModel.IsAllDid()||l?void(l&&ScrollingTipsController_1.ScrollingTipsController.ShowTipsById("InstanceDungeonShieldViewCantOpen")):void BuffItemControl_1.BuffItemControl.TryUseResurrectionItem(t.GetConfigId):void(0!==(o=t.CanGoBattle())?Log_1.Log.CheckInfo()&&Log_1.Log.Info("SceneTeam",48,"上场角色无法换人",["Result",o],["roleId",t.GetConfigId]):this.n7a(r,t));Log_1.Log.CheckInfo()&&Log_1.Log.Info("SceneTeam",48,"当前正在幻象组或剧情组，不能切角色")}}}else Log_1.Log.CheckInfo()&&Log_1.Log.Info("SceneTeam",48,"上场角色为其他玩家的角色",["CreatureDataId",e]),this.n7a(r,t);else Log_1.Log.CheckInfo()&&Log_1.Log.Info("SceneTeam",48,"上场角色实体不存在",["CreatureDataId",e])}else Log_1.Log.CheckInfo()&&Log_1.Log.Info("SceneTeam",48,"下场角色实体不存在或相同",["CreatureDataId",e])}}static n7a(e,o){for(const r of ModelManager_1.ModelManager.CooperationModel.GetHandlers())if(r.Trigger(e,o))break}}exports.CooperationController=CooperationController;
//# sourceMappingURL=CooperationController.js.map