
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LevelPlayReportModel=void 0;const ModelBase_1=require("../../../Core/Framework/ModelBase"),MathUtils_1=require("../../../Core/Utils/MathUtils"),IVar_1=require("../../../UniverseEditor/Interface/IVar"),EventDefine_1=require("../../Common/Event/EventDefine"),EventSystem_1=require("../../Common/Event/EventSystem"),ConfigManager_1=require("../../Manager/ConfigManager");class LevelPlayReportModel extends ModelBase_1.ModelBase{constructor(){super(...arguments),this.nLl=new Map,this.sLl=new Map,this.aLl=new Map,this.Y9l=new Map,this.Ka1=new Map}HasRequestDetail(e,t){e=this.lLl(e,t);return this.nLl.get(e)??!1}SetRequestDetailFlag(e,t){e=this.lLl(e,t);this.nLl.set(e,!0)}ResetDetailRequestFlag(){this.nLl.clear()}lLl(e,t){return e+"_"+t}UpdateSimpleReportMsg(e){this.sLl.clear(),e.forEach(e=>{var t=this.lLl(e.r6n,e._ps);this.sLl.set(t,e)}),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.LevelPlayReportSimpleUpdate)}GetSimpleReportMsgMap(){return this.sLl}UpdateLevelPlayStateMsg(e){this.Y9l.clear(),this.Ka1.clear(),e.forEach(e=>{var t=e.wn1,r=e.An1;for(const n in t){var s=Number(n),a=t[s],i=this.lLl(e.r6n,s);this.Y9l.set(i,a),this.Ka1.set(i,r[s])}}),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.LevelPlayStateDetailUpdate)}GetLevelPlayStateMsgMap(){return this.Y9l}IsCommonLevelPlayComplete(e,t){var r=this.lLl(e,t);return 3===(this.Y9l.get(r)??0)||!((this.Ka1.get(r)??0)<=0)&&1===ConfigManager_1.ConfigManager.MapConfig.GetMapMarkByGamePlayId(t,e)?.HistoryState}IsCommonLevelPlayDiscover(e,t){return!!this.IsCommonLevelPlayComplete(e,t)||(e=this.lLl(e,t),0<(this.Y9l.get(e)??0))}GetSimpleReportMsg(e,t){e=this.lLl(e,t);return this.sLl.get(e)}UpdateDetailReportMsg(e,t,r){var s=this.lLl(e,t);this.aLl.set(s,r),EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.LevelPlayReportDetailUpdate,e,t)}GetVar(e,t,r){e=this.lLl(e,t),t=this.aLl.get(e);if(void 0!==t){var s=t[r];if(void 0!==s){let e=void 0;switch((0,IVar_1.getVarTypeByIndex)(s.iTs)){case"Boolean":e=s.rTs;break;case"Float":e=s.sTs;break;case"Int":e=MathUtils_1.MathUtils.LongToNumber(s.oTs);break;case"String":e=s.nTs;break;default:e=void 0}return e}}}IsLevelPlayReportComplete(e,t){let r=1;for(const s of ConfigManager_1.ConfigManager.LevelPlayReportConfig.GetLevelPlayReportConfig(t)?.Vars??[])this.GetVar(e,t,s)||(r=0);return 1===r}HaveLevelPlayReportRewardCanGet(e,t){var r=ConfigManager_1.ConfigManager.LevelPlayReportConfig.GetLevelPlayReportConfig(t),s=this.GetSimpleReportMsg(e,t)?.Pn1??0;let a=0;for(const i of r.Vars)this.GetVar(e,t,i)&&(a+=1);return s<a}GetLevelPlayReportTarget(e,t){var r={States:[],ConditionTxtIds:[],GetBoxNum:0};for(const n of ConfigManager_1.ConfigManager.LevelPlayReportConfig.GetLevelPlayReportConfig(t)?.Vars??[])this.GetVar(e,t,n)?r.States.push(1):r.States.push(0);var s=ConfigManager_1.ConfigManager.WorldMapConfig.GetPunishReportConfig(t),a=s?.CondDescription1??"",i=s?.CondDescription2??"",s=s?.CondDescription3??"",a=(r.ConditionTxtIds.push(a),r.ConditionTxtIds.push(i),r.ConditionTxtIds.push(s),this.GetSimpleReportMsg(e,t));return r.GetBoxNum=a?.Pn1??0,r}}exports.LevelPlayReportModel=LevelPlayReportModel;
//# sourceMappingURL=LevelPlayReportModel.js.map