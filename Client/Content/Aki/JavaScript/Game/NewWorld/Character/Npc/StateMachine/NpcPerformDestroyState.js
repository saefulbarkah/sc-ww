
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.NpcPerformDestroyState=void 0;const UE=require("ue"),Log_1=require("../../../../../Core/Common/Log"),ResourceSystem_1=require("../../../../../Core/Resource/ResourceSystem"),TimerSystem_1=require("../../../../../Core/Timer/TimerSystem"),MathUtils_1=require("../../../../../Core/Utils/MathUtils"),IComponent_1=require("../../../../../UniverseEditor/Interface/IComponent"),ControllerHolder_1=require("../../../../Manager/ControllerHolder"),ModelManager_1=require("../../../../Manager/ModelManager"),NpcPerformComponent_1=require("../Component/NpcPerformComponent"),NpcPerformBaseState_1=require("./NpcPerformBaseState");class NpcPerformDestroyState extends NpcPerformBaseState_1.NpcPerformBaseState{constructor(){super(...arguments),this.mra=void 0,this.nal=void 0,this.sal=!1,this.aal=void 0,this.lal=void 0,this.hal=!1,this.Tca=!1,this.wCe=0}OnCreate(t){super.OnCreate(t),this.mra=t?.DeathInteract?.Montage,this.aal=t?.DeathInteract?.MaterialDa;var t=this.Owner.Entity.GetComponent(0)?.GetPbEntityInitData();t&&(t=(0,IComponent_1.getComponent)(t.ComponentsData,"EntityVisibleComponent"),this.Tca=!!t?.UseFadeEffect)}OnEnter(t){this.gra()}gra(){2===this.Owner.Entity.GetComponent(0).GetSubEntityType()?this.vra():this.pra()}vra(){this.ActorComp.Actor.DitherEffectController?.EnterDisappearEffect(MathUtils_1.MathUtils.SecondToMillisecond/NpcPerformComponent_1.DEFUALT_DITHER_TIME,1,!0),TimerSystem_1.TimerSystem.Delay(()=>{ControllerHolder_1.ControllerHolder.CreatureController.DelayRemoveEntityFinished(this.Owner?.Entity)},NpcPerformComponent_1.DEFUALT_DITHER_TIME)}pra(){this._al(),this.ual()}_al(){let t=void 0;(t=this.mra?this.mra.IsAbp?ModelManager_1.ModelManager.PlotModel.GetAbpMontageConfig(this.mra.MontageId):ModelManager_1.ModelManager.PlotModel.GetMontageConfig(this.mra.MontageId):t)?ResourceSystem_1.ResourceSystem.LoadAsync(t.ActionMontage,UE.AnimMontage,(t,e)=>{this.sal=!0,this.nal=t,this.cal()}):(this.sal=!0,this.cal())}ual(){this.aal&&""!==this.aal?ResourceSystem_1.ResourceSystem.LoadAsync(this.aal,UE.PD_HolographicEffect_C,(t,e)=>{this.hal=!0,this.lal=t,this.cal()}):(this.hal=!0,this.cal())}cal(){var t;this?.ActorComp?.Actor?.IsValid()&&this.sal&&this.hal&&(this.lal?.IsValid()&&(t=this.lal,this.wCe=(t.Start+t.Loop)*MathUtils_1.MathUtils.SecondToMillisecond,this.PerformComp?.MaterialController?.ApplySimpleMaterialEffectByAsset(this.lal),Log_1.Log.CheckDebug())&&Log_1.Log.Debug("NPC",50,"播放销毁材质表现",["PbDataId",this.ActorComp.CreatureData.GetPbDataId()],["Path",this.aal],["Time",this.wCe]),this.nal?.IsValid()&&(t=this.nal.SequenceLength*MathUtils_1.MathUtils.SecondToMillisecond,0===this.wCe&&(this.wCe=t),this.PerformComp?.PlayOnce(this.nal),Log_1.Log.CheckDebug())&&Log_1.Log.Debug("NPC",50,"播放销毁Montage",["PbDataId",this.ActorComp.CreatureData.GetPbDataId()],["Montage",this.nal.GetName()],["Time",t]),this.Tca&&(0===this.wCe&&(this.wCe=NpcPerformComponent_1.DEFUALT_DITHER_TIME),this.ActorComp.Actor.DitherEffectController?.EnterDisappearEffect(MathUtils_1.MathUtils.SecondToMillisecond/this.wCe,1,!1)),this.mal())}mal(){0===this.wCe?ControllerHolder_1.ControllerHolder.CreatureController.DelayRemoveEntityFinished(this.Owner.Entity):TimerSystem_1.TimerSystem.Delay(()=>{ControllerHolder_1.ControllerHolder.CreatureController.DelayRemoveEntityFinished(this.Owner?.Entity)},this.wCe)}}exports.NpcPerformDestroyState=NpcPerformDestroyState;
//# sourceMappingURL=NpcPerformDestroyState.js.map