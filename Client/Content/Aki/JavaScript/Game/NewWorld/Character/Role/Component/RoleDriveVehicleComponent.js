
"use strict";var __decorate=this&&this.__decorate||function(e,t,i,r){var n,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var h=e.length-1;0<=h;h--)(n=e[h])&&(s=(o<3?n(s):3<o?n(t,i,s):n(t,i))||s);return 3<o&&s&&Object.defineProperty(t,i,s),s};Object.defineProperty(exports,"__esModule",{value:!0}),exports.RoleDriveVehicleComponent=void 0;const RegisterComponent_1=require("../../../../../Core/Entity/RegisterComponent"),TimerSystem_1=require("../../../../../Core/Timer/TimerSystem"),EventDefine_1=require("../../../../Common/Event/EventDefine"),EventSystem_1=require("../../../../Common/Event/EventSystem"),BasePlatform_1=require("../../../Common/BasePlatform"),VehicleConfig_1=require("../../../Vehicle/Common/VehicleConfig"),VehicleController_1=require("../../../Vehicle/Controller/VehicleController"),CharacterDriveVehicleComponent_1=require("../../Common/Component/CharacterDriveVehicleComponent");let RoleDriveVehicleComponent=class RoleDriveVehicleComponent extends CharacterDriveVehicleComponent_1.CharacterDriveVehicleComponent{constructor(){super(...arguments),this.OnChangeRideSharingResponse=e=>{this.TagComp?.AddTag(-1296410005)},this.OnRemoveRideSharingResponse=e=>{this.TagComp?.RemoveTag(-1296410005)}}OnActivate(){VehicleController_1.VehicleController.OnCharacterActivate(this.Entity)}OnTick(e){var t;this.IsOnVehicle||(t=this.ActorComp.Actor.BasedMovement,BasePlatform_1.BasePlatformController.GetBasePlatformByBasedMovementInfo(t)instanceof BasePlatform_1.VehicleBasePlatform?this.SetWaterEffect(!1):this.SetWaterEffect(!0))}OnEnterVehicle(e){super.OnEnterVehicle(e),e.IsDriver&&e.IsRolePassenger(!0)&&this.AddRideSharingEvents()}OnLeaveVehicle(e){e.IsDriver&&e.IsRolePassenger(!0)&&this.RemoveRideSharingEvents(),super.OnLeaveVehicle(e)}PostEnterVehiclePerform(e){super.PostEnterVehiclePerform(e),this.TagComp.AddTag(525255941)}LeaveVehiclePerform(e){this.TagComp.RemoveTag(525255941),super.LeaveVehiclePerform(e),0===e.ExitType&&this.JumpToAirAndParagliding(e)}JumpToAirAndParagliding(e){var t,i=e.PassengerEntity?.GetComponent(2);if(i){i.Actor.CharacterMovement?.SetMovementMode(3);const r=e.PassengerEntity?.GetComponent(167);r&&(i=e.VehicleEntity?.GetComponent(221))&&(e=i.Config?.CatapultSpeed??VehicleConfig_1.CATAPULT_TO_AIR_SPEED,t=i.Config?.ParaglidingDelayTime??VehicleConfig_1.PARAGLIDING_DELAY_MILISECONDS,r.GravityUp.Multiply(e,this.TmpVector1),i?.GetVehicleVelocity(this.TmpVector2),this.TmpVector1.AdditionEqual(this.TmpVector2),r.SetForceSpeed(this.TmpVector1),this.TagComp?.AddTag(-1747001544),TimerSystem_1.TimerSystem.Delay(()=>{this.TagComp?.RemoveTag(-1747001544),r?.TrySetGlide()},t))}}ClearCurrentState(){var e=this.Entity.GetComponent(35);e.Valid&&e.CurrentSkill&&e.StopGroup1Skill("进入载具打断技能"),super.ClearCurrentState()}AddRideSharingEvents(){this.ActorComp?.IsRoleAndCtrlByMe&&(EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnChangeRideSharingPassengerResponse,this.OnChangeRideSharingResponse),EventSystem_1.EventSystem.Add(EventDefine_1.EEventName.OnRemoveRideSharingPassengerResponse,this.OnRemoveRideSharingResponse))}RemoveRideSharingEvents(){this.ActorComp?.IsRoleAndCtrlByMe&&(EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnChangeRideSharingPassengerResponse,this.OnChangeRideSharingResponse),EventSystem_1.EventSystem.Remove(EventDefine_1.EEventName.OnRemoveRideSharingPassengerResponse,this.OnRemoveRideSharingResponse))}};RoleDriveVehicleComponent=__decorate([(0,RegisterComponent_1.RegisterComponent)(218)],RoleDriveVehicleComponent),exports.RoleDriveVehicleComponent=RoleDriveVehicleComponent;
//# sourceMappingURL=RoleDriveVehicleComponent.js.map