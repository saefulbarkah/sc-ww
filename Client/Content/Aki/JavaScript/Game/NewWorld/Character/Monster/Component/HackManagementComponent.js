
"use strict";var HackManagementComponent_1,__decorate=this&&this.__decorate||function(t,e,i,n){var o,r=arguments.length,a=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;0<=s;s--)(o=t[s])&&(a=(r<3?o(a):3<r?o(e,i,a):o(e,i))||a);return 3<r&&a&&Object.defineProperty(e,i,a),a};Object.defineProperty(exports,"__esModule",{value:!0}),exports.HackManagementComponent=void 0;const Time_1=require("../../../../../Core/Common/Time"),EntityComponent_1=require("../../../../../Core/Entity/EntityComponent"),RegisterComponent_1=require("../../../../../Core/Entity/RegisterComponent"),TimerSystem_1=require("../../../../../Core/Timer/TimerSystem"),MathUtils_1=require("../../../../../Core/Utils/MathUtils"),ControllerHolder_1=require("../../../../Manager/ControllerHolder"),ModelManager_1=require("../../../../Manager/ModelManager"),PreloadConfigStatementPart4_1=require("../../../../Preload/PreloadConfigStatementPart4"),NUM_TAG_ID=586736149,NUM_IS_EMPTY_TAG_ID=-1725495138,HACKING_TAG_ID=1545618306,TIP_TEXT_ID="ClientErrorCode_0_Text",SHOW_TIP_INTERVAL=1e3;let HackManagementComponent=HackManagementComponent_1=class HackManagementComponent extends EntityComponent_1.EntityComponent{constructor(){super(...arguments),this.Lo=void 0,this.EIe=void 0,this.Lie=void 0,this.R2_=0,this.A2_=[],this.P2_=!1,this.x2_=0,this.U2_=(t,e)=>{var i=Time_1.Time.Now-this.x2_;e&&this.P2_&&i>SHOW_TIP_INTERVAL&&(this.x2_=Time_1.Time.Now,e=PreloadConfigStatementPart4_1.configMultiTextLang.GetLocalTextNew(TIP_TEXT_ID),ControllerHolder_1.ControllerHolder.GenericPromptController.ShowPromptByItsType(9,void 0,void 0,[e]))}}OnInitData(t){t=t.GetParam(HackManagementComponent_1)[0];return this.Lo=t,this.R2_=this.Lo.MaxHackingCount,!0}OnStart(){if(this.EIe=this.Entity.GetComponent(0),this.EIe?.PbHackingEntities)for(const i of this.EIe.PbHackingEntities){var t=MathUtils_1.MathUtils.LongToNumber(i),t=ModelManager_1.ModelManager.CreatureModel.GetEntity(t);t&&t.Entity?.Valid&&this.A2_.push(t.Entity)}this.Lie=this.Entity.GetComponent(200),this.Lie?.AddTag(NUM_TAG_ID);var e=this.GetRemainingHackNumber();return 1<e&&this.Lie?.TagContainer.UpdateExactTag(1,NUM_TAG_ID,e-1),this.Lie?.AddTagAddOrRemoveListener(NUM_IS_EMPTY_TAG_ID,(t,e)=>{TimerSystem_1.TimerSystem.Delay(()=>{this.P2_=e},100)}),this.Lie?.AddTagAddOrRemoveListener(HACKING_TAG_ID,this.U2_),!0}CanHack(){return this.A2_.length<this.R2_}AddHackEntity(t){this.A2_.push(t),this.Lie?.TagContainer.UpdateExactTag(1,NUM_TAG_ID,-1)}RemoveHackEntity(t){t=this.A2_.indexOf(t);-1!==t&&(this.A2_.splice(t,1),this.Lie?.TagContainer.UpdateExactTag(1,NUM_TAG_ID,1))}GetRemainingHackNumber(){return Math.max(0,this.R2_-this.A2_.length)}};HackManagementComponent=HackManagementComponent_1=__decorate([(0,RegisterComponent_1.RegisterComponent)(270)],HackManagementComponent),exports.HackManagementComponent=HackManagementComponent;
//# sourceMappingURL=HackManagementComponent.js.map