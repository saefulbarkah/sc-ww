
"use strict";var __decorate=this&&this.__decorate||function(t,i,h,s){var e,o=arguments.length,r=o<3?i:null===s?s=Object.getOwnPropertyDescriptor(i,h):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,i,h,s);else for(var a=t.length-1;0<=a;a--)(e=t[a])&&(r=(o<3?e(r):3<o?e(i,h,r):e(i,h))||r);return 3<o&&r&&Object.defineProperty(i,h,r),r};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CharacterAttachComponent=void 0;const Log_1=require("../../../../../Core/Common/Log"),EntityComponent_1=require("../../../../../Core/Entity/EntityComponent"),RegisterComponent_1=require("../../../../../Core/Entity/RegisterComponent"),Vector_1=require("../../../../../Core/Utils/Math/Vector"),ModelManager_1=require("../../../../Manager/ModelManager");let CharacterAttachComponent=class CharacterAttachComponent extends EntityComponent_1.EntityComponent{constructor(){super(...arguments),this.r4a=void 0,this.o4a=void 0,this.n4a=void 0,this.s4a=Vector_1.Vector.Create(),this.a4a=2,this.Hte=void 0,this.Gce=void 0,this.Lie=void 0,this.h4a=void 0,this.l4a=void 0}OnStart(){return this.l4a=[],this.o4a=void 0,this.r4a=void 0,this.n4a=void 0,this.a4a=2,this.h4a=void 0,this.Hte=this.Entity.GetComponent(3),this.Gce=this.Entity.GetComponent(164),this.Lie=this.Entity.GetComponent(191),!0}StartAttachToTarget(t,i,h,s){this.DetachFromHost(!1,!1);var e=t.Entity?.GetComponent(3);e?.Valid&&(this.r4a=t,this.o4a=s,this.n4a=i,this.s4a.DeepCopy(h),this.a4a=0,this.h4a=this.Gce?.Disable("CharacterAttachComponent Disable"),this.Hte?.Valid)&&(this.Hte.Actor.CharacterMovement.SetMovementMode(0),this.Hte.Actor.CapsuleComponent.IgnoreActorWhenMoving(e.Actor,!0),e.Actor.CapsuleComponent.IgnoreActorWhenMoving(this.Hte.Actor,!0))}AttachToTarget(t){var i=t.Entity?.GetComponent(3);i?.Valid&&(0!==this.a4a||this.r4a!==t?Log_1.Log.CheckError()&&Log_1.Log.Error("Character",57,"Attach到目标失败"):this.Hte?.Valid&&this.Lie?.Valid&&(this.Hte.Owner.K2_AttachToActor(i.Actor,this.n4a,1,1,1,!1),this.o4a&&this.Lie.AddTag(this.o4a.TagId),this.a4a=1,this._4a()))}DetachFromHost(t,i){1===this.a4a&&this.Hte?.Owner.K2_DetachFromActor(1,1,1),t&&this.u4a(i),this.c4a(),this.m4a()}u4a(i){for(let t=this.l4a.length-1;0<=t;--t){var h=this.l4a[t];h.Entity?.Valid&&(h=h.Entity.GetComponent(166))?.Valid&&h.DetachFromHost(i,i)}this.l4a.length=0}_4a(){var t;this.r4a?.Valid&&(t=this.r4a.Entity.GetComponent(166))?.Valid&&t.d4a(ModelManager_1.ModelManager.CharacterModel.GetHandleByEntity(this.Entity))}m4a(){var t;this.r4a?.Valid&&(t=this.r4a.Entity.GetComponent(166))?.Valid&&t.C4a(ModelManager_1.ModelManager.CharacterModel.GetHandleByEntity(this.Entity))}d4a(t){t&&!this.l4a.includes(t)&&this.l4a.push(t)}C4a(t){!t||(t=this.l4a.indexOf(t))<0||this.l4a.splice(t,1)}c4a(){var t;this.o4a&&(this.Lie?.RemoveTag(this.o4a.TagId),this.o4a=void 0),this.h4a&&(this.Gce?.Enable(this.h4a,"CharacterAttachComponent Enable"),this.h4a=void 0),this.Hte?.Valid&&(this.Hte.Actor.CharacterMovement.SetDefaultMovementMode(),(t=this.r4a?.Entity?.GetComponent(3))?.Valid)&&(this.Hte.Actor.CapsuleComponent.IgnoreActorWhenMoving(t.Actor,!1),t.Actor.CapsuleComponent.IgnoreActorWhenMoving(this.Hte.Actor,!1)),this.r4a=void 0,this.n4a=void 0,this.a4a=2}OnEnd(){return this.DetachFromHost(!0,!1),this.Hte=void 0,this.Gce=void 0,!(this.Lie=void 0)}};CharacterAttachComponent=__decorate([(0,RegisterComponent_1.RegisterComponent)(166)],CharacterAttachComponent),exports.CharacterAttachComponent=CharacterAttachComponent;
//# sourceMappingURL=CharacterAttachComponent.js.map