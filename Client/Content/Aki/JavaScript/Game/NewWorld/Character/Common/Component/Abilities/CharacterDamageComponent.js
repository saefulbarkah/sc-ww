
"use strict";var __decorate=this&&this.__decorate||function(e,t,r,a){var i,o=arguments.length,n=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,a);else for(var s=e.length-1;0<=s;s--)(i=e[s])&&(n=(o<3?i(n):3<o?i(t,r,n):i(t,r))||n);return 3<o&&n&&Object.defineProperty(t,r,n),n};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CharacterDamageComponent=void 0;const Time_1=require("../../../../../../Core/Common/Time"),CommonDefine_1=require("../../../../../../Core/Define/CommonDefine"),CommonParamById_1=require("../../../../../../Core/Define/ConfigCommon/CommonParamById"),RegisterComponent_1=require("../../../../../../Core/Entity/RegisterComponent"),EventDefine_1=require("../../../../../Common/Event/EventDefine"),EventSystem_1=require("../../../../../Common/Event/EventSystem"),ControllerHolder_1=require("../../../../../Manager/ControllerHolder"),ModelManager_1=require("../../../../../Manager/ModelManager"),BaseDamageComponent_1=require("./BaseDamageComponent"),CharacterAttributeTypes_1=require("./CharacterAttributeTypes"),CharacterDamageCalculations_1=require("./CharacterDamageCalculations");let CharacterDamageComponent=class CharacterDamageComponent extends BaseDamageComponent_1.BaseDamageComponent{constructor(){super(...arguments),this.ActorComponent=void 0,this.$br=void 0,this.HBr=void 0,this.eqr=0,this.tqr=0}OnStart(){return!!super.OnStart()&&(this.ActorComponent=this.Entity.CheckGetComponent(3),this.$br=this.Entity.CheckGetComponent(60),this.HBr=this.Entity.GetComponent(170),this.eqr=this.oqr(),!0)}OnTick(e){-this.ActorComponent.ActorVelocityProxy.Z>=this.eqr?0===this.tqr&&(this.tqr=Time_1.Time.WorldTimeSeconds):this.tqr=0}FallInjure(){var e,t,r,a;this.TagComponent.HasTag(1918148596)||!this.HBr?.IsInGame||ModelManager_1.ModelManager.DeadReviveModel.SkipFallInjure||this.TagComponent.HasTag(560942831)||(e=this.ActorComponent.Actor.CharacterMovement.GetLastUpdateVelocity().Z,r=this.ActorComponent.ActorVelocityProxy.Z,a=this.Pqr(),-e<this.eqr&&(this.tqr=0),t=this.tqr?Time_1.Time.WorldTimeSeconds-this.tqr:0,(r=Math.ceil(this.xqr(-e,-r,a,t)))<=0)||(a=this.CreatureDataComponent.GetCreatureDataId(),this.Entity.GetComponent(67).CollectSampleAndSend(),ControllerHolder_1.ControllerHolder.CreatureController.LandingDamageRequest(a,e,t*CommonDefine_1.MILLIONSECOND_PER_SECOND),EventSystem_1.EventSystem.EmitWithTarget(this.Entity,EventDefine_1.EEventName.CharOnFallInjure,r,!1),this.BuffComponent?.RemoveBuffByEffectType(36,"跌落伤害移除冰冻buff"),this.$br.NeedCalculateFallInjure=!1)}xqr(e,t,r,a){let i=0;var o=this.AttributeComponent.GetCurrentValue(CharacterAttributeTypes_1.EAttributeId.l5n);return(i=this.CreatureDataComponent.IsRealMonster()?CharacterDamageCalculations_1.Calculation.LandingDamageCalculationMonster(r,o):CharacterDamageCalculations_1.Calculation.LandingDamageCalculationRole(e,t,a,o))<=0?0:i}Pqr(){var e,t;return this.$br.NeedCalculateFallInjure&&(e=this.$br.BeHitLocation.Z,(t=this.ActorComponent.ActorLocationProxy.Z)<e)?e-t:0}oqr(){return CommonParamById_1.configCommonParamById.GetIntArrayConfig("landing_damage_args_role")[1]}};CharacterDamageComponent=__decorate([(0,RegisterComponent_1.RegisterComponent)(20)],CharacterDamageComponent),exports.CharacterDamageComponent=CharacterDamageComponent;
//# sourceMappingURL=CharacterDamageComponent.js.map