
"use strict";var CreatureDataComponent_1,__decorate=this&&this.__decorate||function(t,e,i,s){var r,o=arguments.length,n=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,s);else for(var h=t.length-1;0<=h;h--)(r=t[h])&&(n=(o<3?r(n):3<o?r(e,i,n):r(e,i))||n);return 3<o&&n&&Object.defineProperty(e,i,n),n};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CreatureDataComponent=void 0;const UE=require("ue"),Log_1=require("../../../../../Core/Common/Log"),MonsterBattleConfById_1=require("../../../../../Core/Define/ConfigQuery/MonsterBattleConfById"),Protocol_1=require("../../../../../Core/Define/Net/Protocol"),EntityComponent_1=require("../../../../../Core/Entity/EntityComponent"),RegisterComponent_1=require("../../../../../Core/Entity/RegisterComponent"),Net_1=require("../../../../../Core/Net/Net"),DataTableUtil_1=require("../../../../../Core/Utils/DataTableUtil"),FNameUtil_1=require("../../../../../Core/Utils/FNameUtil"),GameplayTagUtils_1=require("../../../../../Core/Utils/GameplayTagUtils"),Rotator_1=require("../../../../../Core/Utils/Math/Rotator"),Vector_1=require("../../../../../Core/Utils/Math/Vector"),MathUtils_1=require("../../../../../Core/Utils/MathUtils"),IComponent_1=require("../../../../../UniverseEditor/Interface/IComponent"),EventDefine_1=require("../../../../Common/Event/EventDefine"),EventSystem_1=require("../../../../Common/Event/EventSystem"),ConfigManager_1=require("../../../../Manager/ConfigManager"),ModelManager_1=require("../../../../Manager/ModelManager"),AdviceData_1=require("../../../../Module/Advice/AdviceData"),CreatureController_1=require("../../../../World/Controller/CreatureController"),BlackboardMap_1=require("../../../../World/Define/BlackboardMap"),CreateEntityData_1=require("../../CreateEntityData");let CreatureDataComponent=CreatureDataComponent_1=class CreatureDataComponent extends EntityComponent_1.EntityComponent{constructor(){super(...arguments),this.Wpo=0,this.j8=0,this.Ehh=0,this.dFe=0,this.fie=Protocol_1.Aki.Protocol.kks.Proto_Monster,this.QQr=0,this.XQr=Protocol_1.Aki.Protocol.rLs.Proto_OldEntity,this.E0=0,this.$Qr=void 0,this.zZa=!1,this.JZa=void 0,this.vil=void 0,this.Mil=void 0,this.Yql=0,this.wIl=0,this.YQr=0,this.JQr=0,this.zQr=0,this.ZQr=0,this.eXr=void 0,this.Yre=void 0,this.tXr=new Array,this.mQt=new Set,this.yne=!1,this.iXr=!1,this.LivingStatus=void 0,this.oXr=0,this.EntityCommonTags=new Set,this.RelationId=0,this.PbRelationMatchCfgIndex=-1,this.ControllerId=0,this.PbDynAttachEntityConfigId=0,this.PbDynAttachEntityActorKey="",this.PbDynAttachRefActorKey="",this.PbDynAttachRelPos=Vector_1.Vector.Create(),this.PbDynAttachRelRot=Rotator_1.Rotator.Create(),this.IsShowingHandFx=!1,this.AutonomousId=0,this.XAl=0,this.OccupiedGridInfo=new Map,this.DynamicGridInfo=[],this.BoardCanMove=!0,this.rXr=0,this.nXr=void 0,this.sXr="",this.aXr=0,this.qne=void 0,this.hXr=void 0,this.lXr=0,this._Xr=void 0,this.ou=!1,this.uXr=void 0,this.PbInRangeEntityCreatureDataIds=void 0,this.PbInRangePlayerIds=void 0,this.PbSceneItemAttributeIds=void 0,this.PbPullingFoundationEntityId=void 0,this.PbSceneAiEnabled=!1,this.PbPatrolInfoPb=void 0,this.PbAnimalInitialPartIds=void 0,this.PbCombinePartInfoList=void 0,this.PbCombineTargetServerId=void 0,this.PbHookLockPointDisabled=!1,this.wDe=0,this.vH=0,this.mXr=!1,this.dXr=void 0,this.d7a=void 0,this.CXr=!1,this.gXr="",this.ger=void 0,this.fXr=0,this.pXr=void 0,this.vXr=!1,this.MXr=void 0,this.EXr=void 0,this.SXr=void 0,this.t4r=void 0,this.ComponentDataMap=new Map,this.yXr=!1,this.Dne=!1,this.IXr=void 0,this.IsConcealed=!1,this.SummonType=Protocol_1.Aki.Protocol.Summon.x3s.Proto_ESummonTypeDefault,this.TXr=void 0,this.LXr=0,this.DXr=0,this.RXr=new Array,this.UXr=new Array,this.xRn=new Map,this.ComponentsKey=0n,this.AXr=-1n}OnEnd(){return EventSystem_1.EventSystem.Emit(EventDefine_1.EEventName.RemoveCreatureDataComponentCache,this.E0),!0}OnInitData(t){var e,i=t,s=i.ComponentsKey;return i instanceof CreateEntityData_1.CreateEntityData?(i=i.EntityData,this.E0=this.Entity.Id,this.ComponentsKey=s,s=ModelManager_1.ModelManager.CharacterModel.GetHandleByEntity(this.Entity),e=t.CreatureDataId,this.SetCreatureDataId(e),s.CreatureDataId=e,this.SetPbDataId(i.v9n),s.PbDataId=i.v9n,this.SetPrefabId(i.LEs),this.SetOwnerIncId(MathUtils_1.MathUtils.LongToNumber(i.qr1)),this.SetEntityConfigType(i.ZHn),s.ConfigType=i.ZHn,this.SetComponentKey(t.ComponentsKey),s.EntityType=i.zHn,this.dXr=t.PbEntityInitData,this.d7a=t.TemplateData,this.gXr=t.PbModelConfigId??"",this.IsConcealed=t.IsConcealed,this.SetPbDataByProtocol(i),this.Yre=new BlackboardMap_1.BlackboardMap,this.IsConcealed=t.IsConcealed,this.nTa(),(e=this.Entity?.EntityData?.GetCreatureDataComponent())&&(e.EntityType=this.fie),!0):(Log_1.Log.CheckError()&&Log_1.Log.Error("Entity",3,"[CreatureDataComponent.OnCreate] createEntityData无效。"),!1)}get ModelBlueprintPath(){return this.sXr}get IsPosAbnormal(){return this.mXr}SetPosAbnormal(t){this.mXr=t}get EntityPbModelConfigId(){return this.gXr}get LiftFloor(){return this.fXr}get IsPlotPlayerOwned(){return!!this.pXr&&this.pXr===ModelManager_1.ModelManager.CreatureModel.GetPlayerId()}ClearPlotPlayerInfo(){this.pXr=void 0,this.vXr=!1}get IsConcomitantEntity(){return[Protocol_1.Aki.Protocol.Summon.x3s.Proto_ESummonTypeConcomitantVision,Protocol_1.Aki.Protocol.Summon.x3s.Proto_ESummonTypeConcomitantCustom].includes(this.SummonType)}get VisionControlCreatureDataId(){return this.LXr}set VisionControlCreatureDataId(t){this.LXr=t}get VisionSkillServerEntityId(){return this.DXr}set VisionSkillServerEntityId(t){this.DXr=t}get CustomServerEntityIds(){return this.RXr}get SummonEntityIds(){return this.UXr}set SummonEntityIds(t){this.UXr=t}get ServerStartLocation(){return this.TXr}GetEntityVar(t){return this.xRn.get(t)}SetMovementByProtocol(t){void 0===this.eXr&&(this.eXr=Protocol_1.Aki.Protocol.C8n.create()),this.eXr.f8n=t.f8n,this.eXr.KWn=t.KWn,this.eXr.P5n=t.P5n,this.eXr.g8n=t.g8n,this.eXr.QWn=t.QWn,this.eXr.XWn=t.XWn,this.eXr.KVn=t.KVn}SetCreatureDataId(t){this.Wpo=t}GetCreatureDataId(){return this.Wpo}GetPlayerId(){return this.j8}SetPlayerId(t){this.j8=t}GetOwnerId(){return MathUtils_1.MathUtils.LongToBigInt(MathUtils_1.MathUtils.NumberToLong(this.Ehh))}GetOwnerIncId(){return this.Ehh}SetOwnerIncId(t){this.Ehh=t}GetRoleId(){return this.dFe}SetRoleId(t){this.dFe=t}GetTrackingIsEnable(){return this.CXr}GetEntityCamp(){if(void 0!==this._Xr)return this._Xr;if(this.GetPbEntityInitData()){var t=this.GetBaseInfo()?.Camp;if(void 0!==t)return t}return Log_1.Log.CheckError()&&Log_1.Log.Error("Character",28,"[清理CDT_EntityConfig]该实体没有对应的Pb表信息Camp",["CreatureDataId",this.GetCreatureDataId()],["TidName",this.GetBaseInfo()?.TidName],["PbDataId",this.GetPbDataId()]),0}GetRoleConfig(){return this.$Qr||(this.$Qr=ConfigManager_1.ConfigManager.RoleConfig.GetRoleConfig(this.dFe)),this.$Qr}GetAutoRoleConfig(){return this.JZa||(this.JZa=ConfigManager_1.ConfigManager.RoleConfig.GetAutoRoleConfig(this.dFe)),this.JZa}GetSkinModelId(){return this.Yql}GetSkinId(){return this.wIl}GetEntityType(){return this.fie}IsRole(){return this.fie===Protocol_1.Aki.Protocol.kks.Proto_Player}IsAutoRole(){return this.fie===Protocol_1.Aki.Protocol.kks.Proto_Player&&this.zZa}IsPlayer(){return this.fie===Protocol_1.Aki.Protocol.kks.Proto_PlayerEntity}IsMonster(){return this.fie===Protocol_1.Aki.Protocol.kks.Proto_Monster}IsNpc(){return this.fie===Protocol_1.Aki.Protocol.kks.Proto_Npc}IsVision(){return this.fie===Protocol_1.Aki.Protocol.kks.Proto_Vision}IsSceneItem(){return this.fie===Protocol_1.Aki.Protocol.kks.Proto_SceneItem}IsAnimal(){return this.fie===Protocol_1.Aki.Protocol.kks.Proto_Animal}IsCustom(){return this.fie===Protocol_1.Aki.Protocol.kks.Proto_Custom}IsCharacter(){return this.IsRole()||this.IsMonster()||this.IsNpc()||this.IsVision()||this.IsAnimal()}IsVehicle(){return this.fie===Protocol_1.Aki.Protocol.kks.bo1}GetSubEntityType(){return this.QQr}SetEntityType(t){this.fie=t}SetSubEntityType(t){this.QQr=t}GetEntityConfigType(){return this.XQr}SetEntityConfigType(t){this.XQr=t}GetLife(){return 0}GetMaxLife(){return 0}GetHardnessModeId(){return this.YQr}SetAiWeaponId(t){this.oXr=t}GetAiWeaponId(){return this.oXr}SetDurabilityValue(t){this.aXr=t,EventSystem_1.EventSystem.EmitWithTarget(this.Entity,EventDefine_1.EEventName.OnSceneItemDurabilityChange,t)}GetDurabilityValue(){return this.aXr}SetHardnessModeId(t){this.YQr=t}PXr(t){this.MXr=new AdviceData_1.AdviceEntityData,this.MXr.Phrase(t)}GetAdviceInfo(){return this.MXr}SetSummonerId(t){this.JQr=t}GetSummonerId(){return this.JQr}SetSummonerPlayerId(t){this.zQr=t}GetSummonerPlayerId(){return this.zQr}SetSummonsVersion(t){this.ZQr=t}GetSummonsVersion(){return this.ZQr}GetMovementInfo(){return this.eXr}SetMovementInfo(t){this.eXr=t}GetLocation(){var t,e,i;return this.eXr?.P5n?(t=(i=this.eXr.P5n).X||0,e=i.Y||0,i=i.Z||0,new UE.VectorDouble(t,e,i)):Vector_1.Vector.ZeroVectorDouble}SetLocation(t){this.eXr||(this.eXr=Protocol_1.Aki.Protocol.C8n.create()),this.eXr.P5n||(this.eXr.P5n=Protocol_1.Aki.Protocol.Gks.create()),this.eXr.P5n.X=t.X??0,this.eXr.P5n.Y=t.Y??0,this.eXr.P5n.Z=t.Z??0;t=this.eXr.P5n;this.TXr=Vector_1.Vector.Create(t.X,t.Y,t.Z)}GetRotation(){var t,e,i;return this.eXr?.g8n?(t=(i=this.eXr.g8n).Pitch||0,e=i.Yaw||0,i=i.Roll||0,new UE.Rotator(t,e,i)):new UE.Rotator(0,0,0)}SetRotation(t){this.eXr||(this.eXr=Protocol_1.Aki.Protocol.C8n.create()),this.eXr.g8n||(this.eXr.g8n=Protocol_1.Aki.Protocol.D2s.create()),this.eXr.g8n.Pitch=t.Pitch,this.eXr.g8n.Roll=t.Roll,this.eXr.g8n.Yaw=t.Yaw}D_GetTransform(){var t=this.GetLocation(),e=this.GetRotation();return UE.KismetMathLibrary.MakeTransformDouble(t,e,Vector_1.Vector.OneVector)}GetBlackboard(){return this.Yre}SetBlackboardsByProtocol(t){if(void 0!==t)for(const e of t)this.SetBlackboardByProtocol(e)}SetBlackboardByProtocol(t){void 0!==t&&(t=BlackboardMap_1.BlackboardParam.CreateByProtocol(t))&&this.Yre.SetValue(t.GetKey(),t)}SetBlackboardsByConfig(t){if(void 0!==t)for(const i of t){var e=BlackboardMap_1.BlackboardParam.CreateByConfig(i);e&&this.Yre.SetValue(e.GetKey(),e)}}GetBlackboardByKey(t){return this.Yre.GetValue(t)}SetBlackboard(t,e){void 0!==e&&this.Yre.SetValue(t,e)}RemoveBlackboard(t){return this.Yre.RemoveValue(t)}GetPublicTags(){return this.tXr}SetPublicTags(t){this.tXr.length=0;for(const e of t)this.AddPublicTags(e),this.mQt.has(e)||this.mQt.add(e)}AddPublicTags(t){this.ContainsPublicTag(t)||(this.tXr.push(t),this.mQt.has(t))||this.mQt.add(t)}RemovePublicTag(e){for(let t=0;t<this.tXr.length;++t)if(this.tXr[t]===e)return this.tXr.splice(t,1),this.mQt.delete(e),!0;return!1}ClearPublicTags(){this.tXr.length=0}ContainsPublicTag(t){for(const e of this.tXr)if(e===t)return!0;return!1}ContainsTag(t){return this.mQt.has(t)}GetVisible(){return(!this.pXr||!this.vXr)&&this.yne}SetVisible(t){this.yne=t}GetComponentKey(){return this.AXr}SetComponentKey(t){this.AXr=t}GetIsStaticInit(){return this.iXr}SetWeaponSkinId(t){this.XAl=t}GetWeaponSkinId(){return this.XAl}SetIsStaticInit(t){this.iXr=t}SetEntityCommonTags(t){this.EntityCommonTags.clear();for(const e of t)this.EntityCommonTags.add(e)}UpdateEntityCommonTags(t){if(0!==t.length)for(const e of t)this.EntityCommonTags.has(e.m5n)?e.lWn||this.EntityCommonTags.delete(e.m5n):e.lWn&&this.EntityCommonTags.add(e.m5n)}SetModelConfig(t){var e;this.rXr!==t&&(this.rXr=t,(e=DataTableUtil_1.DataTableUtil.GetDataTableRowFromName(0,t.toString()))?this.nXr=e:Log_1.Log.CheckError()&&Log_1.Log.Error("Character",6,"模型配置不存在",["ModelConfigId",t]))}GetModelId(){if(this.GetEntityType()===Protocol_1.Aki.Protocol.kks.Proto_Player){if(this.zZa){var t=this.GetAutoRoleConfig();if(t)return t.ModelId;Log_1.Log.CheckError()&&Log_1.Log.Error("Character",48,"Ai角色缺少配置",["CreatureDataId",this.GetCreatureDataId()],["RoleId",this.dFe])}var t=this.GetRoleConfig(),e=this.GetSkinModelId();return 0<e?e:t?t.MeshId:0}e=this.GetPbModelConfig();return e?e.ModelId:(Log_1.Log.CheckError()&&Log_1.Log.Error("Character",28,"[清理CDT_EntityConfig]该实体没有对应的Pb表信息",["CreatureDataId",this.GetCreatureDataId()],["TidName",this.GetBaseInfo()?.TidName],["PbDataId",this.GetPbDataId()]),0)}GetModelConfig(){if(!this.nXr){let t=void 0;(t=this.dXr?(0,IComponent_1.getComponent)(this.dXr.ComponentsData,"ModelComponent"):t)?this.xXr(t.ModelType):this.nXr=DataTableUtil_1.DataTableUtil.GetDataTableRowFromName(0,this.GetModelId().toString())}return this.nXr}xXr(t){switch(t.Type){case"LevelPrefab":this.nXr=new UE.SModelConfig,this.sXr=IComponent_1.levelPrefabBpPathConfig[t.BlueprintPath],this.nXr.场景交互物=new UE.SoftObjectPath(FNameUtil_1.FNameUtil.GetDynamicFName(t.PrefabPath),"");for(const s of t.PrefabStateList)this.nXr.场景交互物状态列表.Add(GameplayTagUtils_1.GameplayTagUtils.GetGameplayTagById(s.LevelTag),s.SceneInteractionState);for(const r of t.EffectStateList)this.nXr.场景交互物特效列表.Add(GameplayTagUtils_1.GameplayTagUtils.GetGameplayTagById(r.LevelTag),r.SceneInteractionEffectState);break;case"ModelId":this.SetModelConfig(t.ModelId);break;case"Npc":this.nXr=new UE.SModelConfig,this.sXr=t.BlueprintPath;var e=UE.KismetSystemLibrary.MakeSoftClassPath(t.BlueprintPath),e=UE.KismetSystemLibrary.Conv_SoftClassPathToSoftClassRef(e),e=(this.nXr.蓝图=e,UE.KismetSystemLibrary.MakeSoftClassPath(t.Abp)),e=UE.KismetSystemLibrary.Conv_SoftClassPathToSoftClassRef(e);if(this.nXr.动画蓝图=e,t.NpcModel)switch(t.NpcModel.Type){case"Da":var i=UE.KismetSystemLibrary.MakeSoftClassPath(t.NpcModel.Da);this.nXr.DA=i;break;case"Mesh":i=UE.KismetSystemLibrary.MakeSoftObjectPath(t.NpcModel.Mesh),i=UE.KismetSystemLibrary.Conv_SoftObjPathToSoftObjRef(i);this.nXr.网格体=i}if(t.BattleSockets)for(const o of t.BattleSockets)this.nXr.BattleSockets.Add(o);if(t.NormalSockets)for(const n of t.NormalSockets)this.nXr.NormalSockets.Add(n);t.BodyType&&(this.nXr.体型类型=t.BodyType),t.LookingUpAngle&&(this.nXr.注释时的抬升角度=t.LookingUpAngle),t.NameZaxisOffset&&(this.nXr.名字Z偏移=t.NameZaxisOffset)}}GetEntityPropertyConfig(){if(this.t4r)return this.t4r;let t="";this.fie===Protocol_1.Aki.Protocol.kks.Proto_Player?(e=this.GetRoleConfig(),t=e.EntityProperty.toString()):(e=this.GetBaseInfo())?.EntityPropertyId?t=e.EntityPropertyId.toString():Log_1.Log.CheckError()&&Log_1.Log.Error("Character",28,"[清理CDT_EntityConfig]该实体没有对应的Pb表信息EntityPropertyId",["CreatureDataId",this.GetCreatureDataId()],["TidName",e?.TidName],["PbDataId",this.GetPbDataId()]);var e=DataTableUtil_1.DataTableUtil.GetDataTableRowFromName(1,t);if(e)return this.t4r=e,this.t4r;Log_1.Log.CheckError()&&Log_1.Log.Error("Character",3,"[CreatureController.LoadActorByTypeAndId] 不存在实体配置表。",["roleName",t])}GetRemoveState(){return this.ou}SetRemoveState(t){this.ou=t}SetInitLocation(t){this.qne=t}GetInitLocation(){return this.qne}GetInitLinearVelocity(){return this.hXr}GetInitCharacterState(){return this.lXr}Reset(){this.ClearPublicTags(),this.mQt.clear(),this.SetHardnessModeId(0),this.SetPlayerId(0),this.SetVisible(!1),this.Yre.Clear(),this.fie=Protocol_1.Aki.Protocol.kks.Proto_Player,this.nXr=void 0}SetPbDataId(t){this.wDe=t}GetPbDataId(){return this.wDe}SetPrefabId(t){this.vH=t}GetPrefabId(){return this.vH}GetMonsterMatchType(){if(this.dXr){var t=this.GetBaseInfo();if(t)return t.Category.MonsterMatchType;Log_1.Log.CheckError()&&Log_1.Log.Error("Entity",3,"[CreatureData.GetMonsterMatchType] 实体的BaseInfoComponent空。",["PbDataId",this.wDe])}}SetPbDataByProtocol(t){var e=t;if(this.wDe=e.v9n,this.vH=e.LEs,this.mXr=e.iys,this.SetOwnerIncId(MathUtils_1.MathUtils.LongToNumber(e.qr1)),this.XQr===Protocol_1.Aki.Protocol.rLs.Proto_Character)this.SetRoleId(t.v9n);else if(this.XQr!==Protocol_1.Aki.Protocol.rLs.Proto_OldEntity){if(!this.dXr)return Log_1.Log.CheckError()&&Log_1.Log.Error("Entity",3,"[CreatureDataComponent.SetPbDataByProtocol] PbEntityInitData数据为空。",["EntityConfigType",this.XQr],["PbDataId",this.wDe]),!1;if(!this.dXr.ComponentsData)return Log_1.Log.CheckError()&&Log_1.Log.Error("Entity",3,"[CreatureDataComponent.SetPbDataByProtocol] ComponentsData",["EntityConfigType",this.XQr],["PbDataId",this.wDe]),!1;var i=this.GetBaseInfo();if(!i)return Log_1.Log.CheckError()&&Log_1.Log.Error("Entity",3,"[CreatureData.SetPbDataByProtocol] 实体的BaseInfoComponent空。",["EntityConfigType",this.XQr],["PbDataId",this.wDe]),!1;i.Category?.EntityPlotBindingType&&this.AddPublicTags(i.Category.EntityPlotBindingType)}this.SetEntityType(e.zHn),this.SetSubEntityType(e.oys),this.SetPlayerId(e.W5n),this.SetVisible(e.rVn),this.LivingStatus=e.JEs;var i=e.l8n;return this.SetLocation(i),this.SetRotation(e._8n),this.SetDurabilityValue(e.ZEs),this.qne=t.YEs,this.hXr=t.tys,this.lXr=t.eys,"number"==typeof t.nys&&(this._Xr=t.nys),this.wXr(e.zEs),0<e.Or1&&(i=ModelManager_1.ModelManager.RoleSkinModel?.GetRoleSkinData(e.Or1),this.Yql=i?.GetRoleMeshId()??0,this.wIl=e.Or1),!0}wXr(t){this.ComponentDataMap.clear();for(const h of t){var e=h.C3s;switch(this.ComponentDataMap.set(e,h),e){case"sys":this.SetHardnessModeId(h.sys.$Wn);break;case"ays":this.SetEntityCommonTags(h.ays.lIs);break;case"dys":this.SetBlackboardsByProtocol(h.dys.pIs);break;case"pys":this.CXr=h.pys.yIs;break;case"lys":this.SetSummonerId(MathUtils_1.MathUtils.LongToNumber(h.lys.YWn)),this.SetSummonerPlayerId(h.lys.W5n),this.SummonType=h.lys.h5n;break;case"yys":this.PXr(h.yys);break;case"Iys":this.fXr=h.Iys.P5n??1;break;case"Rys":this.RelationId=h.Rys.bIs,this.PbRelationMatchCfgIndex=h.Rys.BIs-1,this.ControllerId=MathUtils_1.MathUtils.LongToNumber(h.Rys.xIs),this.IsShowingHandFx=h.Rys.q5n;break;case"Yys":this.AutonomousId=MathUtils_1.MathUtils.LongToNumber(h.Yys.wIs);break;case"Dys":this.VisionSkillServerEntityId=MathUtils_1.MathUtils.LongToNumber(h.Dys.Z5n),this.RXr.length=0;for(const a of h.Dys.OIs)this.RXr.push(MathUtils_1.MathUtils.LongToNumber(a));this.VisionControlCreatureDataId=MathUtils_1.MathUtils.LongToNumber(h.Dys.kIs);break;case"wys":for(const u of h.wys.FIs)this.OccupiedGridInfo.set(u.iLs,u);for(const l of h.wys.VIs)this.DynamicGridInfo.push(l);this.BoardCanMove=h.wys.to1;break;case"Nys":this.PbInRangeEntityCreatureDataIds=h.Nys.rIs.flatMap(t=>MathUtils_1.MathUtils.LongToNumber(t)),this.PbInRangePlayerIds=h.Nys.iIs;break;case"$ys":var i=h.$ys;this.PbDynAttachEntityConfigId=i.qIs,this.PbDynAttachEntityActorKey=i.GIs,this.PbDynAttachRefActorKey=i._6n,this.PbDynAttachRelPos.Set(i.o6n?.X??0,i.o6n?.Y??0,i.o6n?.Z??0);break;case"Hys":i=h.Hys?.hEs;i&&this.sQt(i);break;case"Vr1":this.zZa=h.Vr1?.Zr1??!1;break;case"Qr1":var s=h.Qr1;this.XAl=s.oo1;break;case"Hr1":s=h.Hr1;this.PbSceneItemAttributeIds=s.ho1;break;case"$r1":var r=h.$r1;this.PbPullingFoundationEntityId=r.bIs;break;case"Xr1":r=h.Xr1;this.PbSceneAiEnabled=r.tWn,this.PbPatrolInfoPb=r.tVn?.co1;break;case"Yr1":var o=h.Yr1;this.PbAnimalInitialPartIds=o.do1;break;case"Kr1":o=h.Kr1;this.PbCombinePartInfoList=o.no1,this.PbCombineTargetServerId=MathUtils_1.MathUtils.LongToNumber(o.TVn);break;case"Jr1":var n=h.Jr1;this.PbHookLockPointDisabled=n.fo1}}}GetPbEntityInitData(){return this.dXr}GetPbModelConfig(){if(this.gXr&&0!==this.gXr.length)return this.ger||(this.ger=ModelManager_1.ModelManager.CreatureModel.GetEntityModel(this.gXr)),this.ger}GetLoading(){return this.Dne}SetLoading(t){this.Dne=t}GetPreloadFinished(){return this.yXr}SetPreloadFinished(t){this.yXr=t}GetEntityCommonTags(){return this.EntityCommonTags}SetLivingStatus(t){this.LivingStatus=t}GetLivingStatus(){return this.LivingStatus}SetEnterComponent(t){this.IXr=t}GetEntityEnterComponentState(){return this.IXr}GetBaseInfo(){return this.EXr||(this.dXr?(this.EXr=(0,IComponent_1.getComponent)(this.dXr.ComponentsData,"BaseInfoComponent"),this.EXr):void 0)}GetMonsterComponent(){if(this.dXr)return(0,IComponent_1.getComponent)(this.dXr.ComponentsData,"MonsterComponent")}GetAttributeComponent(){if(this.dXr)return(0,IComponent_1.getComponent)(this.dXr.ComponentsData,"AttributeComponent")}GetVisionComponent(){if(this.dXr)return(0,IComponent_1.getComponent)(this.dXr.ComponentsData,"VisionComponent")}GetEntityOnlineInteractType(){if(this.GetPbEntityInitData()){var t=this.GetBaseInfo()?.OnlineInteractType;if(void 0!==t)return t}return 1}GetEntityTimeScaleModifyStrategy(){if(this.GetPbEntityInitData()){var t=this.GetBaseInfo()?.TimeScaleModifyStrategy;if(void 0!==t)return t}return 0}GetFightInterConfig(){return this.SXr||(this.dXr?(this.SXr=(0,IComponent_1.getComponent)(this.dXr.ComponentsData,"FightInteractComponent"),this.SXr):void 0)}GetModelComponent(){if(this.dXr)return(0,IComponent_1.getComponent)(this.dXr.ComponentsData,"ModelComponent")}RequestPosAbnormal(){this.mXr=!0;var t=Protocol_1.Aki.Protocol.kes.create();t.F4n=MathUtils_1.MathUtils.NumberToLong(this.Wpo),t.JWn=!0,Net_1.Net.Call(16024,t,()=>{})}IsRealMonster(){var t=this.fie===Protocol_1.Aki.Protocol.kks.Proto_Monster,e=void 0===this.GetMonsterComponent(),i=0===this.GetMonsterComponent()?.FightConfigId;return t&&!e&&!i}IsCharacterMonster(){var t;return void 0===this.vil&&(this.vil=!1,this.IsAutoRole()||this.IsMonster()&&(t=this.GetMonsterComponent()?.FightConfigId)&&(t=MonsterBattleConfById_1.configMonsterBattleConfById.GetConfig(t))&&0<t.RoleMappingId)&&(this.vil=!0),this.vil}IsSummonByCharacterMonster(){var t;return void 0===this.Mil&&(this.Mil=!1,this.IsMonster()&&(t=ModelManager_1.ModelManager.CreatureModel.GetEntity(this.GetSummonerId()))?.Valid&&(t=t.Entity.GetComponent(0))?.Valid&&t.IsCharacterMonster())&&(this.Mil=!0),this.Mil}IsLowFrequencyUpdateStrategy(){return 1===this.EXr?.EntityUpdateStrategy}IsHighFrequencyUpdateStrategy(){return 2===this.EXr?.EntityUpdateStrategy}GetAwakedEntities(){return this.uXr||(this.uXr=[],this.dXr&&this.dXr.Children&&0<this.dXr.Children.length&&this.dXr.Children.forEach(t=>{this.BXr(t)&&this.uXr.push(this.bXr(t))})),this.uXr}bXr(t){var e;return CreatureDataComponent_1.qXr.has(t)?CreatureDataComponent_1.qXr.get(t):(e=t.split("_"),e=parseInt(e[2]),CreatureDataComponent_1.qXr.set(t,e),e)}BXr(t){return"e"===t.split("_")[0]}sQt(t){for(const i of Object.keys(t)){var e=t[i];this.xRn.set(i,e)}}UpdateVar(t,e){this.xRn.set(t,e),EventSystem_1.EventSystem.EmitWithTarget(this.Entity,EventDefine_1.EEventName.EntityVarUpdate,t,e)}nTa(){this.CustomServerEntityIds.forEach(t=>{CreatureController_1.CreatureController.AddBindEntity(t,this.Wpo)}),this.VisionSkillServerEntityId&&CreatureController_1.CreatureController.AddBindEntity(this.VisionSkillServerEntityId,this.Wpo),this.VisionControlCreatureDataId&&CreatureController_1.CreatureController.AddBindEntity(this.VisionControlCreatureDataId,this.Wpo),this.JQr&&CreatureController_1.CreatureController.AddBindEntity(this.Wpo,this.JQr),this.PbCombinePartInfoList&&this.PbCombinePartInfoList.forEach(t=>{CreatureController_1.CreatureController.AddBindEntity(this.Wpo,MathUtils_1.MathUtils.LongToNumber(t.kql))})}GetTemplateId(){return this.d7a?.Id??0}};CreatureDataComponent.qXr=new Map,CreatureDataComponent=CreatureDataComponent_1=__decorate([(0,RegisterComponent_1.RegisterComponent)(0)],CreatureDataComponent),exports.CreatureDataComponent=CreatureDataComponent;
//# sourceMappingURL=CreatureDataComponent.js.map