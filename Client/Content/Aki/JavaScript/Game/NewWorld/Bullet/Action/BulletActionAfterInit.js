
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BulletActionAfterInit=void 0;const UE=require("ue"),Info_1=require("../../../../Core/Common/Info"),Log_1=require("../../../../Core/Common/Log"),Protocol_1=require("../../../../Core/Define/Net/Protocol"),MathUtils_1=require("../../../../Core/Utils/MathUtils"),StringUtils_1=require("../../../../Core/Utils/StringUtils"),EventDefine_1=require("../../../Common/Event/EventDefine"),EventSystem_1=require("../../../Common/Event/EventSystem"),ModelManager_1=require("../../../Manager/ModelManager"),CombatMessage_1=require("../../../Module/CombatMessage/CombatMessage"),BulletConstant_1=require("../BulletConstant"),BulletActionBase_1=require("./BulletActionBase");class BulletActionAfterInit extends BulletActionBase_1.BulletActionBase{OnExecute(){var e,t,o,l,r,a=this.BulletInfo,n=a.BulletDataMain.Execution.SendGameplayEventTagToAttackerOnStart;n&&n.TagName!==StringUtils_1.NONE_STRING&&(e=a.AttackerActorComp?.Actor)?.IsValid()&&((t=new UE.GameplayEventData).OptionalObject=a.Actor,UE.AbilitySystemBlueprintLibrary.SendGameplayEventToActor(e,n,t)),Info_1.Info.IsBuildDevelopmentOrDebug&&EventSystem_1.EventSystem.EmitWithTarget(a.Attacker,EventDefine_1.EEventName.BulletCreate,a),a.IsInit=!0,a.ActionLogicComponent.OnAfterInit(),a.PreContextId=a.BulletInitParams.FromRemote?0n:a.BulletInitParams.ContextId,a.ContextId=a.BulletInitParams.FromRemote?a.BulletInitParams.ContextId:ModelManager_1.ModelManager.CombatMessageModel.GenMessageId(),a.BulletInitParams.FromRemote?BulletConstant_1.BulletConstant.OpenCreateLog&&Log_1.Log.CheckDebug()&&Log_1.Log.Debug("Bullet",18,"创建被同步子弹",["bulletRowName",a.BulletRowName]):(e={rVn:a.BulletEntityId,q5n:ModelManager_1.ModelManager.CreatureModel.GetPlayerId()},ModelManager_1.ModelManager.BulletModel.RegisterBullet(e,a.BulletEntityId),n=1!==a.BulletInitParams.SyncType,t=ModelManager_1.ModelManager.CreatureModel.GetCreatureDataId(a.TargetId),o=a.GetActorLocation(),l=a.MoveInfo.BeginSpeedRotator,(r=Protocol_1.Aki.Protocol.p3n.create()).iVn=e,r.ujn=MathUtils_1.MathUtils.NumberToLong(Number(a.BulletRowName)),r.X4n=a.BulletInitParams.SkillId,r.y5n=o,r.a8n=l,r.cjn=ModelManager_1.ModelManager.BulletModel.GetBulletHandleById(a.BulletInitParams.ParentId),r.mjn=MathUtils_1.MathUtils.NumberToLong(ModelManager_1.ModelManager.CreatureModel.GetCreatureDataId(a.BulletInitParams.BaseTransformId)),r.djn=MathUtils_1.MathUtils.NumberToLong(ModelManager_1.ModelManager.CreatureModel.GetCreatureDataId(a.BulletInitParams.BaseVelocityId)),r.sVn=MathUtils_1.MathUtils.NumberToLong(t),r.Cjn=n,r.gjn=a.BulletInitParams.DtType,r.fjn=a.RandomPosOffset,r.pjn=a.RandomInitSpeedOffset,this.Yea(r),CombatMessage_1.CombatNet.Call(18139,a.Attacker,r,e=>{},a.PreContextId,a.ContextId),BulletConstant_1.BulletConstant.OpenCreateLog&&(n?Log_1.Log.CheckDebug()&&Log_1.Log.Debug("Bullet",18,"创建本地子弹",["bulletRowName",a.BulletRowName]):Log_1.Log.CheckDebug()&&Log_1.Log.Debug("Bullet",18,"创建同步子弹",["bulletRowName",a.BulletRowName],["skillId",a.BulletInitParams.SkillId],["handleId",e.rVn],["playerId",e.q5n],["Location",o],["Rotation",l],["TargetId",t])))}Yea(e){ModelManager_1.ModelManager.GameModeModel.IsMulti||(e.y5n=void 0,e.a8n=void 0,e.cjn=void 0,e.djn=0,e.gjn=0,e.fjn=void 0,e.pjn=void 0)}}exports.BulletActionAfterInit=BulletActionAfterInit;
//# sourceMappingURL=BulletActionAfterInit.js.map