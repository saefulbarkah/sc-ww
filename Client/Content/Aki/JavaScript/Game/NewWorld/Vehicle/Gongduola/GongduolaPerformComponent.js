
"use strict";var __decorate=this&&this.__decorate||function(t,i,e,s){var h,o=arguments.length,r=o<3?i:null===s?s=Object.getOwnPropertyDescriptor(i,e):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,i,e,s);else for(var n=t.length-1;0<=n;n--)(h=t[n])&&(r=(o<3?h(r):3<o?h(i,e,r):h(i,e))||r);return 3<o&&r&&Object.defineProperty(i,e,r),r};Object.defineProperty(exports,"__esModule",{value:!0}),exports.GongduolaPerformComponent=void 0;const UE=require("ue"),Log_1=require("../../../../Core/Common/Log"),RegisterComponent_1=require("../../../../Core/Entity/RegisterComponent"),ResourceSystem_1=require("../../../../Core/Resource/ResourceSystem"),TimerSystem_1=require("../../../../Core/Timer/TimerSystem"),IComponent_1=require("../../../../UniverseEditor/Interface/IComponent"),VehiclePerformComponent_1=require("../Common/VehiclePerformComponent"),DEFAULT_SPRINT_DURATION=5e3,CATAPULT_TO_AIR_SPEED=3e3,CATAPULT_TO_AIR_ACCELERATION_SECONDS=.6,PARAGLIDING_DELAY_MILISECONDS=500;class GongduolaMoveConfig{constructor(t){this.MaxForwardSpeed=0,this.MaxSprintSpeed=0,this.MaxBackwardSpeed=0,this.AccelerationCurve=void 0,this.RotAccAngleCoef=0,this.RotAccSpeedCoef=0,this.RotAccConstCoef=0,this.BaseAcceleration=0,this.SprintAcceleration=0,this.SprintDuration=0,this.MinFriction=0,this.MaxFriction=0,this.ExtraFrictionWhenExceedMaxSpeed=0,this.MaxRotationSpeed=0,this.RotFrictionFactor=0,this.StaticRotFriction=0,this.RotaryIntertia=0,this.SpeedImpactFactor=0,this.RotationImpactFactor=0,this.MaxForwardSpeed=t.前进最大移动速度,this.MaxSprintSpeed=t.冲刺最大移动速度,this.MaxBackwardSpeed=t.后退最大移动速度,this.AccelerationCurve=t.加速度曲线,this.RotAccAngleCoef=t.转向公式角度修正系数,this.RotAccSpeedCoef=t.转向公式速度修正系数,this.RotAccConstCoef=t.转向公式最终修正系数,this.BaseAcceleration=t.临时_常态加速度,this.SprintAcceleration=t.临时_冲刺加速度,this.SprintDuration=t.冲刺持续时间,this.MinFriction=t.径向运动摩擦力,this.MaxFriction=t.横向运动摩擦力,this.ExtraFrictionWhenExceedMaxSpeed=t.超出最大速度时的额外摩擦力,this.MaxRotationSpeed=t.最大转向速度,this.RotFrictionFactor=t.转向摩擦力系数,this.StaticRotFriction=t.转向静止摩擦力,this.RotaryIntertia=t.转动惯量,this.SpeedImpactFactor=t.速度冲击力系数,this.RotationImpactFactor=t.旋转冲击力系数}InitGongduolaMovement(t){t.MaxAcceleration=this.BaseAcceleration,t.MaxSpeed=this.MaxForwardSpeed,t.MaxBackwardSpeed=this.MaxBackwardSpeed,t.RotAccAngleCoef=this.RotAccAngleCoef,t.RotAccSpeedCoef=this.RotAccSpeedCoef,t.RotAccConstCoef=this.RotAccConstCoef,t.MinFriction=this.MinFriction,t.MaxFriction=this.MaxFriction,t.ExtraFrictionWhenExceedMaxSpeed=this.ExtraFrictionWhenExceedMaxSpeed,t.MaxRotationSpeed=this.MaxRotationSpeed,t.RotFrictionFactor=this.RotFrictionFactor,t.StaticRotFriction=this.StaticRotFriction,t.RotaryInertia=this.RotaryIntertia,t.SpeedImpactFactor=this.SpeedImpactFactor,t.RotationImpactFactor=this.RotationImpactFactor}}let GongduolaPerformComponent=class GongduolaPerformComponent extends VehiclePerformComponent_1.VehiclePerformComponent{constructor(){super(...arguments),this.MoveParams=void 0,this.IsSprint=!1,this.SprintEclapseTime=0,this.SprintDuration=0,this.LeaveVehicleParaglidingHandler=0,this.OnEnterHitCollision=(t,i,e,s,h)=>{this.CalculateImpactStrength(h),this.CalculateImpactDirection(h),this.IsBeingImpacted=!0,Log_1.Log.CheckDebug()&&Log_1.Log.Debug("Vehicle",50,"载具发生碰撞",["HitComp",t?.GetName()],["OtherActor",i?.GetName()],["OtherComp",e?.GetName()],["ImpactNormal",h.ImpactNormal])}}OnInitData(t){return!0}OnInit(t){return!0}OnStart(){return super.OnStart(),!!this.InitMoveParams()}OnActivate(){this.ActorComp.Actor.VehicleMovementComponent.SetMovementMode(2)}OnTick(t){this.UpdateSprintState(t)}OnEnd(){for(const t of this.PassengerInfoMap.values())this.OnLeaveVehicle(t);return!0}OnClear(){return!0}OnDisable(t){}OnEnable(){}InitMoveParams(){var t;return!!this.ActorComp?.Actor.VehicleMovementComponent?.IsValid()&&!!(t=this.ActorComp?.CreatureData.GetPbEntityInitData())?.ComponentsData&&!(!(t=(0,IComponent_1.getComponent)(t.ComponentsData,"VehicleComponent"))||""===t.Config||"None"===t.Config||!(t=ResourceSystem_1.ResourceSystem.Load(t.Config,UE.BP_VehicleConfig_C))?.IsValid()||(this.MoveParams=new GongduolaMoveConfig(t),this.MoveParams.InitGongduolaMovement(this.ActorComp.Actor.VehicleMovementComponent),0))}OnEnterVehicle(t){var i=t.PassengerEntity;i.GetComponent(213)?.EnterVehicle(t)&&(this.EnterVehiclePerform(t),i=i.GetComponent(2),this.ActorComp.Actor.IgnoreActorWhenMoving(i.Actor,!0,!0),this.TakeOverPassengerControl(t))}OnLeaveVehicle(t){var i=t.PassengerEntity;(i?.GetComponent(213))?.LeaveVehicle(t)&&(this.LeaveVehiclePerform(t),i=i.GetComponent(2),this.ActorComp.Actor.IgnoreActorWhenMoving(i.Actor,!1,!0),this.RestorePassengerControl(t))}TakeOverPassengerControl(t){t.IsDriver&&this.InputComp.OnEnterVehicle();t=t.PassengerEntity?.GetComponent(191);t?.AddTag(-541178966),t?.AddTag(1616400338),t?.AddTag(-469423249),t?.AddTag(766688429),t?.AddTag(-542518289),t?.AddTag(581080458),t?.AddTag(-1802431900),t?.AddTag(-1752099043),t?.AddTag(-732810197),t?.AddTag(-1216591977),t?.AddTag(-1199814358),t?.AddTag(-1183036739),t?.AddTag(-2140742267),t?.AddTag(-1013832153)}RestorePassengerControl(t){t.IsDriver&&(this.InputComp.OnLeaveVehicle(),this.ActorComp.ClearInput());t=t.PassengerEntity?.GetComponent(191);t?.RemoveTag(-541178966),t?.RemoveTag(1616400338),t?.RemoveTag(-469423249),t?.RemoveTag(766688429),t?.RemoveTag(-542518289),t?.RemoveTag(581080458),t?.RemoveTag(-1802431900),t?.RemoveTag(-1752099043),t?.RemoveTag(-732810197),t?.RemoveTag(-1216591977),t?.RemoveTag(-1199814358),t?.RemoveTag(-1183036739),t?.RemoveTag(-2140742267),t?.RemoveTag(-1013832153)}StartSprint(){Log_1.Log.CheckDebug()&&Log_1.Log.Debug("Vehicle",50,"StartSprint",["PbDataId",this.ActorComp?.CreatureData.GetPbDataId()],["EclapseTime",this.SprintEclapseTime],["Duration",this.SprintDuration]),this.IsSprint||this.TagComp?.AddTag(1646668090),this.IsSprint=!0,this.SprintDuration=(this.MoveParams?.SprintDuration??DEFAULT_SPRINT_DURATION)+this.SprintEclapseTime,this.ActorComp.Actor.VehicleMovementComponent.MaxAcceleration=this.MoveParams.SprintAcceleration,this.ActorComp.Actor.VehicleMovementComponent.MaxSpeed=this.MoveParams.MaxSprintSpeed}EndSprint(){Log_1.Log.CheckDebug()&&Log_1.Log.Debug("Vehicle",50,"EndSprint",["PbDataId",this.ActorComp?.CreatureData.GetPbDataId()],["EclapseTime",this.SprintEclapseTime],["Duration",this.SprintDuration]),this.IsSprint=!1,this.SprintDuration=0,this.SprintEclapseTime=0,this.TagComp?.RemoveTag(1646668090),this.ActorComp.Actor.VehicleMovementComponent.MaxAcceleration=this.MoveParams.BaseAcceleration,this.ActorComp.Actor.VehicleMovementComponent.MaxSpeed=this.MoveParams.MaxForwardSpeed}UpdateSprintState(t){this.IsSprint&&(this.SprintEclapseTime+=t,this.SprintEclapseTime>=this.SprintDuration)&&this.EndSprint()}LeaveVehiclePerform(t){this.JumpToAirAndParagliding(t)}JumpToAirAndParagliding(t){var i=t.PassengerEntity?.GetComponent(2);if(i){i.Actor.CharacterMovement?.SetMovementMode(3);const e=t.PassengerEntity?.GetComponent(164);e&&(e.GravityUp.Multiply(CATAPULT_TO_AIR_SPEED,this.TmpVector1),this.LeaveVehicleParaglidingHandler=e.SetAddMoveWorld(this.TmpVector1.ToUeVector(),CATAPULT_TO_AIR_ACCELERATION_SECONDS,void 0,this.LeaveVehicleParaglidingHandler,void 0,1),TimerSystem_1.TimerSystem.Delay(()=>{e?.TrySetGlide(),this.LeaveVehicleParaglidingHandler=0},PARAGLIDING_DELAY_MILISECONDS))}}};GongduolaPerformComponent=__decorate([(0,RegisterComponent_1.RegisterComponent)(221)],GongduolaPerformComponent),exports.GongduolaPerformComponent=GongduolaPerformComponent;
//# sourceMappingURL=GongduolaPerformComponent.js.map