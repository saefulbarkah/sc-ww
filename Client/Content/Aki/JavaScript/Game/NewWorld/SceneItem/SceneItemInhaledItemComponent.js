
"use strict";var SceneItemInhaledItemComponent_1,__decorate=this&&this.__decorate||function(t,e,i,s){var o,n=arguments.length,h=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;0<=r;r--)(o=t[r])&&(h=(n<3?o(h):3<n?o(e,i,h):o(e,i))||h);return 3<n&&h&&Object.defineProperty(e,i,h),h};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SceneItemInhaledItemComponent=void 0;const Log_1=require("../../../Core/Common/Log"),Protocol_1=require("../../../Core/Define/Net/Protocol"),EntityComponent_1=require("../../../Core/Entity/EntityComponent"),RegisterComponent_1=require("../../../Core/Entity/RegisterComponent"),Net_1=require("../../../Core/Net/Net"),TimerSystem_1=require("../../../Core/Timer/TimerSystem"),MathUtils_1=require("../../../Core/Utils/MathUtils"),EventDefine_1=require("../../Common/Event/EventDefine"),EventSystem_1=require("../../Common/Event/EventSystem"),TimeUtil_1=require("../../Common/TimeUtil"),ControllerHolder_1=require("../../Manager/ControllerHolder"),ModelManager_1=require("../../Manager/ModelManager"),SENSORY_RANGE=3e3,performanceStateTag=new Map([[0,1854980392],[1,-600747586],[2,213628921],[3,1534204131]]);let SceneItemInhaledItemComponent=SceneItemInhaledItemComponent_1=class SceneItemInhaledItemComponent extends EntityComponent_1.EntityComponent{constructor(){super(...arguments),this.Lo=void 0,this.Lie=void 0,this.Hte=void 0,this.etl=-1,this.ttl=-1,this.Rne=-1,this.ac=0,this.UTl=5,this.i_l=-1,this.wmo=-1,this.r_l=-1,this.tAl=void 0,this.iAl=-1,this.IsInCooldown=!1,this.g_n=(t,e)=>{this.DTl()}}get IsHaling(){return 0!==this.ac}get InhaledStrength(){return this.Lo?.InhaledStrength}get ATl(){return this.UTl}set ATl(t){var e;this.UTl!==t&&(void 0!==(e=performanceStateTag.get(this.UTl))&&this.Lie?.RemoveTag(e),this.UTl=t,void 0!==(e=performanceStateTag.get(this.UTl)))&&this.Lie?.AddTag(e)}OnInitData(t){t=t.GetParam(SceneItemInhaledItemComponent_1)[0];return this.Lo=t,this.etl=this.Lo.InhaledPerformance.InhaledTime*TimeUtil_1.TimeUtil.InverseMillisecond,this.Lo.InhaledInterruptionRecoveryTime&&(this.iAl=this.Lo.InhaledInterruptionRecoveryTime*TimeUtil_1.TimeUtil.InverseMillisecond),!0}OnStart(){this.Lie=this.Entity.GetComponent(194),this.Hte=this.Entity.GetComponent(191),this.Rne=this.Disable("SceneItemInhaledItemComponent 默认关闭Tick");this.Entity.GetComponent(110).SetLogicRange(SENSORY_RANGE),EventSystem_1.EventSystem.AddWithTarget(this.Entity,EventDefine_1.EEventName.OnSceneItemStateChange,this.g_n);var t=this.Hte.CreatureData.GetBaseInfo();switch(t.Category.InhaledItemType){case"LonelyDollPollutant":this.Lie.AddTag(36602954);break;case"LonelyDollPinkPollutant":this.Lie.AddTag(-422907888);break;case"LonelyDollRedPollutant":this.Lie.AddTag(-368786161)}return this.DTl(),!0}OnTick(t){switch(this.ac){case 0:break;case 1:this.itl(t)}}itl(t){-1===this.ttl?this.ttl=t:this.ttl+=t,this.ttl>=this.etl&&(this.StopInhalation(!1),this.rtl())}StartInhalation(t){if(0===this.ac){this.ac=1,this.Enable(this.Rne,"SceneItemInhaledItemComponent 开始吸入"),this.Rne=-1,this.Lie?.AddTag(-729639866),this.DTl();var e=t.GetComponent(0);if(void 0!==e)switch(e.GetEntityType()){case Protocol_1.Aki.Protocol.kks.Proto_SceneItem:this.i_l=e.GetCreatureDataId(),this.wmo=0,this.r_l=0;break;case Protocol_1.Aki.Protocol.kks.Proto_Player:this.i_l=0,this.wmo=t.GetComponent(35)?.CurrentSkill?.SkillId??-1,this.r_l=1}}}StopInhalation(t=!0){0!==this.ac&&(this.ac=0,this.Rne=this.Disable("sceneItemInhaledItemComponent 停止吸入"),this.Lie?.RemoveTag(-729639866),t&&(this.DTl(),this.rAl()),this.ttl=-1)}rAl(){void 0!==this.tAl&&TimerSystem_1.TimerSystem.Remove(this.tAl),this.iAl<=0||(this.IsInCooldown=!0,this.tAl=TimerSystem_1.TimerSystem.Delay(()=>{this.IsInCooldown=!1,this.tAl=void 0},this.iAl))}rtl(){var t;this.i_l<0||this.wmo<0||this.r_l<0||((t=Protocol_1.Aki.Protocol.nzl.create()).uhh=ModelManager_1.ModelManager.GameModeModel.IsMulti?ModelManager_1.ModelManager.OnlineModel.OwnerId:ModelManager_1.ModelManager.CreatureModel.GetPlayerId(),t.h5n=this.r_l,t.o_l=MathUtils_1.MathUtils.NumberToLong(this.i_l),t.r5n=this.wmo,t.n_l=[MathUtils_1.MathUtils.NumberToLong(this.Hte.CreatureData.GetCreatureDataId())],Net_1.Net.Call(27307,t,t=>{t?.Q4n!==Protocol_1.Aki.Protocol.Q4n.KRs&&ControllerHolder_1.ControllerHolder.ErrorCodeController.OpenErrorCodeTipView(t.Q4n,16086)}),Log_1.Log.CheckInfo()&&Log_1.Log.Info("Temp",31,"成功吸取污染物"))}DTl(){var t=this.IsHaling;this.Lie?.HasTag(-1152559349)?this.ATl=t?2:0:this.Lie?.HasTag(-3775711)?this.ATl=t?3:1:this.Lie?.HasTag(-1278190765)&&(this.ATl=4)}};SceneItemInhaledItemComponent=SceneItemInhaledItemComponent_1=__decorate([(0,RegisterComponent_1.RegisterComponent)(246)],SceneItemInhaledItemComponent),exports.SceneItemInhaledItemComponent=SceneItemInhaledItemComponent;
//# sourceMappingURL=SceneItemInhaledItemComponent.js.map